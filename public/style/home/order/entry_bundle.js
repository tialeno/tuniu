!function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="http:/img1.tuniucdn.com/site/js/bookOnline/webpack/dest/tour_order2",__webpack_require__(0)}([function(module,exports,__webpack_require__){__webpack_require__(1),__webpack_require__(3),__webpack_require__(4);var eventBus=__webpack_require__(5),config=__webpack_require__(6),pageEvent=__webpack_require__(12);eventBus.addMiddleware(__webpack_require__(157)(config)),eventBus.bind(pageEvent),eventBus.trigger("firstInit"),eventBus.trigger("asyncInit")},function(module,exports,__webpack_require__){module.exports=__webpack_require__(2)(7)},function(module,exports){module.exports=webpack_dll_libs},function(module,exports,__webpack_require__){module.exports=__webpack_require__(2)(6)},function(module,exports,__webpack_require__){module.exports=__webpack_require__(2)(5)},function(module,exports,__webpack_require__){module.exports=__webpack_require__(2)(9)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7),__webpack_require__(8),__webpack_require__(9),__webpack_require__(10),__webpack_require__(11)],__WEBPACK_AMD_DEFINE_RESULT__=function(template,_,backbone,json2,constant){window.console=window.console||{log:function(){}};var pageDataObj,isLogin;pageDataObj=window.pageCurrentData,isLogin={status:pageDataObj.isLogin||!1},_.indexOf(constant.TRAIN_PRO_MODE,pageDataObj.proMode)!=-1?(pageDataObj.normalChildPrice=pageDataObj.childPrice,pageDataObj.freeChildPrice=pageDataObj.childPrice-(pageDataObj.trainTrafficFee&&pageDataObj.trainTrafficFee.normalChildPrice||0),pageDataObj.childNum=pageDataObj.normalChildNum+pageDataObj.freeChildNum):3!==pageDataObj.proMode&&13!==pageDataObj.proMode||(pageDataObj.normalChildPrice=pageDataObj.childPrice),pageDataObj.customerCertificate&&pageDataObj.customerCertificate.length?pageDataObj.defaultTickerCardType=pageDataObj.customerCertificate[0].value:(pageDataObj.customerCertificate=pageDataObj.cardTypeList,pageDataObj.defaultTickerCardType=pageDataObj.defaultCardType),pageDataObj.hasAirResource?(backbone.app.set("minChildAge",2),backbone.app.set("maxChildAge",12)):(backbone.app.set("minChildAge",0),backbone.app.set("maxChildAge",18)),backbone.app.set("isFlightV2",pageDataObj.isInternational&&"tour_order2"==pageDataObj.pageType||pageDataObj.flightInternationalNormal&&"self_tour2"==pageDataObj.pageType),backbone.app.set("changeFlightCheckRule",!0),window.pageDataObj=pageDataObj;var tksHost=pageDataObj.tksHost;return{isLogin:isLogin,pageDataObj:pageDataObj,tksHost:tksHost}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;/*!art-template - Template Engine | http://aui.github.com/artTemplate/*/
!function(){function a(a){return a.replace(t,"").replace(u,",").replace(v,"").replace(w,"").replace(x,"").split(y)}function b(a){return"'"+a.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function c(c,d){function e(a){return m+=a.split(/\n/).length-1,k&&(a=a.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")),a&&(a=s[1]+b(a)+s[2]+"\n"),a}function f(b){var c=m;if(j?b=j(b,d):g&&(b=b.replace(/\n/g,function(){return m++,"$line="+m+";"})),0===b.indexOf("=")){var e=l&&!/^=[=#]/.test(b);if(b=b.replace(/^=[=#]?|[\s;]*$/g,""),e){var f=b.replace(/\s*\([^\)]+\)/,"");n[f]||/^(include|print)$/.test(f)||(b="$escape("+b+")")}else b="$string("+b+")";b=s[1]+b+s[2]}return g&&(b="$line="+c+";"+b),r(a(b),function(a){if(a&&!p[a]){var b;b="print"===a?u:"include"===a?v:n[a]?"$utils."+a:o[a]?"$helpers."+a:"$data."+a,w+=a+"="+b+",",p[a]=!0}}),b+"\n"}var g=d.debug,h=d.openTag,i=d.closeTag,j=d.parser,k=d.compress,l=d.escape,m=1,p={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},q="".trim,s=q?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],t=q?"$out+=text;return $out;":"$out.push(text);",u="function(){var text=''.concat.apply('',arguments);"+t+"}",v="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+t+"}",w="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(g?"$line=0,":""),x=s[0],y="return new String("+s[3]+");";r(c.split(h),function(a){a=a.split(i);var b=a[0],c=a[1];1===a.length?x+=e(b):(x+=f(b),c&&(x+=e(c)))});var z=w+x+y;g&&(z="try{"+z+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+b(c)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var A=new Function("$data","$filename",z);return A.prototype=n,A}catch(B){throw B.temp="function anonymous($data,$filename) {"+z+"}",B}}var d=function(a,b){return"string"==typeof b?q(b,{filename:a}):g(a,b)};d.version="3.0.0",d.config=function(a,b){e[a]=b};var e=d.defaults={openTag:"<%",closeTag:"%>",escape:!0,cache:!0,compress:!1,parser:null},f=d.cache={};d.render=function(a,b){return q(a,b)};var g=d.renderFile=function(a,b){var c=d.get(a)||p({filename:a,name:"Render Error",message:"Template not found"});return b?c(b):c};d.get=function(a){var b;if(f[a])b=f[a];else if("object"==typeof document){var c=document.getElementById(a);if(c){var d=(c.value||c.innerHTML).replace(/^\s*|\s*$/g,"");b=q(d,{filename:a})}}return b};var h=function(a,b){return"string"!=typeof a&&(b=typeof a,"number"===b?a+="":a="function"===b?h(a.call(a)):""),a},i={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},j=function(a){return i[a]},k=function(a){return h(a).replace(/&(?![\w#]+;)|[<>"']/g,j)},l=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},m=function(a,b){var c,d;if(l(a))for(c=0,d=a.length;d>c;c++)b.call(a,a[c],c,a);else for(c in a)b.call(a,a[c],c)},n=d.utils={$helpers:{},$include:g,$string:h,$escape:k,$each:m};d.helper=function(a,b){o[a]=b};var o=d.helpers=n.$helpers;d.onerror=function(a){var b="Template Error\n\n";for(var c in a)b+="<"+c+">\n"+a[c]+"\n\n";"object"==typeof console&&console.error(b)};var p=function(a){return d.onerror(a),function(){return"{Template Error}"}},q=d.compile=function(a,b){function d(c){try{return new i(c,h)+""}catch(d){return b.debug?p(d)():(b.debug=!0,q(a,b)(c))}}b=b||{};for(var g in e)void 0===b[g]&&(b[g]=e[g]);var h=b.filename;try{var i=c(a,b)}catch(j){return j.filename=h||"anonymous",j.name="Syntax Error",p(j)}return d.prototype=i.prototype,d.toString=function(){return i.toString()},h&&b.cache&&(f[h]=d),d},r=n.$each,s="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",t=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,u=/[^\w$]+/g,v=new RegExp(["\\b"+s.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),w=/^\d[^,]*|,\d[^,]*/g,x=/^,+|,+$/g,y=/^$|,+/;__WEBPACK_AMD_DEFINE_RESULT__=function(){return d}.call(exports,__webpack_require__,exports,module),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}()},function(module,exports,__webpack_require__){module.exports=__webpack_require__(2)(4)},function(module,exports,__webpack_require__){module.exports=__webpack_require__(2)(3)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){"use strict";function f(n){return n<10?"0"+n:n}function this_value(){return this.valueOf()}function quote(string){return rx_escapable.lastIndex=0,rx_escapable.test(string)?'"'+string.replace(rx_escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key];switch(value&&"object"==typeof value&&"function"==typeof value.toJSON&&(value=value.toJSON(key)),"function"==typeof rep&&(value=rep.call(holder,key,value)),typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";if(gap+=indent,partial=[],"[object Array]"===Object.prototype.toString.apply(value)){for(length=value.length,i=0;i<length;i+=1)partial[i]=str(i,value)||"null";return v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&"object"==typeof rep)for(length=rep.length,i=0;i<length;i+=1)"string"==typeof rep[i]&&(k=rep[i],v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v));else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v));return v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}"object"!=typeof JSON&&(JSON={});var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;return"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(value,replacer,space){var i;if(gap="",indent="","number"==typeof space)for(i=0;i<space;i+=1)indent+=" ";else"string"==typeof space&&(indent=space);if(rep=replacer,replacer&&"function"!=typeof replacer&&("object"!=typeof replacer||"number"!=typeof replacer.length))throw new Error("JSON.stringify");return str("",{"":value})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}),JSON}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports){module.exports={INDEX_IN_CHINESE:["一","二","三","四","五","六","七","八","九","十"],GO_BACK_IN_CHINESE:["去","返"],SEAT_MAP:["商务座","特等座","一等座","二等座","高级软卧","软卧","硬卧","软座","硬座","无座"],LEVEL_MAP:{0:{des:"",star:0},4:{des:"二星级",star:2},7:{des:"经济型",star:2},3:{des:"三星级",star:3},6:{des:"舒适型",star:3},2:{des:"四星级",star:4},8:{des:"高档型",star:4},1:{des:"五星级",star:5},5:{des:"豪华型",star:5}},BREAKFAST_MAP:{0:"无早",1:"单早",2:"双早"},MAX_FILTER_COUNT:3,MAX_FLOAT_PANEL_HEIGHT:830,ADDITION_TYPE:[{code:"jtjb",name:"交通接驳",type:1},{code:"ggy",name:"观光游",type:2},{code:"xxhd",name:"休闲活动",type:3},{code:"ggfw",name:"过关服务",type:4},{code:"qk",name:"券卡",type:5},{code:"dyfw",name:"导游服务",type:6},{code:"asgg",name:"岸上观光",type:7},{code:"gwf",name:"港务费",type:8},{code:"nwx",name:"牛无线",type:9},{code:"crjc",name:"成人加床",type:10},{code:"etjc",name:"儿童加床",type:11},{code:"dfc",name:"单房差",type:12},{code:"ddy",name:"当地游",type:13},{code:"hplp",name:"婚拍旅拍",type:14},{code:"qz",name:"签证",type:110},{code:"mp",name:"门票",type:111},{code:"ddwl",name:"当地玩乐",type:112}],ROOM_PICTURES_COUNT:4,ROOM_PICTURES_COUNT_DETAIL:5,HOTEL_FACILITY_ICON:{5:"",6:"T_wbdh",7:"T_zzxly",8:"T_xlcffw",9:"T_mftcc",10:"",11:"T_qtgzwpbxg",12:"T_ywxswdggqy",13:"",14:"T_pwfw",15:"T_yzfw",16:"",17:"T_hyt",246:"",247:"",20:"T_zct",21:"T_xct",22:"T_cft",23:"",24:"",25:"",245:"T_jdct",27:"",28:"",29:"",30:"",31:"",32:"",33:"",34:"",35:"",36:"",37:"",38:"",39:"",40:"",41:"",42:"T_swyyc",43:"",44:"",58:"T_gnctdh",59:"T_gjctdh",60:"T_mfycxxsyp",61:"",62:"",63:"T_ycxtx",64:"",65:"T_cfj",66:"T_yy",67:"T_ydyyb",68:"T_mfpzs",69:"T_zykt",70:"",71:"",72:"T_bxx",73:"",74:"T_znly",75:"T_24xsrs",76:"",77:"T_drsh",78:"T_220vdycz",79:"T_dzggdycz",80:"",81:"T_yds",82:"",89:"T_yht",90:"",244:"T_swzx",92:"",93:"",242:"T_mfwifi",243:""},MAX_ROOM_COUNT:3,NEW_ARCHITECTURE_INCLUDE:["tour_order2","self_tour2","cruise2","drive_order2","drive_routine2"],COMPOSITION_EVENT_NAME:"alreadyInput",TRAIN_PRO_MODE:[2,6,15]}},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(8),__webpack_require__(6),__webpack_require__(15),__webpack_require__(19),__webpack_require__(21),__webpack_require__(149),__webpack_require__(150),__webpack_require__(13),__webpack_require__(151),__webpack_require__(5),__webpack_require__(16),__webpack_require__(152),__webpack_require__(153),__webpack_require__(154),__webpack_require__(155)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,_,config,helpers,container,modules,pageAjax,handelError,Summary,Livechat,eventBus,tools,animation,showMore,compositionEvent,outer){var pageEvent,models=modules.models,views=modules.views,pageDataObj=config.pageDataObj,priceCalculateModel=models.priceCalculate,productModel=models.product,deliveryAirData={},changeFlightCheckRule=Backbone.app.get("changeFlightCheckRule");return pageEvent={firstInit:function(){var error=new handelError;error.checkOrderData(productModel.getOrderData()),eventBus.trigger("touristNumChange"),eventBus.trigger("initBusPlace"),eventBus.trigger("initPassenger"),eventBus.trigger("initReceiptInfo"),eventBus.trigger("initVisaMaterial"),eventBus.trigger("changeAddBudget"),eventBus.trigger("changeInsurance"),models.contact.setCrm(pageDataObj),new Summary,new Livechat,animation.watchScroll({moduleClass:"modular"}),animation.watchFooter(),showMore.init(),window.PERFORMANCE&&window.d&&(window.PERFORMANCE.r=(new Date).getTime()-window.d.getTime())},"firstInit:self_tour2":function(){var error=new handelError;error.checkOrderData(productModel.getOrderData()),eventBus.trigger("touristNumChange"),eventBus.trigger("calculateTrafficPrice"),eventBus.trigger("initHotel"),eventBus.trigger("initPackage"),eventBus.trigger("initAddition"),eventBus.trigger("initPassenger"),eventBus.trigger("initReceiptInfo"),eventBus.trigger("initVisaMaterial"),eventBus.trigger("changeInsurance"),new Summary,new Livechat,animation.watchScroll({moduleClass:"modular"}),animation.watchFooter(),showMore.init(),window.PERFORMANCE&&window.d&&(window.PERFORMANCE.r=(new Date).getTime()-window.d.getTime())},"firstInit:cruise2":function(){var error=new handelError;error.checkOrderData(productModel.getOrderData()),eventBus.trigger("touristNumChange"),eventBus.trigger("initReceiptInfo"),eventBus.trigger("changeInsurance"),models.contact.setCrm(pageDataObj),new Summary,new Livechat,animation.watchScroll({moduleClass:"modular"}),animation.watchFooter(),showMore.init(),window.PERFORMANCE&&window.d&&(window.PERFORMANCE.r=(new Date).getTime()-window.d.getTime())},"firstInit:drive_routine2":function(){var error=new handelError;error.checkOrderData(productModel.getOrderData()),eventBus.trigger("touristNumChange"),eventBus.trigger("initHotel"),eventBus.trigger("initAddition"),eventBus.trigger("initPassenger"),eventBus.trigger("initReceiptInfo"),eventBus.trigger("initVisaMaterial"),eventBus.trigger("changeInsurance"),new Summary,new Livechat,animation.watchScroll({moduleClass:"modular"}),animation.watchFooter(),showMore.init(),window.PERFORMANCE&&window.d&&(window.PERFORMANCE.r=(new Date).getTime()-window.d.getTime())},asyncInit:function(){eventBus.trigger("ifReOrder"),eventBus.trigger("refreshInsurance"),eventBus.trigger("getCommonReceiptInfo"),eventBus.trigger("getDeliveryAddress"),eventBus.trigger("getAddition"),eventBus.trigger("getTransPort"),1===pageDataObj.proMode?(eventBus.trigger("getMultiTransport",{isInit:!0}),eventBus.trigger("getDefaultTransport"),eventBus.trigger("setDefaultTransport",1,[])):3===pageDataObj.proMode?eventBus.trigger("getDefaultBus"):2===pageDataObj.proMode?eventBus.trigger("getDefaultTrain"):7===pageDataObj.proMode?eventBus.trigger("defaultAirplane",{isRefresh:0}):17===pageDataObj.proMode&&(eventBus.trigger("getDefaultTrain"),eventBus.trigger("defaultAirplane",{isRefresh:0})),eventBus.trigger("getDefaultHotel"),eventBus.trigger("initContract")},"asyncInit:self_tour2":function(){eventBus.trigger("ifReOrder"),eventBus.trigger("refreshInsurance"),eventBus.trigger("getDeliveryAddress"),eventBus.trigger("initContract")},"asyncInit:cruise2":function(){eventBus.trigger("ifReOrder"),eventBus.trigger("refreshInsurance"),eventBus.trigger("getCommonReceiptInfo"),eventBus.trigger("getDeliveryAddress"),eventBus.trigger("initCruiseVendor"),1===pageDataObj.proMode?(eventBus.trigger("getMultiTransport",{isInit:!0}),eventBus.trigger("getDefaultTransport"),eventBus.trigger("setDefaultTransport",1,[])):15===pageDataObj.proMode?eventBus.trigger("getDefaultTrain"):14===pageDataObj.proMode&&eventBus.trigger("defaultAirplane",{isRefresh:0}),0!=productModel.get("cruiseVendorId")&&(eventBus.trigger("getCruise"),eventBus.trigger("getAddition")),eventBus.trigger("getDefaultHotel"),eventBus.trigger("initContract")},"asyncInit:drive_routine2":function(){eventBus.trigger("getAddition"),eventBus.trigger("ifReOrder"),eventBus.trigger("refreshInsurance"),eventBus.trigger("getDeliveryAddress"),eventBus.trigger("initContract")},calculate:function(){priceCalculateModel.trigger("calculate"),productModel.trigger("calculate")},initBusPlace:function(){models.scheduleInfo.initData()},initPassenger:function(){var initTouristInfo={adultNum:pageDataObj.adultNum,normalChildNum:pageDataObj.normalChildNum,childNum:pageDataObj.childNum,freeChildNum:pageDataObj.freeChildNum};models.tourists.initPassenger(initTouristInfo),pageDataObj.hasPassengers=1;var contactsArr=pageDataObj.commonTouristList;models.favors.reset(contactsArr)},initReceiptInfo:function(){eventBus.trigger("getReceiptAddress")},initCruiseVendor:function(){var order=productModel.getOrderData();pageAjax.getCruiseVendor(order).done(function(data){data&&data.success&&data.data.length>0?eventBus.trigger("getVendorListSuccess",data.data):data&&data.success&&0==data.data.length&&productModel.set("cruiseVendorId",0)}).fail(function(err){productModel.set("cruiseVendorId",0)})},getVendorListSuccess:function(data){productModel.set({vendorList:data,isShow:!0});var flag=data.some(function(item){return item.vendorId===pageDataObj.cruiseVendorId});flag||productModel.set("cruiseVendorId",data[0].vendorId),models.optionalSelected.set("renderTime",0)},initVisaMaterial:function(){var data;pageDataObj.visaConfirm?data=_.extend(pageDataObj.visaConfirm,{hasBuyVisa:1}):_.isEmpty(pageDataObj.visaNameList)?pageDataObj.destGroupFlag&&(data={destGroupFlag:pageDataObj.destGroupFlag}):data={hasBuyVisa:0,visaData:pageDataObj.visaNameList},data?models.visaMaterial.initData(data):views.visaMaterial.hideVisaM()},ifReOrder:function(){var queryParams={postData:{productId:productModel.getOrderData().productId,orderType:pageDataObj.orderType}};pageAjax.queryReOrder(queryParams).done(function(data){data&&data.success&&models.reOrder.initData(data.data)})},adultPlus:function(){models.tourists&&models.tourists.numChange("adult",productModel.get("adultNum")+1)},childPlus:function(){models.tourists&&models.tourists.numChange("child",productModel.get("childNum")+1)},normalChildPlus:function(){models.tourists&&models.tourists.numChange("child",productModel.get("normalChildNum")+1)},freeChildPlus:function(){models.tourists&&models.tourists.numChange("freeChild",productModel.get("freeChildNum")+1)},adultMinus:function(){models.tourists&&models.tourists.numChange("adult",productModel.get("adultNum")-1)},childMinus:function(){models.tourists&&models.tourists.numChange("child",productModel.get("childNum")-1)},normalChildMinus:function(){models.tourists&&models.tourists.numChange("child",productModel.get("normalChildNum")-1)},freeChildMinus:function(){models.tourists&&models.tourists.numChange("freeChild",productModel.get("freeChildNum")-1)},touristNumChange:function(){var orderModelData=productModel.getOrderData(),adultNum=orderModelData.adultNum,childNum=orderModelData.childNum;models.priceCalculate.initData(orderModelData),models.scheduleInfo.changeAdultPeople(orderModelData),models.airplane.changeTourist(adultNum,childNum),models.airplaneList.changeTourist(adultNum,childNum),models.multiTransport.hasMultiTransport()&&(models.multiTransport.changeTourist(orderModelData),models.multiTransportList.changeTourist(orderModelData)),models.hotels.changePersonNum(adultNum,childNum),models.mustSelected.changeTourist(adultNum,childNum),models.optionalSelected.changeTourist(adultNum,childNum),models.optionalSelected.destroyRecommend(),models.optionalSelected.canRequestRecommend()&&eventBus.trigger("getRecommend"),eventBus.triggerAsyncOnce("getFavourableInfo"),eventBus.trigger("refreshInsurance")},"touristNumChange:self_tour2":function(){var orderModelData=productModel.getOrderData(),adultNum=orderModelData.adultNum,childNum=orderModelData.childNum;models.priceCalculate.initData(orderModelData),models.traffic.changeTourist(adultNum,childNum),models.airplaneList.changeTourist(adultNum,childNum),models.hotels.changePersonNum(adultNum,childNum),models["package"].changeTourist(adultNum,childNum),models.mustSelected.changeTourist(adultNum,childNum),eventBus.triggerAsyncOnce("getFavourableInfo"),eventBus.trigger("refreshInsurance")},"touristNumChange:cruise2":function(){var orderModelData=productModel.getOrderData(),adultNum=orderModelData.adultNum,childNum=orderModelData.childNum;models.priceCalculate.initData(orderModelData),models.airplane.changeTourist(adultNum,childNum),models.airplaneList.changeTourist(adultNum,childNum),models.multiTransport.hasMultiTransport()&&(models.multiTransport.changeTourist(orderModelData),models.multiTransportList.changeTourist(orderModelData)),models.cruise.changeTourist(adultNum,childNum),models.hotels.changePersonNum(adultNum,childNum),models.mustSelected.changeTourist(adultNum,childNum),models.optionalSelected.changeTourist(adultNum,childNum),eventBus.triggerAsyncOnce("getFavourableInfo"),eventBus.trigger("refreshInsurance")},"touristNumChange:drive_routine2":function(){var orderModelData=productModel.getOrderData(),adultNum=orderModelData.adultNum,childNum=orderModelData.childNum;models.priceCalculate.initData(orderModelData),models.hotels.changePersonNum(adultNum,childNum),models.mustSelected.changeTourist(adultNum,childNum),models.optionalSelected.changeTourist(adultNum,childNum),eventBus.triggerAsyncOnce("getFavourableInfo"),eventBus.trigger("refreshInsurance")},cruiseVendorChange:function(){models.cruise.set({loading:!0,fail:!1}),eventBus.trigger("getCruise"),models.optionalSelected.set("renderTime",0),eventBus.trigger("getAddition")},getFinancePlans:function(){var departDate=productModel.getOrderData().departDate,today=new Date,toDayFomat=today.getFullYear().toString()+"-"+(today.getMonth()+1).toString()+"-"+today.getDate().toString(),diffDay=tools.getDiffTime(departDate,toDayFomat,"day");if(diffDay>7){var postData={productId:pageDataObj.productId,price:models.priceCalculate.get("priceData").sumPrice};pageAjax.getFinancePlans(postData).done(function(res){res&&res.success?models.priceCalculate.initPayMentData(res.data):views.priceCalculate.hideFirstPayment()}).fail(function(err){views.priceCalculate.hideFirstPayment()})}else models.priceCalculate.trigger("render")},changeDepartCityName:function(departCityName){productModel.changeDepartCityName(departCityName)},defaultAirplane:function(data){var isV2=Backbone.app.get("isFlightV2");changeFlightCheckRule&&models.airplane.set({hasCheck:!1,isChecked:!1,isNetOrderFlag:!1,resIds:null});var order=productModel.getOrderData(),params=_.extend({isInternationalFlag:pageDataObj.isInternationalFlag},order),isRefresh=data.isRefresh;order.isRealTimePrice=pageDataObj.isRealTimePrice,pageDataObj.canNotSubmit=1,pageDataObj.isResLoading=1,pageAjax.defaultAirplane(params,{isRefresh:isRefresh,isV2:isV2}).done(function(data){isV2&&(data=models.airplane.transformData(data)),_.isEmpty(data)?(eventBus.trigger("airplaneError",data,isRefresh),pageDataObj.canNotSubmit=1,pageDataObj.isResLoading=0):data.listData&&data.listData.length&&(data.listData.length==pageDataObj.airRange||7==data.resType)?(eventBus.trigger("airplaneSuccess",data,isRefresh),pageDataObj.canNotSubmit=0,pageDataObj.isResLoading=0):(eventBus.trigger("airplaneError",data,isRefresh),pageDataObj.canNotSubmit=1,pageDataObj.isResLoading=0)}).fail(function(err){eventBus.trigger("airplaneError",err,isRefresh),pageDataObj.canNotSubmit=1,pageDataObj.isResLoading=0})},airplaneSuccess:function(data,isRefresh){var isInternationalFlag=data.isInternationalFlag,resType=data.resType,order=(data.sort,productModel.getOrderData()),isFlightV2=(order.adultNum+order.childNum,Backbone.app.get("isFlightV2"));isRefresh&&models.priceCalculate.refreshAirplane(),models.priceCalculate.set("resourceError",!1);var basePrice=models.airplane.getBasePrice(data.listData);if(models.priceCalculate.setAirplaneBasePrice(basePrice),_.extend(data,_.pick(order,"adultNum","childNum")),models.airplane.init(data),"cruise2"==pageDataObj.pageType){var listData=models.airplane.get("listData");models.priceCalculate.changeAirplaneData(listData)}if(!isRefresh&&pageDataObj.isRealTimePrice){var price=models.airplane.getRealTimePrice(),newAdultPrice=order.adultPrice+price.adultPrice,newChildPrice=order.childPrice+price.childPrice;pageDataObj.baseAdultPrice=newAdultPrice,pageDataObj.baseChildPrice=newChildPrice,models.priceCalculate.set({adultPrice:newAdultPrice,childPrice:newChildPrice})}models.tourists&&models.tourists.setResType(resType),isFlightV2||models.airplaneList.set("resId",models.airplane.getIds()),eventBus.trigger("setDefaultTransport",1,data.listData),eventBus.trigger("getMultiTransport",{isInit:!0}),eventBus.trigger("getDefaultTransport"),models.optionalSelected.set("airplaneData",models.airplane.getRecommendData()),models.optionalSelected.destroyRecommend(),models.optionalSelected.canRequestRecommend()?eventBus.trigger("getRecommend"):models.optionalSelected.setHasRequest("recommend"),isInternationalFlag&&(views.airplane.setLoop(),models.airplaneList.set("isInternationalFlag",isInternationalFlag),(isRefresh||isFlightV2)&&2!=isRefresh||eventBus.trigger("requestAirplaneList")),changeFlightCheckRule&&views.airplane.setDelayCheck(),eventBus.triggerAsyncOnce("getFavourableInfo"),eventBus.trigger("refreshInsurance")},airplaneError:function(err,isRefresh){err&&(_.isUndefined(err.canChange)||models.airplane.set("canChange",err.canChange),_.isUndefined(err.resType)||models.airplane.set("resType",err.resType),_.isUndefined(err.isInternationalFlag)||models.airplane.set("canChange",err.isInternationalFlag));var isV2=Backbone.app.get("isFlightV2");isV2&&eventBus.trigger("airplaneListLoadError"),17!=pageDataObj.proMode&&views.airplane.loadError(),models.priceCalculate.set("resourceError",!0),tools.scrollTo($("#m-airplane")),7!=pageDataObj.proMode&&"7"!=pageDataObj.proMode||(models.footer.changeBtnDisabled(!0),pageDataObj.canNotSubmit=1,views.priceCalculate.render()),isRefresh&&models.priceCalculate.refreshAirplane(),eventBus.trigger("setDefaultTransport",1,[]),models.optionalSelected.setHasRequest("recommend")},checkAirplane:function(moduleName){var airPlaneCheckFlag=models[moduleName].getAirplaneCheckFlag();airPlaneCheckFlag&&(models[moduleName].set({isChecked:!1,isNetOrderFlag:!1,resIds:null}),models[moduleName].checkAirplane(productModel.getOrderData(),pageDataObj.productId))},hasRealAirplane:function(diffPrice){models.priceCalculate.changeAirplane(diffPrice);var resIds=[];_.each(models.airplane.get("listData"),function(item){resIds.push(item.resId)}),eventBus.triggerAsyncOnce("getFavourableInfo",{flightType:21,resId:resIds}),eventBus.trigger("refreshInsurance")},requestAirplaneListV2:function(moduleName){eventBus.trigger("deliveryAirplaneData",moduleName),outer.open({title:"选择机票",url:"/web-detail/tour/flightList",area:["1080px","95%"],callback:function(data){var flightData={};if(data){flightData={success:!0,data:data};var airTransformData=models[moduleName].transformData(flightData),fareMapKey=Object.keys(models[moduleName].get("listDataV2").fareMap),diffPrice={diffAdultPrice:models[moduleName].get("listDataV2").fareMap[fareMapKey[0]].adultPrice-deliveryAirData.flightData.airplaneBasePrice.adultPrice,diffChildPrice:models[moduleName].get("listDataV2").fareMap[fareMapKey[0]].childPrice-deliveryAirData.flightData.airplaneBasePrice.childPrice},airplaneData={selectedData:airTransformData.listData,diffPrice:diffPrice||null,resType:airTransformData.resType};eventBus.trigger("changeAirplane",airplaneData)}},data:deliveryAirData})},resetHasCheck:function(){if(Backbone.app.get("isFlightV2")){var model;model="self_tour2"==pageDataObj.pageType?models.traffic:models.airplane,model.set("hasCheck",!1)}},moreAirplane:function(){if(Backbone.app.get("isFlightV2"))return void("self_tour2"==pageDataObj.pageType?eventBus.trigger("requestAirplaneListV2","traffic"):eventBus.trigger("requestAirplaneListV2","airplane"));var model;"self_tour2"==pageDataObj.pageType?(model=models.traffic,model.get("isInternationalFlag")&&!models.airplaneList.get("hasGetAllAirplaneFlag")&&eventBus.trigger("requestAirplaneList")):model=models.airplane,models.airplaneList.init({resIds:model.getIds(),defaultAirplanePrices:model.getPrices(),isShow:!0,cityNameList:model.getCityNameList(),defaultResType:model.get("resType")})},deliveryAirplaneData:function(moduleName){var airplaneModel=models[moduleName],journeyList=[],fareMapKey=Object.keys(airplaneModel.get("listDataV2").fareMap),fareMapKeyList=fareMapKey[0].split("_");fareMapKeyList.forEach(function(item){item=item.split("#")[0],journeyList.push(airplaneModel.get("listDataV2").flightOptionMap[item])}),deliveryAirData={baseInfo:{productId:productModel.get("productId"),bookCityCode:productModel.get("bookCityFromDetail"),departCityCode:productModel.get("departCity"),backCityCode:productModel.get("backCity"),adult:productModel.get("adultNum"),child:productModel.get("childNum"),departDate:productModel.get("departDate"),freeChild:0,journeyId:productModel.get("journeyId")},flightData:{journeyList:journeyList,journeyCount:journeyList.length,airplaneBasePrice:{adultPrice:models[moduleName].get("listDataV2").fareMap[fareMapKey[0]].adultPrice,childPrice:models[moduleName].get("listDataV2").fareMap[fareMapKey[0]].childPrice}}}},needCheckAirplane:function(data,isFromOrder){var model,view;"self_tour2"==pageDataObj.pageType?(model=models.traffic,view=views.traffic):(model=models.airplane,view=views.airplane),model.set("isChecked",!0),data.journeyId=productModel.get("journeyId")||null,view.showCheckLoading(),changeFlightCheckRule&&(models.footer.changeBtnDisabled(!0),models.footer.changeBtnText("正在校验")),pageAjax.checkAirplane(data,{isInternationalFlag:model.get("isInternationalFlag"),isV2:Backbone.app.get("isFlightV2")}).always(function(){view.hideCheckLoading()}).done(function(res){res&&res.success?model.handleCheckAirplaneResult(res.data,productModel.getOrderData(),isFromOrder):model.handleCheckAirplaneError(isFromOrder),changeFlightCheckRule&&(models.footer.changeBtnDisabled(!1),models.footer.changeBtnText("提交订单"))}).fail(function(){model.handleCheckAirplaneError(isFromOrder),changeFlightCheckRule&&(models.footer.changeBtnDisabled(!1),models.footer.changeBtnText("提交订单"))})},needCalculate:function(diffPrice){models.priceCalculate.changeAirplane(diffPrice)},refreshAirplane:function(){views.airplane.showLoading(),eventBus.trigger("defaultAirplane",{isRefresh:1})},refreshAirplaneAndList:function(){views.airplane.showLoading(),models.airplaneList.destroy(),eventBus.trigger("defaultAirplane",{isRefresh:2})},requestAirplaneList:function(){if(Backbone.app.get("isFlightV2"))return void("self_tour2"==pageDataObj.pageType?eventBus.trigger("requestAirplaneListV2","traffic"):eventBus.trigger("requestAirplaneListV2","airplane"));var sort,param=productModel.getOrderData();sort="self_tour2"==pageDataObj.pageType?models.traffic.get("sort"):models.airplane.get("sort"),param.sort=sort,param.journeyId=productModel.get("journeyId")||"",$.when(pageAjax.airplaneListPackage(param),pageAjax.airplaneListRecommend(param),pageAjax.airplaneListFree(param)).done(function(data1,data2,data3){eventBus.trigger("airplaneListSuccess",data1,data2,data3)}).fail(function(err){eventBus.trigger("airplaneListError",err)})},airplaneListSuccess:function(data1,data2,data3){var listData=_.extend({},data1[0],data2[0],data3[0],_.pick(productModel.getOrderData(),"adultNum","childNum"),{hasGetAllAirplaneFlag:1});models.airplaneList.notEmpty(listData)?models.airplaneList.init(listData):models.airplaneList.init({hasGetAllAirplaneFlag:1,loadError:!0})},airplaneListError:function(err){models.airplaneList.init({hasGetAllAirplaneFlag:1,loadError:!0})},airplaneListLoadError:function(){views.airplane&&views.airplane.hideChangeBtn()},airplaneListClosed:function(){models.airplane&&models.airplane.get("isInternationalFlag")&&views.airplane.setLoop()},changeAirplane:function(data){var resType=data.resType,selectedData=data.selectedData,diffPrice=data.diffPrice;productModel.getOrderData().adultNum+productModel.getOrderData().childNum;if(selectedData&&selectedData.length==pageDataObj.airRange){models.airplane.reset({listData:selectedData,resType:resType}),changeFlightCheckRule&&(models.airplane.set({hasCheck:!1,isChecked:!1,isNetOrderFlag:!1}),eventBus.trigger("checkAirplane","airplane")),"cruise2"==pageDataObj.pageType?models.priceCalculate.changeAirplaneData(selectedData):models.priceCalculate.changeAirplane(diffPrice),models.priceCalculate.set("resourceError",!1),models.tourists&&models.tourists.setResType(resType),eventBus.trigger("setDefaultTransport",1,selectedData),eventBus.trigger("checkMultiTransport"),models.optionalSelected.set("airplaneData",models.airplane.getRecommendData()),
models.optionalSelected.destroyRecommend(),models.optionalSelected.canRequestRecommend()&&eventBus.trigger("getRecommend");var resIds=_.pluck(selectedData,"resId");eventBus.triggerAsyncOnce("getFavourableInfo",{flightType:21,resId:resIds}),eventBus.trigger("refreshInsurance"),models.footer.changeBtnDisabled(!1),pageDataObj.canNotSubmit=0,views.priceCalculate.render()}},"changeAirplane:self_tour2":function(data){var tranType,resType=data.resType,selectedData=data.selectedData,transport=(data.diffPrice,pageDataObj.mainResParams.selectMultiTransport);selectedData&&(models.traffic.resetAir(resType,data),transport&&transport.length&&_.some(transport,function(item){if(item.resDetail&&item.resDetail.resType&&21==item.resDetail.resType)return tranType=item.resDetail.resType,!0}),models.tourists.setResType(resType,tranType))},getDefaultTrain:function(){var orderModelInfo=productModel.getOrderData();views.train.show();var getMoreTrainData={productId:pageDataObj.productId,departureCityCode:pageDataObj.departCity,departureCityName:pageDataObj.departCityName,departDate:pageDataObj.departDate};models.train.set("canSaveOrder",!1),models.trainList.set("submitData",getMoreTrainData),models.trainList.set("traficSeq",1),models.trainList.set("selectedTrain",[]),pageDataObj.canNotSubmit=1,pageDataObj.isResLoading=1,pageAjax.getDefaultTrain({postData:orderModelInfo}).done(function(res){if(!_.isNull(res)&&res.success&&(res.data.pageShowTrain||res.data.defaultTrain)){var _defaultTrain,_default=[],_current=[];views.train.hideLoading(),pageDataObj.canNotSubmit=0,pageDataObj.isResLoading=0,res.data.pageShowTrain||(res.data.pageShowTrain=res.data.defaultTrain,models.train.set("isPageShowTrain",!1)),models.train.initData(res.data.pageShowTrain),_defaultTrain=models.train.fixStructData(res.data.defaultTrain),models.train.set("defaultTrain",_defaultTrain),_.each(_defaultTrain,function(item){_default.push({selectedTrain:item})}),_.each(models.train.get("list"),function(item){_current.push({selectedTrain:item})}),"cruise2"==pageDataObj.pageType?models.priceCalculate.changeTrainData(models.train.get("list")):models.priceCalculate.changeTrainInfo(_default,_current),eventBus.trigger("setDefaultTransport",2,models.train.get("list")),eventBus.trigger("getMultiTransport",{isInit:!0}),eventBus.trigger("getDefaultTransport")}else views.train.hideLoading(),17==pageDataObj.proMode?views.train.hideTrainModular():views.train.showLoadError(),pageDataObj.canNotSubmit=1,pageDataObj.isResLoading=0,eventBus.trigger("setDefaultTransport",2,[])}).fail(function(err){views.train.hideLoading(),17==pageDataObj.proMode?views.train.hideTrainModular():views.train.showLoadError(),pageDataObj.canNotSubmit=1,pageDataObj.isResLoading=0})},openTrainSelectPanel:function(data,defaultOpen){var param=_.extend({},models.trainList.get("submitData"),data),orderModelData=productModel.getOrderData();defaultOpen&&views.trainList.init(),pageAjax.getQueryTrain({postData:param}).done(function(res){if(!_.isNull(res)&&res.success){var defaultTrain=models.train.get("list");res.data.defaultTrain=defaultTrain,res.data.peopleLimit=orderModelData.adultNum+orderModelData.normalChildNum,res.data.allCanChoose=models.trainList.get("allCanChoose")||!1,models.trainList.initData(res.data)}else views.trainList.noData()}).fail(function(){views.trainList.noData()})},refreshMoreTrain:function(data){var param=_.extend({},models.trainList.get("submitData"),data);pageAjax.getQueryTrain({postData:param}).done(function(res){!_.isNull(res)&&res.success?models.trainList.set("list",res.data.list):models.trainList.set("list",null)}).fail(function(){models.trainList.set("list",null)})},changeTrainSuccess:function(data){var _default=[],_current=[];models.train.initData(data),_.each(models.train.get("defaultTrain"),function(item){_default.push({selectedTrain:item})}),_.each(models.train.get("list"),function(item){_current.push({selectedTrain:item})}),models.priceCalculate.changeTrainInfo(_default,_current),eventBus.trigger("setDefaultTransport",2,models.train.get("list")),eventBus.trigger("checkMultiTransport"),eventBus.trigger("refreshInsurance")},checkTrainReChoose:function(msg,data,loadTree){var deferred=$.Deferred(),needChangeTicket=!0,len=models.train.get("list").length,orderModelData=productModel.getOrderData(),canChooseSeatLacking=!0,orderNum=orderModelData.childNum+orderModelData.adultNum,checkFunc=function(deferred){for(var i=0;i<len;i++){var param=_.extend({},models.trainList.get("submitData"),{traficSeq:i+1}),loadTrain=!1,j=0;views.train.showCheckLoading(),pageAjax.getQueryTrain({postData:param}).done(function(res){!_.isNull(res)&&res.success?(_.each(res.data.list,function(item){_.each(item.prices,function(v){loadTrain=loadTrain||v.leftNumber>=orderNum,canChooseSeatLacking=canChooseSeatLacking&&v.leftNumber<orderNum})}),needChangeTicket=needChangeTicket&&loadTrain,++j===len?deferred.resolve():""):(needChangeTicket=!1,deferred.resolve())}).fail(function(){needChangeTicket=!1,deferred.resolve()})}return deferred.promise()};checkFunc(deferred).always(function(){views.train.hideCheckLoading()}).done(function(){models.trainList.set("allCanChoose",canChooseSeatLacking),needChangeTicket?(models.trainList.set("traficSeq",data.traficSeq,{silent:!0}),views.train.showChangeDialog(msg,data)):(models.train.set("canSaveOrder",!0),eventBus.trigger("validPostOrder"))})},getDefaultBus:function(){var order=productModel.getOrderData();pageDataObj.canNotSubmit=1,pageDataObj.isResLoading=1,views.bus.show(),pageAjax.getDefaultBus(order).done(function(data){data&&data.success&&data.data?(eventBus.trigger("getDefaultBusSuccess",data.data),models.footer.changeBtnDisabled(!1),pageDataObj.canNotSubmit=0,pageDataObj.isResLoading=0,eventBus.triggerAsyncOnce("refreshInsurance"),eventBus.triggerAsyncOnce("getFavourableInfo")):(models.footer.changeBtnDisabled(!0),eventBus.trigger("getDefaultBusError"))}).fail(function(err){models.footer.changeBtnDisabled(!0),eventBus.trigger("getDefaultBusError")})},getDefaultBusSuccess:function(data){models.bus.init(data)},getDefaultBusError:function(){pageDataObj.canNotSubmit=1,pageDataObj.isResLoading=0,views.bus.loadError(),tools.scrollTo($("#m-bus"))},moreBus:function(){var order=productModel.getOrderData();models.busList.setDefaultBus(models.bus.toJSON()),models.busList.changeTourist(order.adultNum,order.childNum);var list=models.busList.get("list");return _.isEmpty(list)?(views.busList.showLoading(),void pageAjax.getQueryBus(order).always(function(){views.busList.hideLoading()}).done(function(data){data&&data.success&&data.data?eventBus.trigger("getBusListSuccess",data.data.pkgBus):eventBus.trigger("getBusListError")}).fail(function(err){eventBus.trigger("getBusListError")})):void models.busList.init(list)},getBusListSuccess:function(data){models.bus.get("isNew")?models.busListNew.init(data):models.busList.init(data)},getBusListError:function(){models.bus.get("isNew")?views.busListNew.loadError():views.busList.loadError()},changeBus:function(data){var defaultBus=models.bus.toJSON();models.priceCalculate.changeBusInfo(defaultBus,{listData:data}),models.bus.get("isNew")?models.bus.newReset(data):models.bus.reset(data)},newMoreBus:function(){var order=productModel.getOrderData(),hasGetBusList=models.busListNew.get("hasGetBusList");return models.busListNew.set(_.extend({},{defaultBus:models.bus.get("listData")},{cityList:models.bus.getCityNameList()},_.pick(productModel.getOrderData(),"adultNum","childNum"))),hasGetBusList?void models.busListNew.init(models.busListNew.toJSON()):(views.busListNew.showLoading(),void pageAjax.getNewQueryBus(order).always(function(){views.busListNew.hideLoading()}).done(function(data){data&&data.success&&data.data?eventBus.trigger("getBusListSuccess",data.data):eventBus.trigger("getBusListError")}).fail(function(err){eventBus.trigger("getBusListError")}))},checkBusNumber:function(){var postData=models.bus.getPostData(productModel.getOrderData());pageAjax.checkBusLeftNumber(postData).always(function(){views.bus.hideCheckLoading(),models.bus.set({hasCheck:!0})}).done(function(res){res&&res.success?models.bus.handleCheckBusResult(res.data,productModel.getOrderData()):models.bus.handleCheckBusError()}).fail(function(){models.bus.handleCheckBusError()})},initHotel:function(){models.hotels.initData(pageDataObj.mainResParams.selectHotel)},getDefaultHotel:function(){var order=productModel.getOrderData();pageAjax.getDefaultHotel(order).done(function(data){data&&data.success&&data.data?eventBus.trigger("getDefaultHotelSuccess",data.data):eventBus.trigger("getDefaultHotelError")}).fail(function(err){eventBus.trigger("getDefaultHotelError")})},getDefaultHotelSuccess:function(data){var order=productModel.getOrderData();if(_.each(data.list,function(item){item.adultNum=order.adultNum,item.childNum=order.childNum}),models.hotels.init(data),"cruise2"!=pageDataObj.pageType){var totalHalfRoomPrice=models.hotels.getTotalHalfRoomPrice(),adultPrice=productModel.get("adultPrice");productModel.set("adultPrice",adultPrice-totalHalfRoomPrice),priceCalculateModel.initData(productModel.getOrderData())}eventBus.trigger("changeUpdate"),eventBus.trigger("refreshInsurance"),eventBus.triggerAsyncOnce("getFavourableInfo")},getDefaultHotelError:function(){eventBus.trigger("changeUpdate")},refreshRatePlan:function(param){var order=productModel.getOrderData();_.extend(param,order),pageAjax.refreshRatePlan(param).done(function(res){res&&res.success&&res.data&&(res.data.ratePlanId=param.ratePlanId,models.hotels.refreshRatePlan(res.data))}).fail(function(){})},hotelPriceChange:function(){var data=models.hotels.getHotelCountAndName();models.priceCalculate.set({hotelTotalPrice:models.hotels.getTotalRoomPrice(),hotelRoomCountInfo:data}),models.priceCalculate.trigger("calculate")},"hotelPriceChange:cruise2":function(){models.priceCalculate.set("cruiseHotelTotalPrice",models.hotels.getTotalRoomPrice()),models.priceCalculate.changeCruiseHotelData(models.hotels.toJSON()),models.priceCalculate.trigger("calculate")},getHotelResId:function(param){function handleError(){models.saveOrder.setNetOrderFlag("hotel",!0,"散客酒店验房失败转网络单"),eventBus.trigger("sendSaveOrderData")}views.hotels.showCheckLoading(),pageAjax.getHotelResId(param).always(function(){views.hotels.hideCheckLoading()}).done(function(res){res&&res.success&&res.data?(res.data.ratePlanId=param.ratePlanId,models.hotels.setHotelResId(res.data)):handleError()}).fail(function(){handleError()})},checkJiBaoPrice:function(param){views.hotels.showCheckLoading(),pageAjax.checkJiBaoPrice(param).always(function(){views.hotels.hideCheckLoading()}).done(function(res){res&&res.success&&res.data?(res.data.ratePlanId=param.ratePlanId,models.hotels.changeJiBaoPrice(res.data)):views.hotels.jiBaoTip(0)}).fail(function(){eventBus.trigger("saveOrder")})},getMultiTransport:function(options){function request(){var param=models.multiTransportList.getParam(airType);filter&&(param.filter=filter),pageDataObj.bookCity!=models.multiTransport.get("departureCity")&&pageDataObj.needRenderCombineTraffic&&(isInit||views.multiTransportList.showLoading(),pageAjax.getMultiTransport(param).done(function(data){function handleResult(data){data.isShow=isShow,data.selectedTransport=models.multiTransport.get("list"),data.fromTrainFilter=fromTrainFilter,data.airType=airType,loop&&(data.trainsInfo?models.multiTransportList.set("transportType",2):(data.individualFlight||data.groupFlight)&&models.multiTransportList.set("transportType",1)),models.multiTransport.init(data),models.multiTransportList.init(data)}if(views.multiTransportList.hideLoading(),!loop||data&&(data.individualFlight||data.groupFlight||data.trainsInfo))handleResult(data);else if(0==journeyIndex){var find=_.some(arriveDateArr,function(item){if(!requestDate[departureDate]||requestDate[departureDate].indexOf(item)==-1)return backDate=item,requestDate[departureDate].push(backDate),!0});if(!find){var find2=_.some(departDateArr,function(item){if(!requestDate[item])return departureDate=item,backDate=defaultBackDate,requestDate[item]=[],requestDate[item].push(backDate),!0});if(!find2)return handleResult(data)}models.multiTransportList.set({departureDateM:departureDate,backDateM:backDate}),request()}else if(1==journeyIndex){var find=_.some(arriveDateArr,function(item){if(!requestDate[departureDate])return backDate=item,requestDate[departureDate]=!0,!0});if(!find)return handleResult(data);models.multiTransportList.set({backDateM:backDate}),request()}}).fail(function(err){console.log("multiTransportError",err),views.multiTransportList.hideLoading(),fromList&&views.multiTransportList.loadError()}))}options=options||{};var departureDate,backDate,defaultBackDate,airType=options.airType,isInit=options.isInit,isShow=options.isShow,fromTrainFilter=options.fromTrainFilter,filter=options.filter,fromList=options.fromList,loop=options.loop,airplaneDepartDayArr=models.multiTransportList.get("airplaneDepartDayArr"),trainDepartDayArr=models.multiTransportList.get("trainDepartDayArr"),airplaneArriveDayArr=models.multiTransportList.get("airplaneArriveDayArr"),trainArriveDayArr=models.multiTransportList.get("trainArriveDayArr"),journeyIndex=models.multiTransportList.get("journeyIndex"),departDateArr=[],arriveDateArr=[],requestDate={};_.each(trainDepartDayArr,function(item){departDateArr.push(item)}),_.each(airplaneDepartDayArr,function(item){departDateArr.indexOf(item)==-1&&departDateArr.push(item)}),_.each(trainArriveDayArr,function(item){arriveDateArr.push(item)}),_.each(airplaneArriveDayArr,function(item){arriveDateArr.indexOf(item)==-1&&arriveDateArr.push(item)}),0==journeyIndex?(departureDate=models.multiTransportList.get("departureDateM"),defaultBackDate=backDate=models.multiTransportList.get("backDateM"),requestDate[departureDate]=[backDate]):1==journeyIndex&&(departureDate=models.multiTransportList.get("backDateM"),requestDate[departureDate]=!0),request()},getDefaultTransport:function(){var param=models.multiTransportList.getParam();pageDataObj.bookCity!=models.multiTransport.get("departureCity")&&pageDataObj.needRenderCombineTraffic&&pageAjax.getDefaultTransport(param).done(function(data){_.isEmpty(data)?eventBus.trigger("defaultTransportError"):eventBus.trigger("defaultTransportSuccess",data)}).fail(function(err){eventBus.trigger("defaultTransportError")})},defaultTransportSuccess:function(data){Backbone.app.set("haveCombinedRes",!0),models.multiTransport.setDefaultData(data),models.multiTransportList.set("selectedTransport",models.multiTransport.get("list"),{silent:!0}),eventBus.trigger("calculateMultiTransport")},defaultTransportError:function(){models.multiTransport.empty()},newSelectMultiTransport:function(f){var list=models.multiTransport.get("list");models.multiTransportList.set("selectedTransport",list,{silent:!0}),f&&views.multiTransportList.verify(),eventBus.trigger("calculateMultiTransport")},checkMultiTransport:function(){models.multiTransport.checkTime()},setDefaultTransport:function(type,data){models.multiTransport.setDefaultTransport(type,data),models.multiTransportList.setDefaultTransport(type,data)},changeDepartureCityM:function(type){var multiTransport=models.multiTransport.toJSON(),multiTransportList=models.multiTransportList.toJSON();1==type?models.multiTransportList.set({departureCityCodeM:multiTransport.departureCityCodeM,departureCityNameM:multiTransport.departureCityNameM,backCityCodeM:multiTransport.departureCityCodeM,backCityNameM:multiTransport.departureCityNameM},{silent:!0}):models.multiTransport.set({departureCityCodeM:multiTransportList.departureCityCodeM,departureCityNameM:multiTransportList.departureCityNameM,backCityCodeM:multiTransportList.departureCityCodeM,backCityNameM:multiTransportList.departureCityNameM})},changeBackCityM:function(type){var multiTransport=models.multiTransport.toJSON(),multiTransportList=models.multiTransportList.toJSON();1==type?models.multiTransportList.set({backCityCodeM:multiTransport.backCityCodeM,backCityNameM:multiTransport.backCityNameM},{silent:!0}):models.multiTransport.set({backCityCodeM:multiTransportList.backCityCodeM,backCityNameM:multiTransportList.backCityNameM})},changeMultiTransportPersonCount:function(person){models.multiTransport.set({person:person},{silent:!0}),eventBus.trigger("calculateMultiTransport")},calculateMultiTransport:function(notNeedRefresh){var data=models.multiTransport.getPrice();models.priceCalculate.changeMultiTransport(data),notNeedRefresh||(eventBus.triggerAsyncOnce("getFavourableInfo"),eventBus.trigger("refreshInsurance"))},needCheckAirplaneMultiTransport:function(data){views.airplane.showCheckLoading(),pageAjax.checkAirplane(data,{isInternationalFlag:!1}).always(function(){views.airplane.hideCheckLoading()}).done(function(res){res&&res.success?models.multiTransport.handleCheckAirplaneResult(res.data,productModel.getOrderData()):models.multiTransport.handleCheckAirplaneError()}).fail(function(){models.multiTransport.handleCheckAirplaneError()})},changeMultiTransport:function(data){models.multiTransport.reset(data),models.multiTransportList.set("selectedTransport",data,{silent:!0})},changeTouristText:function(flag){var resType,allRes=models.multiTransport.toJSON().list;models.tourists&&(flag?allRes&&allRes.length&&(resType=allRes[0]?allRes[0].resType:allRes[1].resType,models.tourists.changeText(resType)):(resType=void 0,models.tourists.changeText(resType)))},getTransPort:function(){pageAjax.getTransPort(productModel.getOrderData()).done(function(res){res&&res.success&&(Backbone.app.set("haveCombinedRes",!0),models.transport.setBaseData(res.data))})},changeTransport:function(selectData){models.priceCalculate.setTransPort(selectData)},calculateTrafficPrice:function(){var tpPrice=models.traffic.getTpPrice();models.priceCalculate.changeTraffic(tpPrice),eventBus.trigger("refreshInsurance")},initPackage:function(){models["package"].init(pageDataObj.mainResParams.selectPackage)},calculatePackagePrice:function(){var price=models["package"].getTotalPrice();models.priceCalculate.changePackage(price),eventBus.trigger("refreshInsurance")},getCruise:function(){var param=productModel.getOrderData();pageAjax.getCruise(param).done(function(response){if(response&&response.success&&response.data){var data=response.data;eventBus.trigger("getCruiseSuccess",data)}else eventBus.trigger("getCruiseError")}).fail(function(){eventBus.trigger("getCruiseError")})},getCruiseSuccess:function(data){models.cruise.init(data)},getCruiseError:function(){models.cruise.loadError(),eventBus.trigger("changeBtnDisabled",!0),pageDataObj.canNotSubmit=1,console.log("[cruise] getCruise error")},cruisePriceCalculate:function(){var data=models.cruise.get("selectList");models.priceCalculate.changeCruiseData(data),eventBus.trigger("refreshInsurance"),eventBus.triggerAsyncOnce("getFavourableInfo")},checkCruise:function(data){views.cruise.showCheckLoading(),pageAjax.checkCruise(data).always(function(){views.cruise.hideCheckLoading()}).done(function(res){res&&res.success&&res.data?models.cruise.checkCruiseSuccess(res.data):(models.saveOrder.setNetOrderFlag("cruise",!0,"邮轮验房失败转网络单"),eventBus.trigger("sendSaveOrderData"))}).fail(function(){models.saveOrder.setNetOrderFlag("cruise",!0,"邮轮验房失败转网络单"),eventBus.trigger("sendSaveOrderData")})},changeAddBudget:function(){var checkRoomAddBudget=models.scheduleInfo.getIsSelectRow();models.priceCalculate.changeRoomAddBudget(checkRoomAddBudget),eventBus.triggerAsyncOnce("getFavourableInfo")},requestNewRoomAdd:function(requestData){pageAjax.getRoomAddBudget(requestData).done(function(data){_.isNull(data)||(models.scheduleInfo.initData(data),models.scheduleInfo.changeAdultPeople(productModel.getOrderData()))})},initAddition:function(){models.mustSelected.initAdditionDiy(pageDataObj.mainResParams.selectAddService)},getRecommend:function(){var param=models.optionalSelected.getRecommendParam();pageAjax.getAirportTransfer(param).done(function(res){res&&res.success?models.optionalSelected.initRecommend(res):models.optionalSelected.initRecommendFail()}).fail(function(){models.optionalSelected.initRecommendFail()})},recommendPriceCalculate:function(){var selectData=models.optionalSelected.getSelectRecommendData();models.priceCalculate.refreshRecommend(selectData)},getRecommendAddress:function(param,type,from){pageAjax.placeSearch(param).done(function(res){res&&res.success?"default"==from?models.optionalSelected.setRecommendAddress(res,type):models.optionalSelectedList.setRecommendAddress(res,type):"default"==from?models.optionalSelected.setRecommendAddressFail(type):models.optionalSelectedList.setRecommendAddressFail(type)}).fail(function(){"default"==from?models.optionalSelected.setRecommendAddressFail(type):models.optionalSelectedList.setRecommendAddressFail(type)})},getNewestPrice:function(param,type,from){pageAjax.getAirportlist(param).done(function(res){res&&res.success?"default"==from?models.optionalSelected.setInfo(res,type):models.optionalSelectedList.setInfo(res,type):"default"==from?models.optionalSelected.setInfoFail(type):models.optionalSelectedList.setInfoFail(type)}).fail(function(){"default"==from?models.optionalSelected.setInfoFail(type):models.optionalSelectedList.setInfoFail(type)})},getCommonReceiptInfo:function(){pageAjax.getCommonReceiptInfo().done(function(data){_.isNull(data)||models.optionalSelected.set("commonReceiptInfo",data)})},getAddition:function(){var param=productModel.getOrderData();param.journeyId=productModel.get("journeyId")||null,pageAjax.getAddition(param).done(function(res){if(res&&res.success&&res.data){var data=res.data;"drive_routine2"!=pageDataObj.pageType&&models.mustSelected.initAddition(data),models.optionalSelected.initAddition(data),eventBus.trigger("refreshInsurance"),eventBus.triggerAsyncOnce("getFavourableInfo")}else models.optionalSelected.initAdditionFail()}).fail(function(e){models.optionalSelected.initAdditionFail(),console.log("getAdditionError",e)})},additionRequiredCalculate:function(){var data=models.mustSelected.getSelectAdditionData();models.priceCalculate.changeAdditionRequiredData({list:data,title:models.mustSelected.get("title")}),eventBus.trigger("refreshInsurance"),eventBus.triggerAsyncOnce("getFavourableInfo")},additionOptionalCalculate:function(){var data=models.optionalSelected.getSelectAdditionData();models.priceCalculate.changeAdditionOptionalData(data),eventBus.trigger("refreshInsurance"),eventBus.triggerAsyncOnce("getFavourableInfo")},showVisaUserInTourist:function(resName){models.tourists.showVisaUser(resName)},calculaVisaCount:function(obj){var isWho,cid=obj.cid,thisIndex=obj.thisIndex,resId=obj.resId,type=obj.type,visaResCount=models.optionalSelected.calculaThisVisaCount(resId,type),allCount=models.tourists.getAllVisaCount(resId,type);if(isWho="adult"==type?"adultCount":"childCount",allCount[isWho]<visaResCount[resId][isWho])models.tourists.selectThisVisa(cid,thisIndex,type);else if(1==visaResCount[resId][isWho])models.tourists.cancelAllVisa(resId,type),models.tourists.selectThisVisa(cid,thisIndex,type);else{var postCount="adult"==type?visaResCount[resId].adultCount:visaResCount[resId].childCount;views.tourists.showVisaError(postCount)}models.tourists.clearVisaAndSelect()},changeAdditionNetOrderFlag:function(){models.saveOrder.setNetOrderFlag("addition",!0,"可选岸上观光或签证人数与预订人数不一致转网络单"),eventBus.trigger("sendSaveOrderData")},changeUpdate:function(){var checkUpdate=models.optionalSelected.getSelectUpdateScheme();models.priceCalculate.changeUpdate(checkUpdate);var resId=[];if(_.each(checkUpdate,function(oneUpdate){resId.push(oneUpdate.resId)}),priceCalculateModel.set("hotelReses",resId),eventBus.triggerAsyncOnce("getFavourableInfo"),eventBus.trigger("refreshInsurance"),models.scheduleInfo){var roomAddBudgetInfo=models.scheduleInfo.get("roomAddBudget");priceCalculateModel.set("selectUpdateRes",resId),priceCalculateModel.set("budgetNum",roomAddBudgetInfo.length),productModel.set("selectUpdateRes",resId),eventBus.trigger("requestNewRoomAdd",productModel.getOrderData())}},showMoreOptionalSelected:function(data){models.optionalSelectedList.init(data)},changeOptionalSelected:function(data){models.optionalSelected.reset(data)},changeTicketResource:function(){models.tourists&&models.tourists.changeTicketResource(models.mustSelected.getSelectAdditionData())},refreshInsurance:function(){var param=priceCalculateModel.getIfParam(productModel.getOrderData());_.extend(param,models.multiTransport?models.multiTransport.getIfParam(models.multiTransportList.toJSON()):null,models.traffic?models.traffic.getIfParam():null,priceCalculateModel.dealWithResource({orderData:productModel.getOrderData(),airplaneData:models.airplane?models.airplane.toJSON():null,trainData:models.train?models.train.get("list"):null,hotelsData:models.hotels?models.hotels.toJSON():null,busData:models.bus?models.bus.toJSON():null,roomBudgetData:models.scheduleInfo?models.scheduleInfo.getIsSelectRow():null,updateSchemeData:models.optionalSelected?models.optionalSelected.getSelectUpdateScheme():null,favourableData:models.favourable?models.favourable.getSelectPromotion():null,multiTransportData:models.multiTransport?models.multiTransport.toJSON():null,transportData:models.transport?models.transport.getSelectTransPort():null,baseInfo:models.priceCalculate.get("priceData").baseInfo,additionRequiredData:models.mustSelected?models.mustSelected.getSelectAdditionData():null,additionOptionalData:models.optionalSelected?models.optionalSelected.getSelectAdditionData():null,recommendData:models.optionalSelected?models.optionalSelected.getSelectRecommendData():null,trafficData:models.traffic?models.traffic.getFormatData():null,packageData:models["package"]?models["package"].toJSON():null,cruiseData:models.cruise?models.cruise.toJSON():null})),param.journeyId=productModel.get("journeyId")||null,pageAjax.refreshInsurance(param).done(function(data){_.isNull(data)||productModel.getOrderData().isNewInsuranceFlag&&models.insurance.loadSuccess(data)})},changeInsurance:function(){var checkInsuranceInfo=models.insurance.getIsSelectRow();models.priceCalculate.changeInsurance(checkInsuranceInfo),eventBus.triggerAsyncOnce("getFavourableInfo")},getFavourableInfo:function(flightReses){var param=priceCalculateModel.getIfParam(productModel.getOrderData());_.extend(param,models.multiTransport?models.multiTransport.getIfParam(models.multiTransportList.toJSON()):null,models.traffic?models.traffic.getIfParam():null,priceCalculateModel.dealWithResource({orderData:productModel.getOrderData(),airplaneData:models.airplane?models.airplane.toJSON():null,trainData:models.train?models.train.get("list"):null,hotelsData:models.hotels?models.hotels.toJSON():null,busData:models.bus?models.bus.toJSON():null,roomBudgetData:models.scheduleInfo?models.scheduleInfo.getIsSelectRow():null,updateSchemeData:models.optionalSelected?models.optionalSelected.getSelectUpdateScheme():null,favourableData:models.favourable?models.favourable.getSelectPromotion():null,multiTransportData:models.multiTransport?models.multiTransport.toJSON():null,transportData:models.transport?models.transport.getSelectTransPort():null,baseInfo:models.priceCalculate.get("priceData").baseInfo,additionRequiredData:models.mustSelected?models.mustSelected.getSelectAdditionData():null,additionOptionalData:models.optionalSelected?models.optionalSelected.getSelectAdditionData():null,recommendData:models.optionalSelected?models.optionalSelected.getSelectRecommendData():null,trafficData:models.traffic?models.traffic.getFormatData():null,cruiseData:models.cruise?models.cruise.toJSON():null}),{flightReses:flightReses}),param.journeyId=productModel.get("journeyId")||null,param.groupCost=param.groupCostWithoutInsurance,delete param.groupCostWithoutInsurance,views.favourable.beforeLoading(),pageAjax.getFavourableInfo(param).done(function(data){_.isNull(data)||models.favourable.loadingSuccess(data)})},changePromotion:function(info,coupon,travleCoupon){models.priceCalculate.changePromotion(info,coupon,travleCoupon)},getBindsCardsData:function(){pageAjax.getBindsCardsData().done(function(data){data&&data.success&&views.favourable.renderBindsCards(data)})},postBindCardsData:function(params){pageAjax.postBindsCardsData(params).done(function(res){1==res?(eventBus.triggerAsyncOnce("getFavourableInfo"),views.favourable.showBindCardsSuccess()):views.favourable.showBindCardsErr(res)}).fail(function(){views.favourable.showBindCardsErr()})},sendCheckMsg:function(send_time){pageAjax.checkTravleCoupon({flag:"send_msg",send_time:send_time}).done(function(data){send_time&&(data.send_time=send_time),data&&data.times>5,"first"===data.send_time?views.favourable.sendTravelMsg(data):"again"===data.send_time&&views.favourable.timeCaculate(data)})},checkMsgCode:function(codeVal){pageAjax.checkTravleCoupon({flag:"check_mark",mark:codeVal}).done(function(data){models.favourable.checkIsSuccess(data)})},needGetCompanyPrivilege:function(){var param=priceCalculateModel.getIfParam(productModel.getOrderData());pageAjax.getCompanyPrivilege(param).done(function(data){data&&data.success&&data.companyPrivilege&&models.favourable.setCompanyPrivilege(data.companyPrivilege)})},addPromotionCodeService:function(code){pageAjax.addPromotionCodeService(code).done(function(res){res&&res.success?(views.favourable.chargePromotionCodeSuccess(),eventBus.triggerAsyncOnce("getFavourableInfo"),views.favourable.closeDialog()):views.favourable.chargePromotionCodeError(res)})},addTravelPromotion:function(id,pwd){pageAjax.addTravelPromotion(id,pwd).done(function(res){res&&res.success&&9==res.data.errorCode?models.favourable.chargeTooOffen():res&&res.success?(eventBus.triggerAsyncOnce("getFavourableInfo"),views.favourable.closeDialog()):models.favourable.chargeError()}).fail(function(){models.favourable.chargeError()})},getDeliveryAddress:function(t){pageAjax.getDeliveryAddress().done(function(data){models.deliveryAddress.set("hasPostRequest",!0),_.isNull(data)||(models.deliveryAddress.init(data),!!t&&models.deliveryAddress.openPanel())})},setFavDefaultAddress:function(address){models.favourable.setDefaultAddress(address)},resetFavDefaultAddress:function(address){models.favourable.setDefaultAddress(address)},openListAddress:function(){models.deliveryAddress.get("hasPostRequest")?models.deliveryAddress.openPanel():eventBus.trigger("getDeliveryAddress","needOpen")},deleteDevAddress:function(id,i){pageAjax.deleteAddress({addressId:id}).done(function(data){data.success&&(models.deliveryAddress.deleteAddress(i),models.favourable.compareAddress(id))})},saveDeliveryAddress:function(data){pageAjax.saveNewAddress(data).done(function(res){res.success&&(models.deliveryAddress.set({isShowInput:!1}),models.deliveryAddress.addList(data,res))})},updateDeliveryAddress:function(data){pageAjax.updateUserAddress(data).done(function(res){res.success&&(models.deliveryAddress.set({isShowInput:!1}),models.deliveryAddress.updateAddress(data))})},getReceiptAddress:function(){pageAjax.getDeliveryAddress().done(function(data){_.isNull(data)||models.receipt.init(data),views.receipt.renderReceiptNew(pageDataObj.invoiceListInfo)}).fail(function(err){console.log("getReceiptAddress error",err)})},resetDefaultAddress:function(address){pageAjax.setDefaultAddress({addressId:address.address_id}).done(function(data){})},deleteReceiptAddress:function(id,i){pageAjax.deleteAddress({addressId:id}).done(function(data){data.success&&models.receipt.deleteAddress(i)})},saveReceiptAddress:function(data){pageAjax.saveNewAddress(data).done(function(res){res.success&&models.receipt.addList(data,res)})},updateReceiptAddress:function(data){pageAjax.updateUserAddress(data).done(function(res){res.success&&models.receipt.updateAddress(data)})},getUserInfo:function(){pageAjax.getUserInfo().done(function(data){data&&data.data&&data.data.userInfo&&(models.contact.setContact(data),models.header.setContact(data),models.receipt.changeReceiptDeliveryFee(data.custLevel))})},openLogin:function(){var host=window.location.host,hostArr=host.split("."),firstHost=hostArr[0];$.layer({type:2,title:!1,shadeClose:!0,closeBtn:[1,!0],iframe:{src:"https://passport.tuniu.com/login/iframe?origin="+encodeURIComponent("http://www.tuniu.com/ssoConnect/Iframe?reload=tourV3Order&domain="+firstHost)
},area:["375px","350px"]})},login:function(){layer.closeAll(),config.isLogin.status=!0,eventBus.triggerAsyncOnce("getFavourableInfo"),eventBus.trigger("getUserInfo"),eventBus.trigger("getTouristInfo"),views.contact.clearMobile(),eventBus.trigger("ifReOrder")},judgeIsMember:function(mobile){pageAjax.checkRegisted(mobile).done(function(data){models.contact.checkIsMember(data)})},needGetJudgeCrm:function(params){pageAjax.getJudgeCrm(params).done(function(data){data&&data.success&&(config.isLogin.status=!0,models.contact.set({name:data.data.realName,mobile:data.data.tel,email:data.data.email,phoneAreaCode:data.data.phone1,phoneCode:data.data.phone2}),data.data.telCountryId&&models.contact.set({telCountryId:data.data.telCountryId}),data.data.intlCode&&models.contact.set({intlCode:data.data.intlCode}),views.tourists.hideTouristForCrm(),models.contact.trigger("crmSet"),productModel.set("telNum",data.data.tel),eventBus.triggerAsyncOnce("getFavourableInfo"),eventBus.trigger("getTouristInfo"),models.receipt.changeReceiptDeliveryFee(data.custLevel))})},setResType:function(){models.tourists.setResType.apply(models.tourists,arguments)},check_Ajax_Name:function(nameData){pageAjax.getEnglishName(nameData).done(function(res){if(res&&res.success&&res.data){var cid=res.data.cid;models.tourists.each(function(passenger){var _cid=passenger.cid;cid==_cid&&(res.data.hasUncommomWord?(passenger.changeStatus("chinesePingyinName",2),pageDataObj.savingOrder=0):passenger.changeStatus("chinesePingyinName",3),passenger.set("basechineseName",res.data),passenger.setName(passenger.toJSON().name))})}}).fail(function(){console&&console.log("error")})},passengerNumChange:function(passType,type,num){models.tourists.changePassenger(passType,type,num)},getTouristInfo:function(){models.favors&&pageAjax.getTouristInfo(productModel.getOrderData()).done(function(res){res&&res.length?models.favors.reset(res):models.favors.reset([])}).fail(function(){models.favors.reset([])})},beforeSelectFavor:function(favor){var passData=models.tourists.getFirstEmpty(pageDataObj.proMode,favor.toJSON().favorType),pass=passData.pass;pass||(passData.num>0?views.tourists.showErr("ageErr",{passData:favor.toJSON()}):views.tourists.showErr("noPass")),pass&&(pass.load(favor.toJSON()),pass.select(favor),favor.select(pass),favor.once("unselect",function(){pass.unselect()}),pass.once("hasChange",function(){this.changed.serial&&1===_.size(this.changed)||favor.unselect()}),pass.once("clear destroy",function(){favor.unselect()}))},beforeUnselectFavor:function(favor){favor.relPass&&(favor.relPass.isFavor?favor.relPass.remove():favor.relPass.clear()),favor.unselect()},changeFavorStatus:function(show){show?views.favors.showFavors():views.favors.hideFavors()},changeBtnDisabled:function(flag){models.footer.changeBtnDisabled(flag)},initContract:function(refresh){var orderData=productModel.getOrderData(),insuranceData=models.insurance.getIsSelectRow(),getDriveContractData=models.contract.getParam({orderData:orderData,insuranceData:insuranceData});pageAjax.getDriveContract(getDriveContractData).done(function(data){data&&data.success&&(models.contract.init(data.data),models.footer.initContract(data.data),refresh&&views.contract.show())}).fail(function(){})},toContract:function(){eventBus.trigger("initContract",!0)},setNetOrderFlag:function(){models.saveOrder.setNetOrderFlag.apply(models.saveOrder,arguments)},saveOrder:function(){changeFlightCheckRule&&views.airplane&&views.airplane.clearDelayCheck(),eventBus.trigger("validPostOrder")},validPostOrder:function(){var orderModelData=productModel.getOrderData(),validator=tools.validator();validator.add(function(){return!!models.contact.validatorAll()||(tools.scrollTo($("#m-contact")),!1)}),validator.add(function(){return models.contact.validateLogin()}),validator.add(function(){return!!models.receipt.validatorAll()||(tools.scrollTo($("#m-receipt")),!1)}),validator.add(function(){var error=new handelError;return!!error.checkOrderData(orderModelData)}),validator.add(function(){var ransport,passengerData=models.tourists.getAllPassengerData(),airplane=models.airplane.toJSON();if(models.multiTransport.toJSON().list&&models.multiTransport.toJSON().list.length&&(ransport=models.multiTransport.getIndResType()),!_.isEmpty(airplane.listData)&&21==airplane.resType||21==ransport){var isOldOrChild,allOver=0;if(_.each(passengerData.data,function(item,index){item&&(item.mobileNo||""!=item.mobileNo)&&(isOldOrChild=item.mobileNo&&""!=item.mobileNo?models.tourists.checkIsOldOrChild(item.mobileNo):models.tourists.checkIsOldOrChild(item.birthDate_year+"-"+item.birthDate_month+"-"+item.birthDate_day),!isOldOrChild||item.mobileNo&&""!=item.mobileNo||(allOver++,$("html,body").animate({scrollTop:$("#m-tourist").offset().top},500),views.tourists.showEmptyErr("notEmpty",index)))}),0!=allOver)return!1}return 1!=pageDataObj.hasPassengers||!passengerData.err||($("html,body").animate({scrollTop:$("#m-tourist").offset().top},500),views.tourists.showErr(passengerData.err),!1)}),validator.add(function(){var airplane=models.airplane.toJSON(),order=productModel.getOrderData();if(!_.isEmpty(airplane.listData)&&7==airplane.resType){var one=airplane.listData[0];if(one.totalLeft<order.adultNum+order.childNum&&2!=one.stockType&&3!=one.stockType){var hasGetAllAirplaneFlag=models.airplaneList.get("hasGetAllAirplaneFlag");return hasGetAllAirplaneFlag?!models.airplaneList.get("group")&&!models.airplaneList.get("individualFlight")||(views.airplane.showError({type:"totalLeft",code:1}),!1):(views.airplane.showError({type:"totalLeft",code:1}),!1)}return!0}return!0}),validator.add(function(){var result=models.multiTransport.checkTime(!0);return!(!result.flag&&result.conflict)}),validator.add(function(){return models.mustSelected.checkAddition()}),validator.add(function(){return models.optionalSelected.checkAddition()}),validator.add(function(){return models.optionalSelected.checkRecommend()}),validator.add(function(){return models.favourable.checkNeedReCheck()}),validator.add(function(){return views.visaMaterial.confirmVisa()}),validator.add(function(){return!!models.footer.get("agree")||(tools.layer({msg:"请先阅读并同意"+models.footer.get("contractName")}),!1)});var isChecked=models.airplane.get("isChecked");(!changeFlightCheckRule||changeFlightCheckRule&&!isChecked)&&validator.add(function(){var airPlaneCheckFlag=models.airplane.getAirplaneCheckFlag();return!airPlaneCheckFlag||(models.airplane.checkAirplane(productModel.getOrderData(),pageDataObj.productId,!0),!1)}),validator.add(function(){var airPlaneCheckFlag=models.multiTransport.getAirplaneCheckFlag();return!airPlaneCheckFlag||(models.multiTransport.checkAirplane(productModel.getOrderData(),pageDataObj.productId),!1)}),validator.add(function(){if(!_.isEmpty(models.airplane.toJSON().listData)&&7==models.airplane.toJSON().resType&&1!=pageDataObj.hasCheckTourist&&1==pageDataObj.hasPassengers){var result=models.tourists.getJudStatus(),flag=result.tourFlag,name=result.name;return 1==flag||2==flag?(views.tourists.showSelDialog(name),!1):3!=flag||(views.tourists.showAgrDialog(name),!1)}return!0}),validator.add(function(){if(2===pageDataObj.proMode){var nextData=views.train.checkLeftNumber(orderModelData.adultNum+orderModelData.normalChildNum,1);if(nextData.success&&!models.train.get("canSaveOrder"))return eventBus.trigger("checkTrainReChoose",nextData.msg,nextData.data),!1}return!0}),validator.add(function(){return 3!==pageDataObj.proMode||!models.bus.get("isNew")||!models.bus.needCheck()||(views.bus.showCheckLoading(),eventBus.trigger("checkBusNumber"),!1)}),validator.add(function(){return models.hotels.checkHotelResId()});var selectedAir=Backbone.app.get("selectedAir");1===pageDataObj.proType&&[7,5,14].indexOf(pageDataObj.proMode)===-1&&selectedAir&&2==selectedAir.length&&validator.add(function(){var trainAdultNum=models.priceCalculate.get("adultNum"),trainChildNum=models.priceCalculate.get("childNum"),airTicketPassengerNum={adultNum:0,childNum:0,babyNum:0};return models.tourists.forEach(function(tourist){var age=tourist.getAge().deltaAge;age>=2&&age<12?airTicketPassengerNum.childNum++:age<2?airTicketPassengerNum.babyNum++:airTicketPassengerNum.adultNum++}),trainAdultNum==airTicketPassengerNum.adultNum&&trainChildNum==airTicketPassengerNum.childNum||(!!pageDataObj.isSurePassengerInfo||void views.tourists.showAgrPassengerDialog(airTicketPassengerNum))}),validator.valid()&&eventBus.trigger("sendSaveOrderData")},"validPostOrder:self_tour2":function(){var orderModelData=productModel.getOrderData(),validator=tools.validator();validator.add(function(){return!!models.contact.validatorAll()||(tools.scrollTo($("#m-contact")),!1)}),validator.add(function(){return models.contact.validateLogin()}),validator.add(function(){return!!models.receipt.validatorAll()||(tools.scrollTo($("#m-receipt")),!1)}),validator.add(function(){var error=new handelError;return!!error.checkOrderData(orderModelData)}),validator.add(function(){var ransport,passengerData=models.tourists.getAllPassengerData(),airplane=models.traffic.toJSON().selectAir;if(pageDataObj.mainResParams.selectMultiTransport&&pageDataObj.mainResParams.selectMultiTransport.length&&(ransport=models.traffic.getIndResType()),!_.isEmpty(airplane)&&21==airplane[0].resType||21==ransport){var isOldOrChild,allOver=0;if(passengerData.data&&passengerData.data.length&&_.each(passengerData.data,function(item,index){item&&(isOldOrChild=!item.cardNo||""==item.cardNo||15!=item.cardNo.length&&18!=item.cardNo.length?models.tourists.checkIsOldOrChild(item.birthDate):models.tourists.checkIsOldOrChild(item.cardNo),!isOldOrChild||item.mobileNo&&""!=item.mobileNo||(allOver++,$("html,body").animate({scrollTop:$("#m-tourist").offset().top},500),views.tourists.showEmptyErr("notEmpty",index)))}),0!=allOver)return!1}return 1!=pageDataObj.hasPassengers||!passengerData.err||($("html,body").animate({scrollTop:$("#m-tourist").offset().top},500),views.tourists.showErr(passengerData.err),!1)}),validator.add(function(){return models.favourable.checkNeedReCheck()}),validator.add(function(){return views.visaMaterial.confirmVisa()}),validator.add(function(){return!!models.footer.get("agree")||(tools.layer({msg:"请先阅读并同意"+models.footer.get("contractName")}),!1)});var isChecked=models.traffic.get("isChecked");(!changeFlightCheckRule||changeFlightCheckRule&&!isChecked)&&validator.add(function(){var airPlaneCheckFlag=models.traffic.getAirplaneCheckFlag();return!airPlaneCheckFlag||(models.traffic.set("needSaveOrder",!0),models.traffic.checkAirplane(productModel.getOrderData(),pageDataObj.productId,!0),!1)}),validator.add(function(){if(!_.isEmpty(models.traffic.toJSON().selectAir)&&7==models.traffic.get("resType")&&1!=pageDataObj.hasCheckTourist&&1==pageDataObj.hasPassengers){var result=models.tourists.getJudStatus(),flag=result.tourFlag,name=result.name;return 1==flag||2==flag?(views.tourists.showSelDialog(name),!1):3!=flag||(views.tourists.showAgrDialog(name),!1)}return!0}),validator.add(function(){return models.hotels.checkJiBaoPrice()}),validator.valid()&&eventBus.trigger("sendSaveOrderData")},"validPostOrder:cruise2":function(){var orderModelData=productModel.getOrderData(),validator=tools.validator();validator.add(function(){return!!models.contact.validatorAll()||(tools.scrollTo($("#m-contact")),!1)}),validator.add(function(){return models.contact.validateLogin()}),validator.add(function(){return!!models.receipt.validatorAll()||(tools.scrollTo($("#m-receipt")),!1)}),validator.add(function(){var error=new handelError;return!!error.checkOrderData(orderModelData)}),validator.add(function(){return models.cruise.check()}),validator.add(function(){var airplane=models.airplane.toJSON(),order=productModel.getOrderData();if(!_.isEmpty(airplane.listData)&&7==airplane.resType){var one=airplane.listData[0];if(one.totalLeft<order.adultNum+order.childNum&&2!=one.stockType&&3!=one.stockType){var hasGetAllAirplaneFlag=models.airplaneList.get("hasGetAllAirplaneFlag");return hasGetAllAirplaneFlag?!models.airplaneList.get("group")&&!models.airplaneList.get("individualFlight")||(views.airplane.showError({type:"totalLeft",code:1}),!1):(views.airplane.showError({type:"totalLeft",code:1}),!1)}return!0}return!0}),validator.add(function(){var result=models.multiTransport.checkTime(!0);return!(!result.flag&&result.conflict)}),validator.add(function(){return models.mustSelected.checkAddition()}),validator.add(function(){return models.optionalSelected.checkAddition()}),validator.add(function(){return models.favourable.checkNeedReCheck()}),validator.add(function(){return!!models.footer.get("agree")||(tools.layer({msg:"请先阅读并同意"+models.footer.get("contractName")}),!1)}),validator.add(function(){var cruiseCheckFlag=models.cruise.getCruiseCheckFlag();return!cruiseCheckFlag||(models.cruise.checkCruise(productModel.getOrderData()),!1)});var isChecked=models.airplane.get("isChecked");(!changeFlightCheckRule||changeFlightCheckRule&&!isChecked)&&validator.add(function(){var airPlaneCheckFlag=models.airplane.getAirplaneCheckFlag();return!airPlaneCheckFlag||(models.airplane.checkAirplane(productModel.getOrderData(),pageDataObj.productId,!0),!1)}),validator.add(function(){var airPlaneCheckFlag=models.multiTransport.getAirplaneCheckFlag();return!airPlaneCheckFlag||(models.multiTransport.checkAirplane(productModel.getOrderData(),pageDataObj.productId),!1)}),validator.add(function(){if(2===pageDataObj.proMode){var nextData=views.train.checkLeftNumber(orderModelData.adultNum+orderModelData.normalChildNum,1);if(nextData.success&&!models.train.get("canSaveOrder"))return eventBus.trigger("checkTrainReChoose",nextData.msg,nextData.data),!1}return!0}),validator.add(function(){return models.hotels.checkHotelResId()}),validator.valid()&&eventBus.trigger("sendSaveOrderData")},"validPostOrder:drive_routine2":function(){var orderModelData=productModel.getOrderData(),validator=tools.validator();validator.add(function(){return!!models.contact.validatorAll()||(tools.scrollTo($("#m-contact")),!1)}),validator.add(function(){return models.contact.validateLogin()}),validator.add(function(){return!!models.receipt.validatorAll()||(tools.scrollTo($("#m-receipt")),!1)}),validator.add(function(){var error=new handelError;return!!error.checkOrderData(orderModelData)}),validator.add(function(){var passengerData=models.tourists.getAllPassengerData();return 1!=pageDataObj.hasPassengers||!passengerData.err||($("html,body").animate({scrollTop:$("#m-tourist").offset().top},500),views.tourists.showErr(passengerData.err),!1)}),validator.add(function(){return models.optionalSelected.checkAddition()}),validator.add(function(){return models.favourable.checkNeedReCheck()}),validator.add(function(){return!!models.footer.get("agree")||(tools.layer({msg:"请先阅读并同意"+models.footer.get("contractName")}),!1)}),validator.add(function(){return models.hotels.checkJiBaoPrice()}),validator.valid()&&eventBus.trigger("sendSaveOrderData")},sendSaveOrderData:function(){var data={productData:models.product.toJSON(),priceCalculateData:models.priceCalculate.toJSON(),totalResPrice:models.priceCalculate.totalResPrice(),airplaneData:models.airplane?models.airplane.toJSON():null,trainData:models.train?models.train.get("list"):null,busData:models.bus?models.bus.toJSON():null,multiTransportData:models.multiTransport?models.multiTransport.toJSON():null,transportData:models.transport?models.transport.getSelectTransPort():null,hotelsData:models.hotels?models.hotels.toJSON():null,busPlaceData:models.scheduleInfo?models.scheduleInfo.getSelectRow():null,roomAddBudgetData:models.scheduleInfo?models.scheduleInfo.getIsSelectRow():null,additionRequiredData:models.mustSelected?models.mustSelected.getSelectAdditionData():null,recommendData:models.optionalSelected?models.optionalSelected.getSelectRecommendData():null,additionOptionalData:models.optionalSelected?models.optionalSelected.getSelectAdditionData():null,updateSchemeData:models.optionalSelected?models.optionalSelected.getSelectUpdateScheme():null,insuranceData:models.insurance.getIsSelectRow()?models.insurance.getIsSelectRow():null,favourableData:models.favourable?models.favourable.getSelectPromotion():null,deliveryAddressData:models.favourable?models.favourable.toJSON().defaultAddress:null,contactData:models.contact?models.contact.getSubmitData():null,isRegister:models.contact?models.contact.isRegister():null,touristsData:models.tourists?models.tourists.getAllPassengerData().data:null,hasForeignOrOld:models.tourists?models.tourists.hasForeignOrOld:null,receiptData:models.receipt?models.receipt.toJSON():null,visaMaterialData:views.visaMaterial?views.visaMaterial.getData():null,remarkData:models.remark?models.remark.toJSON():null,trafficData:models.traffic?models.traffic.getFormatData():null,transportTimeFlag:models.traffic?models.traffic.getTransportTimeFlag():null,packageData:models["package"]?models["package"].toJSON():null,cruiseData:models.cruise?models.cruise.toJSON():null,journeyId:productModel.get("journeyId")||null};"cruise2"==pageDataObj.pageType&&(data.cruiseVendorId=models.product.get("cruiseVendorId"));var sendData=models.saveOrder.getPostData(data),sendDataString=JSON.stringify(sendData);sendDataString=sendDataString.replace(/\(/g,"（"),sendDataString=sendDataString.replace(/\)/g,"）");var postData={d:sendDataString};eventBus.trigger("sendSaveOrderPost",postData)},sendSaveOrderPost:function(postData){views.saveOrder.showLoading(),pageAjax.sendSaveOrder(postData).always(function(){views.saveOrder.hideLoading()}).done(function(data){data&&data.success?views.saveOrder.saveOrderSuccess(data):views.saveOrder.saveOrderFail(data)}).fail(function(){views.saveOrder.saveOrderFail()})},"sendSaveOrderPost:cruise2":function(postData){views.saveOrder.showLoading(),pageAjax.sendSaveOrder2(postData).always(function(){views.saveOrder.hideLoading()}).done(function(data){views.saveOrder.saveOrderSuccess2(data)}).fail(function(){views.saveOrder.saveOrderFail2()})},checkPaySwitch:function(params){pageAjax.checkPaySwitch(params).done(function(res){res&&res.success&&(res.canSign?views.saveOrder.goSige(res):2===res.occupyStatus&&views.saveOrder.goNetOrder(res))})},needSign:function(data){var sendData={orderId:data.orderId,email:models.contact.get("email"),type:"json",productId:pageDataObj.productId};pageAjax.saveSign(sendData).done(function(data){data.next&&(window.location.href=data.next)})},changeReceiptDeliveryFee:function(showFlag){models.priceCalculate.changeReceiptDeliveryFee(showFlag)},refreshHasUnsureTrain:function(flag){models.multiTransport.setUnsureTrain(flag),models.transport.setUnsureTrain(flag),Backbone.app.set("hasUnsureTrain",flag)},closeAllExceptReOrder:function(){var indexes=[];views.reOrder&&views.reOrder.dialog&&(indexes=[views.reOrder.dialog]),tools.closeOther(indexes)},hasNoRightBlackCard:function(blackCardInfo){views.priceCalculate.showNewPrice(blackCardInfo)},noBlackCardInfoSaveOrder:function(blackCardInfo){models.favourable.deleteBlackCardPro(blackCardInfo),eventBus.trigger("sendSaveOrderData")}},window.loginSuccess=function(){eventBus.trigger("login")},window.getSelectHotelData=function(data){window.selectHotelData=data,$(window).trigger("selectedHotel"),$(".allHotelPath").hide(),$(".all_hotel_path_bg").hide()},window.closeHotelWindow=function(){$(".allHotelPath").hide(),$(".all_hotel_path_bg").hide(),$("html,body").animate({scrollTop:$("#m-hotel").offset().top},500)},window.closeHotelDetail=function(){$(window).trigger("closeHotelDetail")},pageEvent}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(14),__webpack_require__(9)],__WEBPACK_AMD_DEFINE_RESULT__=function($,Backbone){return Backbone.Model.extend({initialize:function(){this.elt=$(".price-calculate"),this.timer=null,this.bindEvents()},bindEvents:function(){var self=this;$(window).scroll(function(){self.timer&&clearTimeout(self.timer),self.timer=setTimeout(function(){self.adjustSummaryPostion(),self.timer=null},10)}),$(window).resize(function(){self.timer&&clearTimeout(self.timer),self.timer=setTimeout(function(){self.adjustSummaryPostion(),self.timer=null},20)})},adjustSummaryPostion:function(){var windowTop=$(window).scrollTop(),contentOffset=$(".g-wrapper .content").offset(),contentHeight=$(".g-wrapper .content").height();windowTop>contentOffset.top&&windowTop<contentOffset.top+contentHeight?this.elt.css({position:"fixed",marginTop:0,top:0,left:contentOffset.left+820}):this.elt.css({top:0,left:0,marginTop:"20px",position:"relative"})}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){module.exports=__webpack_require__(2)(1)},function(module,exports,__webpack_require__){var template=__webpack_require__(7),_=__webpack_require__(8),tools=__webpack_require__(16),constant=__webpack_require__(11);template.helper("_",_),template.helper("Math",Math),template.helper("helperGetConstant",function(){return constant}),template.helper("formatTime",function(val){var distancetime=1e3*val,min=Math.floor(distancetime/1e3/60%60),hour=Math.floor(distancetime/1e3/60/60%24);return min<10&&(min="0"+min),hour<10&&(hour="0"+hour),hour+"小时"+min+"分"}),template.helper("replaceBr",function(val){return val.replace(/\<br\>/g,",")}),template.helper("dealWithPrice",function(val){return parseInt(val)>=0?"￥"+val:"-￥"+Math.abs(val)}),template.helper("showPrice",function(val){var absVal=Math.abs(val);return val<0?"-￥"+absVal:"￥"+absVal}),template.helper("isShowLinker",function(data1,data2){if(data1&&data2)return"/"}),template.helper("makeString",function(charArr,key){var finalString="";if(!charArr||!charArr.length||"object"!=typeof charArr)return finalString;for(var k=0;k<charArr.length;k++)finalString.length?charArr[k]&&(finalString+=key+charArr[k]):charArr[k]&&(finalString+=charArr[k]);return finalString}),template.helper("helperShowPrice",tools.showPriceHelper),template.helper("helperIsShowFree",tools.isShowFree),template.helper("helperAirplaneShowPrice",function(price){var intPrice=parseInt(price),returnStr="";if(intPrice<0)returnStr+='<span class="tiny-font">-￥</span>';else{if(!(intPrice>=0))return"--";returnStr+='<span class="tiny-font">+￥</span>'}return returnStr+=Math.abs(intPrice)}),template.helper("helperGetJourney",function(order,journeyCount){if(journeyCount>2){var arr=["一","二","三","四","五","六","七","八","九"];return"第"+arr[order]}return 0==order?"去":"返"}),template.helper("helperFormatFilterName",function(val){var name;switch(val){case"routeLineList":name="直飞/中转";break;case"airLineCompanyList":name="航空公司";break;case"departureTimeSerialList":name="出发时间";break;case"arrivalTimeSerialList":name="到达时间";break;case"transferCityList":name="中转城市";break;case"transferDurationList":name="中转时长";break;case"departureAirportList":name="出发机场";break;case"arrivalAirportList":name="到达机场";break;case"cabinSerialList":name="舱位等级"}return name}),template.helper("helperGetSortInfo",function(sortData,key){var resultData={};return _.each(sortData,function(cell){cell.code==key&&(resultData=cell)}),resultData}),template.helper("helperTimeTransfer",function(timeStr){return tools.isEmpty(timeStr)?"":String.prototype.substr.call(timeStr,0,5)}),template.helper("helperProductCalendarPrice",function(reductions){var price=0;if(reductions){for(var j=0;j<reductions.length;j++){var oneReductions=reductions[j];if(1==oneReductions.type||5==oneReductions.type){price+=oneReductions.total_reduction;break}3==oneReductions.type&&(price="增加抵用券使用")}"number"==typeof price&&(0===price?price="￥0":price<0?price="-￥"+Math.abs(price):price>0&&(price="￥"+price))}return price}),template.helper("helperResourceCalendarPrice",function(reductions){var price=0;if(reductions){for(var j=0;j<reductions.length;j++){var oneReductions=reductions[j];if(1==oneReductions.proWay){var price=oneReductions.totalReduction;break}}"number"==typeof price&&(0===price?price="￥0":price<0?price="-￥"+Math.abs(price):price>0&&(price="￥"+price))}return price}),template.helper("helperPromotionCodeInfo",function(proPromotion){var data=proPromotion.data,len=data.length;if(data&&len){for(var promotionCode=[],j=0;j<len;j++){var onePro=data[j];21==onePro.type&&promotionCode.push(onePro)}return promotionCode.length?promotionCode:void 0}}),template.helper("helperFormatFacility",function(val){var map=constant.HOTEL_FACILITY_ICON;return map[val]?map[val]:""}),template.helper("helperIsInsuranceHide",function(triggerFalg,insuranceInfo,currentIndex,defaultShowNum){if(!triggerFalg)return"";defaultShowNum||(defaultShowNum=1);var hasIsSelect=!1;_.each(insuranceInfo,function(item,index){1===item.isSelect&&(hasIsSelect=!0)});var returnStr=void 0;return hasIsSelect?(_.each(insuranceInfo,function(item,index){index===currentIndex&&1===item.isSelect&&(returnStr=!0)}),returnStr?"":"hide"):currentIndex<defaultShowNum?"":"hide"}),template.helper("helperCanShowMoreBut",function(insuranceInfo){var isAllSelect=!0;return _.each(insuranceInfo,function(item){0===item.isSelect&&(isAllSelect=!1)}),insuranceInfo.length>=2&&!isAllSelect}),template.helper("helperMultiTransportShowPrice",function(price){return'<span class="tiny-font">￥</span>'+price}),template.helper("helperFormatSeatType",function(val){var arr=["商务座","特等座","一等座","二等座","高级软卧","软卧","硬卧","软座","硬座","无座"];return arr[val]}),template.helper("helperNumToChinese",function(num){var arr=["一","二","三","四","五","六","七","八","九","十"];return arr[num]}),template.helper("helperIsImg",function(url){var reg=/.+\.(jpg|jpeg|png)/i;return!!reg.test(url)}),template.helper("helperIsHideBusPlace",function(isShowMore,insuranceInfo,currentIndex,firstShow,defaultShowNum){if(isShowMore)return"";defaultShowNum||(defaultShowNum=5);var hasIsSelect=!1;_.each(insuranceInfo,function(item,index){1===item.isSelect&&(hasIsSelect=!0)});var returnStr=void 0;return hasIsSelect&&!firstShow?(_.each(insuranceInfo,function(item,index){index===currentIndex&&1===item.isSelect&&(returnStr=!0)}),returnStr?"":"hide"):currentIndex<defaultShowNum?"":"hide"}),template.helper("formatIcon",function(type){var result;switch(type){case 1:result="resource_traffic_icon";break;case 2:result="resource_visit_icon";break;case 3:result="resource_leisure_icon";break;case 4:result="resource_pass_icon";break;case 5:result="resource_card_icon";break;case 6:result="resource_guide_icon";break;case 7:result="resource_shore_icon";break;case 8:result="resource_fee_icon";break;case 9:result="resource_wifi_icon";break;case 10:result="resource_adult_bed_icon";break;case 11:result="resource_child_bed_icon";break;case 12:result="resource_room_icon";break;case 13:result="resource_local_icon";break;case 14:result="resource_marry_icon";break;case 110:result="resource_visa_icon"}return result}),template.helper("helperFormatText",function(type){return tools.formatText.apply(tools,arguments)}),template.helper("helperGetTypeByCode",function(code){return tools.getTypeByCode.apply(tools,arguments)}),template.helper("helperFormatDrawType",function(val){var result;switch(val){case 1:result="实体票";break;case 8:result="预付电子票";break;case 9:result="景区现付";break;case 10:result="第三方配送"}return result}),template.helper("helperFormatEnterWay",function(val){var result;switch(val){case 1:result="短信换票入园";break;case 2:result="短信二维码入园";break;case 3:result="有效证件入园";break;case 4:result="邮件打印凭证入园";break;case 5:result="导游带团入园";break;case 6:result="电话预约入园"}return result}),template.helper("helperFormatRecommendNote",function(vehicleGroupInfos){return"最多可乘坐"+vehicleGroupInfos.passengerNumber+"人，最多可携带"+vehicleGroupInfos.luggageNumber+"个行李箱"}),template.helper("helperFormatCalendarDate",function(date){return date=tools.formatDate(date),date.getFullYear()+"年"+tools.formatMonth(date.getMonth()+1)+"月"}),template.helper("helperGetCalendarDate",function(date,type){date=tools.formatDate(date);var month=date.getMonth()+1;return"prev"==type?month--:month++,13==month&&(month=1),0==month&&(month=12),month+="月"}),template.helper("helperFormatCalendarDay",function(date){var day;return date==tools.parseDate(new Date)?day="今天":(date=tools.formatDate(date),day=date.getDate()),day}),template.helper("helperFormatDate",function(dateStr){var returnStr="",dataArr=dateStr?dateStr.split("-"):[];return 3!=dataArr.length?dateStr:(returnStr+=dataArr[0]+"-",returnStr+=(2==dataArr[1].length?dataArr[1]:"0"+dataArr[1])+"-",returnStr+=2==dataArr[2].length?dataArr[2]:"0"+dataArr[2])}),template.helper("helperIsEmpty",tools.isEmpty),template.helper("helperIsExist",tools.isExist),template.helper("helperFormatProductName",function(name){if(name){var re=/(\[.+])?((<|&lt;)(.+)(>|&gt;))?.*/,result=name.match(re);if(result){var festival=result[1],abbr=result[4];abbr&&(name=abbr,festival&&(name=festival+abbr))}}return name}),template.helper("helperFormatBooleanTip",function(result){return result?"是":"否"}),template.helper("helperFormatRoomTypeDesc",function(val){var result;switch(val){case 1:result="无烟房";break;case 2:result="可无烟处理";break;case 3:result="全部无窗";break;case 4:result="部分无窗"}return result}),template.helper("helperTransformNull",tools.transformNull)},function(module,exports,__webpack_require__){var config=__webpack_require__(6),pageDataObj=config.pageDataObj,$=__webpack_require__(14),layer=__webpack_require__(17),constant=(__webpack_require__(18),__webpack_require__(11));module.exports={insuranceFormat:function(data){var for_insurance=data;return _.each(for_insurance,function(single,index){"airTickets"!=index&&"trainTickets"!=index&&"busTickets"!=index||null==single&&(for_insurance[index]=0)}),for_insurance},validator:function(){var validators=[];return{add:function(func){var params=_.rest(arguments);validators.push({func:func,params:params})},valid:function(){return _.every(validators,function(validator){var result=validator.func.apply(this,validator.params);return result})}}},showPriceHelper:function(price,decimalLength){var str="";return decimalLength=decimalLength||0,parseInt(price)!==price&&(price=price.toFixed(decimalLength)),str+=price>=0?"￥":"-￥",str+=Math.abs(price)},isShowFree:function(price,decimalLength,flag){var result;return price=parseFloat(price),decimalLength=decimalLength||0,parseInt(price)!==price&&(price=price.toFixed(decimalLength)),result=0==price?flag?"限时赠送":"免费赠送":"￥"+price},toFixed:function(num,len){return parseFloat(num.toFixed(len||0))},layer:function(obj){obj=obj||{};var title=obj.title||"提示",closeBtn=void 0!=obj.closeBtn?obj.closeBtn:[0,!0],btns=obj.btns||1,btn=obj.btn||["确定"],line=obj.line||1,boxHeights=["","200px","200px","232px","264px"],heights=["",32,64,96,128],height=boxHeights[line],yes=obj.yes,no=obj.no,close=obj.close,end=obj.end,msg=obj.msg,time=obj.time,icon=void 0!=obj.icon?obj.icon:1,classList=["T-alert-success","T-alert-fail","T-alert-note"],html='<div class="T-layer-alert"><i class="T-alert '+classList[icon]+'"></i>'+msg+"</div>",param={type:1,title:title,closeBtn:closeBtn,btns:btns,btn:btn,area:["430px",height],page:{html:html},success:function(el){var alert=$(el).find(".T-layer-alert"),tmpHeight=alert.height(),tmpIndex=_.indexOf(heights,tmpHeight);if(tmpIndex!=line){var newHeight=parseInt(boxHeights[tmpIndex]);$(el).height(newHeight),$(el).find(".xubox_border").height(newHeight+12),$(window).trigger("resize")}}};return time&&(param.time=time),yes&&(param.yes=yes),no&&(param.no=no),close&&(param.close=close),end&&(param.end=end),$.layer(param)},responsive:function(el,targetHeight){function change(){var wh=$(window).height();height=wh>=targetHeight?targetHeight:wh,$(el).height(height)}var height;return change(),{height:height}},scrollTo:function($dom){$("html,body").animate({scrollTop:$dom.offset().top},500)},formatDate:function(date){return date=date.replace(/-/g,"/"),new Date(date)},parseDate:function(date){return date.getFullYear()+"-"+this.formatMonth(date.getMonth()+1)+"-"+this.formatDay(date.getDate())},formatMonth:function(month){
return month=month<10?"0"+month:""+month},formatDay:function(day){return day=day<10?"0"+day:""+day},formatHour:function(hour){return hour=hour<10?"0"+hour:""+hour},getDiffTime:function(t1,t2,type){var diffTime=new Date(t1).getTime()-new Date(t2).getTime(),diffYear=new Date(t1).getFullYear()-new Date(t2).getFullYear(),diffMonth=Math.floor(diffTime/2592e6),diffDay=Math.floor(diffTime/864e5),diffHour=Math.floor(diffTime/36e5),diffMinute=Math.floor(diffTime/6e4),diffSecond=Math.floor(diffTime/1e3),res={year:diffYear,month:diffMonth,day:diffDay,hour:diffHour,minute:diffMinute,second:diffSecond};return res[type]||0},moveCursor:function(obj,s,e){if(obj.createTextRange){var rng=obj.createTextRange();rng.moveStart("character",s),rng.moveEnd("character",e),rng.select()}else obj.setSelectionRange(s,e),obj.focus()},getCountDays:function(data){var curDate=data,curMonth=curDate.getMonth();return curDate.setMonth(curMonth+1),curDate.setDate(0),curDate.getDate()},alreadyInput:function(){return pageDataObj[constant.COMPOSITION_EVENT_NAME]},isEmpty:function(val){return"null"===val||"undefined"===val||_.isEmpty(val)},isExist:function(val){return"null"!==val&&"undefined"!==val&&"0"!==val&&!!val},transformNull:function(val){return"null"!==val&&"undefined"!==val&&void 0!==val||(val=""),val},safeEventTrack:function(m){window.eventTrack&&window.eventTrack.push({text:m})},formatText:function(type){var name;return _.some(constant.ADDITION_TYPE,function(item){return item.type==type&&(name=item.name)}),name},getTypeByCode:function(code){var type;return _.some(constant.ADDITION_TYPE,function(item){return item.code==code&&(type=item.type)}),type},addDate:function(date,days){return date.setDate(date.getDate()+days),date},closeOther:function(retains){$.each($(".xubox_layer"),function(){var b=$(this),index=parseInt(b.attr("times"));retains.indexOf(index)==-1&&layer.close(index)})}}},function(module,exports,__webpack_require__){module.exports=__webpack_require__(2)(8)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(a,b){"use strict";var c,d,e={getPath:function(){var a=document.scripts,b=a[a.length-1],c=b.src;if(!b.getAttribute("merge"))return c.substring(0,c.lastIndexOf("/")+1)}(),enter:function(a){13===a.keyCode&&a.preventDefault()},config:{},end:{},btn:["&#x786E;&#x5B9A;","&#x53D6;&#x6D88;"],type:["dialog","page","iframe","loading","tips"]},f={v:"2.1",ie6:!!a.ActiveXObject&&!a.XMLHttpRequest,index:0,path:e.getPath,config:function(a,b){var d=0;return a=a||{},f.cache=e.config=c.extend(e.config,a),f.path=e.config.path||f.path,"string"==typeof a.extend&&(a.extend=[a.extend]),f.use("skin/layer.css",a.extend&&a.extend.length>0?function g(){var c=a.extend;f.use(c[c[d]?d:d-1],d<c.length?function(){return++d,g}():b)}():b),this},use:function(a,b,d){var e=c("head")[0],a=a.replace(/\s/g,""),g=/\.css$/.test(a),h=document.createElement(g?"link":"script"),i="layui_layer_"+a.replace(/\.|\//g,"");return f.path?(g&&(h.rel="stylesheet"),h[g?"href":"src"]=/^http:\/\//.test(a)?a:f.path+a,h.id=i,c("#"+i)[0]||e.appendChild(h),function j(){(g?1989===parseInt(c("#"+i).css("width")):f[d||i])?function(){b&&b();try{g||e.removeChild(h)}catch(a){}}():setTimeout(j,100)}(),this):void 0},ready:function(a,b){var d="function"==typeof a;return d&&(b=a),f.config(c.extend(e.config,function(){return d?{}:{path:a}}()),b),this},alert:function(a,b,d){var e="function"==typeof b;return e&&(d=b),f.open(c.extend({content:a,yes:d},e?{}:b))},confirm:function(a,b,d,g){var h="function"==typeof b;return h&&(g=d,d=b),f.open(c.extend({content:a,btn:e.btn,yes:d,cancel:g},h?{}:b))},msg:function(a,d,g){var i="function"==typeof d,j=e.config.skin,k=(j?j+" "+j+"-msg":"")||"layui-layer-msg",l=h.anim.length-1;return i&&(g=d),f.open(c.extend({content:a,time:3e3,shade:!1,skin:k,title:!1,closeBtn:!1,btn:!1,end:g},i&&!e.config.skin?{skin:k+" layui-layer-hui",shift:l}:function(){return d=d||{},(-1===d.icon||d.icon===b&&!e.config.skin)&&(d.skin=k+" "+(d.skin||"layui-layer-hui")),d}()))},load:function(a,b){return f.open(c.extend({type:3,icon:a||0,shade:.01},b))},tips:function(a,b,d){return f.open(c.extend({type:4,content:[a,b],closeBtn:!1,time:3e3,maxWidth:210},d))}},g=function(a){var b=this;b.index=++f.index,b.config=c.extend({},b.config,e.config,a),b.creat()};g.pt=g.prototype;var h=["layui-layer",".layui-layer-title",".layui-layer-main",".layui-layer-dialog","layui-layer-iframe","layui-layer-content","layui-layer-btn","layui-layer-close"];h.anim=["layui-anim","layui-anim-01","layui-anim-02","layui-anim-03","layui-anim-04","layui-anim-05","layui-anim-06"],g.pt.config={type:0,shade:.3,fix:!0,move:h[1],title:"&#x4FE1;&#x606F;",offset:"auto",area:"auto",closeBtn:1,time:0,zIndex:19891014,maxWidth:360,shift:0,icon:-1,scrollbar:!0,tips:2},g.pt.vessel=function(a,b){var c=this,d=c.index,f=c.config,g=f.zIndex+d,i="object"==typeof f.title,j=f.maxmin&&(1===f.type||2===f.type),k=f.title?'<div class="layui-layer-title" style="'+(i?f.title[1]:"")+'">'+(i?f.title[0]:f.title)+"</div>":"";return f.zIndex=g,b([f.shade?'<div class="layui-layer-shade" id="layui-layer-shade'+d+'" times="'+d+'" style="'+("z-index:"+(g-1)+"; background-color:"+(f.shade[1]||"#000")+"; opacity:"+(f.shade[0]||f.shade)+"; filter:alpha(opacity="+(100*f.shade[0]||100*f.shade)+");")+'"></div>':"",'<div class="'+h[0]+" "+(h.anim[f.shift]||"")+(" layui-layer-"+e.type[f.type])+(0!=f.type&&2!=f.type||f.shade?"":" layui-layer-border")+" "+(f.skin||"")+'" id="'+h[0]+d+'" type="'+e.type[f.type]+'" times="'+d+'" showtime="'+f.time+'" conType="'+(a?"object":"string")+'" style="z-index: '+g+"; width:"+f.area[0]+";height:"+f.area[1]+(f.fix?"":";position:absolute;")+'">'+(a&&2!=f.type?"":k)+'<div class="layui-layer-content'+(0==f.type&&-1!==f.icon?" layui-layer-padding":"")+(3==f.type?" layui-layer-loading"+f.icon:"")+'">'+(0==f.type&&-1!==f.icon?'<i class="layui-layer-ico layui-layer-ico'+f.icon+'"></i>':"")+(1==f.type&&a?"":f.content||"")+'</div><span class="layui-layer-setwin">'+function(){var a=j?'<a class="layui-layer-min" href="javascript:;"><cite></cite></a><a class="layui-layer-ico layui-layer-max" href="javascript:;"></a>':"";return f.closeBtn&&(a+='<a class="layui-layer-ico '+h[7]+" "+h[7]+(f.title?f.closeBtn:4==f.type?"1":"2")+'" href="javascript:;"></a>'),a}()+"</span>"+(f.btn?function(){var a="";"string"==typeof f.btn&&(f.btn=[f.btn]);for(var b=0,c=f.btn.length;c>b;b++)a+='<a class="'+h[6]+b+'">'+f.btn[b]+"</a>";return'<div class="'+h[6]+'">'+a+"</div>"}():"")+"</div>"],k),c},g.pt.creat=function(){var a=this,b=a.config,g=a.index,i=b.content,j="object"==typeof i;switch("string"==typeof b.area&&(b.area="auto"===b.area?["",""]:[b.area,""]),b.type){case 0:b.btn="btn"in b?b.btn:e.btn[0],f.closeAll("dialog");break;case 2:var i=b.content=j?b.content:[b.content||"http://layer.layui.com","auto"];b.content='<iframe scrolling="'+(b.content[1]||"auto")+'" allowtransparency="true" id="'+h[4]+g+'" name="'+h[4]+g+'" onload="this.className=\'\';" class="layui-layer-load" frameborder="0" src="'+b.content[0]+'"></iframe>';break;case 3:b.title=!1,b.closeBtn=!1,-1===b.icon&&0===b.icon,f.closeAll("loading");break;case 4:j||(b.content=[b.content,"body"]),b.follow=b.content[1],b.content=b.content[0]+'<i class="layui-layer-TipsG"></i>',b.title=!1,b.shade=!1,b.fix=!1,b.tips="object"==typeof b.tips?b.tips:[b.tips,!0],b.tipsMore||f.closeAll("tips")}a.vessel(j,function(d,e){c("body").append(d[0]),j?function(){2==b.type||4==b.type?function(){c("body").append(d[1])}():function(){i.parents("."+h[0])[0]||(i.show().addClass("layui-layer-wrap").wrap(d[1]),c("#"+h[0]+g).find("."+h[5]).before(e))}()}():c("body").append(d[1]),a.layero=c("#"+h[0]+g),b.scrollbar||h.html.css("overflow","hidden").attr("layer-full",g)}).auto(g),2==b.type&&f.ie6&&a.layero.find("iframe").attr("src",i[0]),c(document).off("keydown",e.enter).on("keydown",e.enter),a.layero.on("keydown",function(a){c(document).off("keydown",e.enter)}),4==b.type?a.tips():a.offset(),b.fix&&d.on("resize",function(){a.offset(),(/^\d+%$/.test(b.area[0])||/^\d+%$/.test(b.area[1]))&&a.auto(g),4==b.type&&a.tips()}),b.time<=0||setTimeout(function(){f.close(a.index)},b.time),a.move().callback()},g.pt.auto=function(a){function b(a){a=g.find(a),a.height(i[1]-j-k-2*(0|parseFloat(a.css("padding"))))}var e=this,f=e.config,g=c("#"+h[0]+a);""===f.area[0]&&f.maxWidth>0&&(/MSIE 7/.test(navigator.userAgent)&&f.btn&&g.width(g.innerWidth()),g.outerWidth()>f.maxWidth&&g.width(f.maxWidth));var i=[g.innerWidth(),g.innerHeight()],j=g.find(h[1]).outerHeight()||0,k=g.find("."+h[6]).outerHeight()||0;switch(f.type){case 2:b("iframe");break;default:""===f.area[1]?f.fix&&i[1]>=d.height()&&(i[1]=d.height(),b("."+h[5])):b("."+h[5])}return e},g.pt.offset=function(){var a=this,b=a.config,c=a.layero,e=[c.outerWidth(),c.outerHeight()],f="object"==typeof b.offset;a.offsetTop=(d.height()-e[1])/2,a.offsetLeft=(d.width()-e[0])/2,f?(a.offsetTop=b.offset[0],a.offsetLeft=b.offset[1]||a.offsetLeft):"auto"!==b.offset&&(a.offsetTop=b.offset,"rb"===b.offset&&(a.offsetTop=d.height()-e[1],a.offsetLeft=d.width()-e[0])),b.fix||(a.offsetTop=/%$/.test(a.offsetTop)?d.height()*parseFloat(a.offsetTop)/100:parseFloat(a.offsetTop),a.offsetLeft=/%$/.test(a.offsetLeft)?d.width()*parseFloat(a.offsetLeft)/100:parseFloat(a.offsetLeft),a.offsetTop+=d.scrollTop(),a.offsetLeft+=d.scrollLeft()),c.css({top:a.offsetTop,left:a.offsetLeft})},g.pt.tips=function(){var a=this,b=a.config,e=a.layero,f=[e.outerWidth(),e.outerHeight()],g=c(b.follow);g[0]||(g=c("body"));var i={width:g.outerWidth(),height:g.outerHeight(),top:g.offset().top,left:g.offset().left},j=e.find(".layui-layer-TipsG"),k=b.tips[0];b.tips[1]||j.remove(),i.autoLeft=function(){i.left+f[0]-d.width()>0?(i.tipLeft=i.left+i.width-f[0],j.css({right:12,left:"auto"})):i.tipLeft=i.left},i.where=[function(){i.autoLeft(),i.tipTop=i.top-f[1]-10,j.removeClass("layui-layer-TipsB").addClass("layui-layer-TipsT").css("border-right-color",b.tips[1])},function(){i.tipLeft=i.left+i.width+10,i.tipTop=i.top,j.removeClass("layui-layer-TipsL").addClass("layui-layer-TipsR").css("border-bottom-color",b.tips[1])},function(){i.autoLeft(),i.tipTop=i.top+i.height+10,j.removeClass("layui-layer-TipsT").addClass("layui-layer-TipsB").css("border-right-color",b.tips[1])},function(){i.tipLeft=i.left-f[0]-10,i.tipTop=i.top,j.removeClass("layui-layer-TipsR").addClass("layui-layer-TipsL").css("border-bottom-color",b.tips[1])}],i.where[k-1](),1===k?i.top-(d.scrollTop()+f[1]+16)<0&&i.where[2]():2===k?d.width()-(i.left+i.width+f[0]+16)>0||i.where[3]():3===k?i.top-d.scrollTop()+i.height+f[1]+16-d.height()>0&&i.where[0]():4===k&&f[0]+16-i.left>0&&i.where[1](),e.find("."+h[5]).css({"background-color":b.tips[1],"padding-right":b.closeBtn?"30px":""}),e.css({left:i.tipLeft,top:i.tipTop})},g.pt.move=function(){var a=this,b=a.config,e={setY:0,moveLayer:function(){var a=e.layero,b=parseInt(a.css("margin-left")),c=parseInt(e.move.css("left"));0===b||(c-=b),"fixed"!==a.css("position")&&(c-=a.parent().offset().left,e.setY=0),a.css({left:c,top:parseInt(e.move.css("top"))-e.setY})}},f=a.layero.find(b.move);return b.move&&f.attr("move","ok"),f.css({cursor:b.move?"move":"auto"}),c(b.move).on("mousedown",function(a){if(a.preventDefault(),"ok"===c(this).attr("move")){e.ismove=!0,e.layero=c(this).parents("."+h[0]);var f=e.layero.offset().left,g=e.layero.offset().top,i=e.layero.outerWidth()-6,j=e.layero.outerHeight()-6;c("#layui-layer-moves")[0]||c("body").append('<div id="layui-layer-moves" class="layui-layer-moves" style="left:'+f+"px; top:"+g+"px; width:"+i+"px; height:"+j+'px; z-index:2147483584"></div>'),e.move=c("#layui-layer-moves"),b.moveType&&e.move.css({visibility:"hidden"}),e.moveX=a.pageX-e.move.position().left,e.moveY=a.pageY-e.move.position().top,"fixed"!==e.layero.css("position")||(e.setY=d.scrollTop())}}),c(document).mousemove(function(a){if(e.ismove){var c=a.pageX-e.moveX,f=a.pageY-e.moveY;if(a.preventDefault(),!b.moveOut){e.setY=d.scrollTop();var g=d.width()-e.move.outerWidth(),h=e.setY;0>c&&(c=0),c>g&&(c=g),h>f&&(f=h),f>d.height()-e.move.outerHeight()+e.setY&&(f=d.height()-e.move.outerHeight()+e.setY)}e.move.css({left:c,top:f}),b.moveType&&e.moveLayer(),c=f=g=h=null}}).mouseup(function(){try{e.ismove&&(e.moveLayer(),e.move.remove(),b.moveEnd&&b.moveEnd()),e.ismove=!1}catch(a){e.ismove=!1}}),a},g.pt.callback=function(){function a(){var a=g.cancel&&g.cancel(b.index);a===!1||f.close(b.index)}var b=this,d=b.layero,g=b.config;b.openLayer(),g.success&&(2==g.type?d.find("iframe").on("load",function(){g.success(d,b.index)}):g.success(d,b.index)),f.ie6&&b.IE6(d),d.find("."+h[6]).children("a").on("click",function(){var e=c(this).index();g["btn"+(e+1)]&&g["btn"+(e+1)](b.index,d),0===e?g.yes?g.yes(b.index,d):f.close(b.index):1===e?a():g["btn"+(e+1)]||f.close(b.index)}),d.find("."+h[7]).on("click",a),g.shadeClose&&c("#layui-layer-shade"+b.index).on("click",function(){f.close(b.index)}),d.find(".layui-layer-min").on("click",function(){f.min(b.index,g),g.min&&g.min(d)}),d.find(".layui-layer-max").on("click",function(){c(this).hasClass("layui-layer-maxmin")?(f.restore(b.index),g.restore&&g.restore(d)):(f.full(b.index,g),g.full&&g.full(d))}),g.end&&(e.end[b.index]=g.end)},e.reselect=function(){c.each(c("select"),function(a,b){var d=c(this);d.parents("."+h[0])[0]||1==d.attr("layer")&&c("."+h[0]).length<1&&d.removeAttr("layer").show(),d=null})},g.pt.IE6=function(a){function b(){a.css({top:f+(e.config.fix?d.scrollTop():0)})}var e=this,f=a.offset().top;b(),d.scroll(b),c("select").each(function(a,b){var d=c(this);d.parents("."+h[0])[0]||"none"===d.css("display")||d.attr({layer:"1"}).hide(),d=null})},g.pt.openLayer=function(){var a=this;f.zIndex=a.config.zIndex,f.setTop=function(a){var b=function(){f.zIndex++,a.css("z-index",f.zIndex+1)};return f.zIndex=parseInt(a[0].style.zIndex),a.on("mousedown",b),f.zIndex}},e.record=function(a){var b=[a.outerWidth(),a.outerHeight(),a.position().top,a.position().left+parseFloat(a.css("margin-left"))];a.find(".layui-layer-max").addClass("layui-layer-maxmin"),a.attr({area:b})},e.rescollbar=function(a){h.html.attr("layer-full")==a&&(h.html[0].style.removeProperty?h.html[0].style.removeProperty("overflow"):h.html[0].style.removeAttribute("overflow"),h.html.removeAttr("layer-full"))},a.layer_2_1=f,f.getChildFrame=function(a,b){return b=b||c("."+h[4]).attr("times"),c("#"+h[0]+b).find("iframe").contents().find(a)},f.getFrameIndex=function(a){return c("#"+a).parents("."+h[4]).attr("times")},f.iframeAuto=function(a){if(a){var b=f.getChildFrame("html",a).outerHeight(),d=c("#"+h[0]+a),e=d.find(h[1]).outerHeight()||0,g=d.find("."+h[6]).outerHeight()||0;d.css({height:b+e+g}),d.find("iframe").css({height:b})}},f.iframeSrc=function(a,b){c("#"+h[0]+a).find("iframe").attr("src",b)},f.style=function(a,b){var d=c("#"+h[0]+a),f=d.attr("type"),g=d.find(h[1]).outerHeight()||0,i=d.find("."+h[6]).outerHeight()||0;(f===e.type[1]||f===e.type[2])&&(d.css(b),f===e.type[2]&&d.find("iframe").css({height:parseFloat(b.height)-g-i}))},f.min=function(a,b){var d=c("#"+h[0]+a),g=d.find(h[1]).outerHeight()||0;e.record(d),f.style(a,{width:180,height:g,overflow:"hidden"}),d.find(".layui-layer-min").hide(),"page"===d.attr("type")&&d.find(h[4]).hide(),e.rescollbar(a)},f.restore=function(a){var b=c("#"+h[0]+a),d=b.attr("area").split(",");b.attr("type"),f.style(a,{width:parseFloat(d[0]),height:parseFloat(d[1]),top:parseFloat(d[2]),left:parseFloat(d[3]),overflow:"visible"}),b.find(".layui-layer-max").removeClass("layui-layer-maxmin"),b.find(".layui-layer-min").show(),"page"===b.attr("type")&&b.find(h[4]).show(),e.rescollbar(a)},f.full=function(a){var b,g=c("#"+h[0]+a);e.record(g),h.html.attr("layer-full")||h.html.css("overflow","hidden").attr("layer-full",a),clearTimeout(b),b=setTimeout(function(){var b="fixed"===g.css("position");f.style(a,{top:b?0:d.scrollTop(),left:b?0:d.scrollLeft(),width:d.width(),height:d.height()}),g.find(".layui-layer-min").hide()},100)},f.title=function(a,b){var d=c("#"+h[0]+(b||f.index)).find(h[1]);d.html(a)},f.close=function(a){var b=c("#"+h[0]+a),d=b.attr("type");if(b[0]){if(d===e.type[1]&&"object"===b.attr("conType")){b.children(":not(."+h[5]+")").remove();for(var g=0;2>g;g++)b.find(".layui-layer-wrap").unwrap().hide()}else{if(d===e.type[2])try{var i=c("#"+h[4]+a)[0];i.contentWindow.document.write(""),i.contentWindow.close(),b.find("."+h[5])[0].removeChild(i)}catch(j){}b[0].innerHTML="",b.remove()}c("#layui-layer-moves, #layui-layer-shade"+a).remove(),f.ie6&&e.reselect(),e.rescollbar(a),c(document).off("keydown",e.enter),"function"==typeof e.end[a]&&e.end[a](),delete e.end[a]}},f.closeAll=function(a){c.each(c("."+h[0]),function(){var b=c(this),d=a?b.attr("type")===a:1;d&&f.close(b.attr("times")),d=null})},e.run=function(){c=jQuery,d=c(a),h.html=c("html"),f.open=function(a){var b=new g(a);return b.index}},__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(14)],__WEBPACK_AMD_DEFINE_RESULT__=function(){return e.run(),f}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(window)},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),tpl=__webpack_require__(20),config=__webpack_require__(6),pageDataObj=config.pageDataObj,view=backbone.View.extend({el:"#m-container",initialize:function(){this.render()},render:function(){var data=pageDataObj;data.currentYear=(new Date).getFullYear();var html=tpl(data);this.$el.html(html)}});new view},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,$escape=($utils.$helpers,$utils.$escape),currentYear=$data.currentYear,$out="";return $out+='<!-- 头部 -->\r\n<div class="g-head2nd" id="m-header"></div>\r\n\r\n<!-- 头部信息 -->\r\n<div class="info-box" id="m-top-info"></div>\r\n\r\n<!-- 主体部分 -->\r\n<div class="g-wrapper">\r\n\r\n    <div class="content"> \r\n\r\n        <!-- 产品基础信息 -->\r\n        <div class="modular m-product" id="m-product"></div>\r\n\r\n        <!-- 机票 -->\r\n        <div class="modular m-airplane m-traffic" id="m-airplane"></div>\r\n\r\n        <!-- 火车票 -->\r\n        <div class="modular m-train" id="m-train"></div>\r\n\r\n        <!-- 汽车票 -->\r\n        <div class="modular m-bus" id="m-bus"></div>\r\n\r\n        <!-- 联运 -->\r\n        <div class="modular m-multi-transport" id="m-multi-transport"></div>\r\n\r\n        <!-- 自助交通信息 -->\r\n        <div class="modular m-traffic m-airplane m-train m-bus m-multi-transport" id="m-traffic"></div>\r\n\r\n        <!-- 联运方案 -->\r\n        <div class="modular m-transport" id="m-transport"></div>\r\n\r\n        <!-- 邮轮 -->\r\n        <div class="modular m-cruise" id="m-cruise"></div>\r\n\r\n        <!-- 酒店 -->\r\n        <div class="m-hotel" id="m-hotel"></div>\r\n\r\n        <!-- 自助套餐 -->\r\n        <div class="m-package m-airplane m-traffic m-hotel" id="m-package"></div>\r\n\r\n        <!-- 行程信息 -->\r\n        <div class="modular m-schedule" id="m-schedule-info"></div>\r\n\r\n        <!-- 必选产品 -->\r\n        <div class="modular m-must-select" id="m-must-selected"></div>\r\n\r\n        <!-- 可选产品 -->\r\n        <div class="modular m-optional" id="m-optional-selected"></div>\r\n\r\n        <!-- 保险 -->\r\n        <div class="modular m-insurance" id="m-insurance"></div>\r\n\r\n        <!-- 优惠 -->\r\n        <div class="modular m-favourable" id="m-favourable"></div>\r\n\r\n        <!-- 联系人 -->\r\n        <div class="modular m-contact" id="m-contact"></div>\r\n\r\n        <!-- 出游人 -->\r\n        <div class="modular m-tourist" id="m-tourist"></div>\r\n\r\n        <!-- 签证材料确认 -->\r\n        <div class="modular m-visa-material" id="m-visa-material"></div>\r\n\r\n        <!-- 发票 -->\r\n        <div class="modular m-receipt" id="m-receipt"></div>\r\n\r\n        <!-- 客服下单备注信息 -->\r\n        <div class="modular m-remark" id="m-remark"></div>\r\n\r\n    </div>\r\n\r\n    <!-- 价格明细 -->\r\n    <div class="price-calculate" id="m-price-calculate"></div>\r\n\r\n    <div class="clear-float"></div>\r\n</div>\r\n\r\n<!-- 页脚 -->\r\n<div class="footer" id="m-footer"></div>\r\n\r\n<!-- 版权信息 -->\r\n<div class="copyright">Copyright © 2006-',$out+=$escape(currentYear),$out+=' 途牛旅游网 Tuniu.com</div>\r\n\r\n<!-- 合同、预订须知 -->\r\n<div class="order-agreement" id="m-agreement"></div>\r\n\r\n<!-- 机票弹窗 -->\r\n<div class="float-panel float-airplane" id="m-float-airplane"></div>\r\n\r\n<!-- 火车票弹窗 -->\r\n<div class="float-panel float-train" id="m-float-train"></div>\r\n\r\n<!-- 汽车票弹窗 -->\r\n<div class="float-panel float-bus" id="m-float-bus"></div>\r\n\r\n<!-- 新汽车票弹窗 -->\r\n<div class="float-panel float-bus-new" id="m-float-bus-new"></div>\r\n\r\n<!-- 联运弹窗 -->\r\n<div class="float-panel float-multi-transport" id="m-float-multi-transport"></div>\r\n\r\n<!-- 更改酒店弹窗 -->\r\n<div id="allHotelPath" class="allHotelPath"><div id="iframeContainer"></div></div>\r\n<div class="all_hotel_path_bg"></div>\r\n\r\n<!-- 可选产品弹窗 -->\r\n<div class="float-panel float-optional" id="m-float-optional"></div>\r\n\r\n<!-- 配送地址弹窗 -->\r\n<div class="float-panel float-delivery" id="m-float-delivery"></div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(25),__webpack_require__(61),__webpack_require__(26),__webpack_require__(27),__webpack_require__(28),__webpack_require__(29),__webpack_require__(30),__webpack_require__(31),__webpack_require__(32),__webpack_require__(33),__webpack_require__(34),__webpack_require__(35),__webpack_require__(36),__webpack_require__(38),__webpack_require__(39),__webpack_require__(40),__webpack_require__(42),__webpack_require__(43),__webpack_require__(44),__webpack_require__(45),__webpack_require__(46),__webpack_require__(47),__webpack_require__(48),__webpack_require__(49),__webpack_require__(51),__webpack_require__(53),__webpack_require__(55),__webpack_require__(56),__webpack_require__(57),__webpack_require__(58),__webpack_require__(59),__webpack_require__(60),__webpack_require__(22),__webpack_require__(62),__webpack_require__(64),__webpack_require__(66),__webpack_require__(68),__webpack_require__(72),__webpack_require__(74),__webpack_require__(76),__webpack_require__(80),__webpack_require__(84),__webpack_require__(87),__webpack_require__(89),__webpack_require__(92),__webpack_require__(94),__webpack_require__(98),__webpack_require__(100),__webpack_require__(104),__webpack_require__(106),__webpack_require__(108),__webpack_require__(111),__webpack_require__(113),__webpack_require__(116),__webpack_require__(122),__webpack_require__(125),__webpack_require__(129),__webpack_require__(133),__webpack_require__(135),__webpack_require__(137),__webpack_require__(142),__webpack_require__(144),__webpack_require__(146),__webpack_require__(148)],__WEBPACK_AMD_DEFINE_RESULT__=function(){for(var length=["product","reOrder","header","topInfo","priceCalculate","airplane","airplaneList","train","trainList","bus","busList","busListNew","multiTransport","multiTransportList","transport","hotels","scheduleInfo","mustSelected","optionalSelected","optionalSelectedList","insurance","favourable","deliveryAddress","contact","tourists","favors","receipt","visaMaterial","remark","footer","contract","saveOrder"].length,modules={},models={},views={},i=0;i<length;i++){var model=null;arguments[i]&&(model=new arguments[i]),models[["product","reOrder","header","topInfo","priceCalculate","airplane","airplaneList","train","trainList","bus","busList","busListNew","multiTransport","multiTransportList","transport","hotels","scheduleInfo","mustSelected","optionalSelected","optionalSelectedList","insurance","favourable","deliveryAddress","contact","tourists","favors","receipt","visaMaterial","remark","footer","contract","saveOrder"][i]]=model,arguments[i+length]&&(views[["product","reOrder","header","topInfo","priceCalculate","airplane","airplaneList","train","trainList","bus","busList","busListNew","multiTransport","multiTransportList","transport","hotels","scheduleInfo","mustSelected","optionalSelected","optionalSelectedList","insurance","favourable","deliveryAddress","contact","tourists","favors","receipt","visaMaterial","remark","footer","contract","saveOrder"][i]]=new arguments[i+length]({model:model}))}return modules.models=models,modules.views=views,window.modules=modules,modules}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(14),__webpack_require__(7),__webpack_require__(23),__webpack_require__(6),__webpack_require__(5),__webpack_require__(24),__webpack_require__(11)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,$,Template,tpl,config,eventBus,Scrollbar,constant){var pageDataObj=config.pageDataObj;return Backbone.View.extend({el:"#m-product",events:{},initialize:function(){var data=this.model.toJSON();this.render(),this.listenTo(this.model,"calculate",this.render),this.listenTo(this.model,"change:cruiseVendorId",this.render),this.listenTo(this.model,"change:isShow",this.render),this.changeDepartCity(),this.changeBackCity(),this.changeDepartDate(),data.supportChangeAdult&&this.changeAdultNum(),data.supportChangeChild&&this.changeChildNum(),this.changeVendor(),_.indexOf(constant.TRAIN_PRO_MODE,pageDataObj.proMode)!=-1&&data.supportChangeAdult&&data.supportChangeNormalChild&&data.supportChangeFreeChild&&this.initTouristConsideringFreeChild()},render:function(){this.model.setCalendar();var data=this.model.toJSON();data.canNotSubmit=pageDataObj.canNotSubmit,data.isResLoading=pageDataObj.isResLoading;var str=tpl(data);this.$el.html(str).show(),this.departCity=this.$el.find(".J_departCity"),this.departDate=this.$el.find(".J_departDate"),this.changeStatus()},setChooseBtnInitialStatus:function($node,minValue,maxValueFunc){+$node.find("input").val()>minValue?$node.find(".minus").addClass("on"):$node.find(".minus").removeClass("on"),!maxValueFunc||+$node.find("input").val()<maxValueFunc()?$node.find(".plus").addClass("on"):$node.find(".plus").removeClass("on")},changeDepartCity:function(){var self=this;this.$el.on("click",".J_departCity .s_cnum",function(e){var content=self.$el.find(".J_departCity"),ccon=content.find(".s_ccon"),clist=content.find(".s_clist");self.$el.find(".J_departDate .s_clist").hide(),clist.find("li").length>1?$(clist).toggle():ccon.css({cursor:"auto"}),e.stopPropagation()}),this.$el.on("click",".J_departCity .s_clist li",function(e){var content=self.$el.find(".J_departCity"),ccon=content.find(".s_ccon"),clist=content.find(".s_clist");$(clist).hide(),$(ccon).text($(this).text()),self.model.set("departCity",$(this).attr("cityCode")),$(ccon).attr("cityCode",$(this).attr("cityCode")),e.stopPropagation()}),$(document).on("click",function(e){var content=self.$el.find(".J_departCity"),clist=content.find(".s_clist");$(clist).hide()})},changeBackCity:function(){var self=this;this.$el.on("click",".J_backCity .s_cnum",function(e){var content=self.$el.find(".J_backCity"),ccon=content.find(".s_ccon"),clist=content.find(".s_clist");clist.find("li").length>1?$(clist).toggle():ccon.css({cursor:"auto"}),e.stopPropagation()}),this.$el.on("click",".J_backCity .s_clist li",function(e){var content=self.$el.find(".J_backCity"),ccon=content.find(".s_ccon"),clist=content.find(".s_clist");$(clist).hide(),$(ccon).text($(this).text()),self.model.set("backCity",$(this).attr("cityCode")),$(ccon).attr("cityCode",$(this).attr("cityCode")),e.stopPropagation()}),$(document).on("click",function(e){var content=self.$el.find(".J_backCity"),clist=content.find(".s_clist");$(clist).hide()})},changeDepartDate:function(){var self=this;this.$el.on("click",".J_departDate .s_cnum",function(e){self.model.set("calendarListShow",!self.model.get("calendarListShow")),self.render(),e.stopPropagation()}),this.$el.on("click",".J_departDate .calendar-wrapper",function(e){e.stopPropagation()}),this.$el.on("click",".J_departDate .calendar-wrapper .prev",function(e){var obj=$(e.currentTarget);obj.hasClass("disabled")||self.model.prevCalendar()}),this.$el.on("click",".J_departDate .calendar-wrapper .next",function(e){var obj=$(e.currentTarget);obj.hasClass("disabled")||self.model.nextCalendar()}),this.$el.on("click",".J_departDate .calendar-wrapper li",function(e){if(""!=$(this).attr("adultPrice")){self.model.set("calendarListShow",!1);var departDate=$(this).attr("departDate"),calendarList=self.model.get("calendarList");_.each(calendarList,function(item){item.departDate==departDate?item.selected=!0:item.selected=!1}),self.render(),self.model.set("departDate",departDate)}}),$(document).on("click",function(e){self.model.set("calendarListShow",!1),$(".J_departDate .calendar-wrapper").hide()})},changeAdultNum:function(){var self=this,defaultOption={min:11==pageDataObj.tagType?0:1,max:50};this.$el.on("click",".J_adultCount",function(e){var childContent=self.$el.find(".J_childCount"),childCount=childContent.children("input.value").val()-0,target=$(e.target),input=$(this).children("input.value"),value=parseInt($(input).val());$(target).hasClass("plus")&&value<defaultOption.max&&(value+=1,eventBus.trigger("adultPlus")),$(target).hasClass("minus")&&value>defaultOption.min&&(1==value&&0==childCount||(value-=1),eventBus.trigger("adultMinus")),$(input).attr("value",value),self.model.set("adultNum",value)})},changeChildNum:function(){var self=this,defaultOption={min:0,max:50};this.$el.on("click",".J_childCount",function(e){var adultContent=self.$el.find(".J_adultCount"),adultCount=adultContent.children("input.value").val()-0,target=$(e.target),input=$(this).children("input.value"),value=parseInt($(input).val());$(target).hasClass("plus")&&value<defaultOption.max&&(value+=1,eventBus.trigger("childPlus")),$(target).hasClass("minus")&&value>defaultOption.min&&(1==value&&0==adultCount||(value-=1),eventBus.trigger("childMinus")),$(input).attr("value",value),self.model.set("childNum",value)})},changeVendor:function(){var self=this;this.$el.on("click",".J_vendorItem",function(e){var $this=$(this);self.model.set("cruiseVendorId",$this.data("vendor"))}),this.$el.on("mouseover",".J_vendorItem",function(e){var $this=$(this);$this.addClass("hover")}),this.$el.on("mouseout",".J_vendorItem",function(e){var $this=$(this);$this.removeClass("hover")})},initTouristConsideringFreeChild:function(){var adult_choose,normalChild_choose,freeChild_choose,normalChildUpdate,freeChildUpdate,changeAdultCount,changeNormalChildCount,changeFreeChildCount,changeTotalChildrenCount,self=this,$node=this.$el,minFreeChildCount=0,minNormalChildCount=0,minAdultCount=1,maxNormalChildCountFunc=function(){return adult_choose=$node.find(".adult-choose"),4*+adult_choose.find("input").val()},maxFreeChildCountFunc=function(){return adult_choose=$node.find(".adult-choose"),+adult_choose.find("input").val()},maxAdultCountFunc=null;changeAdultCount=function(){adult_choose=$node.find(".adult-choose"),
normalChild_choose=$node.find(".normalChild-choose"),freeChild_choose=$node.find(".freeChild-choose"),self.model.set("adultNum",+adult_choose.find("input").val())},changeNormalChildCount=function(){adult_choose=$node.find(".adult-choose"),normalChild_choose=$node.find(".normalChild-choose"),freeChild_choose=$node.find(".freeChild-choose");var childNum=0;normalChild_choose.find("input").val()&&(childNum=normalChild_choose.find("input").val()),self.model.set("normalChildNum",+childNum)},changeFreeChildCount=function(){adult_choose=$node.find(".adult-choose"),normalChild_choose=$node.find(".normalChild-choose"),freeChild_choose=$node.find(".freeChild-choose");var freeChildNum=0;freeChild_choose.find("input").val()&&(freeChildNum=freeChild_choose.find("input").val()),self.model.set("freeChildNum",+freeChild_choose.find("input").val())},changeTotalChildrenCount=function(){adult_choose=$node.find(".adult-choose"),normalChild_choose=$node.find(".normalChild-choose"),freeChild_choose=$node.find(".freeChild-choose");var normalChildCount=0,freeChildCount=0;normalChild_choose.find("input").val()&&(normalChildCount=parseInt(normalChild_choose.find("input").val())),freeChild_choose.find("input").val()&&(freeChildCount=parseInt(freeChild_choose.find("input").val())),self.model.set("childNum",normalChildCount+freeChildCount)},normalChildUpdate=this.changeTouristConsideringFreeChild("normalChild",".normalChild-choose .minus",".normalChild-choose .plus",".normalChild-choose input",minNormalChildCount,maxNormalChildCountFunc,function(){changeNormalChildCount(),changeTotalChildrenCount()}),freeChildUpdate=this.changeTouristConsideringFreeChild("freeChild",".freeChild-choose .minus",".freeChild-choose .plus",".freeChild-choose input",minFreeChildCount,maxFreeChildCountFunc,function(){changeFreeChildCount(),changeTotalChildrenCount()}),this.changeTouristConsideringFreeChild("adult",".adult-choose .minus",".adult-choose .plus",".adult-choose input",minAdultCount,maxAdultCountFunc,function(){normalChildUpdate(),freeChildUpdate(),changeAdultCount()})},changeTouristConsideringFreeChild:function(passengerType,minus,plus,_input,minValue,maxValueFunc,notify){var currentValue,limitCurrentValue,updateMinusLabel,updatePlusLabel,update,self=this;return currentValue=parseInt($(_input).val(),10),limitCurrentValue=function(){var oldValue;currentValue?(oldValue=currentValue,currentValue=Math.max(currentValue,minValue),maxValueFunc&&(currentValue=Math.min(currentValue,maxValueFunc())),oldValue>currentValue&&eventBus.trigger("passengerNumChange",passengerType,"minus",oldValue-currentValue)):currentValue=minValue},limitCurrentValue(),updateMinusLabel=function(){currentValue>minValue?$(minus).addClass("on"):$(minus).removeClass("on")},updatePlusLabel=function(){return!!maxValueFunc&&void(currentValue<maxValueFunc()?$(plus).addClass("on"):$(plus).removeClass("on"))},update=function(){limitCurrentValue(),$(_input).val(currentValue),updateMinusLabel(),updatePlusLabel(),notify&&notify()},this.$el.on("click",plus,function(){return maxValueFunc&&currentValue>=maxValueFunc()?(self.beyondMaxValue($(_input).parent(".input_number")),!1):(currentValue++,$(this).parent().attr("class").indexOf("adult")>0?eventBus.trigger("adultPlus"):$(this).parent().attr("class").indexOf("normalChild")>0?eventBus.trigger("normalChildPlus"):$(this).parent().attr("class").indexOf("freeChild")>0&&eventBus.trigger("freeChildPlus"),void update())}),this.$el.on("click",minus,function(){return!(currentValue<=minValue)&&(currentValue--,$(this).parent().attr("class").indexOf("adult")>0?eventBus.trigger("adultMinus"):$(this).parent().attr("class").indexOf("normalChild")>0?eventBus.trigger("normalChildMinus"):$(this).parent().attr("class").indexOf("freeChild")>0&&eventBus.trigger("freeChildMinus"),void update())}),update},changeStatus:function(){var adult_choose,normalChild_choose,freeChild_choose,$node=this.$el,minFreeChildCount=0,minNormalChildCount=0,minAdultCount=1,maxNormalChildCountFunc=function(){return 4*+adult_choose.find("input").val()},maxFreeChildCountFunc=function(){return+adult_choose.find("input").val()},maxAdultCountFunc=null;adult_choose=$node.find(".adult-choose"),normalChild_choose=$node.find(".normalChild-choose"),freeChild_choose=$node.find(".freeChild-choose"),this.setChooseBtnInitialStatus(normalChild_choose,minNormalChildCount,maxNormalChildCountFunc),this.setChooseBtnInitialStatus(freeChild_choose,minFreeChildCount,maxFreeChildCountFunc),this.setChooseBtnInitialStatus(adult_choose,minAdultCount,maxAdultCountFunc)},beyondMaxValue:function($input_number){var $tip=$input_number.find(".number-tip");$tip.queue().length||$tip.fadeIn().delay(2e3).fadeOut()}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,$string=($utils.$helpers,$utils.$string),productName=$data.productName,$escape=$utils.$escape,productId=$data.productId,_=$data._,departCityList=$data.departCityList,departCity=($data.item,$data.departCity),transportDepartCityName=$data.transportDepartCityName,departCityName=$data.departCityName,journeyName=$data.journeyName,overLenFlag=$data.overLenFlag,backCityList=$data.backCityList,backCity=$data.backCity,backCityName=$data.backCityName,supportChangeDepartDate=$data.supportChangeDepartDate,calendarListShow=$data.calendarListShow,prevBtnDisabled=$data.prevBtnDisabled,helperGetCalendarDate=$data.helperGetCalendarDate,calendarDate=$data.calendarDate,helperFormatCalendarDate=$data.helperFormatCalendarDate,nextBtnDisabled=$data.nextBtnDisabled,formatCalendarList=$data.formatCalendarList,helperFormatCalendarDay=($data.calendarDay,$data.helperFormatCalendarDay),resourceError=$data.resourceError,defaultCalendar=$data.defaultCalendar,calendarList=$data.calendarList,constant=$data.constant,proMode=$data.proMode,supportChangeAdult=$data.supportChangeAdult,adultNum=$data.adultNum,supportChangeNormalChild=$data.supportChangeNormalChild,normalChildNum=$data.normalChildNum,supportChangeFreeChild=$data.supportChangeFreeChild,freeChildNum=$data.freeChildNum,trainChildStandard=$data.trainChildStandard,trainFreeChildStandard=$data.trainFreeChildStandard,supportChangeChild=$data.supportChangeChild,childNum=$data.childNum,childStandard=$data.childStandard,multiJourneyInfo=$data.multiJourneyInfo,isShow=$data.isShow,vendorList=$data.vendorList,cruiseVendorId=$data.cruiseVendorId,$out="";if($out+='<div class="modular-body">\r\n    <div class="price-title">\r\n        <p class="name">\r\n            <i class="icon name-icon"></i>',$out+=$string(productName),$out+='\r\n        </p>\r\n        <p class="order-id">编号：',$out+=$escape(productId),$out+='</p>\r\n    </div>\r\n\r\n    <div class="book-tourist-info">\r\n        <div class="book-tourist-main">\r\n            <div class="row">\r\n                <div class="field field-width J_departCity">\r\n                    <label class="c9">出发城市</label>\r\n                    <div class="input_select w_200 ',!_.isEmpty(departCityList)&&departCityList.length>1&&($out+="s_cnum_more"),$out+='">\r\n                        <ul class="s_clist">\r\n                            ',_.each(departCityList,function(item){$out+='\r\n                            <li cityCode="',$out+=$escape(item.departCityCode),$out+='"\r\n                                title="',$out+=$escape(item.departCityName),$out+='">',$out+=$escape(item.departCityName),$out+="</li>\r\n                            "}),$out+='\r\n                        </ul>\r\n                        <div class="s_cnum ',_.isEmpty(departCityList)||1!=departCityList.length||($out+="s_cnum_onlyone"),$out+='">\r\n                            ',!_.isEmpty(departCityList)&&departCityList.length>1&&($out+='\r\n                            <span class="sc_arrow"></span>\r\n                            '),$out+='\r\n                            <p class="s_ccon"\r\n                            citycode="',$out+=$escape(departCity),$out+='">',$out+=$escape(transportDepartCityName?transportDepartCityName:departCityName),$out+="</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                ",journeyName){var overLenFlag=journeyName.length>8;$out+='\r\n                <div class="field field-width journey-package">\r\n                    <label class="c9">行程套餐</label>\r\n                    <div class="input_select w_200">\r\n                        <div class="s_cnum s_cnum_onlyone">\r\n                            <p class="s_ccon" title="',$out+=$escape(overLenFlag?journeyName:""),$out+='">',$out+=$escape(journeyName.substring(0,8)+(overLenFlag?"...":"")),$out+="</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                "}if($out+="\r\n            </div>\r\n            ",!_.isEmpty(backCityList)&&backCityList.length>1&&($out+='\r\n            <div class="field J_backCity">\r\n                <label class="c9">归来城市</label>\r\n                <div class="input_select w_200 s_cnum_more">\r\n                    <ul class="s_clist">\r\n                        ',_.each(backCityList,function(item){$out+='\r\n                    <li cityCode="',$out+=$escape(item.backCityCode),$out+='" title="',$out+=$escape(item.backCityName),$out+='">',$out+=$escape(item.backCityName),$out+="</li>\r\n                        "}),$out+='\r\n                    </ul>\r\n                    <div class="s_cnum">\r\n                        <span class="sc_arrow"></span>\r\n                        <p class="s_ccon" citycode="',$out+=$escape(backCity),$out+='">',$out+=$escape(backCityName),$out+="</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            "),$out+='\r\n            <div class="field J_departDate">\r\n                <label class="c9">出发日期</label>\r\n                <div class="input_select w_350">\r\n                    ',supportChangeDepartDate){$out+="\r\n                    ",calendarListShow&&($out+='\r\n                    <div class="calendar-wrapper">\r\n                        <span class="icon white-triangle"></span>\r\n                        <div class="calendar-date">\r\n                        <span class="prev ',prevBtnDisabled&&($out+="disabled"),$out+='">\r\n                            <i class="tn_fontface">&#xe61e;</i>\r\n                            ',prevBtnDisabled||($out+='\r\n                            <span class="month-text">',$out+=$escape(helperGetCalendarDate(calendarDate,"prev")),$out+="</span>\r\n                            "),$out+="\r\n                        </span>\r\n                            ",$out+=$escape(helperFormatCalendarDate(calendarDate)),$out+='\r\n                            <span class="next ',nextBtnDisabled&&($out+="disabled"),$out+='">\r\n                                ',nextBtnDisabled||($out+='\r\n                                <span class="month-text">',$out+=$escape(helperGetCalendarDate(calendarDate,"next")),$out+="</span>\r\n                                "),$out+='\r\n                                <i class="tn_fontface">&#xe621;</i>\r\n                        </span>\r\n                        </div>\r\n                        <div class="calendar-week">\r\n                            <span>日</span>\r\n                            <span>一</span>\r\n                            <span>二</span>\r\n                            <span>三</span>\r\n                            <span>四</span>\r\n                            <span>五</span>\r\n                            <span>六</span>\r\n                            <div class="clear-float"></div>\r\n                        </div>\r\n                        <ul class="calendar-day">\r\n                            ',_.each(formatCalendarList,function(item){$out+='\r\n                            <li data="',$out+=1==item.excludeChildFlag?"1":"0",$out+='"\r\n                                departdate="',$out+=$escape(item.departDate),$out+='"\r\n                                adultprice="',$out+=$escape(item.tuniuPrice),$out+='"\r\n                                childprice="',0==item.excludeChildFlag&&($out+=" ",$out+=$escape(item.childPrice),$out+=" "),$out+='"\r\n                                roomaddbudget="',$out+=$escape(item.roomAddBudget),$out+='"\r\n                                class="',item.selected&&item.currentMonth&&($out+="selected"),$out+=" ",item.currentMonth||($out+="not-current-month"),$out+='">\r\n                                ';var calendarDay=helperFormatCalendarDay(item.departDate);$out+='\r\n                                <div class="first-line ',"今天"==calendarDay&&($out+="current-day"),$out+='">\r\n                                    ',$out+=$escape(calendarDay),$out+='\r\n                                </div>\r\n                                <div class="second-line">\r\n                                    ',item.tuniuPrice&&item.currentMonth&&($out+="\r\n                                    ￥",$out+=$escape(item.tuniuPrice),$out+="\r\n                                    "),$out+="\r\n                                </div>\r\n                            </li>\r\n                            "}),$out+='\r\n                            <div class="clear-float"></div>\r\n                        </ul>\r\n                    </div>\r\n                    '),$out+='\r\n                    <div class="s_cnum ',resourceError&&($out+="resource-error"),$out+='">\r\n                        <span class="sc_arrow"></span>\r\n                        ';var defaultCalendar=_.find(calendarList,function(item){return item.selected});$out+="\r\n                        ",defaultCalendar&&($out+='\r\n                        <p class="f-ol s_ccon" title="',$out+=$escape(defaultCalendar.formatStr),$out+='"\r\n                           departdate="',$out+=$escape(defaultCalendar.departDate),$out+='"\r\n                           adultprice="',$out+=$escape(defaultCalendar.tuniuPrice),$out+='"\r\n                           childprice="',0==defaultCalendar.excludeChildFlag&&($out+=" ",$out+=$escape(defaultCalendar.childPrice),$out+=" "),$out+='"\r\n                           roomaddbudget="',$out+=$escape(defaultCalendar.roomAddBudget),$out+='">\r\n                            ',$out+=$escape(defaultCalendar.formatStr),$out+="\r\n                        </p>\r\n                        "),$out+="\r\n                    </div>\r\n                    "}else{$out+='\r\n                    <div class="s_cnum s_cnum_onlyone ',resourceError&&($out+="resource-error"),$out+='">\r\n                        ';var defaultCalendar=_.find(calendarList,function(item){return item.selected});$out+="\r\n                        ",defaultCalendar&&($out+='\r\n                        <p class="f-ol s_ccon" title="',$out+=$escape(defaultCalendar.formatStr),$out+='"\r\n                           departdate="',$out+=$escape(defaultCalendar.departDate),$out+='"\r\n                           adultprice="',$out+=$escape(defaultCalendar.tuniuPrice),$out+='"\r\n                           childprice="',0==defaultCalendar.excludeChildFlag&&($out+=" ",$out+=$escape(defaultCalendar.childPrice),$out+=" "),$out+='"\r\n                           roomaddbudget="',$out+=$escape(defaultCalendar.roomAddBudget),$out+='">\r\n                            ',$out+=$escape(defaultCalendar.formatStr),$out+="\r\n                        </p>\r\n                        "),$out+="\r\n                    </div>\r\n                    "}return $out+='\r\n                    <div class="T_tri_pop ',resourceError||($out+="hide"),$out+='">\r\n                        <span class="T_tri_outside">\r\n                            <em class="T_tri_inside"></em>\r\n                        </span>\r\n                        您可以在此更换团期\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n\r\n            ',_.indexOf(constant.TRAIN_PRO_MODE,proMode)!=-1?($out+='\r\n            <div class="field J_touristCount tourist-choose">\r\n                <label class="tourist-num c9">出游人数</label>\r\n                <div class="input_number adult-choose J_adult">\r\n                    ',supportChangeAdult?($out+='\r\n                <a class="tn_fontface minus"></a><input type="text" class="value" readonly value="',$out+=$escape(adultNum),$out+='"><a class="tn_fontface plus on"></a>\r\n                    '):($out+='\r\n                    <span class="person-number">',$out+=$escape(adultNum),$out+="</span>\r\n                    "),$out+="\r\n                    <label>成人</label>\r\n                    ",!supportChangeNormalChild&&normalChildNum&&($out+='\r\n                    <span class="person-number">',$out+=$escape(normalChildNum),$out+="</span>\r\n                    <label>儿童</label>\r\n                    "),$out+="\r\n                    ",!supportChangeFreeChild&&freeChildNum&&($out+='\r\n                    <span class="person-number">',$out+=$escape(freeChildNum),$out+="</span>\r\n                    <label>免票儿童</label>\r\n                    "),$out+="\r\n                </div>\r\n                ",defaultCalendar&&0==defaultCalendar.excludeChildFlag?($out+="\r\n                ",supportChangeNormalChild&&($out+='\r\n                <div class="input_number normalChild-choose J_normalChild">\r\n                        <a class="tn_fontface minus"></a><input type="text" class="value" readonly value="',$out+=$escape(normalChildNum),$out+='"><a class="tn_fontface plus on"></a>\r\n                    <label for="">含火车票儿童</label>\r\n                    <div class="jtxz-detail2 auto-width number-tip">\r\n                        <p class="YD_mgb">每位成人最多可携带4名普通儿童</p>\r\n                        <span class="z">◆</span>\r\n                        <span class="j">◆</span>\r\n                    </div>\r\n                    <div class="childCount-tips jtxz-detail-hover">\r\n                        <i class="icon notice2-icon"></i>\r\n                        <div class="jtxz-detail2">\r\n                            <p class="YD_mgb">',$out+=$escape(trainChildStandard),$out+='</p>\r\n                            <span class="z">◆</span>\r\n                            <span class="j">◆</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                '),$out+="\r\n                ",supportChangeFreeChild&&($out+='\r\n                <div class="input_number freeChild-choose J_freeChild">\r\n                        <a class="tn_fontface minus"></a><input type="text" class="value" readonly value="',$out+=$escape(freeChildNum),$out+='"><a class="tn_fontface plus on"></a>\r\n                    <label for="">免火车票儿童</label>\r\n                    <div class="jtxz-detail2 auto-width number-tip">\r\n                        <p class="YD_mgb">每位成人最多可携带1名免票儿童</p>\r\n                        <span class="z">◆</span>\r\n                        <span class="j">◆</span>\r\n                    </div>\r\n                    <div class="childCount-tips jtxz-detail-hover">\r\n                        <i class="icon notice2-icon"></i>\r\n                        <div class="jtxz-detail2">\r\n                            <p class="YD_mgb">',$out+=$escape(trainFreeChildStandard),$out+='</p>\r\n                            <span class="z">◆</span>\r\n                            <span class="j">◆</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                '),$out+="\r\n                "):($out+='\r\n                <div class="input_number">\r\n                    <div class="childCount-tips jtxz-detail-hover">\r\n                        <i class="icon notice2-icon"></i>\r\n                        <div class="jtxz-detail2">\r\n                            <p class="YD_mgb">',$out+=$escape(trainChildStandard),$out+='</p>\r\n                            <span class="z">◆</span>\r\n                            <span class="j">◆</span>\r\n                        </div>\r\n                    </div>\r\n                    <label>本团期不支持儿童出游</label>\r\n                </div>\r\n                '),$out+="\r\n            </div>\r\n            "):($out+='\r\n            <div class="field J_touristCount">\r\n            <label class="tourist-num c9">出游人数</label>\r\n                <div class="input_number J_adultCount">\r\n                    ',supportChangeAdult?($out+='\r\n                <a class="tn_fontface minus"></a><input type="text" class="value" readonly value="',$out+=$escape(adultNum),$out+='"><a class="tn_fontface plus"></a>\r\n                    '):($out+='\r\n                    <span class="person-number">',$out+=$escape(adultNum),$out+="</span>\r\n                    "),$out+="\r\n                    <label>成人</label>\r\n                    ",!supportChangeChild&&childNum&&($out+='\r\n                    <span class="person-number">',$out+=$escape(childNum),$out+="</span>\r\n                    <label>儿童</label>\r\n                    "),$out+="\r\n                </div>\r\n                ",defaultCalendar&&0==defaultCalendar.excludeChildFlag?($out+="\r\n                ",supportChangeChild&&($out+='\r\n                <div class="input_number J_childCount">\r\n                <a class="tn_fontface minus"></a><input type="text" class="value" readonly value="',$out+=$escape(childNum),$out+='"><a class="tn_fontface plus"></a>\r\n                    <label>儿童</label>\r\n                    <div class="childCount-tips jtxz-detail-hover">\r\n                        <i class="icon notice2-icon"></i>\r\n                        <div class="jtxz-detail2">\r\n                            <p class="YD_mgb">',$out+=$escape(childStandard),$out+='</p>\r\n                            <span class="z">◆</span>\r\n                            <span class="j">◆</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                '),$out+="\r\n                "):($out+='\r\n                <div class="input_number">\r\n                    <div class="childCount-tips jtxz-detail-hover">\r\n                        <i class="icon notice2-icon"></i>\r\n                        <div class="jtxz-detail2">\r\n                            <p class="YD_mgb">',$out+=$escape(childStandard),$out+='</p>\r\n                            <span class="z">◆</span>\r\n                            <span class="j">◆</span>\r\n                        </div>\r\n                    </div>\r\n                    <label>本团期不支持儿童出游</label>\r\n                </div>\r\n                '),$out+="\r\n            </div>\r\n            "),$out+="\r\n\r\n            ",multiJourneyInfo&&($out+='\r\n            <div class="field multi-journey clear-float">\r\n                <label class="c9">适用行程</label>\r\n                <span>',$out+=$escape(multiJourneyInfo),$out+='</span>\r\n                <div class="clear-float"></div>\r\n            </div>\r\n            '),$out+="\r\n            ",isShow&&($out+='\r\n            <div class="field J_vendor">\r\n                <label class="c9">选择套餐</label>\r\n                <div class="vendor-list">\r\n                    ',_.each(vendorList,function(item){$out+='                             \r\n                                <div class="J_vendorItem u-checkbox ',$out+=$escape(item.vendorId==cruiseVendorId?"active":""),$out+='" data-vendor="',$out+=$escape(item.vendorId),$out+='">\r\n                                    <p>',$out+=$escape(item.vendorName),$out+='</p>\r\n                                    <p><span class="price">¥',$out+=$escape(item.adultPrice),$out+='</span><span class="text">起/人</span></p>\r\n                                    <i></i>\r\n                                </div>\r\n                    '}),$out+="                    \r\n                </div>\r\n            </div>\r\n            "),$out+="\r\n\r\n        </div>\r\n    </div>\r\n\r\n\r\n</div>",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(factory){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(14)],__WEBPACK_AMD_DEFINE_FACTORY__=factory,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function($){function Scroll(options){this._init(options)}var defaultOptions={yScroll:!0,xScroll:!1,fixedScrollObjHeight:!0,scrollWrapperStyle:null,scrollObjStyle:null,fixedScrollObjWidth:!0,scrollWrapperStyleX:null,scrollObjStyleX:null,delta:0,deltaX:0},minScrollObjHeight=30,minScrollObjWidth=30;Scroll.prototype._init=function(options){this._options=$.extend({},defaultOptions,options),this.$container=null,this.$scrollWrapper=null,this.$scrollObj=null,this.$slideDiv=null,this.$el=this._options.el,this._loopIndex="",this._pageY="",this.$el.children(".T_scroll_main").length?this._findElement():this._addElement(),this._bindEvents(),this._setLoop()},Scroll.prototype._addElement=function(){var self=this;this.$slideDiv=$('<div class="T_slide"></div>'),this.$el.append(this.$slideDiv),this.$el.contents().each(function(index,item){$(item).hasClass("T_slide")||self.$slideDiv.append(item)}),this.$scrollWrapper=$('<div class="T_scroll_wrapper">'),this.$scrollObj=$('<div class="T_scroll_obj">');var scrollWrapperStyle=this._options.scrollWrapperStyle,scrollObjStyle=this._options.scrollObjStyle;if(scrollWrapperStyle&&this.$scrollWrapper.css(scrollWrapperStyle),scrollObjStyle&&this.$scrollObj.css(scrollObjStyle),this.$scrollWrapper.append(this.$scrollObj),this.$el.append(this.$scrollWrapper),this._options.xScroll){this.$scrollWrapperX=$('<div class="T_scroll_wrapper_x">'),this.$scrollObjX=$('<div class="T_scroll_obj_x">');var scrollWrapperStyleX=this._options.scrollWrapperStyle,scrollObjStyleX=this._options.scrollObjStyle;scrollWrapperStyleX&&this.$scrollWrapperX.css(scrollWrapperStyleX),scrollObjStyleX&&this.$scrollObjX.css(scrollObjStyleX),this.$scrollWrapperX.append(this.$scrollObjX),this.$el.append(this.$scrollWrapperX)}this.$container=$('<div class="T_scroll_main"></div>'),this.$el.append(this.$container),this.$el.contents().each(function(index,item){$(item).hasClass("T_scroll_main")||self.$container.append(item)})},Scroll.prototype._findElement=function(){this.$container=this.$el.children(".T_scroll_main"),this.$scrollWrapper=this.$container.children(".T_scroll_wrapper"),this.$scrollObj=this.$scrollWrapper.children(".T_scroll_obj"),this._options.xScroll&&(this.$scrollWrapperX=this.$container.children(".T_scroll_wrapper_x"),this.$scrollObjX=this.$scrollWrapper.children(".T_scroll_obj_x")),this.$slideDiv=this.$container.children(".T_slide")},Scroll.prototype._bindEvents=function(){var self=this;window.addEventListener&&this.$el[0]&&this.$el[0].addEventListener("DOMMouseScroll",$.proxy(this._scrollFunc,this),!1),this.$el[0]&&(this.$el[0].onmousewheel=$.proxy(this._scrollFunc,this)),this.$scrollObj.off().on("mouseenter",function(){document.body.onselectstart||(document.body.onselectstart=function(){return!1})}),this.$scrollObj.on("mousedown",function(e){1==e.which&&(self._pageY=e.pageY,$(document).on("mousemove.scroll",$.proxy(self._moveFunc,self)))}),this._options.xScroll&&(this.$scrollObjX.off().on("mouseenter",function(){document.body.onselectstart||(document.body.onselectstart=function(){return!1})}),this.$scrollObjX.on("mousedown",function(e){1==e.which&&(self._pageX=e.pageX,$(document).on("mousemove.scroll",$.proxy(self._moveFuncX,self)))})),$(document).on("mouseup.scroll",function(e){1==e.which&&self._stop()})},Scroll.prototype._scrollFunc=function(e){e=e||window.event;var deltaY;"object"==typeof e?(e.preventDefault?e.preventDefault():e.returnValue=!1,deltaY=(e.wheelDelta?-e.wheelDelta:e.detail/3*120)/5):deltaY=e;var newTop,top=this._getSlideTop(),ratio=this._getRatio();if(deltaY>0){if(this._getContentHeight()>this._getHeight()){newTop=top-deltaY;var maxSlideHeight=this._getMaxSlideHeight();Math.abs(newTop)>maxSlideHeight?this.$slideDiv.css("top",-maxSlideHeight):this.$slideDiv.css("top",newTop),"object"==typeof e&&this._moveFunc(deltaY/ratio)}}else newTop=top-deltaY,newTop>0?this.$slideDiv.css("top",0):this.$slideDiv.css("top",newTop),"object"==typeof e&&this._moveFunc(deltaY/ratio)},Scroll.prototype._scrollFuncX=function(e){var newLeft,deltaX=e,left=this._getSlideLeft();if(deltaX>0){if(this._getContentWidth()>this._getWidth()){newLeft=left-deltaX;var maxSlideWidth=this._getMaxSlideWidth();Math.abs(newLeft)>maxSlideWidth?this.$slideDiv.css("left",-maxSlideWidth):this.$slideDiv.css("left",newLeft)}}else newLeft=left-deltaX,newLeft>0?this.$slideDiv.css("left",0):this.$slideDiv.css("left",newLeft)},Scroll.prototype._moveFunc=function(e){var deltaY,newTop,top=this._getScrollObjTop(),maxScrollHeight=this._getMaxScrollHeight(),ratio=this._getRatio(),height=this._getHeight();"object"==typeof e?(deltaY=e.pageY-this._pageY,newTop=top+deltaY,newTop<0?newTop=0:newTop>maxScrollHeight&&(newTop=maxScrollHeight),this._scrollFunc(deltaY*ratio),this.$scrollObj.css("top",newTop),this._pageY=e.pageY):(deltaY=e,newTop=top+deltaY,newTop<0?newTop=0:newTop>maxScrollHeight&&(newTop=maxScrollHeight),this.$scrollObj.css("top",newTop),this._pageY=newTop+height)},Scroll.prototype._moveFuncX=function(e){var deltaX,newLeft,left=this._getScrollObjLeft(),maxScrollWidth=this._getMaxScrollWidth(),ratioX=this._getRatioX();deltaX=e.pageX-this._pageX,newLeft=left+deltaX,newLeft<0?newLeft=0:newLeft>maxScrollWidth&&(newLeft=maxScrollWidth),this._scrollFuncX(deltaX*ratioX),this.$scrollObjX.css("left",newLeft),this._pageX=e.pageX},Scroll.prototype._setLoop=function(){function calculate(){var height=self._getHeight(),maxHeight=self._getMaxHeight(),contentHeight=self._getContentHeight(),width=self._getWidth(),contentWidth=self._getContentWidth();if("none"==maxHeight?self.$container.css("max-height","none"):self.$container.css("max-height",parseInt(maxHeight)),self._options.xScroll){var slideWidth=[Math.max.apply(Math,self.$slideDiv.children().map(function(index,item){return $(item).outerWidth(!0)})),"100%"],parentWidth=self.$slideDiv.parent().width();slideWidth[0]>parentWidth?self.$slideDiv.css("width",slideWidth[0]):self.$slideDiv.css("width",slideWidth[1])}if(!self._options.fixedScrollObjHeight){var resultHeight=height*height/contentHeight,resultWidth=width*width/contentWidth;resultHeight<minScrollObjHeight&&(resultHeight=minScrollObjHeight),resultWidth<minScrollObjWidth&&(resultWidth=minScrollObjWidth),self.$scrollObj.height(resultHeight),self._options.xScroll&&!self._options.fixedScrollObjWidth&&self.$scrollObjX.width(resultWidth)}height>=contentHeight?(self.$scrollWrapper.hide(),self.$scrollObj.css("top",0),self.$slideDiv.css("top",0)):self.$scrollWrapper.show(),self._options.xScroll&&(width>=contentWidth?(self.$scrollWrapperX.hide(),
self.$scrollObjX.css("left",0),self.$slideDiv.css("left",0)):self.$scrollWrapperX.show());var wrapperWidth=self.$scrollWrapper.width();if(self._options.xScroll)var wrapperXHeight=self.$scrollWrapperX.height();var delta=self._options.delta,deltaX=self._options.deltaX;height<contentHeight?self.$slideDiv.css("paddingRight",wrapperWidth+delta):self.$slideDiv.css("paddingRight",delta),self._options.xScroll&&(width<contentWidth?self.$slideDiv.css("paddingBottom",wrapperXHeight+deltaX):self.$slideDiv.css("paddingBottom",deltaX)),height<contentHeight&&width<contentWidth&&self._options.xScroll?(self.$scrollWrapper.css("height",height-wrapperWidth),self.$scrollWrapperX.css("width",width-wrapperXHeight)):(self.$scrollWrapper.css("height",height),self._options.xScroll&&self.$scrollWrapperX.css("width",width))}var self=this;this._loopIndex=setInterval(calculate,200),calculate()},Scroll.prototype._stop=function(){$(document).off("mousemove.scroll"),document.body.onselectstart&&(document.body.onselectstart=null)},Scroll.prototype.scrollY=function(target){var top,oldTop=this._getSlideTop();return"object"==typeof target?top=oldTop+target.position().top:"number"==typeof target&&(top=oldTop+target),this._scrollFunc(top),this._moveFunc(top/this._getRatio()),this},Scroll.prototype._getHeight=function(){return this.$el.innerHeight()},Scroll.prototype._getWidth=function(){return this.$el.innerWidth()},Scroll.prototype._getMaxHeight=function(){return this.$el.css("max-height")},Scroll.prototype._getContentHeight=function(){return this.$slideDiv.innerHeight()},Scroll.prototype._getContentWidth=function(){return this.$slideDiv.innerWidth()},Scroll.prototype._getMaxSlideHeight=function(){return this._getContentHeight()-this._getHeight()},Scroll.prototype._getMaxSlideWidth=function(){return this._getContentWidth()-this._getWidth()},Scroll.prototype._getMaxScrollHeight=function(){return this._getScrollWrapperHeight()-this.$scrollObj.height()},Scroll.prototype._getMaxScrollWidth=function(){return this._getScrollWrapperWidth()-this.$scrollObjX.width()},Scroll.prototype._getRatio=function(){return this._getMaxSlideHeight()/this._getMaxScrollHeight()},Scroll.prototype._getRatioX=function(){return this._getMaxSlideWidth()/this._getMaxScrollWidth()},Scroll.prototype._getTop=function(){return this.$el.offset().top},Scroll.prototype._getSlideTop=function(){return parseFloat(this.$slideDiv.css("top"))},Scroll.prototype._getSlideLeft=function(){return parseFloat(this.$slideDiv.css("left"))},Scroll.prototype._getScrollWrapperHeight=function(){return parseFloat(this.$scrollWrapper.innerHeight())},Scroll.prototype._getScrollWrapperWidth=function(){return parseFloat(this.$scrollWrapperX.innerWidth())},Scroll.prototype._getScrollObjTop=function(){return parseFloat(this.$scrollObj.css("top"))},Scroll.prototype._getScrollObjLeft=function(){return parseFloat(this.$scrollObjX.css("left"))},$.fn.tScroll=$.fn.TScroll=function(options){return options?options.el=this:options={el:this},new Scroll(options)}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(14),__webpack_require__(6),__webpack_require__(5),__webpack_require__(16),__webpack_require__(11)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,$,config,eventBus,tools,constant){var pageDataObj=config.pageDataObj;return"tour_order2"!=pageDataObj.pageType&&"self_tour2"!=pageDataObj.pageType||(""==pageDataObj.normalChildNumTips&&(pageDataObj.normalChildNumTips="1、身高标准1.2-1.5米，含火车票，当地旅游车位费、导游服务费；不含住宿费且不占床位、不含门票及早餐。 2、由于儿童火车票实时计算，本价格中含火车票儿童价格暂按成人火车票价格计算展示，下单成功后自动改为儿童火车票价格计算收费"),""==pageDataObj.freeChildNumTips&&(pageDataObj.freeChildNumTips="身高标准1.19米及以下，免购火车票，但不含火车票座位或铺位。该价格只含当地旅游车位费、导游服务费；其他接待费用均不包含")),Backbone.Model.extend({defaults:function(){return{productId:null,productName:null,departDate:null,arriveDate:null,departCity:null,departCityName:null,backCity:null,backCityName:null,adultNum:null,childNum:null,adultPrice:0,childPirce:0,fromUrl:void 0,cityCodeFromDetail:void 0,isNewInsuranceFlag:void 0,combinedTransport:null,departCityList:null,backCityList:null,calendarList:null,trainChildStandard:pageDataObj.normalChildNumTips,trainFreeChildStandard:pageDataObj.freeChildNumTips,childStandard:"儿童价标准：身高0.8~1.2米（含），不占床，只包含座位费，其余产生费用自理",resourceError:!1,calendarDate:"",nextBtnDisabled:!1,prevBtnDisabled:!1,calendarListShow:!1,transportDepartCityName:"",supportChangeDepartDate:!0,supportChangeAdult:!0,supportChangeChild:!0,supportChangeNormalChild:!0,supportChangeFreeChild:!0,constant:constant,multiJourneyInfo:"",showDepartCity:!0,stayDays:"",stayDaysTip:"",personLabel:Backbone.app.get("personLabel"),journeyId:"",journeyName:"",vendorList:[],cruiseVendorId:0,isShow:!1}},initialize:function(){"self_tour2"==pageDataObj.pageType&&this.formatDiyData(),this.initData(pageDataObj),this.on("change:adultNum change:childNum",function(){eventBus.trigger("touristNumChange")}),this.on("change:departCity",function(){this.refresh_page("back_city")}),this.on("change:backCity",function(){this.refresh_page("")}),this.on("change:departDate",function(){eventBus.trigger("initCruiseVendor"),this.refresh_page("")}),this.on("change:cruiseVendorId",function(){eventBus.trigger("cruiseVendorChange")})},formatDiyData:function(){pageDataObj.productName=pageDataObj.mainResParams.productInfo.productName,pageDataObj.departDate=this.formatDate(pageDataObj.departDate),pageDataObj.backDate=this.formatDate(pageDataObj.mainResParams.productInfo.backDate)},initData:function(params){if(params){if(null===this.get("productId")){this.set("productId",params.productId),this.set("productName",params.productName),this.set("departDate",params.departDate),this.set("arriveDate",params.backDate),this.set("departCity",params.departCity),this.set("departCityCode",params.departCityCode),this.set("adultNum",params.adultNum),this.set("childNum",params.childNum),this.set("adultPrice",params.adultPrice),this.set("childPrice",params.childPrice),this.set("fromUrl",params.fromUrl),this.set("departCityName",params.departCityName),this.set("isNewInsuranceFlag",params.isNewInsuranceFlag),this.set("backCity",params.backCity),this.set("backCityName",params.backCityName),this.set("normalChildPrice",params.normalChildPrice),this.set("freeChildPrice",params.freeChildPrice),this.set("normalChildNum",params.normalChildNum),this.set("freeChildNum",params.freeChildNum||0),this.set("bookCityFromDetail",params.cityCodeFromDetail),this.set("bookCity",params.bookCity),this.set("combinedCityCode",params.combinedCityCode||""),this.set("combinedCityName",params.combinedCityName||""),this.set("departCityList",params.departCityList),this.set("backCityList",params.backCityList),this.set("calendarList",params.calendarList),this.set("multiJourneyInfo",params.multiJourneyInfo),params.childStandard&&this.set("childStandard",params.childStandard);var dateObj=tools.formatDate(params.departDate);dateObj.setDate(1),this.set("calendarDate",tools.parseDate(dateObj)),this.set("budgetNum",params.roomGrapFlag?2:3),this.set("cruiseVendorId",params.cruiseVendorId,{silent:!0})}"self_tour2"!=pageDataObj.pageType&&"drive_routine2"!=pageDataObj.pageType||this.set({supportChangeAdult:!1,supportChangeChild:!1,supportChangeNormalChild:!1,supportChangeFreeChild:!1,supportChangeDepartDate:!1}),this.set("journeyId",params.journeyId),this.set("journeyName",params.journeyName),"visa2"==pageDataObj.pageType&&this.set("showDepartCity",!1)}eventBus.trigger("calculate")},formatDate:function(dateStr){var returnStr="",dataArr=dateStr?dateStr.split("-"):[];return 3!=dataArr.length?dateStr:(returnStr+=dataArr[0]+"-",returnStr+=(2==dataArr[1].length?dataArr[1]:"0"+dataArr[1])+"-",returnStr+=2==dataArr[2].length?dataArr[2]:"0"+dataArr[2])},refresh_page:function(type){function productInput(name,value){$("<input />",{type:"text",name:name,value:value}).appendTo(form)}var orderData=this.toJSON();orderData.telNum=pageDataObj.telNum;var form=$("<form />",{action:"",method:"post"}).appendTo("body");_.each(orderData,function(value,key){var name=void 0;switch(key){case"productId":name="route_id";break;case"departDate":name="begin_date";break;case"departCity":name="dep_city";break;case"backCity":name="back_city";break;case"adultNum":name="user_num";break;case"childNum":_.indexOf(constant.TRAIN_PRO_MODE,pageDataObj.proMode)==-1&&(name="child_count");break;case"normalChildNum":_.indexOf(constant.TRAIN_PRO_MODE,pageDataObj.proMode)!=-1&&(name="child_count");break;case"freeChildNum":name="freeChildCount";break;case"fromUrl":name="from_url";break;case"telNum":name="tel_reg";break;case"bookCityFromDetail":name="bookCityCode_FromDetail"}name&&name!=type&&productInput(name,value)}),form.submit()},getCalendar:function(calendarDate){var data=this.toJSON();calendarDate=tools.formatDate(calendarDate||data.calendarDate);for(var calendarList=data.calendarList,list=[],firstDay=new Date(calendarDate.setDate(1)),month=firstDay.getMonth(),week=firstDay.getDay(),count=42;week--;){count--,firstDay.setDate(firstDay.getDate()-1);var currentDate=tools.parseDate(firstDay),find=_.some(calendarList,function(item){if(item.departDate==currentDate)return list.push(_.extend({currentMonth:!1},item)),!0});find||list.push({departDate:currentDate,currentMonth:!1})}for(list.reverse(),firstDay=new Date(calendarDate.setDate(1));count--;){var currentMonth=!0;firstDay.getMonth()>month&&(currentMonth=!1);var currentDate=tools.parseDate(firstDay),find=_.some(calendarList,function(item){if(item.departDate==currentDate)return list.push(_.extend({currentMonth:currentMonth},item)),!0});find||list.push({departDate:currentDate,currentMonth:currentMonth}),firstDay.setDate(firstDay.getDate()+1)}return list},prevCalendar:function(){var data=this.toJSON(),calendarDate=tools.formatDate(data.calendarDate);calendarDate.setMonth(calendarDate.getMonth()-1),this.set({calendarDate:tools.parseDate(calendarDate)}),eventBus.trigger("calculate")},nextCalendar:function(){var data=this.toJSON(),calendarDate=tools.formatDate(data.calendarDate);calendarDate.setMonth(calendarDate.getMonth()+1),this.set({calendarDate:tools.parseDate(calendarDate)}),eventBus.trigger("calculate")},setCalendar:function(){this.set({formatCalendarList:this.getCalendar()}),this.changeCalendarBtnDisabled()},changeCalendarBtnDisabled:function(){var prevBtnDisabled,nextBtnDisabled,data=this.toJSON(),calendarDate=tools.formatDate(data.calendarDate),calendarList=data.calendarList;calendarDate.setMonth(calendarDate.getMonth()-1);var list=this.getCalendar(tools.parseDate(calendarDate)),find=_.some(list,function(item){return item.currentMonth&&_.some(calendarList,function(sub){if(item.departDate==sub.departDate)return!0})});prevBtnDisabled=!find,calendarDate=tools.formatDate(data.calendarDate),calendarDate.setMonth(calendarDate.getMonth()+1);var list=this.getCalendar(tools.parseDate(calendarDate)),find=_.some(list,function(item){return item.currentMonth&&_.some(calendarList,function(sub){if(item.departDate==sub.departDate)return!0})});nextBtnDisabled=!find,this.set({prevBtnDisabled:prevBtnDisabled,nextBtnDisabled:nextBtnDisabled})},getOrderData:function(){var params=this.toJSON(),o={productId:params.productId,productName:params.productName,departDate:params.departDate,arriveDate:params.backDate,departCity:params.departCity,departCityCode:params.departCityCode,adultNum:params.adultNum,childNum:params.childNum,adultPrice:params.adultPrice,childPrice:params.childPrice,fromUrl:params.fromUrl,departCityName:params.departCityName,isNewInsuranceFlag:params.isNewInsuranceFlag,backCity:params.backCity,backCityName:params.backCityName,normalChildPrice:params.normalChildPrice,freeChildPrice:params.freeChildPrice,normalChildNum:params.normalChildNum,freeChildNum:params.freeChildNum||0,bookCityFromDetail:params.bookCityFromDetail,bookCity:params.bookCity,combinedCityCode:params.combinedCityCode,combinedCityName:params.combinedCityName,budgetNum:params.budgetNum,selectUpdateRes:params.selectUpdateRes,telNum:params.telNum,version:2,cruiseVendorId:params.cruiseVendorId};return o},changeDepartCityName:function(departCityName){this.set("transportDepartCityName",departCityName),this.trigger("calculate")}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),config=__webpack_require__(6),pageDataObj=config.pageDataObj;__webpack_require__(8);module.exports=backbone.Model.extend({defaults:{isLogin:!1,name:"",isTeamTour:"",isFastOrder:!1},initialize:function(){this.set({isLogin:pageDataObj.isLogin,isTeamTour:1==pageDataObj.custom||1==pageDataObj.form,isFastOrder:pageDataObj.isFastOrder}),pageDataObj.userInfo&&this.set({name:pageDataObj.userInfo.name})},setContact:function(data){this.set({isLogin:!0,name:data.data.userInfo.name}),this.trigger("render")}})},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),config=__webpack_require__(6),pageDataObj=config.pageDataObj;module.exports=backbone.Model.extend({defaults:{days:"",needRenderNotice:!1,headerNotice:"",isCustom:"",productName:"",productId:"",isFastOrder:!1},initialize:function(){this.set({needRenderNotice:pageDataObj.needRenderNotice,headerNotice:pageDataObj.headerNotice,isCustom:pageDataObj.custom,productName:pageDataObj.name,productId:pageDataObj.productId,days:pageDataObj.beforeDayNum,isFastOrder:pageDataObj.isFastOrder})}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(14),__webpack_require__(6),__webpack_require__(5),__webpack_require__(16),__webpack_require__(11)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,$,config,eventBus,tools,constant){var pageDataObj=config.pageDataObj;return"tour_order2"!=pageDataObj.pageType&&"self_tour2"!=pageDataObj.pageType||""==pageDataObj.totalPriceTips&&(pageDataObj.totalPriceTips="由于儿童火车票实时计算，本价格中含火车票儿童价格暂按成人价格计算展示，下单成功后自动改为实时儿童火车票价格并收费"),Backbone.Model.extend({defaults:function(){return{priceData:{baseInfo:null,airTickets:null,trainTickets:null,busTickets:null,multiTransport:null,visa:null,promotionList:[],updateScheme:[],dfc:null,insurance:[],sumPrice:0,additional:[],optional:[],transferService:[],cruise:[],cruiseAirTickets:[],cruiseTrainTickets:[],cruiseHotel:[],additionRequired:[],additionOptional:[],receiptDeliveryFee:0},hotelTotalPrice:0,hotelRoomCountInfo:null,cruiseHotelTotalPrice:0,mustSelectPrice:0,airplaneTotalPrice:0,trainTotalPrice:0,resourceError:!1,trafficTotalPrice:0,packageTotalPrice:0,additionRequiredTitle:"",trainChildTimeStandard:pageDataObj.totalPriceTips||"由于儿童火车票实时计算，本价格中含火车票儿童价格暂按成人价格计算展示，下单成功后自动改为实时儿童火车票价格并收费",constant:constant,airplaneBasePrice:null}},initialize:function(){this.on("calculate",this.sumPrice),this.initData(pageDataObj),Backbone.app.set("haveCombinedRes",!1)},initData:function(params){if(params){var priceData=this.get("priceData");priceData.baseInfo={adultPrice:params.adultPrice||0,childPrice:params.childPrice||0,adultNum:params.adultNum||0,childNum:params.childNum||0,normalChildNum:params.normalChildNum||0,normalChildPrice:params.normalChildPrice||0,freeChildNum:params.freeChildNum||0,freeChildPrice:params.freeChildPrice||0},this.set("priceData",priceData)}this.trigger("calculate")},changeUserTel:function(){this.trigger("changeUserTel")},triggerChangeNum:function(eventName){this.trigger(eventName)},dealWithResource:function(data){data=data||{};var orderData=data.orderData,airplaneData=data.airplaneData,trainData=data.trainData,hotelsData=data.hotelsData,busData=data.busData,roomBudgetData=data.roomBudgetData,updateSchemeData=data.updateSchemeData,multiTransportData=(data.favourableData,data.multiTransportData),transportData=data.transportData,baseInfo=data.baseInfo,additionRequiredData=data.additionRequiredData,additionOptionalData=data.additionOptionalData,recommendData=data.recommendData,trafficData=data.trafficData,packageData=data.packageData,cruiseData=data.cruiseData,allNum=+orderData.adultNum+ +orderData.childNum,resource=[],airPlaneNum=0,cruiseRes=[],airplaneBasePrice=this.get("airplaneBasePrice"),pageType=pageDataObj.pageType;trafficData&&!_.isEmpty(trafficData.selectAir)&&(airplaneData=trafficData.selectAir),airplaneData&&_.each(airplaneData.listData,function(item,index){airPlaneNum++,resource.push({orderSourceId:item.resId,orderSourceType:airplaneData.resType,orderSourceAdultPrice:item.price,orderSourceChildPrice:item.childPrice,orderSourceAdultNum:orderData.adultNum,orderSourceChildNum:orderData.childNum})}),trafficData&&!_.isEmpty(trafficData.selectTrain)&&(trainData=trafficData.selectTrain),trainData?_.map(trainData,function(trainData){var price;price=trainData.price,resource.push({orderSourceId:price.resId,orderSourceType:8,orderSourceAdultPrice:price.adultPrice,orderSourceChildPrice:price.normalChildPrice,orderSourceAdultNum:orderData.adultNum,orderSourceChildNum:orderData.normalChildNum})}):void 0,cruiseData&&(_.isEmpty(cruiseData.selectList)?void 0:_.each(cruiseData.selectList,function(item){_.each(item.lists,function(room){cruiseRes.push({cabinRes:room.cabinRes,roomNum:room.roomCount,adultNum:room.adultNum,childNum:room.childNum,totalPrice:room.totalPrice})})})),_.isEmpty(hotelsData)?void 0:_.map(hotelsData,function(model){var plan,price,hotel=model.hotel,room=hotel.room;hotel.hotelType?(plan=room&&room.ratePlan,plan&&(price=plan.price)):room&&(price=room.price),resource.push({orderSourceId:room.roomId,orderSourceType:2,orderSourceAdultPrice:price,orderSourceChildPrice:0,orderSourceAdultNum:hotel.hotelType?plan.roomCount:room.roomCount,orderSourceChildNum:0})}),trafficData&&!_.isEmpty(trafficData.selectBus)&&(busData=trafficData.selectBus),busData?_.map(busData.listData,function(item){resource.push({orderSourceId:item.resId,orderSourceType:busData.resType,orderSourceAdultPrice:item.price,orderSourceChildPrice:item.childPrice,orderSourceAdultNum:orderData.adultNum,orderSourceChildNum:orderData.childNum})}):void 0,packageData&&_.each(packageData.selectPackage,function(item){item.packageType?resource.push({orderSourceId:item.resId,orderSourceType:5,orderSourceAdultPrice:item.adultPrice,orderSourceChildPrice:0,orderSourceAdultNum:Math.ceil(orderData.adultNum/item.availableNumber),orderSourceChildNum:0}):resource.push({orderSourceId:item.resId,orderSourceType:5,orderSourceAdultPrice:item.adultPrice,orderSourceChildPrice:item.childPrice,orderSourceAdultNum:orderData.adultNum,orderSourceChildNum:orderData.childNum})}),roomBudgetData&&roomBudgetData.length&&_.each(roomBudgetData,function(item){resource.push({orderSourceId:item.resId[0],orderSourceType:18,orderSourceAdultPrice:item.price,orderSourceChildPrice:0,orderSourceAdultNum:1,orderSourceChildNum:0})}),updateSchemeData&&updateSchemeData.length&&_.each(updateSchemeData,function(item){resource.push({orderSourceId:item.resId,orderSourceType:27,orderSourceAdultPrice:item.adultPrice,orderSourceChildPrice:item.childPrice,orderSourceAdultNum:orderData.adultNum,orderSourceChildNum:orderData.childNum})}),trafficData&&!_.isEmpty(trafficData.selectMultiTransport)&&(multiTransportData=trafficData.selectMultiTransport),multiTransportData&&_.each(multiTransportData.list,function(item,index){if(item&&item.isSelected)if(1==item.transportType){if(0!=index&&2==item.airType)return!1;resource.push({orderSourceId:item.resId,orderSourceType:item.resType,orderSourceAdultPrice:item.price,orderSourceChildPrice:item.childPrice,orderSourceAdultNum:multiTransportData.person[item.transportType].adultNum,orderSourceChildNum:multiTransportData.person[item.transportType].childNum})}else resource.push({orderSourceId:item.resId,orderSourceType:8,orderSourceAdultPrice:item.adultPrice,orderSourceChildPrice:item.normalChildPrice,orderSourceAdultNum:multiTransportData.person[item.transportType].adultNum,orderSourceChildNum:multiTransportData.person[item.transportType].childNum})}),_.isEmpty(transportData)||resource.push({orderSourceId:transportData.resId,orderSourceType:18,orderSourceAdultPrice:transportData.price,orderSourceChildPrice:transportData.price,orderSourceAdultNum:orderData.adultNum,orderSourceChildNum:orderData.childNum});var baseInfoRes={};if(baseInfo){var bAdultPrice=baseInfo.adultPrice,bChildPrice=baseInfo.childPrice;"tour_order2"!=pageType&&"drive_order2"!=pageType||airplaneBasePrice&&(bAdultPrice-=airplaneBasePrice.adultPrice,bChildPrice-=airplaneBasePrice.childPrice),baseInfoRes={orderSourceId:"",orderSourceType:27,orderSourceAdultPrice:bAdultPrice,orderSourceChildPrice:bChildPrice,orderSourceAdultNum:baseInfo.adultNum,orderSourceChildNum:baseInfo.childNum}}var qz=tools.getTypeByCode("qz"),mp=tools.getTypeByCode("mp"),ddwl=tools.getTypeByCode("ddwl"),notAdditionTypes=[qz,mp,ddwl],additionData=_.filter(additionRequiredData,function(item){return _.indexOf(notAdditionTypes,item.subType)==-1}).concat(_.filter(additionOptionalData,function(item){return _.indexOf(notAdditionTypes,item.subType)==-1}));_.each(additionData,function(item){var adultNum=0,childNum=0,adultPrice=0,childPrice=0;"儿童"==item.resInfo.priceComputerType?(childNum=item.adultResourceCount,childPrice=item.adultPrice):(item.adultSelect&&(adultNum=item.adultResourceCount,adultPrice=item.adultPrice),item.childSelect&&(childNum=item.childResourceCount,childPrice=item.childPrice)),resource.push({orderSourceId:item.resId,orderSourceType:18,orderSourceAdultPrice:adultPrice,orderSourceChildPrice:childPrice,orderSourceAdultNum:adultNum,orderSourceChildNum:childNum})});var visaData=_.filter(additionRequiredData,function(item){return item.subType==qz}).concat(_.filter(additionOptionalData,function(item){return item.subType==qz}));_.each(visaData,function(item){resource.push({orderSourceId:item.resId,orderSourceType:14,orderSourceAdultPrice:item.price,orderSourceChildPrice:item.childPrice,orderSourceAdultNum:item.adultSelect?item.adultResourceCount:0,orderSourceChildNum:item.childSelect?item.childResourceCount:0})}),_.isEmpty(pageDataObj.visaData)||_.each(pageDataObj.visaData,function(item){resource.push({orderSourceId:item.resId,orderSourceType:14,orderSourceAdultPrice:item.price,orderSourceChildPrice:item.childPrice,orderSourceAdultNum:orderData.adultNum,orderSourceChildNum:orderData.childNum})});var ticketData=_.filter(additionRequiredData,function(item){return item.subType==mp}).concat(_.filter(additionOptionalData,function(item){return item.subType==mp}));_.each(ticketData,function(item){resource.push({orderSourceId:item.resId,orderSourceType:4,orderSourceAdultPrice:item.adultPrice,orderSourceChildPrice:item.childPrice,orderSourceAdultNum:item.adultSelect?item.adultResourceCount:0,orderSourceChildNum:item.childSelect?item.childResourceCount:0})});var localData=_.filter(additionRequiredData,function(item){return item.subType==ddwl}).concat(_.filter(additionOptionalData,function(item){return item.subType==ddwl}));if(_.each(localData,function(item){resource.push({orderSourceId:item.resId,orderSourceType:"",orderSourceAdultPrice:item.adultPrice,orderSourceChildPrice:item.childPrice,orderSourceAdultNum:item.adultSelect?item.adultResourceCount:0,orderSourceChildNum:item.childSelect?item.childResourceCount:0})}),recommendData){var recommArr=[recommendData.deliveryInfo,recommendData.pickupInfo];_.each(recommArr,function(item){if(item&&1==item.type){var unitPrice=item.totalPrice/allNum;resource.push({orderSourceType:38,orderSourceAdultPrice:unitPrice,orderSourceChildPrice:unitPrice,orderSourceAdultNum:1,orderSourceChildNum:1})}})}var result={resource:resource,orderDiscountPrice:0,airplaneNum:airPlaneNum,cruiseRes:cruiseRes};return"self_tour2"!=pageDataObj.pageType&&(result.baseInfo=baseInfoRes),result},setTransPort:function(data){this.set("transPort",data),this.trigger("calculate")},changeReceiptDeliveryFee:function(showFlag){var priceData=this.get("priceData");showFlag?priceData.receiptDeliveryFee=10:priceData.receiptDeliveryFee=0,this.set("priceData",priceData),this.trigger("calculate")},changeAirplane:function(diffPrice){if(diffPrice){var priceData=this.get("priceData"),newAdultPrice=parseInt(diffPrice.diffAdultPrice),newChildPrice=parseInt(diffPrice.diffChildPrice);priceData.airTickets&&(newAdultPrice=parseInt(newAdultPrice)+priceData.airTickets.adultPrice,newChildPrice=parseInt(newChildPrice)+priceData.airTickets.childPrice),priceData.airTickets={adultPrice:newAdultPrice,childPrice:newChildPrice},this.set("priceData",priceData)}this.trigger("calculate")},refreshAirplane:function(){var priceData=this.get("priceData");priceData.airTickets={adultPrice:0,childPrice:0},this.set("priceData",priceData),this.trigger("calculate")},changeTrainInfo:function(firstSelectedTrainsData,currentSelectedTrainsData){var priceData,firstSelectedTrainsPrice,currentSelectedTrainsPrice,diffPrice,diffSumPrice;priceData=this.get("priceData"),firstSelectedTrainsPrice=_.reduce(firstSelectedTrainsData,function(firstSelectedTrainsPrice,firstSelectedTrainData){return firstSelectedTrainsPrice.adultPrice+=firstSelectedTrainData.selectedTrain.price.adultPrice,firstSelectedTrainsPrice.normalChildPrice+=firstSelectedTrainData.selectedTrain.price.normalChildPrice,firstSelectedTrainsPrice},{adultPrice:0,normalChildPrice:0}),currentSelectedTrainsPrice=_.reduce(currentSelectedTrainsData,function(currentSelectedTrainsPrice,currentSelectedTrainData){return currentSelectedTrainsPrice.adultPrice+=currentSelectedTrainData.selectedTrain.price.adultPrice,currentSelectedTrainsPrice.normalChildPrice+=currentSelectedTrainData.selectedTrain.price.normalChildPrice,currentSelectedTrainsPrice},{adultPrice:0,normalChildPrice:0}),diffPrice={adultPrice:currentSelectedTrainsPrice.adultPrice-firstSelectedTrainsPrice.adultPrice,normalChildPrice:currentSelectedTrainsPrice.normalChildPrice-firstSelectedTrainsPrice.normalChildPrice},diffSumPrice={adultPrice:diffPrice.adultPrice*priceData.baseInfo.adultNum,normalChildPrice:diffPrice.normalChildPrice*priceData.baseInfo.normalChildNum},priceData.trainTickets={diffPrice:diffPrice,diffSumPrice:diffSumPrice},this.set("priceData",priceData),this.trigger("calculate")},changeBusInfo:function(defaultData,data){for(var diffPrice,diffSumPrice,priceData=this.get("priceData"),sumPrice=0,sumChildPrice=0,sumDefPrice=0,sumDefChildPrice=0,i=0;i<defaultData.listData.length;i++)sumDefPrice+=defaultData.listData[i].price,sumDefChildPrice+=defaultData.listData[i].childPrice;for(var j=0;j<data.listData.length;j++)sumPrice+=data.listData[j].price,sumChildPrice+=data.listData[j].childPrice;diffPrice={adultPrice:sumPrice-sumDefPrice,childPrice:sumChildPrice-sumDefChildPrice},priceData.busTickets&&(diffPrice.adultPrice+=priceData.busTickets.diffPrice.adultPrice,diffPrice.childPrice+=priceData.busTickets.diffPrice.childPrice),diffSumPrice={adultPrice:diffPrice.adultPrice*priceData.baseInfo.adultNum,childPrice:diffPrice.childPrice*priceData.baseInfo.childNum},priceData.busTickets={diffPrice:diffPrice,diffSumPrice:diffSumPrice},this.set("priceData",priceData),this.trigger("calculate")},changeMultiTransport:function(data){var priceData=this.get("priceData");priceData.multiTransport=data,this.set("priceData",priceData),this.trigger("calculate")},refreshRecommend:function(data){var priceData=this.get("priceData");priceData.transferService=data,this.trigger("calculate")},changePromotion:function(checkPromotiones,coupon,travelCoupon){var priceData=this.get("priceData");if(priceData.promotionList=[],checkPromotiones&&checkPromotiones.length&&_.each(checkPromotiones,function(checkPromotion){if(15==checkPromotion.type){var addCouponPromotion={name:"抵用券",price:-coupon.data};_.findWhere(priceData.promotionList,{name:"抵用券"})&&(priceData.promotionList=_.filter(priceData.promotionList,function(item,index){return"抵用券"!=item.name}),priceData.promotionList.push(addCouponPromotion))}else{var addPromotion={promotionId:checkPromotion.campaign_id,name:checkPromotion.name,price:0,type:checkPromotion.reductions[0].type},price=0;checkPromotion.reductions&&_.each(checkPromotion.reductions,function(item){1!=item.type&&5!=item.type||(price+=item.total_reduction)}),addPromotion.price=price,priceData.promotionList.push(addPromotion)}}),coupon){var addCouponPromotion={name:"抵用券",price:-coupon};priceData.promotionList.push(addCouponPromotion)}travelCoupon&&priceData.promotionList.push({name:"旅游券",price:-travelCoupon}),this.set("priceData",priceData),this.trigger("calculate")},changeUpdate:function(checkUpdate){var priceData=this.get("priceData");priceData.updateScheme=[],checkUpdate&&checkUpdate.length&&_.each(checkUpdate,function(item){var oneUpdate={name:item.resName,adultPrice:item.adultPrice,childPrice:item.childPrice};priceData.updateScheme.push(oneUpdate)}),this.trigger("calculate")},changeRoomAddBudget:function(checkRoomAddBudget){var priceData=this.get("priceData");priceData.dfc=void 0,checkRoomAddBudget&&checkRoomAddBudget.length&&_.each(checkRoomAddBudget,function(item){2!=item.type&&(priceData.dfc={price:item.price})}),this.trigger("calculate")},changeInsurance:function(checkInsuranceInfo){var priceData=this.get("priceData");priceData.insurance=[],checkInsuranceInfo&&checkInsuranceInfo.length&&_.each(checkInsuranceInfo,function(item){var oneInsuranceInfo={name:item.resName,price:item.price,airRange:item.airRange};priceData.insurance.push(oneInsuranceInfo)}),this.trigger("calculate")},checkOptionalInfo:function(info,selectData){var priceData=this.get("priceData");priceData.optional=[],info.length&&_.each(info,function(item){if(item.isSelect&&1==item.isSelect){item.selectDataIndex||(item.selectDataIndex=0);var oneAdditional={name:item.resName,price:item.resourceDatePrices[item.selectDataIndex].price,priceComputerType:item.resInfo.priceComputerType};"份"!=oneAdditional.priceComputerType&&"张"!=oneAdditional.priceComputerType&&"台"!=oneAdditional.priceComputerType&&"辆"!=oneAdditional.priceComputerType||(item.resInfo.sellRule&&1==item.resInfo.sellRule&&item.resInfo.subType&&9==item.resInfo.subType?(oneAdditional.priceComputerType="单日/台",oneAdditional.defaultNum=+item.defaultNum,oneAdditional.allPrice=oneAdditional.defaultNum*+item.resInfo.durationDays*+item.resourceDatePrices[0].price,oneAdditional.type=0,oneAdditional.durationDays=item.resInfo.durationDays):(oneAdditional.defaultNum=+item.defaultNum,oneAdditional.type=1)),"人"==oneAdditional.priceComputerType&&(oneAdditional.isSupportChildPrice=item.resourceDatePrices[0].isSupportChildPrice,0==item.resourceDatePrices[0].isSupportChildPrice?(oneAdditional.type=2,oneAdditional.defaultNum=+item.adultResourceCount+ +item.childResourceCount,oneAdditional.adutlCount=+item.adultResourceCount,oneAdditional.childCount=+item.childResourceCount,oneAdditional.childPrice=+item.resourceDatePrices[item.selectDataIndex].childPrice):(oneAdditional.defaultNum=+item.adultResourceCount,oneAdditional.type=3)),"成人"!=oneAdditional.priceComputerType&&"第“三”成人"!=oneAdditional.priceComputerType||(oneAdditional.defaultNum=+item.adultResourceCount,oneAdditional.type=4),"儿童"==oneAdditional.priceComputerType&&(oneAdditional.defaultNum=+item.childResourceCount,oneAdditional.type=5,oneAdditional.childPrice=item.resourceDatePrices[item.selectDataIndex].cost),priceData.optional.push(oneAdditional)}}),this.trigger("calculate")},checkAdditionalInfo:function(info,flag){var priceData=this.get("priceData");priceData.additional=[],info.length&&!flag&&_.each(info,function(item){if(item.isSelect&&1==item.isSelect){item.selectDataIndex||(item.selectDataIndex=0);var oneAdditional={name:item.resName,price:item.resourceDatePrices[item.selectDataIndex].price,priceComputerType:item.resInfo.priceComputerType};"份"!=oneAdditional.priceComputerType&&"张"!=oneAdditional.priceComputerType&&"台"!=oneAdditional.priceComputerType&&"辆"!=oneAdditional.priceComputerType||(item.resInfo.sellRule&&1==item.resInfo.sellRule&&item.resInfo.subType&&9==item.resInfo.subType?(oneAdditional.priceComputerType="单日/台",
oneAdditional.defaultNum=+item.defaultNum,oneAdditional.type=0,oneAdditional.allPrice=oneAdditional.defaultNum*+item.resInfo.durationDays*+item.resourceDatePrices[0].price,oneAdditional.durationDays=+item.resInfo.durationDays):(oneAdditional.defaultNum=+item.defaultNum,oneAdditional.type=1)),"人"==oneAdditional.priceComputerType&&(oneAdditional.isSupportChildPrice=item.resourceDatePrices[0].isSupportChildPrice,0==item.resourceDatePrices[0].isSupportChildPrice?(oneAdditional.type=2,oneAdditional.defaultNum=+item.adultResourceCount+ +item.childResourceCount,oneAdditional.adutlCount=+item.adultResourceCount,oneAdditional.childCount=+item.childResourceCount,oneAdditional.childPrice=+item.resourceDatePrices[item.selectDataIndex].childPrice):(oneAdditional.defaultNum=+item.adultResourceCount,oneAdditional.type=3)),"成人"!=oneAdditional.priceComputerType&&"第“三”成人"!=oneAdditional.priceComputerType||(oneAdditional.defaultNum=+item.adultResourceCount,oneAdditional.type=4),"儿童"==oneAdditional.priceComputerType&&(oneAdditional.defaultNum=+item.childResourceCount,oneAdditional.type=5,oneAdditional.childPrice=item.resourceDatePrices[item.selectDataIndex].cost),priceData.additional.push(oneAdditional)}}),this.trigger("calculate")},changeVisa:function(info){var priceData=this.get("priceData");if(priceData.visa=null,info&&info.data&&info.data.length){priceData.visa={};for(var tempPrice=0,i=info.data.length-1;i>=0;i--)info.data[i].chose&&(tempPrice+=info.data[i].totalPrice);priceData.visa.price=tempPrice}this.trigger("calculate")},totalResPrice:function(){var priceData=this.get("priceData"),promotionPrice=this.getListPrice(priceData.promotionList),insurancePrice=this.getListPrice(priceData.insurance,"insurance"),receiptDeliveryFee=priceData.receiptDeliveryFee,totalResPrice=0;return totalResPrice=priceData.sumPrice-promotionPrice-insurancePrice-receiptDeliveryFee},sumPrice:function(){var priceData=this.get("priceData"),basePrice=this.getBasePrice(priceData),hotelPrice=this.getHotelPrice(priceData),cruiseHotelPrice=this.getCruiseHotelPrice(priceData),airTicketPrice=this.getAirTicketPrice(priceData);this.calculateTrainTicketsDiffPrice();var trainTicketsPrice=this.getTrainTicketsPrice(priceData);this.calculateBusTicketsDiffPrice();var busTicketsPrice=this.getBusTicketsPrice(priceData),multiTransportPrice=this.getMultiTransportPrice(),promotionPrice=this.getListPrice(priceData.promotionList),schemePrice=this.getListPrice(priceData.updateScheme,"scheme"),dfcPrice=this.getDfcPrice(priceData),insurancePrice=this.getListPrice(priceData.insurance,"insurance"),visaPrice=this.getVisaPrice(priceData),transportPrice=this.getTransportPrice(priceData),additionalPrice=this.getAddiPrice(priceData),optionalPrice=this.getOptionPrice(priceData),transferPrice=this.getTransfer(priceData.transferService),cruisePrice=this.getCruiseTotalPrice(),cruiseAirplanePrice=this.getCruiseAirplaneTotalPrice(),cruiseTrainPrice=this.getCruiseTrainTotalPrice(),additionRequiredPrice=this.getAdditionRequiredTotalPrice(),additionOptionalPrice=this.getAdditionOptionalTotalPrice(),trafficTotalPrice=this.get("trafficTotalPrice"),packageTotalPrice=this.get("packageTotalPrice"),receiptDeliveryFee=priceData.receiptDeliveryFee;priceData.sumPrice=basePrice+hotelPrice+cruiseHotelPrice+airTicketPrice+trainTicketsPrice+busTicketsPrice+multiTransportPrice+promotionPrice+schemePrice+dfcPrice+insurancePrice+visaPrice+additionalPrice+optionalPrice+transferPrice+cruisePrice+cruiseAirplanePrice+cruiseTrainPrice+additionRequiredPrice+additionOptionalPrice+transportPrice+trafficTotalPrice+packageTotalPrice+receiptDeliveryFee,this.set("priceData",priceData),eventBus.trigger("getFinancePlans")},initPayMentData:function(data){this.set({financeData:data}),this.trigger("render")},getGroupCostWithOutPromotion:function(){var priceData=this.get("priceData"),basePrice=this.getBasePrice(priceData),hotelPrice=this.getHotelPrice(priceData),cruiseHotelPrice=this.getCruiseHotelPrice(priceData),airTicketPrice=this.getAirTicketPrice(priceData);this.calculateTrainTicketsDiffPrice();var trainTicketsPrice=this.getTrainTicketsPrice(priceData);this.calculateBusTicketsDiffPrice();var busTicketsPrice=this.getBusTicketsPrice(priceData),multiTransportPrice=this.getMultiTransportPrice(),schemePrice=this.getListPrice(priceData.updateScheme,"scheme"),dfcPrice=this.getDfcPrice(priceData),insurancePrice=this.getListPrice(priceData.insurance,"insurance"),visaPrice=this.getVisaPrice(priceData),cruisePrice=this.getCruiseTotalPrice(),cruiseAirplanePrice=this.getCruiseAirplaneTotalPrice(),cruiseTrainPrice=this.getCruiseTrainTotalPrice(),additionRequiredPrice=this.getAdditionRequiredTotalPrice(),additionOptionalPrice=(this.getTransportPrice(priceData),this.getAdditionOptionalTotalPrice()),receiptDeliveryFee=priceData.receiptDeliveryFee,sumPrice=basePrice+hotelPrice+cruiseHotelPrice+airTicketPrice+trainTicketsPrice+busTicketsPrice+multiTransportPrice+schemePrice+dfcPrice+insurancePrice+visaPrice+cruisePrice+cruiseAirplanePrice+cruiseTrainPrice+additionRequiredPrice+additionOptionalPrice+receiptDeliveryFee;return sumPrice},getPromotionlist:function(){var priceData=this.get("priceData"),chosedPsIdsArr=[],promotion={chosedPsIds:"",product_coupon:0},promotionList=priceData.promotionList;return promotionList&&promotionList.length&&_.each(promotionList,function(checkPromotion){"抵用券"==checkPromotion.name?promotion.product_coupon=-checkPromotion.price:chosedPsIdsArr.push(checkPromotion.promotionId)}),promotion.chosedPsIds=chosedPsIdsArr.join(","),promotion},calculateTrainTicketsDiffPrice:function(){var priceData,diffPrice,diffSumPrice;priceData=this.get("priceData"),priceData.trainTickets&&(diffPrice=priceData.trainTickets.diffPrice,diffSumPrice={adultPrice:diffPrice.adultPrice*priceData.baseInfo.adultNum,normalChildPrice:diffPrice.normalChildPrice*priceData.baseInfo.normalChildNum},priceData.trainTickets.diffSumPrice=diffSumPrice,this.set("priceData",priceData))},calculateBusTicketsDiffPrice:function(){var priceData,diffPrice,diffSumPrice;priceData=this.get("priceData"),priceData.busTickets&&(diffPrice=priceData.busTickets.diffPrice,diffSumPrice={adultPrice:diffPrice.adultPrice*priceData.baseInfo.adultNum,childPrice:diffPrice.childPrice*priceData.baseInfo.childNum},priceData.busTickets.diffSumPrice=diffSumPrice,this.set("priceData",priceData))},getBasePrice:function(priceData){var cost=0,selectPrice=this.get("mustSelectPrice");return priceData.baseInfo.adultNum&&priceData.baseInfo.adultNum>0&&(cost+=parseFloat(priceData.baseInfo.adultPrice+(selectPrice.adultAllPrice||0)/priceData.baseInfo.adultNum)*parseInt(priceData.baseInfo.adultNum)),priceData.baseInfo.normalChildNum||priceData.baseInfo.freeChildNum?(priceData.baseInfo.normalChildNum&&(cost+=parseInt(priceData.baseInfo.normalChildNum)*parseFloat(priceData.baseInfo.normalChildPrice)),priceData.baseInfo.freeChildNum&&(cost+=parseInt(priceData.baseInfo.freeChildNum)*parseFloat(priceData.baseInfo.freeChildPrice))):priceData.baseInfo.childNum&&priceData.baseInfo.childNum>0&&(cost+=parseFloat(priceData.baseInfo.childPrice+(selectPrice.childAllPrice||0)/priceData.baseInfo.childNum)*parseInt(priceData.baseInfo.childNum)),cost},getHotelPrice:function(){return this.get("hotelTotalPrice")},getCruiseHotelPrice:function(){return this.get("cruiseHotelTotalPrice")},getAirTicketPrice:function(priceData){if(!priceData.airTickets)return 0;var cost=0;return priceData.baseInfo.adultNum&&priceData.baseInfo.adultNum>0&&(cost+=parseFloat(priceData.airTickets.adultPrice)*priceData.baseInfo.adultNum),priceData.baseInfo.childNum&&priceData.baseInfo.childNum>0&&(cost+=parseFloat(priceData.airTickets.childPrice)*priceData.baseInfo.childNum),cost},getTrainTicketsPrice:function(priceData){var trainTickets=priceData.trainTickets;return trainTickets?trainTickets.diffSumPrice.adultPrice+trainTickets.diffSumPrice.normalChildPrice:0},getBusTicketsPrice:function(priceData){var busTickets=priceData.busTickets;return busTickets?busTickets.diffSumPrice.adultPrice+busTickets.diffSumPrice.childPrice:0},getTransportPrice:function(){var transPortData=this.get("transPort"),priceData=this.get("priceData");priceData.transport={price:0};var allPrice=0;return transPortData&&transPortData.resId&&(allPrice=(priceData.baseInfo.adultNum+priceData.baseInfo.childNum)*transPortData.price,priceData.transport.price=transPortData.price,priceData.transport.name=transPortData.resName,priceData.transport.touristNum=priceData.baseInfo.adultNum+priceData.baseInfo.childNum,priceData.transport.allPrice=allPrice),this.set("priceData",priceData),allPrice},getMultiTransportPrice:function(){var multiTransport=this.get("priceData").multiTransport,cost=0;return multiTransport&&_.each(multiTransport,function(item){var adultPrice=item.adultPrice,childPrice=item.childPrice,adultNum=item.adultNum,childNum=item.childNum;cost+=adultPrice*adultNum+childPrice*childNum}),cost},getListPrice:function(list,type){var priceData=this.get("priceData"),cost=0;return list?(_.each(list,function(item){switch(type){case"scheme":priceData.baseInfo.adultNum&&priceData.baseInfo.adultNum>0&&(cost+=parseFloat(item.adultPrice)*parseInt(priceData.baseInfo.adultNum)),priceData.baseInfo.childNum&&priceData.baseInfo.childNum>0&&(cost+=parseFloat(item.childPrice)*parseInt(priceData.baseInfo.childNum));break;case"insurance":cost+=parseFloat(item.price*item.airRange)*(parseInt(priceData.baseInfo.adultNum)+parseInt(priceData.baseInfo.childNum));break;default:5!=item.type&&(cost+=parseFloat(item.price))}}),cost):cost},getDfcPrice:function(priceData){return priceData.dfc?parseFloat(priceData.dfc.price):0},getVisaPrice:function(priceData){return priceData.visa?parseFloat(priceData.visa.price,10):0},getAddiPrice:function(priceData){for(var list=priceData.additional,cost=0,i=0;i<list.length;i++)if(list[i].allPrice){var allPrice=parseInt(list[i].allPrice);cost+=allPrice}else"份"!=list[i].priceComputerType&&"张"!=list[i].priceComputerType&&"台"!=list[i].priceComputerType&&"辆"!=list[i].priceComputerType||(cost+=parseInt(list[i].price)*parseInt(list[i].defaultNum)),"人"==list[i].priceComputerType&&(cost+=0==list[i].isSupportChildPrice?parseInt(list[i].price)*parseInt(list[i].adutlCount)+parseInt(list[i].childPrice)*parseInt(list[i].childCount):parseInt(list[i].price)*parseInt(list[i].defaultNum)),"成人"!=list[i].priceComputerType&&"第“三”成人"!=list[i].priceComputerType||(cost+=parseInt(list[i].price)*parseInt(list[i].defaultNum)),"儿童"==list[i].priceComputerType&&(cost+=parseInt(list[i].childPrice)*parseInt(list[i].defaultNum));return cost},getOptionPrice:function(priceData){for(var data=priceData.optional,allCost=0,i=0;i<data.length;i++)if(data[i].allPrice){var allPrice=parseInt(data[i].allPrice);allCost+=allPrice}else"份"!=data[i].priceComputerType&&"张"!=data[i].priceComputerType&&"台"!=data[i].priceComputerType&&"辆"!=data[i].priceComputerType||(allCost+=parseInt(data[i].price)*parseInt(data[i].defaultNum)),"人"==data[i].priceComputerType&&(allCost+=0==data[i].isSupportChildPrice?parseInt(data[i].price)*parseInt(data[i].adutlCount)+parseInt(data[i].childPrice)*parseInt(data[i].childCount):parseInt(data[i].price)*parseInt(data[i].defaultNum)),"成人"!=data[i].priceComputerType&&"第“三”成人"!=data[i].priceComputerType||(allCost+=parseInt(data[i].price)*parseInt(data[i].defaultNum)),"儿童"==data[i].priceComputerType&&(allCost+=parseInt(data[i].childPrice)*parseInt(data[i].defaultNum));return allCost},getTransfer:function(transfer){var allPrice=0,priceData=this.get("priceData"),allNum=priceData.baseInfo.adultNum+priceData.baseInfo.childNum;return allNum<=4&&!_.isEmpty(transfer)&&(transfer.deliveryAddress&&transfer.deliveryInfo&&transfer.deliveryInfo.totalPrice&&(allPrice+=transfer.deliveryInfo.totalPrice),transfer.pickupAddress&&transfer.pickupInfo&&transfer.pickupInfo.totalPrice&&(allPrice+=transfer.pickupInfo.totalPrice)),allPrice},changeCruiseData:function(data){var priceData=this.get("priceData");priceData.cruise=data,this.trigger("calculate")},getCruiseTotalPrice:function(){var price=0,priceData=this.get("priceData"),cruiseData=priceData.cruise;return _.each(cruiseData,function(item){_.each(item.lists,function(room){price+=room.totalPrice})}),price},changeAirplaneData:function(data){var priceData=this.get("priceData");priceData.cruiseAirTickets=data,this.trigger("calculate")},getCruiseAirplaneTotalPrice:function(){var priceData=this.get("priceData"),baseInfo=this.get("priceData").baseInfo,adultNum=baseInfo.adultNum,childNum=baseInfo.childNum,price=0;return _.each(priceData.cruiseAirTickets,function(item){price+=item.price*adultNum,price+=item.childPrice*childNum}),price},changeTrainData:function(data){var priceData=this.get("priceData");priceData.cruiseTrainTickets=data,this.trigger("calculate")},getCruiseTrainTotalPrice:function(){var priceData=this.get("priceData"),baseInfo=this.get("priceData").baseInfo,adultNum=baseInfo.adultNum,normalChildNum=baseInfo.normalChildNum,price=0;return _.each(priceData.cruiseTrainTickets,function(item){price+=item.price.adultPrice*adultNum,price+=item.price.normalChildPrice*normalChildNum}),price},changeCruiseHotelData:function(data){var priceData=this.get("priceData");priceData.cruiseHotel=data,this.trigger("calculate")},changeAdditionRequiredData:function(data){var priceData=this.get("priceData");priceData.additionRequired=data.list,this.set("additionRequiredTitle",data.title),this.trigger("calculate")},getAdditionRequiredTotalPrice:function(){var priceData=this.get("priceData"),data=priceData.additionRequired,price=0;return _.each(data,function(item){price+=item.totalAdultPrice+item.totalChildPrice}),price},changeAdditionOptionalData:function(data){var priceData=this.get("priceData");priceData.additionOptional=data,this.trigger("calculate")},getAdditionOptionalTotalPrice:function(){var priceData=this.get("priceData"),data=priceData.additionOptional,price=0;return _.each(data,function(item){price+=item.totalAdultPrice+item.totalChildPrice}),price},getIfParam:function(data1){var data=this.toJSON(),priceData=data.priceData,param=_.extend({groupCost:priceData.sumPrice,groupCostWithoutInsurance:this.totalResPrice(),hotel_total:priceData.hotelTotalPrice,chosedPsIds:this.getPromotionlist().chosedPsIds,product_coupon:this.getPromotionlist().product_coupon},data1);return param},changeTraffic:function(price){this.set("trafficTotalPrice",price),this.trigger("calculate")},changePackage:function(price){this.set("packageTotalPrice",price),this.trigger("calculate")},setAirplaneBasePrice:function(basePrice){this.set("airplaneBasePrice",basePrice)}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(5),__webpack_require__(6),__webpack_require__(16)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,eventBus,config,tools){var pageDataObj=config.pageDataObj;return Backbone.Model.extend({defaults:function(){return{listData:[],resType:"",canChange:!1,isInternationalFlag:"",stockType:"",usedSystemType:"",adultNum:2,childNum:0,hasCheck:!1,checkTimes:0,resIds:[],isFromOrder:!1,isInList:!1,loading:!0,loadingMsg:"正在为您筛选低价机票，请稍候...",fail:!1,failMsg:"机票已售罄，请重新选择产品或更换团期",titleDesc:"",isChecked:!1,isNetOrderFlag:!1}},init:function(airplane){var arr=[],diffPrice={diffAdultPrice:0,diffChildPrice:0},diffAdultPriceFlag=!1,diffChildPriceFlag=!1;_.each(airplane.listData,function(item){item.flightPriceList=airplane.flightPriceList,item.flightPriceTrip=airplane.flightPriceTrip,item.baggages=airplane.baggages,item.priceJourneyCabinList=airplane.priceJourneyCabinList,item.seatTypeCode=airplane.seatTypeCode,item.queryVoList=airplane.queryVoList,item.mainAirCom=airplane.mainAirCom;var hasRealPrice=void 0!=item.realPrice,hasRealChildPrice=void 0!=item.realChildPrice;(hasRealPrice||hasRealChildPrice)&&(arr.push({resId:item.resId}),"tour_order2"===pageDataObj.pageType?(hasRealPrice&&(diffAdultPriceFlag=!0,diffPrice.diffAdultPrice+=item.realPrice,item.price=item.realPrice),hasRealChildPrice&&(diffChildPriceFlag=!0,diffPrice.diffChildPrice+=item.realChildPrice,item.childPrice=item.realChildPrice)):(hasRealPrice&&(diffPrice.diffAdultPrice+=item.realPrice-item.price,item.price=item.realPrice),hasRealChildPrice&&(diffPrice.diffChildPrice+=item.realChildPrice-item.childPrice,item.childPrice=item.realChildPrice)));var format=function(item2){item2.numberLimit="",item2.travelerCategory="";var saleControl=item2.saleControl;saleControl&&(saleControl.minPassengerNum&&(item2.numberLimit+="最少出行人数"+saleControl.minPassengerNum+"；"),saleControl.maxPassengerNum&&(item2.numberLimit+="最多出行人数"+saleControl.maxPassengerNum+"；"),saleControl.corePassengerNum&&(item2.numberLimit+="固定出行人数"+saleControl.corePassengerNum+"；"),item2.travelerCategory=saleControl.applicableTravelerCategory)};item.transferInfo?_.each(item.transferInfo,function(item2){format(item2)}):format(item)}),diffAdultPriceFlag&&(diffPrice.diffAdultPrice-=pageDataObj.adultFlightPrice),diffChildPriceFlag&&(diffPrice.diffChildPrice-=pageDataObj.childFlightPrice),this.setGlobalData(airplane),this.set(airplane,{silent:!0}),this.set("loading",!1),this.get("webOrder")?this.set({canChange:!1,failMsg:"机票信息待确认，请继续下单，下单后客服会联系您，最终价格以客服与您确认需求后核算的价格为准！"}):(this.changeTitleDesc(),this.getCanRender()),this.trigger("needRender"),arr.length&&"cruise2"!=pageDataObj.pageType&&eventBus.trigger("hasRealAirplane",diffPrice)},changeTitleDesc:function(){var titleDesc="";"back2"!=pageDataObj.pageType||this.get("isFromOrder")?this.get("isInternationalFlag")?titleDesc="起降时间为当地时间，机票价格变动频繁，下单后请您尽快完成付款":21==this.get("resType")&&(titleDesc="机票价格变动频繁，下单后请您尽快完成付款"):titleDesc="此航班为默认推荐，请确认航班",this.set("titleDesc",titleDesc)},reset:function(airplane){airplane.isInternationalFlag=this.get("isInternationalFlag"),this.setGlobalData(airplane),this.set(airplane,{silent:!0}),this.changeTitleDesc(),this.getCanRender(),this.trigger("needRender")},getIds:function(){var resIds=[];return _.each(this.get("listData"),function(item){resIds.push(item.resId)}),resIds},getPrices:function(){var priceList=[];return _.each(this.get("listData"),function(item,index){priceList.push({price:item.price,childPrice:item.childPrice})}),priceList},changePrice:function(priceList){var diffPrice={diffAdultPrice:0,diffChildPrice:0},isFlightV2=Backbone.app.get("isFlightV2");if(_.each(this.get("listData"),function(item,index){diffPrice.diffAdultPrice+=priceList[index].adultPrice-item.price,diffPrice.diffChildPrice+=priceList[index].childPrice-item.childPrice,item.price=priceList[index].adultPrice,item.childPrice=priceList[index].childPrice,(2==item.airType||isFlightV2)&&(item.totalPrice=priceList[index].totalAdultPrice,item.totalChildPrice=priceList[index].totalChildPrice)}),isFlightV2){var fareMapKey=Object.keys(this.get("listDataV2").fareMap);this.get("listDataV2").fareMap[fareMapKey[0]].adultPrice=priceList[0].totalAdultPrice,this.get("listDataV2").fareMap[fareMapKey[0]].childPrice=priceList[0].totalChildPrice}eventBus.trigger("needCalculate",diffPrice)},getAirplaneCheckFlag:function(){var needCheck=!1;this.get("isInternationalFlag");return!this.get("hasCheck")&&(!_.isEmpty(this.get("listData"))&&(1!=this.get("usedSystemType")&&(21==this.get("resType")&&("back2"==pageDataObj.pageType&&this.get("isFromOrder")?pageDataObj.hasTakeSeat?(this.get("adultNum")>pageDataObj.adultNum||this.get("childNum")>pageDataObj.childNum)&&this.get("isInList")&&(needCheck=!0):this.get("adultNum")==pageDataObj.adultNum&&this.get("childNum")==pageDataObj.childNum||(needCheck=!0):needCheck=!0),needCheck)))},checkAirplane:function(orderInfo,productId,isFromOrder){var checkData,list=(this.get("resType"),this.get("listData")),isInternationalFlag=this.get("isInternationalFlag"),adultNum=orderInfo.adultNum,childNum=orderInfo.childNum;if("back2"==pageDataObj.pageType&&this.get("isFromOrder")&&pageDataObj.hasTakeSeat&&(adultNum>pageDataObj.adultNum||childNum>pageDataObj.childNum)&&this.get("isInList")&&(adultNum-=pageDataObj.adultNum,childNum-=pageDataObj.childNum),isInternationalFlag?(checkData={productId:productId,adultNum:adultNum,childNum:childNum,resIdArr:[],adultPrice:[],childPrice:[]},_.each(list,function(item){checkData.resIdArr.push(item.checkId),checkData.adultPrice.push(item.price),checkData.childPrice.push(item.childPrice),checkData.airType=item.airType})):(checkData={productId:productId,adultNum:adultNum,childNum:childNum,flightInfo:[]},_.each(list,function(item){checkData.flightInfo.push(_.pick(item,"cityKey","flightNo","departDate","solutionId","policyId","cabinKey","seatClass","saleControl","price","childPrice")),checkData.airType=item.airType})),checkData.isInternationalFlag=isInternationalFlag,Backbone.app.get("isFlightV2")){checkData={};var list2=this.get("listDataV2"),fareMap=list2.fareMap,cacheParamsKeyList=[];for(var j in fareMap){var fareObj=fareMap[j];cacheParamsKeyList.push(fareObj.resId)}checkData={international:1==isInternationalFlag,cacheParamsKeyList:cacheParamsKeyList}}eventBus.trigger("needCheckAirplane",checkData,isFromOrder)},handleCheckAirplaneResult:function(data,orderInfo,isFromOrder){var adultNum=orderInfo.adultNum,childNum=orderInfo.childNum,resIds=data.resIds,msg=data.tipMsg,isInternationalFlag=this.get("isInternationalFlag"),checkTimes=this.get("checkTimes"),changeFlightCheckRule=Backbone.app.get("changeFlightCheckRule"),self=this,diffPrice=0,saveOrderFun=function(){changeFlightCheckRule?changeFlightCheckRule&&isFromOrder&&eventBus.trigger("sendSaveOrderData"):eventBus.trigger("saveOrder")},handleDiffPrice=function(){var o,priceList=[],list=self.get("listData");_.each(data.resourceInfoList,function(item,index){2==list[index].airType?_.each(list,function(){o={adultPrice:tools.toFixed(item.adultPrice/list.length,2),childPrice:tools.toFixed(item.childPrice/list.length,2),totalAdultPrice:item.adultPrice,totalChildPrice:item.childPrice},priceList.push(o)}):(o={adultPrice:item.adultPrice,childPrice:item.childPrice},priceList.push(o))});var diffPrice=0;return _.each(priceList,function(item,index){diffPrice+=(item.adultPrice-list[index].price)*adultNum+(item.childPrice-list[index].childPrice)*childNum}),self.changePrice(priceList),diffPrice},handleOldDiffPrice=function(){var o,priceList=[],list=self.get("listData");_.each(resIds,function(item,index){isInternationalFlag?2==list[index].airType?_.each(list,function(){o={adultPrice:tools.toFixed(item.extraInfo.adultPrice/list.length,2),childPrice:tools.toFixed(item.extraInfo.childPrice/list.length,2),totalAdultPrice:item.extraInfo.adultPrice,totalChildPrice:item.extraInfo.childPrice},priceList.push(o)}):(o={adultPrice:item.extraInfo.adultPrice,childPrice:item.extraInfo.childPrice},priceList.push(o)):(index=item.rph-1,2==list[index].airType?_.each(list,function(){o={adultPrice:tools.toFixed(adultNum?item.segmentAdultTotalPrice/(list.length*adultNum):0,2),childPrice:tools.toFixed(childNum?item.segmentChildTotalPrice/(list.length*childNum):0,2),totalAdultPrice:tools.toFixed(adultNum?item.segmentAdultTotalPrice/adultNum:0,2),totalChildPrice:tools.toFixed(childNum?item.segmentChildTotalPrice/childNum:0,2)},priceList.push(o)}):(o={adultPrice:tools.toFixed(adultNum?item.segmentAdultTotalPrice/adultNum:0,2),childPrice:tools.toFixed(childNum?item.segmentChildTotalPrice/childNum:0,2)},priceList[index]=o))});var diffPrice=0;return _.each(priceList,function(item,index){diffPrice+=(item.adultPrice-list[index].price)*adultNum+(item.childPrice-list[index].childPrice)*childNum}),self.changePrice(priceList),diffPrice};if("back2"==pageDataObj.pageType&&this.get("isFromOrder")&&pageDataObj.hasTakeSeat&&(adultNum>pageDataObj.adultNum||childNum>pageDataObj.childNum)&&this.get("isInList")&&(adultNum-=pageDataObj.adultNum,childNum-=pageDataObj.childNum),Backbone.app.get("isFlightV2")){if(!(changeFlightCheckRule&&2!=data.checkStatus&&3!=data.checkStatus||!changeFlightCheckRule&&2!=data.checkStatus)){if(changeFlightCheckRule&&3==data.checkStatus){diffPrice=handleDiffPrice(),diffPrice=diffPrice<0?"-￥"+-diffPrice:"+￥"+diffPrice;var self=this;self.set("changePriceTip","航班实时价格变动："+diffPrice+"，请确认价格"),setTimeout(function(){self.set("changePriceTip","")},3e3)}return resIds=[],_.each(data.resourceInfoList,function(item){resIds.push({singleId:item.resId,isNewFlightCheck:!0})}),this.set({hasCheck:1,resIds:resIds},{silent:!0}),void saveOrderFun()}if(this.set({checkTimes:++checkTimes},{silent:!0}),3!=data.checkStatus&&"cruise2"==pageDataObj.pageType)return void(!changeFlightCheckRule||changeFlightCheckRule&&isFromOrder?(eventBus.trigger("setNetOrderFlag","airplane",!0,"机票验舱验价失败转网络单"),eventBus.trigger("sendSaveOrderData")):this.set({hasCheck:1,isNetOrderFlag:!0},{silent:!0}));if(!isInternationalFlag&&3==checkTimes)return this.set({hasCheck:1,isNetOrderFlag:!0},{silent:!0}),void saveOrderFun();changeFlightCheckRule||3!=data.checkStatus||(diffPrice=handleDiffPrice());var code=data.checkStatus;if(0==code)return void this.handleCheckAirplaneError(isFromOrder);this.trigger("error",{type:"check",code:code,isFromOrder:isFromOrder},diffPrice)}else if(data.goNextStep||changeFlightCheckRule&&3==msg){if(changeFlightCheckRule&&3==msg){diffPrice=handleOldDiffPrice(),diffPrice=diffPrice<0?"-￥"+-diffPrice:"+￥"+diffPrice;var self=this;self.set("changePriceTip","航班实时价格变动："+diffPrice+"，请确认价格"),setTimeout(function(){self.set("changePriceTip","")},3e3)}if(isInternationalFlag)this.set({hasCheck:1,resIds:resIds},{silent:!0});else{var list=this.get("listData");_.each(resIds,function(item){var index=item.rph-1;list[index]&&(list[index].resId=item.flightResourceId)}),this.set({hasCheck:1},{silent:!0})}saveOrderFun()}else{if(this.set({checkTimes:++checkTimes},{silent:!0}),3!=msg&&"cruise2"==pageDataObj.pageType)return void(!changeFlightCheckRule||changeFlightCheckRule&&isFromOrder?(eventBus.trigger("setNetOrderFlag","airplane",!0,"机票验舱验价失败转网络单"),eventBus.trigger("sendSaveOrderData")):this.set({hasCheck:1,isNetOrderFlag:!0},{silent:!0}));if(!isInternationalFlag&&3==checkTimes)return this.set({hasCheck:1,isNetOrderFlag:!0},{silent:!0}),void saveOrderFun();3==msg&&(diffPrice=handleOldDiffPrice()),this.trigger("error",{type:"check",code:msg,isFromOrder:isFromOrder},diffPrice)}},handleCheckAirplaneError:function(isFromOrder){if("cruise2"==pageDataObj.pageType)return void(!changeFlightCheckRule||changeFlightCheckRule&&isFromOrder?(eventBus.trigger("setNetOrderFlag","airplane",!0,"机票验舱验价失败转网络单"),eventBus.trigger("sendSaveOrderData")):this.set({hasCheck:1,isNetOrderFlag:!0},{silent:!0}));var changeFlightCheckRule=Backbone.app.get("changeFlightCheckRule");changeFlightCheckRule?(this.set({hasCheck:1,isNetOrderFlag:!0},{silent:!0}),isFromOrder&&eventBus.trigger("sendSaveOrderData")):this.trigger("error",{type:"check",code:4})},getCanRender:function(){var canRender=1,list=this.get("listData");return _.isEmpty(list)&&(canRender=0),Backbone.app.get("isFlightV2")||_.some(list,function(item){if(!item.resId)return canRender=0,!0}),canRender?this.set({fail:!1}):this.get("canChange")?this.set({fail:!0,failMsg:"机票信息异常，请更改机票或更换产品"}):this.set({fail:!0,failMsg:"机票信息异常，请刷新页面重试或更换产品"}),canRender},changeTourist:function(adultNum,childNum){7!=pageDataObj.proMode&&14!=pageDataObj.proMode||(this.set({adultNum:adultNum,childNum:childNum},{silent:!0}),this.trigger("needRender"))},getCityNameList:function(){var _cityNameList=[],airData=this.get("listData");return _.each(airData,function(oneAir){var _cityName={departureCityName:oneAir.departureCityName,destinationCityName:oneAir.destinationCityName};_cityNameList.push(_cityName)}),_cityNameList},getRealTimePrice:function(){var _adultAirPrice=0,_childAirPrice=0,listData=this.get("listData");return _.isEmpty(listData)||_.each(listData,function(oneAir){oneAir.realPrice?(_adultAirPrice+=oneAir.realPrice,oneAir.price=oneAir.realPrice):_adultAirPrice+=oneAir.price,oneAir.realChildPrice?(_childAirPrice+=oneAir.realChildPrice,oneAir.childPrice=oneAir.realChildPrice):_childAirPrice+=oneAir.childPrice}),{adultPrice:_adultAirPrice,childPrice:_childAirPrice}},showLoading:function(){this.set("loading",!0),this.trigger("needRender")},loadError:function(){this.set({loading:!1,fail:!0,failMsg:"机票已售罄，请重新选择产品或更换团期"}),this.trigger("needRender")},hideChangeBtn:function(){this.set("canChange",!1),this.trigger("needRender")},getRecommendData:function(){var list=this.get("listData"),first=list[0],last=list[list.length-1],data={resType:this.get("resType"),departDate:first.departDate,departTime:first.departTime,arrivalDate:last.arrivalDate,arriveTime:last.arriveTime,departureAirportCode:first.departureAirportCode,departureAirportTerminal:first.departureAirportTerminal||"",destinationAirportCode:last.destinationAirportCode,arrivalAirportTerminal:last.arrivalAirportTerminal||"",departureCityName:first.departureCityName,destinationCityName:last.destinationCityName,departFlightNo:first.flightNo,arriveFlightNo:last.flightNo};return data},setGlobalData:function(obj){var selectedAir=Backbone.app.get("selectedAir")||[];selectedAir[0]={type:obj.resType,internationalFlag:obj.isInternationalFlag},Backbone.app.set("selectedAir",selectedAir,{silent:!0}),Backbone.app.trigger("change:selectedAir")},getBasePrice:function(listData){var result={adultPrice:0,childPrice:0};return _.each(listData,function(item){result.adultPrice+=item.price,result.childPrice+=item.childPrice}),result},transformData:function(flightData){var data={canChange:!0,isInternationalFlag:1,listData:[],resType:7},totalJourneyMap="",getFlightDetail=function(journeyTotalId,flightRawData,journeyMap){var journeyId=journeyTotalId.split("#")[0],flightOption=flightRawData.flightOptionMap[journeyId],flightNos=flightOption.flightList,cabinDetail=flightRawData.flightOptionCabinMap[journeyTotalId]||{},beginFlight=flightRawData.flightDetailMap[flightNos[0]],endFlight=flightRawData.flightDetailMap[flightNos[flightNos.length-1]],result={airlineName:beginFlight.airlineName,airplaneTypeName:beginFlight.airplaneTypeName,arrivalDate:endFlight.arriveDate,arriveTime:endFlight.arriveTime,cabinType:cabinDetail.seatTypeName,cabinTypeRes:[{seatStatus:cabinDetail.seatStatus,cabinType:cabinDetail.seatTypeName}],childPrice:0,departDate:beginFlight.flightDate,departTime:beginFlight.departTime,departureAirportCode:beginFlight.dAirportIataCode,departureAirportName:beginFlight.departureAirportName,departureCityName:beginFlight.departureCityName,destinationAirportCode:endFlight.aAirportIataCode,destinationAirportName:endFlight.destinationAirportName,destinationCityName:endFlight.destinationCityName,duration:beginFlight.duration,flightCode:"",flightNo:beginFlight.flightNo,isInternational:1,journeyId:0,luggageLimitStatement:"",minBookingNum:1,price:0,purchaseNotes:flightRawData.purchaseDesc.join(","),flightNum:flightNos.length,transferTips:flightOption.transferTips&&flightOption.transferTips.length?flightOption.transferTips[0]:"",visaTips:"",stopTip:"",sAirComImageUrl:beginFlight.airComImageUrl};if(flightOption.visaTips&&flightOption.visaTips.length&&(result.visaTips=flightOption.visaTips.filter(function(item){return item&&item.length}).join(",")),1!=flightNos.length&&(result.transferInfo=flightNos.reduce(function(result,flightNo,currentIndex){var item=flightRawData.flightDetailMap[flightNo],data={airlineName:item.airlineName,airplaneTypeName:item.airplaneTypeName,arrivalDate:item.arriveDate,arriveTime:item.arriveTime,cabinType:cabinDetail.seatTypeName,cabinTypeRes:[{seatStatus:cabinDetail.seatStatus,cabinType:cabinDetail.seatTypeName}],hasMeal:item.hasMeal,departDate:item.flightDate,departTime:item.departTime,departureAirportCode:item.dAirportIataCode,departureAirportName:item.departureAirportName,departureCityName:item.departureCityName,destinationAirportCode:item.aAirportIataCode,destinationAirportName:item.destinationAirportName,destinationCityName:item.destinationCityName,duration:item.duration,flightCode:"",flightNo:item.flightNo,isInternational:1,journeyId:0,
transfer:"",stopTip:"",sAirComImageUrl:item.airComImageUrl};return flightOption.trainsitTimes&&flightOption.trainsitTimes.length&&flightOption.trainsitTimes[currentIndex]&&(data.transfer={city:item.destinationCityName,duration:flightOption.trainsitTimes[currentIndex]}),item.stopPointList&&item.stopPointList.length&&(data.stopTip={stopAirportName:item.stopPointList[0].stopCityName,durationTime:item.stopPointList[0].stopTime}),result.push(data),result},[])),beginFlight.stopPointList&&beginFlight.stopPointList.length&&(result.stopTip={stopAirportName:beginFlight.stopPointList[0].stopCityName,durationTime:beginFlight.stopPointList[0].stopTime}),flightRawData.fareMap&&flightRawData.fareMap[journeyMap]){var fareMap=flightRawData.fareMap[journeyMap];result.childPrice=fareMap.childPrice,result.price=fareMap.adultPrice,result.realChildPrice=fareMap.childPrice,result.realPrice=fareMap.adultPrice,totalJourneyMap=journeyMap}return result},getNextJourney=function(journeyId,flightRawData,journeyMap,result){if(flightRawData.sequenceMap[journeyMap]&&flightRawData.sequenceMap[journeyMap].next){var nextJourneyId=flightRawData.sequenceMap[journeyMap].next[0];return journeyMap=journeyMap+"_"+nextJourneyId,journeyId=nextJourneyId,getNextJourney(journeyId,flightRawData,journeyMap,result.concat(getFlightDetail(journeyId,flightRawData,journeyMap)))}return result};if(flightData.success&&flightData.data&&flightData.data.firstJourney&&flightData.data.firstJourney.length){var flightRawData=flightData.data;if(this.set("listDataV2",flightRawData),flightData.data.firstJourney[0]&&flightData.data.firstJourney[0].list&&flightData.data.firstJourney[0].list.length){var firstJourneyId=flightData.data.firstJourney[0].list[0];data.listData=data.listData.concat(getFlightDetail(firstJourneyId,flightRawData,firstJourneyId)),data.listData=getNextJourney(firstJourneyId,flightRawData,firstJourneyId,data.listData)}var fareMap=flightRawData.fareMap[totalJourneyMap];data.resType=1==fareMap.ticketPurchaseType?7:21;var airType=1==fareMap.ticketPurchaseType?3:2,resId=fareMap.resId,luggageLimitStatement="";fareMap.additionals&&fareMap.additionals.length&&fareMap.additionals.some(function(additional){if("行李额"==additional.title)return luggageLimitStatement=additional.description,!0}),data.listData.forEach(function(item){item.airType=airType,item.resType=data.resType,item.resId=resId,item.luggageLimitStatement=luggageLimitStatement})}else data.canChange=!1;return data}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(5),__webpack_require__(6)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,eventBus,config){var pageDataObj=config.pageDataObj;return Backbone.Model.extend({defaults:function(){return{isShow:!1,pkgFlight:null,group:null,individualFlight:null,individualData:null,individualCopyData:null,hasGetAllAirplaneFlag:!1,isInternationalFlag:0,resIds:[],defaultAirplanePrices:[],adultNum:2,childNum:0,loadError:!1,selectType:1,disabled:!1,defaultResType:null}},init:function(data){this.set(data),this.show()},show:function(){var isShow=this.get("isShow"),hasGetAllAirplaneFlag=this.get("hasGetAllAirplaneFlag"),isInternationalFlag=this.get("isInternationalFlag"),loadError=this.get("loadError");if(isShow){if(loadError)return void this.loadError();isInternationalFlag?hasGetAllAirplaneFlag?this.format(0):this.trigger("showLoading"):hasGetAllAirplaneFlag?this.format(0):(this.trigger("showLoading"),eventBus.trigger("requestAirplaneList"))}},format:function(journeyIndex,options){function iterator(it){for(var i=0;i<it.length;i++){var result=it[i]();if(result)return result}}var checkId,totalPrice,totalChildPrice,pkgData=this.get("pkgFlight"),group=this.get("group"),individualFlight=this.get("individualFlight"),individualData=this.get("individualData")||{},list=individualData.list||[],selectedData=individualData.selectedData||[],temporaryData={},resIds=this.get("resIds"),defaultAirplanePrices=this.get("defaultAirplanePrices"),adultNum=this.get("adultNum"),childNum=this.get("childNum"),airType=options?options.airType:"",airplaneId=options?options.airplaneId:"",isInit=0==journeyIndex&&!options,defaultResType=this.get("defaultResType");pkgData&&_.each(pkgData.flightlist,function(item){var listTotalAdultPrice=0,listTotalChildPrice=0,defaultTotalAdultPrice=0,defaultTotalChildPrice=0;_.each(defaultAirplanePrices,function(item2){defaultTotalAdultPrice+=item2.price,defaultTotalChildPrice+=item2.childPrice}),_.each(item.listData,function(item2){listTotalAdultPrice+=item2.price,listTotalChildPrice+=item2.childPrice}),item.diffAdultPrice=(listTotalAdultPrice-defaultTotalAdultPrice)*adultNum,item.diffChildPrice=(listTotalChildPrice-defaultTotalChildPrice)*childNum}),temporaryData.filter={},temporaryData.sort=this.formatSort(),temporaryData.list=[],temporaryData.selectedData=[],temporaryData.journeyIndex=journeyIndex,temporaryData.journeyLength="",temporaryData.departureCityName="",temporaryData.destinationCityName="";for(var i=0;i<=journeyIndex;i++)selectedData[i]&&temporaryData.selectedData.push(selectedData[i]);if(airplaneId&&_.some(list,function(item){var b=_.some(item.cabinTypeRes,function(item2){if(item2.resId==airplaneId)return _.each(item2,function(item3,key3){"flightNo"!=key3&&(item[key3]=item3)}),temporaryData.selectedData[journeyIndex-1]=item,!0});if(b)return checkId=item.checkId,totalPrice=item.totalPrice,totalChildPrice=item.totalChildPrice,!0}),3==airType&&journeyIndex>0)for(var n=journeyIndex+1;n<selectedData.length;n++)temporaryData.selectedData.push(selectedData[n]);if(void 0!=checkId&&2==airType&&_.each(temporaryData.selectedData,function(item){item.checkId=checkId,item.totalPrice=totalPrice,item.totalChildPrice=totalChildPrice}),group&&_.some(group.flightlist,function(item){return temporaryData.journeyLength=item.listData.length,!0}),individualFlight&&(temporaryData.journeyLength||(temporaryData.journeyLength=individualFlight.journeyData.length)),journeyIndex<temporaryData.journeyLength){group&&(temporaryData.filter=this.formatFilter(temporaryData.filter,group.filter),_.some(group.flightlist,function(item){return _.some(item.listData,function(item2){return temporaryData.departureCityName=item2.departureCityName,temporaryData.destinationCityName=item2.destinationCityName,!0})}),_.each(group.flightlist,function(item){var sameItem,sameIndex,one=item.listData[journeyIndex];if(journeyIndex>0){if(2!=airType)return;for(var find=!0,i=0;i<journeyIndex;i++){var onePrev=item.listData[i];find=find&&onePrev.flightNo==temporaryData.selectedData[i].flightNo}if(!find)return}var same=_.some(temporaryData.list,function(item2,index2){if(2==item2.airType&&one.flightNo==item2.flightNo)return sameItem=item2,sameIndex=index2,!0});if(same){var price=one.cabinTypeRes[0].price*adultNum+one.cabinTypeRes[0].childPrice*childNum,samePrice=sameItem.cabinTypeRes[0].price*adultNum+sameItem.cabinTypeRes[0].childPrice*childNum;samePrice<price&&temporaryData.list.splice(sameIndex,1,sameItem)}else temporaryData.list.push(one)})),individualFlight&&(temporaryData.filter=this.formatFilter(temporaryData.filter,individualFlight.filter),0!=journeyIndex&&3!=airType||(temporaryData.list=temporaryData.list.concat(individualFlight.journeyData[journeyIndex].listData),temporaryData.departureCityName||_.some(individualFlight.journeyData[journeyIndex].listData,function(item){return temporaryData.departureCityName=item.departureCityName,temporaryData.destinationCityName=item.destinationCityName,!0})));var defaultAdultPrice=0,defaultChildPrice=0;defaultAirplanePrices[journeyIndex]&&(defaultAdultPrice=defaultAirplanePrices[journeyIndex].price,defaultChildPrice=defaultAirplanePrices[journeyIndex].childPrice),_.each(temporaryData.list,function(item){if(3==item.airType)_.each(item.cabinTypeRes,function(item2){item2.diffAdultPrice=(item2.price-defaultAdultPrice)*adultNum,item2.diffChildPrice=(item2.childPrice-defaultChildPrice)*childNum});else if(2==item.airType)if(0==journeyIndex)_.each(item.cabinTypeRes,function(item2){item2.diffAdultPrice=(item2.price-defaultAdultPrice)*adultNum,item2.diffChildPrice=(item2.childPrice-defaultChildPrice)*childNum});else{for(var selectedTotalAdultPrice=0,selectedTotalChildPrice=0,realAdultPrice=0,realChildPrice=0,i=0;i<journeyIndex;i++)selectedTotalAdultPrice+=temporaryData.selectedData[i].price,selectedTotalChildPrice+=temporaryData.selectedData[i].childPrice;_.each(item.cabinTypeRes,function(item2){realAdultPrice=item2.price*(journeyIndex+1)-selectedTotalAdultPrice,realChildPrice=item2.childPrice*(journeyIndex+1)-selectedTotalChildPrice,item2.diffAdultPrice=(realAdultPrice-defaultAdultPrice)*adultNum,item2.diffChildPrice=(realChildPrice-defaultChildPrice)*childNum})}var priceForSort;_.each(item.cabinTypeRes,function(item2){var _price=item2.diffAdultPrice+item2.diffChildPrice;priceForSort=priceForSort||_price,_price<priceForSort&&(priceForSort=_price)}),item.priceForSort=priceForSort;var format=function(item2){_.each(item2.cabinTypeRes,function(item3){item3.numberLimit="",item3.travelerCategory="",item3.disabled=!1;var saleControl=item3.saleControl;if(saleControl&&(saleControl.minPassengerNum&&(item3.numberLimit+="最少出行人数"+saleControl.minPassengerNum+"；",adultNum+childNum<saleControl.minPassengerNum&&(item3.disabled=!0)),saleControl.maxPassengerNum&&(item3.numberLimit+="最多出行人数"+saleControl.maxPassengerNum+"；",adultNum+childNum>saleControl.maxPassengerNum&&(item3.disabled=!0)),saleControl.corePassengerNum&&(item3.numberLimit+="固定出行人数"+saleControl.corePassengerNum+"；",adultNum+childNum!=saleControl.corePassengerNum&&(item3.disabled=!0)),item3.travelerCategory=saleControl.applicableTravelerCategory,item3.travelerCategory)){var personArr=item3.travelerCategory.split(","),adultSelect=!1,childSelect=!1,babySelect=!1;_.each(personArr,function(item4){"成人"==item4&&(adultSelect=!0),"儿童"==item4&&(childSelect=!0),"婴儿"==item4&&(babySelect=!0)}),adultNum&&!adultSelect&&(item3.disabled=!0),childNum&&!childSelect&&(item3.disabled=!0)}})};item.transferInfo?_.each(item.transferInfo,function(item2){format(item2)}):format(item)});var one=temporaryData.selectedData[temporaryData.journeyIndex];_.each(temporaryData.list,function(item){_.each(item.cabinTypeRes,function(item2){item2.selected=item2.resId==(one?one.resId:resIds[journeyIndex])})})}if(this.set({individualData:temporaryData,individualCopyData:$.extend(!0,{},temporaryData)},{silent:!0}),3==airType&&journeyIndex<temporaryData.selectedData.length&&airplaneId)return this.format(++journeyIndex);if(journeyIndex==temporaryData.journeyLength&&airplaneId)return this.format(--journeyIndex,{airType:airType});if(isInit){if(!pkgData&&_.isEmpty(temporaryData.list))return this.loadError();var gen=function(selectType,hasData){return function(){return!!hasData&&selectType}},pkgFunc=gen(1,!!pkgData),individualFunc=gen(2,!_.isEmpty(temporaryData.list)),funcIt={7:[pkgFunc,individualFunc],21:[individualFunc,pkgFunc]},it=funcIt[defaultResType],selectType=iterator(it);selectType&&this.set("selectType",selectType)}this.sort("price"),this.trigger("needRender")},filter:function(type,key){var individualData=this.get("individualData"),individualCopyData=this.get("individualCopyData"),filter=individualData.filter[individualData.journeyIndex];_.each(filter,function(item,_type){_type==type&&_.some(item,function(sub){if(sub.key==key)return sub.selected=!sub.selected,!0})});var prevType,prevArr,currentData=$.extend(!0,[],individualCopyData.list),getKey=function(airplane,type){var key=0;if(2==type){if(airplane.transfer){var duration=airplane.transfer.duration,match1=duration.match(/(\d*)小时/),match2=duration.match(/(\d*)分钟/),match3=duration.match(/(\d*)秒/);if(match1)var hour=+match1[1];if(match2)var minute=+match2[1];if(match3)var second=+match3[1];hour?(minute&&(hour+=minute/60),second&&(hour+=second/3600),key=hour<4?1:hour<8?2:hour<12?3:4):key=1}}else{var date=0==type?new Date("2016/09/23 "+airplane.departTime):new Date("2016/09/23 "+airplane.arriveTime),hour=(date.getTime()-new Date("2016/09/23").getTime())/36e5;hour<8?key=4:hour<12?key=1:hour<18?key=2:hour<24&&(key=3)}return key},check=function(type,sub,airplane){var flag;switch(type){case"routeLineList":flag=airplane.flightNum==sub.key;break;case"airLineCompanyList":flag=airplane.flightCode==sub.key;break;case"departureTimeSerialList":flag=getKey(airplane,0)==sub.key;break;case"arrivalTimeSerialList":flag=getKey(airplane,1)==sub.key;break;case"transferCityList":flag=!!airplane.transfer&&airplane.transfer.city==sub.viewName;break;case"transferDurationList":flag=getKey(airplane,2)==sub.key;break;case"departureAirportList":flag=airplane.departureAirportCode==sub.key;break;case"arrivalAirportList":flag=airplane.destinationAirportCode==sub.key;break;case"cabinSerialList":flag=_.some(airplane.cabinTypeRes,function(item){return item.cabinTypeCode==sub.key})}return flag};_.each(filter,function(item,type){_.each(item,function(sub){if(sub.selected){if(type==prevType){var result=_.filter(prevArr,function(airplane){return check(type,sub,airplane)});_.each(result,function(item){var flag=_.some(currentData,function(item2){return item.airType==item2.airType&&item.flightNo==item2.flightNo});flag||currentData.push(item)})}else prevArr=$.extend(!0,[],currentData),currentData=_.filter(currentData,function(airplane){return check(type,sub,airplane)});return prevType=type,!0}})}),individualData.list=currentData,this.set("individualData",individualData,{silent:!0}),this.sort()},sort:function(type){var individualData=this.get("individualData"),sort=individualData.sort;type&&_.each(sort,function(item){item.code==type?(item.selected=!0,item.val=-item.val):(item.selected=!1,item.val=-1)});var toNumber=function(type,airplane){var num;switch(type){case"departTime":case"arriveTime":num=new Date("2016/09/23 "+airplane[type]).getTime();break;case"duration":var duration=airplane[type],match1=duration.match(/(\d*)小时/),match2=duration.match(/(\d*)分钟/),match3=duration.match(/(\d*)秒/);if(match1){var hour=+match1[1];num=3600*hour}if(match2){var minute=+match2[1];num?num+=60*minute:num=60*minute}if(match3){var second=+match3[1];num?num+=second:num=second}break;case"price":num=airplane.priceForSort}return num};_.each(sort,function(item){item.selected&&(individualData.list=_.sortBy(individualData.list,function(airplane){var selected=!1;return _.some(airplane.cabinTypeRes,function(item){item.selected&&(selected=!0)}),selected?-(1/0):1==item.val?toNumber(item.code,airplane):-toNumber(item.code,airplane)}))}),this.set("individualData",individualData,{silent:!0})},formatFilter:function(target,filters){return _.isEmpty(target)?target=filters:_.each(filters,function(item,index1){_.each(item,function(item2,key2){var _item2=target[index1][key2];_item2?_.each(item2,function(item3){var find=_.some(_item2,function(_item3){return _item3.key==item3.key});find||_item2.push(item3)}):target[index1][key2]=item2})}),target||{}},formatSort:function(){var sort=[{code:"departTime",name:"出发时间",val:-1,selected:!1},{code:"arriveTime",name:"到达时间",val:-1,selected:!1},{code:"duration",name:"航程时长",val:-1,selected:!1},{code:"price",name:"价格",val:-1,selected:!0}];return sort},changeAirplane:function(airType,index){var pkgData=this.get("pkgFlight"),individualData=this.get("individualData"),selectedData=individualData.selectedData,defaultAirplanePrices=this.get("defaultAirplanePrices"),postData=(this.get("adultNum"),this.get("childNum"),{resType:1==airType?7:21,selectedData:[],diffPrice:{diffAdultPrice:0,diffChildPrice:0}});if(1==airType){var one=pkgData.flightlist[index];postData.selectedData=one.listData;var listTotalAdultPrice=0,listTotalChildPrice=0,defaultTotalAdultPrice=0,defaultTotalChildPrice=0;_.each(defaultAirplanePrices,function(item2){defaultTotalAdultPrice+=item2.price,defaultTotalChildPrice+=item2.childPrice}),_.each(one.listData,function(item2){listTotalAdultPrice+=item2.price,listTotalChildPrice+=item2.childPrice}),postData.diffPrice.diffAdultPrice=listTotalAdultPrice-defaultTotalAdultPrice,postData.diffPrice.diffChildPrice=listTotalChildPrice-defaultTotalChildPrice}else postData.selectedData=selectedData,_.each(postData.selectedData,function(item,index){var defaultAdultPrice=0,defaultChildPrice=0;defaultAirplanePrices[index]&&(defaultAdultPrice=defaultAirplanePrices[index].price,defaultChildPrice=defaultAirplanePrices[index].childPrice),postData.diffPrice.diffAdultPrice+=item.price-defaultAdultPrice,postData.diffPrice.diffChildPrice+=item.childPrice-defaultChildPrice});eventBus.trigger("changeAirplane",postData)},changeTourist:function(adultNum,childNum){childNum!=this.get("childNum")&&0==this.get("isInternationalFlag")&&this.set("hasGetAllAirplaneFlag",!1,{silent:!0}),this.set({adultNum:adultNum,childNum:childNum},{silent:!0})},destroy:function(){this.set("hasGetAllAirplaneFlag",!1,{silent:!0})},loadError:function(){this.set({isShow:!1},{silent:!0}),this.trigger("loadError"),eventBus.trigger("airplaneListLoadError")},destroyAll:function(){this.set({isShow:!1,individualData:null,individualCopyData:null,resIds:[],defaultAirplanePrices:[],selectType:1},{silent:!0})},notEmpty:function(data){var _group=data.group,_groupFlag=0;_group&&!_.isEmpty(_group.flightlist)&&_.each(_group.flightlist,function(oneGroup){oneGroup&&oneGroup.listData&&oneGroup.listData.length==pageDataObj.airRange&&(_groupFlag=1)});var _individualFlight=data.individualFlight,_individualFlightFlag=0;_individualFlight&&!_.isEmpty(_individualFlight.journeyData)&&_individualFlight.journeyData.length==pageDataObj.airRange&&(_individualFlightFlag=1);var _pkgFlight=data.pkgFlight,_pkgFlightFlag=0;return _pkgFlight&&!_.isEmpty(_pkgFlight.flightlist)&&_.each(_pkgFlight.flightlist,function(onePkg){onePkg&&onePkg.listData&&onePkg.listData.length==pageDataObj.airRange&&(_pkgFlightFlag=1)}),_groupFlag||_individualFlightFlag||_pkgFlightFlag},changeType:function(selectType){this.set("selectType",selectType),this.trigger("needRender")}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(5),__webpack_require__(11)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,EventBus,CONSTANT){return Backbone.Model.extend({defaults:{defaultTrain:[],list:[],isFromOrder:!1,isInList:!1,canChange:!1,isCorrectTime:!1,isPageShowTrain:!0,unsureInfoShow:!1},initialize:function(){this.setCurrentTime(),this.on("change:unsureInfoShow",function(){this.trigger("needRenderContainer"),EventBus.trigger("refreshHasUnsureTrain",this.toJSON().unsureInfoShow)})},initData:function(data){var newData=this.fixStructData(data),hasUnsureTrain=_.some(newData,function(item){return item.isUnsureTicket});this.set("list",newData),this.set("unsureInfoShow",hasUnsureTrain),this.trigger("needRender"),this.setGlobalData()},fixStructData:function(data){return _.map(data,function(item,i){var resourceDatePrice,trainNumText,durationTextDetail,newItem={};if(!item.resourceDatePrices)return item;if(item.isUnsureTicket){if(("待定"==item.trainNum||""==item.trainNum)&&(item.trainType||0==item.trainType))switch(item.trainType){case 0:trainNumText="高铁G(车次待定)";break;case 1:trainNumText="城际C(车次待定)";break;case 2:trainNumText="动车D(车次待定)";break;case 3:trainNumText="直达Z(车次待定)";break;case 4:trainNumText="特快T(车次待定)";break;case 5:trainNumText="普快(车次待定)";break;default:trainNumText="车型车次待定"}item.duration||(durationTextDetail=item.departStartTime&&item.departEndTime?"预计车票出发时间在"+item.departStartTime+"~"+item.departEndTime+"之间，抵达时间、运行时间待定；确切时间以实际出票结果为准；":"出发时间，抵达时间，运行时间均待定；确切时间以实际出票结果为准"),item.departStartTime&&item.departEndTime&&(item.departDepartTime=item.departStartTime+"-"+item.departEndTime+"待定",item.destArriveTime="待定")}return resourceDatePrice=item.resourceDatePrices[0],newItem.departCityName=item.departCityName,newItem.destCityName=item.destCityName,newItem.departDate=item.departDate,newItem.arrivalDate=item.departDate,newItem.trainNum="待定"==item.trainNum?trainNumText:item.trainNum,newItem.departDepartTime=item.departDepartTime,newItem.departStationName=item.departStationName,newItem.duration=item.duration,newItem.durationTextDetail=durationTextDetail?durationTextDetail:"",newItem.destArriveTime=item.destArriveTime,newItem.destStationName=item.destStationName,newItem.trainId=item.trainId,newItem.seatType=item.seatType,newItem.isStockTicket=resourceDatePrice.isStockTicket,newItem.price={resId:item.id,seatName:CONSTANT.SEAT_MAP[item.seatType],adultPrice:resourceDatePrice.adultPrice,normalChildPrice:resourceDatePrice.normalChildPrice,leftNumber:resourceDatePrice.leftNumber},newItem.durationDay=item.durationDay,newItem.isUnsureTicket=item.isUnsureTicket,newItem})},setCurrentTime:function(){var currentDate=new Date,minDate=new Date,maxDate=new Date,isCorrectTime=!1;minDate.setHours(22,30,0),maxDate.setHours(6,1,0),(currentDate>=minDate||currentDate<maxDate)&&(isCorrectTime=!0),this.set("isCorrectTime",isCorrectTime)},setGlobalData:function(){Backbone.app.set("selectedTrain",!0)}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(5)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,EventBus){return Backbone.Model.extend({defaults:function(){return{isCorrectTime:!1}},initialize:function(){this.setCurrentTime()},initData:function(data){this.set(this.formateData(data),{silent:!0}),this.trigger("needRender")},formateData:function(data){var trainNumText,durationTextDetail;if(data&&data.list&&data.list.length)return data.list.forEach(function(item,index){if(item.isUnsureTicket){if("待定"==item.trainNum&&(item.trainType||0==item.trainType)){switch(item.trainType){case 0:trainNumText="高铁G(车次待定)";break;case 1:trainNumText="城际C(车次待定)";break;case 2:trainNumText="动车D(车次待定)";break;case 3:trainNumText="直达Z(车次待定)";break;case 4:trainNumText="特快T(车次待定)";break;case 5:trainNumText="普快(车次待定)";break;default:trainNumText="车型车次待定"}item.trainNum=trainNumText}item.duration||(item.durationText="时间待定",durationTextDetail=item.departStartTime&&item.departEndTime?"预计车票出发时间在"+item.departStartTime+"~"+item.departEndTime+"之间，抵达时间、运行时间待定；确切时间以实际出票结果为准；":"出发时间，抵达时间，运行时间均待定；确切时间以实际出票结果为准",item.durationTextDetail=durationTextDetail),item.departStartTime&&item.departEndTime&&(item.departDepartTime=item.departStartTime+"-"+item.departEndTime+"待定",item.destArriveTime="待定")}}),data},setCurrentTime:function(){var currentDate=new Date,minDate=new Date,maxDate=new Date,isCorrectTime=!1;minDate.setHours(22,30,0),maxDate.setHours(6,1,0),(currentDate>=minDate||currentDate<maxDate)&&(isCorrectTime=!0),this.set("isCorrectTime",isCorrectTime)}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(5)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,EventBus){return Backbone.Model.extend({defaults:{id:"",haveChange:!1,listData:null,isFromOrder:!1,isInList:!1,hasCheck:!1,selectBusPkgFlag:null,isCheckFailed:!0},init:function(data){this.set(data),this.setGlobalData()},getCityNameList:function(){var listData=this.get("listData"),cityNameList=[];return listData&&_.each(listData,function(item){cityNameList.push({departCityName:item.dptRegionName,destCityName:item.dstRegionName})}),cityNameList},reset:function(data){this.set(data)},newReset:function(data){this.set({listData:data,hasCheck:!1}),this.trigger("change")},needCheck:function(){var needCheck=!0,list=this.get("listData");return!this.get("hasCheck")&&(!_.isEmpty(list)&&(_.each(list,function(v){needCheck=needCheck&&!v.isPack}),this.set({selectBusPkgFlag:!needCheck}),!0))},getPostData:function(orderModelData){var list=this.get("listData");if(list&&list[0].isPack){var item=list[0];return[{productId:orderModelData.productId,scheduleId:item.scheduleCode,departDate:item.dptDate,ticketPrice:2*item.ticketPrice,departCityName:item.dptRegionName,arrivalCityName:item.dstRegionName,ticketNum:orderModelData.adultNum+orderModelData.childNum,vendorIdList:item.vendorIdList}]}return list&&_.map(list,function(item){return{productId:orderModelData.productId,scheduleId:item.scheduleCode,departDate:item.dptDate,ticketPrice:item.ticketPrice,departCityName:item.dptRegionName,arrivalCityName:item.dstRegionName,ticketNum:orderModelData.adultNum+orderModelData.childNum,vendorIdList:item.vendorIdList}})},handleCheckBusResult:function(data,orderData){var self=this,list=self.get("listData"),isCheckSuccess=!0;data&&list[0].isPack?_.each(list,function(item,i){item.resId=data[0].resId,item.scheduleId=data[0].scheduleId,isCheckSuccess=isCheckSuccess&&data[0].resId,i+1==list.length&&self.set({isCheckFailed:!isCheckSuccess})}):_.each(data,function(item,i){list[i].resId=item.resId,list[i].scheduleId=item.scheduleId,isCheckSuccess=isCheckSuccess&&item.resId,i+1==data.length&&self.set({isCheckFailed:!isCheckSuccess})}),EventBus.trigger("validPostOrder")},handleCheckBusError:function(){EventBus.trigger("validPostOrder")},destroy:function(){},setGlobalData:function(){Backbone.app.set("selectedBusTicket",!0)}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(5)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,EventBus){return Backbone.Model.extend({defaults:{list:null,defaultBus:null,selectedIndex:null,disabled:!0,adultNum:2,childNum:0},init:function(data){_.isEmpty(data)?this.trigger("loadError"):(this.format(data),this.trigger("render"))},format:function(data){var selectedIndex,selectedItem,defaultBus=this.get("defaultBus"),defaultAdultPrice=0,defaultChildPrice=0,adultNum=this.get("adultNum"),childNum=this.get("childNum"),o={};_.each(defaultBus.listData,function(item){defaultAdultPrice+=item.price,defaultChildPrice+=item.childPrice}),_.each(data,function(item,index){item.id==defaultBus.id&&(selectedItem=item,selectedIndex=index);var adultPrice=0,childPrice=0;_.each(item.listData,function(item){adultPrice+=item.price,childPrice+=item.childPrice}),item.diffPrice=adultNum*(adultPrice-defaultAdultPrice)+childNum*(childPrice-defaultChildPrice)}),void 0!=selectedIndex&&(data.splice(selectedIndex,1),data.unshift(selectedItem),o.selectedIndex=0),o.list=data,this.set(o)},setDefaultBus:function(data){this.set("defaultBus",data)},changeTourist:function(adultNum,childNum){this.set({adultNum:adultNum,childNum:childNum})},reset:function(){},select:function(index){var list=this.get("list"),defaultBus=this.get("defaultBus"),o={};list[index].id==defaultBus.id?o.disabled=!0:o.disabled=!1,o.selectedIndex=index,this.set(o),this.trigger("render")},confirm:function(){var selectedIndex=this.get("selectedIndex"),list=this.get("list"),selectedData=_.find(list,function(item,index){return selectedIndex==index});EventBus.trigger("changeBus",selectedData),EventBus.trigger("refreshInsurance"),this.destroy()},destroy:function(){this.set({selectedIndex:null,disabled:!0})}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(5)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,EventBus){return Backbone.Model.extend({defaults:{individualList:null,filters:null,filterKey:null,filterString:{depStop:"出发车站",dsStop:"到达车站",timeFilters:"出发时段"},cityList:null,timeSortList:null,defaultBus:null,journeyIndex:null,adultNum:2,childNum:0,hasGetBusList:!1,indSelected:null,copyList:null},init:function(data){this.structData(data)?this.trigger("render"):this.trigger("loadError")},structData:function(data){var filterKey=[],adultNum=this.get("adultNum"),childNum=this.get("childNum"),defaultBus=this.get("defaultBus"),res=data.individualList,fillArr=[];return data.individualList&&data.individualList.length&&_.each(data.individualList,function(items,i){fillArr.push(0),items&&items.length&&_.each(items,function(item,j){item.show=!0;var defaultId;_.some(defaultBus,function(defaultItem,defaultIndex){return defaultIndex==i&&(defaultId=defaultItem.scheduleCode)}),item.selected=defaultId==item.scheduleCode,item.unique_id=j,item.diffPrice=(item.ticketPrice-defaultBus[i].price)*(adultNum+childNum)})}),data.filters&&data.filters.length&&_.each(data.filters,function(eve){var eveFilter={};eve&&_.each(eve,function(items,key){eveFilter[key]=_.map(items,function(item){return!1})}),filterKey.push(eveFilter)}),this.set({individualList:data.individualList,filters:data.filters,filterKey:filterKey,journeyIndex:0,hasGetBusList:res,copyList:_.extend({},data.individualList),timeSortList:fillArr}),!!res},setFilterKey:function(type,index,inputParam){var filterKey=this.get("filterKey"),journeyIndex=this.get("journeyIndex");filterKey[journeyIndex][type][index]=inputParam,this.doFilter(journeyIndex,filterKey[journeyIndex])},doFilter:function(i,filArr){var self=this,indList=self.get("individualList")[i],filters=self.get("filters")[i],filterItem=function(v){v.show=!0;var dep=!0,dst=!0,timer=!0,inDep=!1,inDst=!1,inTimer=!1;_.each(filters,function(filItems,key){_.each(filItems,function(item,i){if("depStop"===key)filArr[key][i]&&(inDep=inDep||v.dptStation==item,dep&&(dep=!dep));else if("dsStop"===key)filArr[key][i]&&(inDst=inDst||v.dstStation==item,dst&&(dst=!dst));else if("timeFilters"===key){var beArr=item.split("-"),dptTimeArr=v.dptTime&&v.dptTime.split(":");if(filArr[key][i]&&v.dptTime&&dptTimeArr&&dptTimeArr.length>=2){var date="1970/09/23 ",startTime=new Date(date+beArr[0]).getTime(),endTime=new Date(date+beArr[1]).getTime(),currentTime=new Date(date+v.dptTime).getTime(),timeCompare=currentTime>=startTime&&currentTime<=endTime;inTimer=inTimer||timeCompare,timer&&(timer=!timer)}}})}),dep&&dst&&timer?v.show=!0:(!dep&&(v.show=v.show&&inDep),!dst&&(v.show=v.show&&inDst),!timer&&(v.show=v.show&&inTimer))};_.each(indList,function(item){filterItem(item)})},sort:function(){var i=this.get("journeyIndex"),parentList=this.get("individualList"),indList=this.get("individualList")[i],timeSort=this.get("timeSortList");timeSort[i]=timeSort[i]&&1===timeSort[i]?-1:1;var timeToNumber=function(v){var timerArr=v.split(":");return 3600*parseInt(timerArr[0])+60*parseInt(timerArr[1])+parseInt(timerArr[2])};parentList[i]=_.sortBy(indList,function(item){return 1===timeSort[i]?timeToNumber(item.dptTime):-timeToNumber(item.dptTime)})},structIndData:function(data){var indData=this.get("indSelected")||[],index=this.get("journeyIndex"),newData=_.extend({},data,{id:"",busStopId:data.dptRegionCode,resId:0,price:data.ticketPrice,childPrice:data.ticketPrice,departDate:data.dptDate,departStopName:data.dptStation,arriveStopName:data.dstStation,departTime:data.dptTime,arriveTime:data.dstTime,duration:data.takeTimes});indData[index]=newData,this.set({indSelected:indData})},dataChange:function(){EventBus.trigger("changeBus",this.get("indSelected")),EventBus.triggerAsyncOnce("refreshInsurance"),EventBus.triggerAsyncOnce("getFavourableInfo"),this.destroy()},destroy:function(){this.set({journeyIndex:0,copyList:this.get("copyList"),
indSelected:[]})}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(5),__webpack_require__(37),__webpack_require__(6)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,EventBus,MultiTransportCommon,config){var PageDataObj=config.pageDataObj;return Backbone.Model.extend({defaults:{isCombinedTransport:!1,defaultTransport:[],departureCity:"",departureCityName:"",backCity:"",backCityName:"",departureCityListM:[],departureCityCodeM:"",departureCityNameM:"",backCityListM:[],backCityCodeM:"",backCityNameM:"",price:"",list:[],airplaneArriveHourBeforeNextTrip:"",trainArriveHourBeforeNextTrip:"",airplaneDepartHourAfterPreviousTrip:"",trainDepartHourAfterPreviousTrip:"",hasCheck:!1,checkTimes:0,person:null,isOneBackJourney:!1,firstIn:!0,isFromOrder:!1,isInList:!1,isPackTour:1==PageDataObj.proMode&&1==PageDataObj.productType,isPackAndIncludePrice:1==PageDataObj.proMode&&3==PageDataObj.includeCombinedPrice&&1==PageDataObj.productType,isIncudePrice:3==PageDataObj.includeCombinedPrice,defaultSelected:PageDataObj.combinedCityCode&&3==PageDataObj.includeCombinedPrice,allSelected:!1},initialize:function(){this.changeCity(),this.changeTourist(PageDataObj)},changeCity:MultiTransportCommon.changeCity,changeTourist:MultiTransportCommon.changeTourist,init:function(data){data.isCombinedTransport&&(this.set({isCombinedTransport:data.isCombinedTransport,departureCityListM:data.combinedTransportationsCities,backCityListM:data.combinedTransportationsCities,price:data.lowestPrice,airplaneArriveHourBeforeNextTrip:data.airplaneArriveHourBeforeNextTrip,trainArriveHourBeforeNextTrip:data.trainArriveHourBeforeNextTrip,airplaneDepartHourAfterPreviousTrip:data.airplaneDepartHourAfterPreviousTrip,trainDepartHourAfterPreviousTrip:data.trainDepartHourAfterPreviousTrip,isOneBackJourney:data.isOneBackJourney}),1===PageDataObj.proMode&&this.set("packageResourceTime",data.packetResourceTime,{silent:!0}))},setDefaultData:function(data){var list=[];data instanceof Array?(_.each(data,function(item){item.isSelected=!1;var trainNumText,durationTextDetail,format=function(item2){item2.numberLimit="",item2.travelerCategory="";var saleControl=item2.saleControl;saleControl&&(saleControl.minPassengerNum&&(item2.numberLimit+="最少出行人数"+saleControl.minPassengerNum+"；"),saleControl.maxPassengerNum&&(item2.numberLimit+="最多出行人数"+saleControl.maxPassengerNum+"；"),saleControl.corePassengerNum&&(item2.numberLimit+="固定出行人数"+saleControl.corePassengerNum+"；"),item2.travelerCategory=saleControl.applicableTravelerCategory)};if(1==item.transportType&&(item.transferInfo?_.each(item.transferInfo,function(item2){format(item2)}):format(item)),1===item.journeyIndex&&(list[item.journeyIndex-1]=item),2===item.journeyIndex&&(list[item.journeyIndex-1]=item),item.isUnsureTicket){if(("待定"==item.trainNum||""==item.trainNum)&&(item.trainType||0==item.trainType)){switch(item.trainType){case 0:trainNumText="高铁G(车次待定)";break;case 1:trainNumText="城际C(车次待定)";break;case 2:trainNumText="动车D(车次待定)";break;case 3:trainNumText="直达Z(车次待定)";break;case 4:trainNumText="特快T(车次待定)";break;case 5:trainNumText="普快(车次待定)";break;default:trainNumText="车型车次待定"}item.trainNum=trainNumText}item.duration||(item.durationText="时间待定",durationTextDetail=item.departStartTime&&item.departEndTime?"预计车票出发时间在"+item.departStartTime+"~"+item.departEndTime+"之间，抵达时间、运行时间待定；确切时间以实际出票结果为准；":"出发时间，抵达时间，运行时间均待定；确切时间以实际出票结果为准"),item.departStartTime&&item.departEndTime&&(item.departDepartTime=item.departStartTime+"-"+item.departEndTime+"待定",item.destArriveTime="待定"),item.durationTextDetail=durationTextDetail?durationTextDetail:""}}),this.set({list:list},{silent:!0})):(_.each(data.list,function(item){data.isFromOrder?item.isSelected=!0:item.isSelected=!1,1===item.journeyIndex&&(list[item.journeyIndex-1]=item),2===item.journeyIndex&&(list[item.journeyIndex-1]=item)}),this.set({list:list,isFromOrder:data.isFromOrder,isInList:data.isInList},{silent:!0}),data.isFromOrder&&EventBus.trigger("newSelectMultiTransport",!0)),this.trigger("change")},setDefaultTransport:function(type,data){data=$.extend(!0,[],data),_.each(data,function(item){item.transportType=type}),this.set({defaultTransport:data},{silent:!0})},deleteOne:function(index){var list=this.get("list"),airType=list[index].airType;2==airType?_.each(list,function(item,index){list[index]=null}):list[index]=null,this.trigger("change"),EventBus.trigger("calculateMultiTransport")},checkTime:function(isSaveOrder){var defaultTransportFirst,defaultTransportLast,multiTransportFirst,multiTransportLast,result,tTime,o={flag:!0,journeyIndex:-1,conflict:!1,timeDifference1:"",timeDifference2:""},model=this.toJSON(),defaultTransport=model.defaultTransport,selectedData=model.list,airplaneArriveHourBeforeNextTrip=model.airplaneArriveHourBeforeNextTrip,trainArriveHourBeforeNextTrip=model.trainArriveHourBeforeNextTrip,airplaneDepartHourAfterPreviousTrip=model.airplaneDepartHourAfterPreviousTrip,trainDepartHourAfterPreviousTrip=model.trainDepartHourAfterPreviousTrip,packageResourceTime=model.packageResourceTime||void 0,compare=function(d,m,journeyIndex){var departureTime,arriveTime;0==journeyIndex?(departureTime=1===PageDataObj.proMode?d.normalDepartDate+" "+d.normalDepartTime:1==d.transportType?d.departDate+" "+d.departTime:d.departDate+" "+d.departDepartTime,arriveTime=1==m.transportType?m.arrivalDate+" "+m.arriveTime:m.arrivalDate+" "+m.destArriveTime):(departureTime=1==m.transportType?m.departDate+" "+m.departTime:m.departDate+" "+m.departDepartTime,arriveTime=1===PageDataObj.proMode?d.normalArriveDate+" "+d.normalArriveTime:1==d.transportType?d.arrivalDate+" "+d.arriveTime:d.arrivalDate+" "+d.destArriveTime);var aTime=new Date(arriveTime.replace(/-/g,"/")).getTime(),dTime=new Date(departureTime.replace(/-/g,"/")).getTime();if(aTime>dTime)return{flag:!1,conflict:!0};var _timeDifference,timeDifference=dTime-aTime;return 1==m.transportType?(tTime=3600*(0==journeyIndex?airplaneArriveHourBeforeNextTrip:airplaneDepartHourAfterPreviousTrip)*1e3,_timeDifference=0==journeyIndex?airplaneArriveHourBeforeNextTrip:airplaneDepartHourAfterPreviousTrip):(tTime=3600*(0==journeyIndex?trainArriveHourBeforeNextTrip:trainDepartHourAfterPreviousTrip)*1e3,_timeDifference=0==journeyIndex?trainArriveHourBeforeNextTrip:trainDepartHourAfterPreviousTrip),timeDifference<tTime?{flag:!1,conflict:!1,timeDifference:_timeDifference}:{flag:!0,conflict:!1}};return _.each(defaultTransport,function(item,index){0==index&&(defaultTransportFirst=item),0!=index&&index==defaultTransport.length-1&&(defaultTransportLast=item)}),_.each(selectedData,function(item,index){0==index&&item&&item.isSelected&&(multiTransportFirst=item),1==index&&item&&item.isSelected&&(multiTransportLast=item)}),defaultTransportFirst&&multiTransportFirst&&(result=compare(defaultTransportFirst,multiTransportFirst,0),o.flag=o.flag&&result.flag,o.conflict=o.conflict||result.conflict,o.timeDifference1=result.timeDifference,o.flag||(o.journeyIndex=0)),defaultTransportLast&&multiTransportLast&&(result=compare(defaultTransportLast,multiTransportLast,1),o.flag=o.flag&&result.flag,o.conflict=o.conflict||result.conflict,o.timeDifference2=result.timeDifference,o.flag||(o.journeyIndex=0==o.journeyIndex?2:1)),1===PageDataObj.proMode&&multiTransportFirst&&(result=compare(packageResourceTime,multiTransportFirst,0),o.flag=o.flag&&result.flag,o.conflict=o.conflict||result.conflict,o.timeDifference1=result.timeDifference,o.flag||(o.journeyIndex=0)),1===PageDataObj.proMode&&multiTransportLast&&(result=compare(packageResourceTime,multiTransportLast,1),o.flag=o.flag&&result.flag,o.conflict=o.conflict||result.conflict,o.timeDifference2=result.timeDifference,o.flag||(o.journeyIndex=0==o.journeyIndex?2:1)),o.flag||isSaveOrder&&!o.conflict||this.trigger("error",_.extend({type:"time",proMode:PageDataObj.proMode},o)),o},checkTrain:function(){var defaultTransportType,flag=!0,model=this.toJSON(),defaultTransport=model.defaultTransport,person=model.person,childNum=person[1].childNum;return 1===PageDataObj.proMode&&_.some(model.list,function(item,index){if(item&&item.isSelected&&2==item.transportType&&childNum)return flag=!1,!0}),_.some(defaultTransport,function(item){return defaultTransportType=item.transportType,!0}),1==defaultTransportType&&_.some(model.list,function(item,index){if(item&&item.isSelected&&2==item.transportType&&childNum)return flag=!1,!0}),flag},getPrice:function(){var adultNum,childNum,model=this.toJSON(),list=model.list,person=model.person,arr=[],adultPrice=0,childPrice=0;if(_.each(list,function(item){item&&item.isSelected&&(adultNum=person[item.transportType].adultNum,childNum=person[item.transportType].childNum,1==item.transportType?(adultPrice=item.price,childPrice=item.childPrice):(adultPrice=item.adultPrice,childPrice=item.normalChildPrice),arr.push({adultNum:adultNum,childNum:childNum,adultPrice:adultPrice,childPrice:childPrice}))}),2==arr.length){var one=arr[0],two=arr[1];one.adultNum==two.adultNum&&one.childNum==two.childNum&&(arr=[{adultNum:one.adultNum,childNum:one.childNum,adultPrice:one.adultPrice+two.adultPrice,childPrice:one.childPrice+two.childPrice}])}return arr},getAirplaneCheckFlag:function(){var self=this,needCheck=!1;return!this.get("hasCheck")&&(!_.isEmpty(this.get("list"))&&(_.some(this.get("list"),function(item){if(item&&item.isSelected&&1==item.transportType)return PageDataObj.isSignBack&&self.get("isFromOrder")?PageDataObj.hasTakeSeat?self.airplanePersonChange(1)&&self.get("isInList")&&(needCheck=!0):self.airplanePersonChange(2)&&(needCheck=!0):needCheck=!0,!0}),needCheck))},airplanePersonChange:function(type){var person=this.get("person"),adultNum=person[1].adultNum,childNum=person[1].childNum,adultNumDefault=PageDataObj.adultNum,childNumDefault=2==PageDataObj.proMode?PageDataObj.normalChildNum:PageDataObj.childNum,freeChildNumDefault=2==PageDataObj.proMode?PageDataObj.freeChildNum:0;return 1==type?adultNum>adultNumDefault||childNum>childNumDefault+freeChildNumDefault:adultNum!=adultNumDefault||childNum!=childNumDefault+freeChildNumDefault},checkAirplane:function(orderInfo,productId){var checkData,model=this.toJSON(),list=model.list,person=model.person;checkData={productId:productId,adultNum:person[1].adultNum,childNum:person[1].childNum,flightInfo:[]},PageDataObj.isSignBack&&this.get("isFromOrder")&&PageDataObj.hasTakeSeat&&this.airplanePersonChange(1)&&this.get("isInList")&&(checkData.adultNum=checkData.adultNum-PageDataObj.adultNum,checkData.childNum=checkData.childNum-PageDataObj.childNum),_.each(list,function(item,index){item&&item.isSelected&&1==item.transportType&&(checkData.flightInfo.push(_.pick(item,"cityKey","flightNo","departDate","solutionId","policyId","cabinKey","seatClass","saleControl","price","childPrice")),checkData.airType=item.airType)}),EventBus.trigger("needCheckAirplaneMultiTransport",checkData)},handleCheckAirplaneResult:function(data,orderInfo){var model=this.toJSON(),list=model.list,person=model.person,resIds=data.resIds,msg=data.tipMsg,checkTimes=this.get("checkTimes");if(data.goNextStep)_.each(resIds,function(item){var index;1==resIds.length?_.some(list,function(item2,index2){item2&&item2.isSelected&&1==item2.transportType&&(index=index2)}):index=item.rph-1,list[index]&&(list[index].resId=item.flightResourceId)}),this.set({hasCheck:1},{silent:!0}),EventBus.trigger("saveOrder");else{if(this.set({checkTimes:++checkTimes},{silent:!0}),2==checkTimes)return this.set({hasCheck:1},{silent:!0}),void EventBus.trigger("saveOrder");if(3==msg){var newAdultPrice,newChildPrice,priceDifference=0,adultNum=person[1].adultNum,childNum=person[1].childNum,isGroup=_.some(list,function(item){if(item&&item.isSelected)return 1==item.transportType&&2==item.airType});PageDataObj.isSignBack&&this.get("isFromOrder")&&PageDataObj.hasTakeSeat&&this.airplanePersonChange(1)&&this.get("isInList")&&(adultNum-=PageDataObj.adultNum,childNum-=PageDataObj.childNum),_.each(resIds,function(item){if(isGroup)newAdultPrice=adultNum?item.segmentAdultTotalPrice/(list.length*adultNum):0,newChildPrice=childNum?item.segmentChildTotalPrice/(list.length*childNum):0,_.each(list,function(item2){priceDifference+=(newAdultPrice-item2.price)*adultNum,priceDifference+=(newChildPrice-item2.childPrice)*childNum,item2.price=newAdultPrice,item2.childPrice=newChildPrice});else{var index;1==resIds.length?_.some(list,function(item2,index2){item2&&item2.isSelected&&1==item2.transportType&&(index=index2)}):index=item.rph-1,newAdultPrice=adultNum?item.segmentAdultTotalPrice/adultNum:0,newChildPrice=childNum?item.segmentChildTotalPrice/childNum:0,priceDifference+=(newAdultPrice-list[index].price)*adultNum,priceDifference+=(newChildPrice-list[index].childPrice)*childNum,list[index].price=newAdultPrice,list[index].childPrice=newChildPrice}}),EventBus.trigger("calculateMultiTransport",!0)}this.trigger("error",{type:"check",code:msg,priceDifference:priceDifference,proMode:PageDataObj.proMode})}},handleCheckAirplaneError:function(){this.trigger("error",{type:"check",code:4,proMode:PageDataObj.proMode})},reset:function(data){var list=this.get("list"),firstIn=this.get("firstIn"),transportTypeList=[];return this.get("defaultSelected")?(this.set("allSelected",!1,{silent:!0}),_.each(data,function(item,index){item&&(list[index]=item,item.isSelected=!1)}),this.set({list:list,hasCheck:!1},{silent:!0}),void this.trigger("change")):(_.each(data,function(item,index){item&&(list[index]=item,item.isSelected=!0,transportTypeList.push(item.transportType))}),this.changeTouristCardType(transportTypeList),firstIn&&_.each(list,function(item){item?item.isSelected=!0:null}),this.set({list:list,hasCheck:!1},{silent:!0}),this.trigger("change"),void EventBus.trigger("calculateMultiTransport"))},empty:function(){this.set("list",[])},changeTouristCardType:function(arr){var trainTicket=!1,flightTicket=!1;_.each(arr,function(item){1===item&&(flightTicket=!0),2===item&&(trainTicket=!0)});var selectedAir=Backbone.app.get("selectedAir")||[];flightTicket?selectedAir[1]={type:21,internationalFlag:0}:selectedAir.splice(1,1),Backbone.app.set({selectedAir:selectedAir,selectedTrain:trainTicket},{silent:!0}),Backbone.app.trigger("change:selectedAir")},getIfParam:function(list){var data=this.toJSON(),first=data.list[0],last=data.list[1],param={combinedTransport:{departDate:first?list.departureDateM:"",arriveDate:last?list.backDateM:""}};return param},hasMultiTransport:function(){return this.get("isCombinedTransport")},getIndResType:function(){var resType,list=this.get("list"),indResType=21;return _.some(list,function(item){if(item&&item.isSelected&&item.resType==indResType)return resType=indResType,!0}),resType},setUnsureTrain:function(flag){var list=this.get("list");flag&&(_.some(list,function(item){item.isSelected=!1}),EventBus.trigger("calculateMultiTransport"))}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var config=__webpack_require__(6),PageDataObj=config.pageDataObj,EventBus=__webpack_require__(5);exports.changeCity=function(){var departureCityName="";departureCityName=1==PageDataObj.proMode?PageDataObj.classBrandId&&13==PageDataObj.classBrandId?PageDataObj.teamCityName:PageDataObj.packetDepartCityName:PageDataObj.departCityName,this.set({departureCity:1==PageDataObj.proMode?PageDataObj.packetDepartCityCode:PageDataObj.departCity,departureCityName:departureCityName,backCity:PageDataObj.backCity,backCityName:PageDataObj.backCityName,departureCityCodeM:PageDataObj.multiTransport&&PageDataObj.multiTransport.departCity||(PageDataObj.isSignBack?PageDataObj.bookCityFromIp:PageDataObj.bookCity),departureCityNameM:PageDataObj.multiTransport&&PageDataObj.multiTransport.departCityName||(PageDataObj.isSignBack?PageDataObj.bookCityNameFromIp:PageDataObj.bookCityName),backCityCodeM:PageDataObj.multiTransport&&PageDataObj.multiTransport.backCity||PageDataObj.bookCity,backCityNameM:PageDataObj.multiTransport&&PageDataObj.multiTransport.backCityName||PageDataObj.bookCityName,proMode:PageDataObj.proMode},{silent:!0}),this.get("backCity")||this.set({backCity:this.get("departureCity"),backCityName:this.get("departureCityName")},{silent:!0})},exports.changeTourist=function(orderData){var adultNum=orderData.adultNum,proMode=PageDataObj.proMode,childNum=2==proMode?orderData.normalChildNum:orderData.childNum,freeChildNum=orderData.freeChildNum,person={};person[1]={},person[1].adultNum=adultNum,person[1].childNum=2==proMode?childNum+freeChildNum:childNum,person[2]={},person[2].adultNum=adultNum,person[2].childNum=childNum,this.set("person",person,{silent:!0}),EventBus.trigger("calculateMultiTransport")}},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(5),__webpack_require__(37),__webpack_require__(6),__webpack_require__(16)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,EventBus,MultiTransportCommon,config,tools){var PageDataObj=config.pageDataObj;return Backbone.Model.extend({defaults:{defaultTransport:[],selectedTransport:[],departureCity:"",departureCityName:"",backCity:"",backCityName:"",departureCityListM:[],departureCityCodeM:"",departureCityNameM:"",backCityListM:[],backCityCodeM:"",backCityNameM:"",departureDateListM:[],departureDateM:"",backDateListM:[],backDateM:"",airplaneDepartDayArr:[],trainDepartDayArr:[],airplaneArriveDayArr:[],trainArriveDayArr:[],transportType:2,group:null,individualFlight:null,individualData:null,train:null,isOneJourney:!1,isOneBackJourney:!1,airplaneArriveHourBeforeNextTrip:"",trainArriveHourBeforeNextTrip:"",airplaneDepartHourAfterPreviousTrip:"",trainDepartHourAfterPreviousTrip:"",journeyIndex:0,selectedData:[],person:null,isShow:!1,hasCheck1:!1,hasCheck2:!1,hasCheck3:!1,proMode:0,isInit:!0,supportTrain:!1,supportAirplane:!1,isPackTour:1==PageDataObj.proMode&&1==PageDataObj.productType,isPackAndIncludePrice:1==PageDataObj.proMode&&3==PageDataObj.includeCombinedPrice&&1==PageDataObj.productType},initialize:function(){this.changeCity(),this.changeTourist(PageDataObj)},changeCity:MultiTransportCommon.changeCity,changeTourist:MultiTransportCommon.changeTourist,init:function(data){if(data.isCombinedTransport){var model=this.toJSON();data.fromTrainFilter&&(data.trainsInfo.filter=model.train.filter),this.set({selectedTransport:data.selectedTransport,departureCityListM:data.combinedTransportationsCities,backCityListM:data.combinedTransportationsCities,airplaneDepartDayArr:data.airplaneDepartDayArr,trainDepartDayArr:data.trainDepartDayArr,airplaneArriveDayArr:data.airplaneArriveDayArr,trainArriveDayArr:data.trainArriveDayArr,group:data.groupFlight,individualFlight:data.individualFlight,train:data.trainsInfo,isOneJourney:data.isOneJourney,isOneBackJourney:data.isOneBackJourney,airplaneArriveHourBeforeNextTrip:data.airplaneArriveHourBeforeNextTrip,trainArriveHourBeforeNextTrip:data.trainArriveHourBeforeNextTrip,airplaneDepartHourAfterPreviousTrip:data.airplaneDepartHourAfterPreviousTrip,trainDepartHourAfterPreviousTrip:data.trainDepartHourAfterPreviousTrip,isShow:data.isShow,supportTrain:data.supportTrain,supportAirplane:data.supportAirplane,hasCheck1:!1,hasCheck2:!1,hasCheck3:!1},{silent:!0}),data.isOneBackJourney&&this.set("journeyIndex",1,{silent:!0}),data.supportTrain||this.set("transportType",1,{silent:!0}),data.supportAirplane||this.set("transportType",2,{silent:!0}),"tour_order2"===PageDataObj.pageType&&data.supportTrain&&tools.getDiffTime(tools.parseDate(tools.addDate(new Date,30)),model.departureDateM,"day")<=0&&(this.set("supportTrain",!1),this.set("transportType",1,{silent:!0})),data.isShow&&this.format({airType:data.airType}),1===PageDataObj.proMode&&this.set("packageResourceTime",data.packetResourceTime,{silent:!0})}},getParam:function(airType){var model=this.toJSON(),param={},defaultTransport=model.defaultTransport,journeyIndex=model.journeyIndex,departDate=PageDataObj.departDate,backDate=PageDataObj.backDate;return 2==airType&&(journeyIndex=0),1!=PageDataObj.proMode?(_.each(defaultTransport,function(item,index){0==index&&(param.normalDepartTime=1==item.transportType?item.departTime:item.departDepartTime,param.normalDepartDate=item.departDate,0==journeyIndex&&(param.departDate=item.departDate)),index==defaultTransport.length-1&&(param.normalArriveTime=1==item.transportType?item.arriveTime:item.destArriveTime,param.normalArriveDate=item.arrivalDate,0==journeyIndex&&(param.arriveDate=item.arrivalDate),1==journeyIndex&&(param.departDate=item.arrivalDate))}),param.normalDepartDate>departDate&&(param.normalDepartTime="00:01",param.normalDepartDate=departDate),param.normalArriveDate<backDate&&(param.normalArriveTime="23:59",param.normalArriveDate=backDate)):(param.normalDepartDate=PageDataObj.departDate,param.normalArriveDate=PageDataObj.backDate,param.noramlBookCityCode=PageDataObj.bookCity,param.departDate=PageDataObj.departDate,param.arriveDate=PageDataObj.backDate),0==journeyIndex&&(model.departureDateM&&(param.departDate=model.departureDateM),model.backDateM&&(param.arriveDate=model.backDateM)),1==journeyIndex&&model.backDateM&&(param.departDate=model.backDateM),0==journeyIndex?(param.departCityCode=PageDataObj.combinedCityCode||model.departureCityCodeM,param.departCityName=PageDataObj.combinedCityName||model.departureCityNameM,param.destinationCityCode=model.departureCity,param.destinationCityName=model.departureCityName):1==journeyIndex&&(param.departCityCode=model.backCity,param.departCityName=model.backCityName,param.destinationCityCode=model.backCityCodeM,param.destinationCityName=model.backCityNameM),param.productId=PageDataObj.productId,param.traficSeq=journeyIndex+1,PageDataObj.isSignBack&&(param.orderId=PageDataObj.orderId,param.bookCity=PageDataObj.bookCityFromIp,param.multiTransport=PageDataObj.multiTransport),param.childNum=model.person[1].childNum,param.destinationCode=PageDataObj.teamCityCode,param.destinationCityName=PageDataObj.teamCityName,param},format:function(options){var model=this.toJSON(),selectedTransport=model.selectedTransport,group=model.group,individualFlight=model.individualFlight,individualData=model.individualData||{},selectedData=model.selectedData,train=model.train,journeyIndex=model.journeyIndex,person=model.person,airType=options?options.airType:"",airplaneId=options?options.airplaneId:"",trainId=options?options.trainId:"",currentSelected=selectedData[journeyIndex],defaultSelected=selectedTransport[journeyIndex],isOneJourney=model.isOneJourney,isOneBackJourney=model.isOneBackJourney,transportType=model.transportType;if(airplaneId&&(_.some(individualData.list,function(item){return _.some(item.cabinTypeRes,function(item2){if(item2.resId==airplaneId)return item.isSelected=!0,_.each(item2,function(item3,key3){"flightNo"!=key3&&(item[key3]=item3)}),selectedData[journeyIndex-1]=item,!currentSelected||2!=currentSelected.airType&&2!=item.airType||selectedData.splice(journeyIndex,1),!0})}),journeyIndex<2)){if(isOneJourney&&!isOneBackJourney)return this.set("journeyIndex",journeyIndex+1,{silent:!0}),void this.format();if(3==airType)return void this.request({loop:!0})}if(trainId&&(_.some(train.list,function(item){return _.some(item.prices,function(item2){if(item2.resId==trainId)return item.isSelected=!0,_.each(item2,function(item3,key3){item[key3]=item3}),selectedData[journeyIndex-1]=item,currentSelected&&2==currentSelected.airType&&selectedData.splice(journeyIndex,1),!0})}),journeyIndex<2))return isOneJourney&&!isOneBackJourney?(this.set("journeyIndex",journeyIndex+1,{silent:!0}),void this.format()):void this.request({loop:!0});if(individualData.filter={},individualData.sort=this.formatSort(),individualData.list=[],journeyIndex<2&&(train&&(train.sort=this.formatSort(),_.each(train.list,function(item){item.transportType=2;var priceForSort;_.each(item.prices,function(item2){var _price=item2.adultPrice;priceForSort=priceForSort||_price,_price<priceForSort&&(priceForSort=_price),currentSelected&&2==currentSelected.transportType?item2.selected=item2.resId==currentSelected.resId&&item.departDate==currentSelected.departDate:defaultSelected&&2==defaultSelected.transportType?item2.selected=item2.resId==defaultSelected.resId&&item.departDate==defaultSelected.departDate:item2.selected=!1}),item.priceForSort=priceForSort})),group&&(individualData.filter=this.formatFilter(individualData.filter,group.filter),_.each(group.flightlist,function(item){var sameItem,sameIndex,one=item.listData[journeyIndex];if(journeyIndex>0){if(2!=airType)return;for(var find=!0,i=0;i<journeyIndex;i++){var onePrev=item.listData[i];find=find&&onePrev.flightNo==selectedData[i].flightNo}if(!find)return}var same=_.some(individualData.list,function(item2,index2){if(2==item2.airType&&one.flightNo==item2.flightNo)return sameItem=item2,sameIndex=index2,!0});if(same){var price=one.cabinTypeRes[0].price,samePrice=sameItem.cabinTypeRes[0].price;samePrice>price&&individualData.list.splice(sameIndex,1,one)}else individualData.list.push(one)})),individualFlight&&(individualData.filter=this.formatFilter(individualData.filter,individualFlight.filter),0!=journeyIndex&&2==airType||(individualData.list=individualData.list.concat(individualFlight.journeyData[0].listData))),!_.isEmpty(individualData.list))){var adultNum=person[1].adultNum,childNum=person[1].childNum;_.each(individualData.list,function(item){item.transportType=1;var priceForSort;_.each(item.cabinTypeRes,function(item2){var _price=item2.price;priceForSort=priceForSort||_price,_price<priceForSort&&(priceForSort=_price),currentSelected&&1==currentSelected.transportType?item2.selected=item2.resId==currentSelected.resId:defaultSelected&&1==defaultSelected.transportType?item2.selected=item2.resId==defaultSelected.resId:item2.selected=!1}),item.priceForSort=priceForSort;var format=function(item2){_.each(item2.cabinTypeRes,function(item3){item3.numberLimit="",item3.travelerCategory="",item3.disabled=!1;var saleControl=item3.saleControl;if(saleControl&&(saleControl.minPassengerNum&&(item3.numberLimit+="最少出行人数"+saleControl.minPassengerNum+"；",adultNum+childNum<saleControl.minPassengerNum&&(item3.disabled=!0)),saleControl.maxPassengerNum&&(item3.numberLimit+="最多出行人数"+saleControl.maxPassengerNum+"；",adultNum+childNum>saleControl.maxPassengerNum&&(item3.disabled=!0)),saleControl.corePassengerNum&&(item3.numberLimit+="固定出行人数"+saleControl.corePassengerNum+"；",adultNum+childNum!=saleControl.corePassengerNum&&(item3.disabled=!0)),item3.travelerCategory=saleControl.applicableTravelerCategory,item3.travelerCategory)){var personArr=item3.travelerCategory.split(","),adultSelect=!1,childSelect=!1,babySelect=!1;_.each(personArr,function(item4){"成人"==item4&&(adultSelect=!0),"儿童"==item4&&(childSelect=!0),"婴儿"==item4&&(babySelect=!0)}),adultNum&&!adultSelect&&(item3.disabled=!0),childNum&&!childSelect&&(item3.disabled=!0)}})};item.transferInfo?_.each(item.transferInfo,function(item2){format(item2)}):format(item)})}if(train&&train.list&&train.list.length){train.list.forEach(function(item,index){var trainNumText,durationTextDetail;if(item.isUnsureTicket){if(("待定"==item.trainNum||""==item.trainNum)&&(item.trainType||0==item.trainType)){switch(item.trainType){case 0:trainNumText="高铁G(车次待定)";break;case 1:trainNumText="城际C(车次待定)";break;case 2:trainNumText="动车D(车次待定)";break;case 3:trainNumText="直达Z(车次待定)";break;case 4:trainNumText="特快T(车次待定)";break;case 5:trainNumText="普快(车次待定)";break;default:trainNumText="车型车次待定"}item.trainNum=trainNumText}item.duration||(item.durationText="时间待定",durationTextDetail=item.departStartTime&&item.departEndTime?"预计车票出发时间在"+item.departStartTime+"~"+item.departEndTime+"之间，抵达时间、运行时间待定；确切时间以实际出票结果为准；":"出发时间，抵达时间，运行时间均待定；确切时间以实际出票结果为准",item.departStartTime&&item.departEndTime&&(item.departDepartTime=item.departStartTime+"-"+item.departEndTime+"待定",item.destArriveTime="待定"),item.durationTextDetail=durationTextDetail)}})}this.set({individualData:individualData,individualCopyData:$.extend(!0,{},individualData),train:train,departureDateListM:1==transportType?model.airplaneDepartDayArr:model.trainDepartDayArr,backDateListM:1==transportType?model.airplaneArriveDayArr:model.trainArriveDayArr},{silent:!0}),_.isEmpty(individualData.list)||this.sort("price",1),train&&this.sort("price",2),this.trigger("needRender")},request:function(options){options=_.extend({},options,{isShow:!0,fromList:!0}),EventBus.trigger("getMultiTransport",options)},setDefaultTransport:function(type,data){data=$.extend(!0,[],data);var departDate=PageDataObj.departDate,backDate=PageDataObj.backDate,backDateM="",departureDateM="";_.each(data,function(item,index){item.transportType=type,0==index&&(departureDateM=item.departDate),index==data.length-1&&(backDateM=item.arrivalDate)}),1===PageDataObj.proMode&&(departureDateM=PageDataObj.departDate,backDateM=PageDataObj.backDate),departureDateM>departDate&&(departureDateM=departDate),backDateM<backDate&&(backDateM=backDate),this.set({defaultTransport:data,departureDateM:departureDateM,backDateM:backDateM},{silent:!0})},filter:function(type,key){var transportType=this.get("transportType"),group=this.get("group"),individualFlight=this.get("individualFlight"),train=this.get("train"),individualData=this.get("individualData"),individualCopyData=this.get("individualCopyData"),journeyIndex=this.get("journeyIndex"),filter=[];if(1==transportType?0==journeyIndex?filter=individualData.filter[0]:1==journeyIndex&&(group?filter=individualData.filter[1]:individualFlight&&(filter=individualData.filter[0])):filter=train.filter,2==transportType){_.some(filter,function(item){if(item.id==type)return 99==key?(_.each(item.sub,function(item2){item2.selected=!1}),!0):_.some(item.sub,function(item2){item2.id==key&&(item2.selected=!item2.selected)})});var filterParam={trainTypes:[],seats:[],departureStations:[],arrivalStations:[],departureTimes:[],arrivalTimes:[],departStationTypes:[]};return _.each(filter,function(item){_.each(item.sub,function(item2){item2.selected&&(filterParam[item.id]?filterParam[item.id].push(item2.id):filterParam[item.id]=[])})}),void this.request({fromTrainFilter:!0,filter:filterParam})}_.each(filter,function(item,_type){_type==type&&_.some(item,function(sub){if(sub.key==key)return sub.selected=!sub.selected,!0})});var prevType,prevArr,currentData=$.extend(!0,[],individualCopyData.list),getKey=function(airplane,type){var key=0;if(2==type){if(airplane.transfer){var duration=airplane.transfer.duration,match1=duration.match(/(\d*)小时/),match2=duration.match(/(\d*)分钟/),match3=duration.match(/(\d*)秒/);if(match1)var hour=+match1[1];if(match2)var minute=+match2[1];if(match3)var second=+match3[1];hour?(minute&&(hour+=minute/60),second&&(hour+=second/3600),key=hour<4?1:hour<8?2:hour<12?3:4):key=1}}else{var date=0==type?new Date("2016/09/23 "+airplane.departTime):new Date("2016/09/23 "+airplane.arriveTime),hour=(date.getTime()-new Date("2016/09/23").getTime())/36e5;hour<8?key=4:hour<12?key=1:hour<18?key=2:hour<24&&(key=3)}return key},check=function(type,sub,airplane){var flag;switch(type){case"routeLineList":flag=airplane.flightNum==sub.key;break;case"airLineCompanyList":flag=airplane.flightCode==sub.key;break;case"departureTimeSerialList":flag=getKey(airplane,0)==sub.key;break;case"arrivalTimeSerialList":flag=getKey(airplane,1)==sub.key;break;case"transferCityList":flag=!!airplane.transfer&&airplane.transfer.city==sub.viewName;break;case"transferDurationList":flag=getKey(airplane,2)==sub.key;break;case"departureAirportList":flag=airplane.departureAirportCode==sub.key;break;case"arrivalAirportList":flag=airplane.destinationAirportCode==sub.key;break;case"cabinSerialList":flag=_.some(airplane.cabinTypeRes,function(item){return item.cabinTypeCode==sub.key})}return flag};_.each(filter,function(item,type){_.each(item,function(sub){if(sub.selected){
if(type==prevType){var result=_.filter(prevArr,function(airplane){return check(type,sub,airplane)});_.each(result,function(item){var flag=_.some(currentData,function(item2){return item.airType==item2.airType&&item.flightNo==item2.flightNo});flag||currentData.push(item)})}else prevArr=$.extend(!0,[],currentData),currentData=_.filter(currentData,function(airplane){return check(type,sub,airplane)});return prevType=type,!0}})}),individualData.list=currentData,this.set("individualData",individualData,{silent:!0}),this.sort()},sort:function(type,_transportType){var transportType=_transportType||this.get("transportType"),individualData=this.get("individualData"),train=this.get("train"),sortData=1==transportType?individualData:train,sort=sortData.sort;type&&_.each(sort,function(item){item.code==type?(item.selected=!0,item.val=-item.val):(item.selected=!1,item.val=-1)});var toNumber=function(type,item){var num;switch(type){case"departTime":num=new Date("2016/09/23 "+(1==transportType?item.departTime:item.departDepartTime)).getTime();break;case"arriveTime":num=new Date("2016/09/23 "+(1==transportType?item.arriveTime:item.destArriveTime)).getTime();break;case"duration":var duration=item.duration,match1=duration.match(/(\d*)小时/),match2=duration.match(/(\d*)分钟/),match3=duration.match(/(\d*)秒/);if(match1){var hour=+match1[1];num=3600*hour}if(match2){var minute=+match2[1];num?num+=60*minute:num=60*minute}if(match3){var second=+match3[1];num?num+=second:num=second}break;case"price":num=item.priceForSort}return num};_.each(sort,function(item){item.selected&&(sortData.list=_.sortBy(sortData.list,function(item2){var selected=!1;return 1==transportType?_.some(item2.cabinTypeRes,function(item3){item3.selected&&(selected=!0)}):_.some(item2.prices,function(item3){item3.selected&&(selected=!0)}),selected?-(1/0):1==item.val?toNumber(item.code,item2):-toNumber(item.code,item2)}))}),1==transportType?this.set("individualData",sortData,{silent:!0}):this.set("train",sortData,{silent:!0})},formatFilter:function(target,filters){var journeyIndex=this.get("journeyIndex");return _.isEmpty(target)?target=filters:_.each(filters,function(item,index1){_.each(item,function(item2,key2){var _item2=target[journeyIndex][key2];_item2?_.each(item2,function(item3){var find=_.some(_item2,function(_item3){return _item3.key==item3.key});find||_item2.push(item3)}):target[journeyIndex][key2]=item2})}),target||{}},formatSort:function(){var sort=[{code:"departTime",name:"出发时间",val:-1,selected:!1},{code:"arriveTime",name:"到达时间",val:-1,selected:!1},{code:"duration",name:"时长",val:-1,selected:!1},{code:"price",name:"价格",val:-1,selected:!0}];return sort},checkTime:function(){var defaultTransportFirst,defaultTransportLast,multiTransportFirst,multiTransportLast,result,tTime,o={flag:!0,journeyIndex:-1,conflict:!1,timeDifference1:"",timeDifference2:""},model=this.toJSON(),defaultTransport=model.defaultTransport,selectedData=model.selectedData,airplaneArriveHourBeforeNextTrip=model.airplaneArriveHourBeforeNextTrip,trainArriveHourBeforeNextTrip=model.trainArriveHourBeforeNextTrip,airplaneDepartHourAfterPreviousTrip=model.airplaneDepartHourAfterPreviousTrip,trainDepartHourAfterPreviousTrip=model.trainDepartHourAfterPreviousTrip,packageResourceTime=model.packageResourceTime||void 0,compare=function(d,m,journeyIndex){var departureTime,arriveTime;0==journeyIndex?(departureTime=1===pageDataObj.proMode?d.normalDepartDate+" "+d.normalDepartTime:1==d.transportType?d.departDate+" "+d.departTime:d.departDate+" "+d.departDepartTime,arriveTime=1==m.transportType?m.arrivalDate+" "+m.arriveTime:m.arrivalDate+" "+m.destArriveTime):(departureTime=1==m.transportType?m.departDate+" "+m.departTime:m.departDate+" "+m.departDepartTime,arriveTime=1===pageDataObj.proMode?d.normalArriveDate+" "+d.normalArriveTime:1==d.transportType?d.arrivalDate+" "+d.arriveTime:d.arrivalDate+" "+d.destArriveTime);var aTime=new Date(arriveTime.replace(/-/g,"/")).getTime(),dTime=new Date(departureTime.replace(/-/g,"/")).getTime();if(aTime>dTime)return{flag:!1,conflict:!0};var _timeDifference,timeDifference=dTime-aTime;return 1==m.transportType?(tTime=3600*(0==journeyIndex?airplaneArriveHourBeforeNextTrip:airplaneDepartHourAfterPreviousTrip)*1e3,_timeDifference=0==journeyIndex?airplaneArriveHourBeforeNextTrip:airplaneDepartHourAfterPreviousTrip):(tTime=3600*(0==journeyIndex?trainArriveHourBeforeNextTrip:trainDepartHourAfterPreviousTrip)*1e3,_timeDifference=0==journeyIndex?trainArriveHourBeforeNextTrip:trainDepartHourAfterPreviousTrip),timeDifference<tTime?{flag:!1,conflict:!1,timeDifference:_timeDifference}:{flag:!0,conflict:!1}};return _.each(defaultTransport,function(item,index){0==index&&(defaultTransportFirst=item),0!=index&&index==defaultTransport.length-1&&(defaultTransportLast=item)}),_.each(selectedData,function(item,index){0==index&&item&&item.isSelected&&(multiTransportFirst=item),1==index&&item&&item.isSelected&&(multiTransportLast=item)}),defaultTransportFirst&&multiTransportFirst&&(result=compare(defaultTransportFirst,multiTransportFirst,0),o.flag=o.flag&&result.flag,o.conflict=o.conflict||result.conflict,o.timeDifference1=result.timeDifference,o.flag||(o.journeyIndex=0)),defaultTransportLast&&multiTransportLast&&(result=compare(defaultTransportLast,multiTransportLast,1),o.flag=o.flag&&result.flag,o.conflict=o.conflict||result.conflict,o.timeDifference2=result.timeDifference,o.flag||(o.journeyIndex=0==o.journeyIndex?2:1)),1===PageDataObj.proMode&&multiTransportFirst&&(result=compare(packageResourceTime,multiTransportFirst,0),o.flag=o.flag&&result.flag,o.conflict=o.conflict||result.conflict,o.timeDifference1=result.timeDifference,o.flag||(o.journeyIndex=0)),1===PageDataObj.proMode&&multiTransportLast&&(result=compare(packageResourceTime,multiTransportLast,1),o.flag=o.flag&&result.flag,o.conflict=o.conflict||result.conflict,o.timeDifference2=result.timeDifference,o.flag||(o.journeyIndex=0==o.journeyIndex?2:1)),o},checkTrain:function(){var defaultTransportType,o={flag:!0,journeyIndex:-1},model=this.toJSON(),defaultTransport=model.defaultTransport,selectedData=model.selectedData,person=model.person,childNum=person[1].childNum;return selectedData.length||(selectedData=model.selectedTransport),1===PageDataObj.proMode&&_.each(selectedData,function(item,index){if(item&&item.isSelected&&2==item.transportType&&childNum){if(o.flag=!1,0==o.journeyIndex)return o.journeyIndex=2,!1;o.journeyIndex=index}}),_.some(defaultTransport,function(item){return defaultTransportType=item.transportType,!0}),1==defaultTransportType&&_.each(selectedData,function(item,index){if(item&&item.isSelected&&2==item.transportType&&childNum){if(o.flag=!1,0==o.journeyIndex)return o.journeyIndex=2,!1;o.journeyIndex=index}}),o},checkCurrentDay:function(){var defaultTransportFirst,defaultTransportLast,multiTransportFirst,multiTransportLast,result,o={flag:!0,departureDateDifference:0,backDateDifference:0},model=this.toJSON(),defaultTransport=model.defaultTransport,selectedData=model.selectedData,packageResourceTime=model.packageResourceTime||void 0,compare=function(d,m,journeyIndex){var departureTime,arriveTime;0==journeyIndex?(departureTime=1===pageDataObj.proMode?d.normalDepartDate:d.departDate,arriveTime=m.arrivalDate):(departureTime=m.departDate,arriveTime=1===pageDataObj.proMode?d.normalArriveDate:d.arrivalDate);var aTime=new Date(arriveTime.replace(/-/g,"/")).getTime(),dTime=new Date(departureTime.replace(/-/g,"/")).getTime(),dateDifference=(dTime-aTime)/864e5;return{flag:!dateDifference,dateDifference:dateDifference}};return _.each(defaultTransport,function(item,index){0==index&&(defaultTransportFirst=item),0!=index&&index==defaultTransport.length-1&&(defaultTransportLast=item)}),_.each(selectedData,function(item,index){0==index&&item&&item.isSelected&&(multiTransportFirst=item),1==index&&item&&item.isSelected&&(multiTransportLast=item)}),defaultTransportFirst&&multiTransportFirst&&(result=compare(defaultTransportFirst,multiTransportFirst,0),o.flag=o.flag&&result.flag,o.departureDateDifference=result.dateDifference),defaultTransportLast&&multiTransportLast&&(result=compare(defaultTransportLast,multiTransportLast,1),o.flag=o.flag&&result.flag,o.backDateDifference=result.dateDifference),1===PageDataObj.proMode&&multiTransportFirst&&(result=compare(packageResourceTime,multiTransportFirst,0),o.flag=o.flag&&result.flag,o.departureDateDifference=result.dateDifference),1===PageDataObj.proMode&&multiTransportLast&&(result=compare(packageResourceTime,multiTransportLast,1),o.flag=o.flag&&result.flag,o.backDateDifference=result.dateDifference),o},destroy:function(){var isOneBackJourney=this.get("isOneBackJourney");this.set({departureCityListM:[],backCityListM:[],departureDateListM:[],backDateListM:[],transportType:2,group:null,individualFlight:null,individualData:null,train:null,isOneJourney:!1,isOneBackJourney:!1,journeyIndex:isOneBackJourney?1:0,selectedData:[],isShow:!1,hasCheck1:!1,hasCheck2:!1,hasCheck3:!1},{silent:!0})}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(8),__webpack_require__(5),__webpack_require__(6)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,_,eventBus,config){var pageDataObj=config.pageDataObj;return Backbone.Model.extend({defaults:{combinedCityName:"",departCityName:""},initialize:function(){this.set(_.pick(pageDataObj,"combinedCityName","departCityName"))},setBaseData:function(data){this.set("baseData",data),this.trigger("needRender");var selectData=this.getSelectTransPort();eventBus.trigger("changeTransport",selectData)},selectOne:function(resId){var allData=this.get("baseData");_.each(allData,function(oneTransport){oneTransport.resId!=resId||oneTransport.select?oneTransport.select=!1:oneTransport.select=!0}),this.set("baseData",allData),this.trigger("needRender");var selectData=this.getSelectTransPort();eventBus.trigger("changeTransport",selectData)},getSelectTransPort:function(){var allData=this.get("baseData"),selectData={};return _.each(allData,function(oneTransport){oneTransport.select&&(selectData=oneTransport)}),selectData},setUnsureTrain:function(flag){if(flag){var baseData=this.get("baseData");_.some(baseData,function(item){item.select=!1});var selectData=this.getSelectTransPort();eventBus.trigger("changeTransport",selectData)}}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(41),__webpack_require__(5)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,HotelModel,EventBus){var PageDataObj=window.pageDataObj;return Backbone.Collection.extend({model:HotelModel,initialize:function(){this.getHotelResIdLock=0,$(window).on("selectedHotel",$.proxy(this.changeHotel,this))},init:function(data){this.reset(data.list),this.trigger("needRender")},initData:function(arr){arr=this.formatDiyData(arr),this.reset(arr),this.trigger("needRender")},formatDiyData:function(arr){var self=this;return _.each(arr,function(item){var hotel=item.hotel;return hotel.hotelType?self.formatDiyFitData(item):self.formatDiyMangerData(item)}),arr},formatDiyMangerData:function(item){var self=this,hotel=item.hotel;item.hotelType=hotel.hotelType,hotel.journeyId="j_"+hotel.journeyId,hotel.startDate=hotel.departDate,hotel.endDate=hotel.backDate,hotel.journeyDays=hotel.duration,hotel.hotels={};var hotelId=hotel.hotelId;_.each(hotel.pictures,function(item){item.alt=item.name}),hotel.star=self.unFormatMangerStar(hotel.star),_.each(hotel.roomList,function(room){room.resId=room.roomId,room.resName=room.name,void 0==room.breakfastNum&&(room.breakfastNum=self.unFormatBreakfast(room.breakfast)),room.roomCount=item.roomCount,room.isExtraBed=self.unFormatExtraBed(room.isExtraBed),room.price=room.priceList,room.select=!0});var hotelResInfo=hotel,rooms=hotel.roomList;return hotel.hotels["h_"+hotelId]={hotelResInfo:hotelResInfo,rooms:rooms},item},formatDiyFitData:function(item){var self=this,hotel=item.hotel;return item.hotelType=hotel.hotelType,item.journeyId=hotel.journeyId,item.departDate=hotel.departDate,item.backDate=hotel.backDate,item.duration=hotel.duration,hotel.star=self.unFormatFitStar(hotel.star),_.each(hotel.roomList,function(room){_.each(room.ratePlans,function(plan){plan.breakfastNum=self.unFormatBreakfast(plan.breakfast),plan.netWork=plan.network,plan.maxOccupancy=room.maxAdultNum,plan.roomCount=item.roomCount,plan.select=!0,plan.departsDates=self.unFormatPriceList(plan.priceList)}),_.each(room.pictures,function(pic){pic.alt=pic.name})}),item},unFormatMangerStar:function(val){var arr=["五星级","四星级","三星级","普通型","豪华型","舒适型","经济型","高档型"];return _.indexOf(arr,val)+1},unFormatBreakfast:function(val){var result;switch(val){case"无早":result=0;break;case"单早":result=1;break;case"双早":result=2;break;case"三早":result=3;break;case"四早":result=4;break;case"五早":result=5;break;case"六早":result=6;break;case"七早":result=7;break;case"八早":result=8;break;case"九早":result=9;break;case"十早":result=10}return result},unFormatExtraBed:function(val){var arr=["不可加床","可加床"];return _.indexOf(arr,val)},unFormatFitStar:function(val){var star;switch(val){case 2:star=4e3;break;case 3:star=6e3;break;case 4:star=8e3;break;case 5:star=1e4;break;case"舒适型":star=5e3;break;case"高档型":star=7e3;break;case"豪华型":star=9e3;break;default:star=val}return star},unFormatPriceList:function(val){var arr=[];return _.each(val,function(item,key){var o={departsDate:key,tuniuPrice:item};arr.push(o)}),arr},refreshRatePlan:function(ratePlan){var self=this;_.some(self.models,function(model){var hotel=model.get("hotel"),room=hotel.room;if(room){var plan=room.ratePlan;if(plan&&ratePlan.ratePlanId==plan.ratePlanId&&ratePlan.revertResult)return plan.price=model.getFitRoomPrice(ratePlan.revertResult),EventBus.trigger("hotelPriceChange"),!0}})},changePersonNum:function(adultNum,childNum){var self=this;_.each(self.models,function(model){model.changePersonNum(adultNum,childNum)}),EventBus.trigger("hotelPriceChange")},getTotalHalfRoomPrice:function(){return this.models.reduce(function(sum,model){var hotel=model.get("hotel"),room=hotel.room,price=0;if(hotel.hotelType){var plan=room&&room.ratePlan;plan&&(price=plan.price)}else room&&(price=room.price);return sum+.5*price},0)},getTotalRoomPrice:function(){return this.models.reduce(function(sum,model){var hotel=model.get("hotel"),room=hotel.room,price=0,roomCount=0;if(hotel.hotelType){var plan=room&&room.ratePlan;plan&&(price=plan.price,roomCount=plan.roomCount)}else room&&(price=room.price,roomCount=room.roomCount);return sum+price*roomCount},0)},checkHotelResId:function(){var self=this,flag=!0;return _.each(this.toJSON(),function(item){var hotel=item.hotel,room=hotel.room;if(hotel.hotelType&&!item.resId&&0!==item.resId){flag=!1;var plan=room&&room.ratePlan;if(plan){var param={productId:PageDataObj.productId,departDate:PageDataObj.departDate,departCityCode:PageDataObj.departCity,backCityCode:PageDataObj.backCity,adultNum:item.adultNum,childNum:item.childNum,hotelId:hotel.hotelId,roomId:room.roomId,ratePlanId:plan.ratePlanId,vendorHotelId:plan.vendorHotelId||0,vendorId:plan.vendorId||0,businessType:plan.businessType||0,vendorResId:plan.vendorResId||0,journeyId:item.journeyId};self.getHotelResIdLock++,EventBus.trigger("getHotelResId",param)}}}),flag},setHotelResId:function(data){var self=this,resId=data.resId,cancelTime=data.cancelTime,ratePlanId=data.ratePlanId;this.some(function(model){var hotel=model.get("hotel"),room=hotel.room;if(room){var plan=room.ratePlan;plan&&ratePlanId==plan.ratePlanId&&(model.set({resId:resId,cancelTime:cancelTime},{silent:!0}),self.getHotelResIdLock--,0==self.getHotelResIdLock&&EventBus.trigger("saveOrder"))}})},changeHotel:function(){this.some(function(model){var hotel=model.get("hotel");if(hotel.journeyId==window.selectHotelData.journeyId)return model.changeHotel(),!0})},checkJiBaoPrice:function(){var flag=!0;if(this.getJiBaoFlag()&&!this.hasCheckedJiBaoPrice&&!this.getNeixiaoJiBaoFlag()){flag=!1,this.hasCheckedJiBaoPrice=!0;var param=this.getJiBaoParam();EventBus.trigger("checkJiBaoPrice",param)}return flag},getNeixiaoJiBaoFlag:function(){var flag=!1;return this.some(function(model){var hotel=model.get("hotel"),hotelType=model.get("hotelType");if(hotelType){var room=hotel.room,plan=room&&room.ratePlan;if(plan&&1==plan.isJiBao&&plan.vendorId)return flag=!0}}),flag},getJiBaoFlag:function(){var flag=!1;return this.some(function(model){var hotel=model.get("hotel"),hotelType=model.get("hotelType");if(hotelType){var room=hotel.room,plan=room&&room.ratePlan;if(plan&&1==plan.isJiBao)return flag=!0}}),flag},getJiBaoParam:function(){var param={};return param.productId=PageDataObj.productId,this.some(function(model){var data=model.toJSON(),hotel=data.hotel,hotelType=data.hotelType;if(param.adultNum=data.adultNum,param.childNum=data.childNum,param.departDate=data.departDate,param.hotelId=hotel.hotelId,param.resId=data.resId,hotelType){var room=hotel.room,plan=room&&room.ratePlan;if(param.roomId=room.roomId,plan)return param.businessType=plan.businessType,param.ratePlanId=plan.ratePlanId,param.vendorHotelId=plan.vendorHotelId,param.vendorId=plan.vendorId,param.vendorResId=plan.vendorResId,!0}}),param},changeJiBaoPrice:function(data){var self=this,ratePlanId=data.ratePlanId;this.some(function(model){var hotel=model.get("hotel"),room=hotel.room;if(room){var plan=room.ratePlan;if(plan&&ratePlanId==plan.ratePlanId){var oldPrice=plan.price;data.revertResult&&(plan.departsDates=data.revertResult,plan.price=model.getFitRoomPrice(plan.departsDates),plan.priceList=model.getPriceListFromDepartsDates(plan.departsDates));var diffPrice=plan.price-oldPrice;return self.trigger("jiBaoTip",diffPrice),EventBus.trigger("hotelPriceChange"),!0}}})},getHotelCountAndName:function(){var arr=[];return _.each(this.models,function(model){var chineseName,hotel=model.get("hotel"),room=hotel.room,roomCount=0;if(hotel.hotelType){var plan=room&&room.ratePlan;plan&&(roomCount=plan.roomCount)}else room&&(roomCount=room.roomCount);chineseName=hotel.chineseName,arr.push({chineseName:chineseName,roomCount:roomCount})}),arr}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(5),__webpack_require__(11)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,EventBus,constant){var PageDataObj=window.pageDataObj,DEFAULT_MAX_OCCUPANCY=2;return Backbone.Model.extend({defaults:{hotel:null,canChange:!1,isFromOrder:!1,adultNum:2,childNum:0,resId:"",cancelTime:"",constant:constant},initialize:function(){var data=this.toJSON();if(1==data.hotelType||2==data.hotelType)var formatData=this.formatFitData(data);else if(0==data.hotelType)var formatData=this.formatMangerData(data);this.set({hotel:formatData,adultNum:data.adultNum,childNum:data.childNum,resId:data.resId,cancelTime:data.cancelTime,isCruise:PageDataObj.isCruise},{silent:!0})},formatMangerData:function(data){var self=this,result={},hotel=data.hotel;result.hotelType=hotel.hotelType,result.journeyId=hotel.journeyId.substring(2),result.departDate=hotel.startDate,result.backDate=hotel.endDate,result.duration=hotel.journeyDays,result.destinationName=hotel.destinationName;var hotels=hotel.hotels;for(var i in hotels){result.hotelId=i.substring(2);var hotelResInfo=hotels[i].hotelResInfo,rooms=hotels[i].rooms,pictures=[];_.each(hotelResInfo.pictures,function(item){var o={};o.name=item.alt,o.small=item.small,pictures.push(o)}),result.pictures=pictures,result.chineseName=hotelResInfo.chineseName,result.englishName=hotelResInfo.englishName,result.latitude=hotelResInfo.latitude,result.longitude=hotelResInfo.longitude,result.isInter=hotelResInfo.isInter,result.star=self.formatMangerStar(hotelResInfo.star),result.commentScore="",result.fullScore="",result.commentCount="",result.facilities=hotelResInfo.facilities,result.facilityName=hotelResInfo.facilityName,result.address=hotelResInfo.address,_.some(rooms,function(item){var o={};o.roomId=item.resId,o.name=item.resName,o.bedType=item.bedType,o.breakfast=self.formatBreakfast(item.breakfastNum),o.network=item.network,o.maxAdultNum=item.maxAdultNum,o.maxChildNum=item.maxChildNum,o.minRoomCount=Math.ceil(data.adultNum/o.maxAdultNum),o.maxRoomCount=data.adultNum,o.roomCount=item.roomCount||o.minRoomCount,self.changeMinRoomCount(o),o.bookNotice=item.bookNotice,o.floor=item.floor,o.area=item.area,o.isExtraBed=item.isExtraBed?"可加床":"不可加床",o.price=self.getMangerRoomPrice(item.price),o.priceList=item.price,o.select=item.select,o.isJiBao="";var roomPictures=[];return _.each(item.pictures,function(pic){var o1={};o1.name=pic.alt,o1.small=pic.small,o1.big=pic.big,roomPictures.push(o1)}),o.pictures=roomPictures,result.room=o,!0})}return result},formatFitData:function(data){var self=this,result={},hotel=data.hotel;result.hotelType=data.hotelType,result.journeyId=data.journeyId,result.departDate=data.departDate,result.backDate=data.backDate,result.duration=data.duration,result.hotelId=hotel.hotelId,result.destinationName=hotel.destinationName;var pictures=[];return _.each(hotel.pictures,function(item){var o={};o.name=item.name,o.small=item.small,pictures.push(o)}),result.pictures=pictures,result.chineseName=hotel.chineseName,result.englishName=hotel.englishName,result.latitude=hotel.latitude,result.longitude=hotel.longitude,result.isInter=hotel.isInter,result.star=self.formatFitStar(hotel.star),result.commentScore=hotel.commentScore,result.fullScore=hotel.fullScore,result.commentCount=hotel.commentCount,result.facilities=hotel.facilities,result.facilityName=hotel.facilityName,result.address=hotel.address,result.cityCode=hotel.cityCode,result.ruleId=hotel.ruleId,result.isIndividualHotel=hotel.isIndividualHotel,result.starName=hotel.starName,_.some(hotel.roomList,function(item){var o={};o.roomId=item.roomId,o.name=item.name,o.floor=item.floor,o.area=item.area,o.isExtraBed="",_.some(item.ratePlans,function(plan){var o1={};return o1.ratePlanId=plan.ratePlanId,o1.ratePlanName=plan.ratePlanName,o1.bedType=plan.bedType,o1.gift=plan.gift,o1.breakfast=self.formatBreakfast(plan.breakfastNum),o1.breakfastNum=plan.breakfastNum,o1.network=plan.netWork,o1.maxAdultNum=plan.maxOccupancy||DEFAULT_MAX_OCCUPANCY,o1.minRoomCount=Math.ceil(data.adultNum/o1.maxAdultNum),o1.maxRoomCount=data.adultNum,o1.roomCount=plan.roomCount||o1.minRoomCount,self.changeMinRoomCount(o1),o1.price=self.getFitRoomPrice(plan.departsDates),o1.priceList=self.getPriceListFromDepartsDates(plan.departsDates),o1.select=plan.select,o1.isJiBao=plan.isJiBao,o1.vendorHotelId=plan.vendorHotelId,o1.vendorId=plan.vendorId,o1.vendorResId=plan.vendorResId,o1.businessType=plan.businessType,o1.departsDates=plan.departsDates,o.ratePlan=o1,!0});var roomPictures=[];return _.each(item.pictures,function(pic){var o2={};o2.name=pic.alt,o2.small=pic.small,o2.big=pic.big,roomPictures.push(o2)}),o.pictures=roomPictures,result.room=o,!0}),result},getMangerRoomPrice:function(val){var price=0;for(var i in val)price+=Math.ceil(val[i]);return price},formatMangerStar:function(val){var arr=["五星级","四星级","三星级","普通型","豪华型","舒适型","经济型","高档型"];return arr[--val]},getFitRoomPrice:function(val){var price=0;return _.each(val,function(item){price+=Math.ceil(item.tuniuPrice||item.salePrice)}),price},formatFitStar:function(val){var star;switch(val){case 4e3:star=2;break;case 6e3:star=3;break;case 8e3:star=4;break;case 1e4:star=5;break;case 5e3:star="舒适型";break;case 7e3:star="高档型";break;case 9e3:star="豪华型";break;default:star=val}return star},formatBreakfast:function(val){var result;switch(val){case 0:result="无早";break;case 1:result="单早";break;case 2:result="双早";break;case 3:result="三早";break;case 4:result="四早";break;case 5:result="五早";break;case 6:result="六早";break;case 7:result="七早";break;case 8:result="八早";break;case 9:result="九早";break;case 10:result="十早"}return result},changeMinRoomCount:function(o){return PageDataObj.isSignBack&&PageDataObj.hasTakeSeat&&this.get("isFromOrder")&&(o.minRoomCount<o.roomCount&&(o.minRoomCount=o.roomCount),this.set("defaultMinRoomCount",o.roomCount,{silent:!0})),o},getAllHotelPath:function(){var resId,ratePlanId,price,hotel=this.get("hotel"),room=hotel.room,location=window.location,protocol=location.protocol?location.protocol+"//"+location.host:"http://"+location.host;if(hotel.hotelType){if(room){var ratePlan=room.ratePlan;ratePlan&&(resId="",ratePlanId=ratePlan.ratePlanId,price=ratePlan.price)}}else resId=room.roomId,ratePlanId="",price=room.price;var data={productId:PageDataObj.productId||0,departCityCode:PageDataObj.departCity||0,backCityCode:PageDataObj.backCity||0,bookCityCode:PageDataObj.bookCity||0,adultNum:this.get("adultNum")||2,childNum:this.get("childNum")||0,departDate:hotel.departDate,journeyId:hotel.journeyId||0,hotelType:hotel.hotelType,resId:resId||0,ratePlanId:ratePlanId||0,price:price||0,orderId:PageDataObj.orderId,version:2,hswHost:protocol};return $.param(data)},changeHotel:function(){var data=window.selectHotelData,hotel=this.get("hotel"),adultNum=this.get("adultNum"),childNum=this.get("childNum");if(data.adultNum=adultNum,data.childNum=childNum,data.hotelType)var formatData=this.formatFitDataFromIframe(data);else var formatData=this.formatMangerDataFromIframe(data);formatData.journeyId=hotel.journeyId,formatData.departDate=hotel.departDate,formatData.backDate=hotel.backDate,formatData.duration=hotel.duration,this.set({hotel:formatData,adultNum:adultNum,childNum:childNum,resId:"",cancelTime:""}),EventBus.trigger("hotelPriceChange")},formatMangerDataFromIframe:function(data){var self=this,result={};result.hotelType=data.hotelType;var hotel=data.hotelList[0];result.hotelId=hotel.hotelId;var pictures=[];return _.each(hotel.pictures,function(item){var o={};o.name=item.alt,o.small=item.small,pictures.push(o)}),result.pictures=pictures,result.chineseName=hotel.name,result.englishName=hotel.ename,result.latitude=hotel.latitude,result.longitude=hotel.longitude,result.isInter=hotel.isInter,result.star=self.formatMangerStar(hotel.star),result.commentScore="",result.fullScore="",result.commentCount="",result.facilities=hotel.facilities,result.facilityName=hotel.facilityName,result.address=hotel.address,result.isIndividualHotel=hotel.isIndividualHotel,_.some(hotel.roomList,function(item){if(item.select){var o={};o.roomId=item.resId,o.name=item.roomType,o.bedType=item.bedType,o.breakfast=self.formatBreakfast(item.breakfastNum),o.network=item.network,o.maxAdultNum=item.maxAdultNum,o.maxChildNum=item.maxChildNum,o.minRoomCount=Math.ceil(data.adultNum/item.maxAdultNum),o.maxRoomCount=data.adultNum,o.roomCount=data.selectNum,o.bookNotice=item.bookNotice,o.floor=item.floor,o.area=item.area,o.isExtraBed=item.isExtraBed?"可加床":"不可加床",o.price=self.getMangerRoomPrice(item.priceList),o.priceList=item.priceList,o.select=item.select,o.isJiBao="";var roomPictures=[];_.each(item.pictures,function(pic){var o1={};o1.name=pic.alt,o1.small=pic.small,o1.big=pic.big,roomPictures.push(o1)}),o.pictures=roomPictures,result.room=o}}),result},formatFitDataFromIframe:function(data){var self=this,result={};result.hotelType=data.hotelType;var hotel=data.hotelList[0];result.hotelId=hotel.hotelId;var pictures=[];return _.each(hotel.pictures,function(item){var o={};o.name=item.alt,o.small=item.small,pictures.push(o)}),result.pictures=pictures,result.chineseName=hotel.chineseName,result.englishName=hotel.englishName,result.latitude=hotel.latitude,result.longitude=hotel.longitude,result.isInter=hotel.isInter,result.star=self.formatFitStar(hotel.star),result.commentScore=hotel.commentScore,result.fullScore=hotel.fullScore,result.commentCount=hotel.commentCount,result.facilities=hotel.facilities,result.facilityName=hotel.facilityName,result.address=hotel.address,result.starName=hotel.starName,_.some(hotel.roomList,function(item){var select=_.some(item.ratePlans,function(plan){return plan.select});if(select){var o={};o.roomId=item.roomId,o.name=item.name,o.maxAdultNum=item.maxAdultNum,o.maxChildNum=item.maxChildNum,o.floor=item.floor,o.area=item.area,o.isExtraBed="",_.some(item.ratePlans,function(plan){if(plan.select){var o1={};return o1.ratePlanId=plan.ratePlanId,o1.ratePlanName=plan.ratePlanName,o1.bedType=plan.bedType,o1.breakfast=self.formatBreakfast(plan.breakfastNum),o1.breakfastNum=plan.breakfastNum,o1.network=plan.netWork,o1.price=self.getFitRoomPrice(plan.departsDates),o1.priceList=self.getPriceListFromDepartsDates(plan.departsDates),o1.select=plan.select,o1.isJiBao=plan.isJiBao,o1.vendorHotelId=plan.vendorHotelId,o1.vendorId=plan.vendorId,o1.vendorResId=plan.vendorResId,o1.businessType=plan.businessType,o1.departsDates=plan.departsDates,o1.minRoomCount=Math.ceil(data.adultNum/(plan.maxOccupancy||DEFAULT_MAX_OCCUPANCY)),o1.maxRoomCount=data.adultNum,o1.roomCount=data.selectNum,o.ratePlan=o1,!0}});var roomPictures=[];return _.each(item.pictures,function(pic){var o2={};o2.name=pic.alt,o2.small=pic.small,o2.big=pic.big,roomPictures.push(o2)}),o.pictures=roomPictures,result.room=o,!0}}),result},roomCountChange:function(roomCount){var hotel=this.get("hotel"),hotelType=hotel.hotelType,room=hotel.room;if(hotelType){if(room){var plan=room.ratePlan;plan&&(plan.roomCount=roomCount,this.trigger("change"));var refreshParam={departDate:hotel.departDate,hotelId:hotel.hotelId,roomId:room.roomId};_.extend(refreshParam,_.pick(plan,"ratePlanId","vendorHotelId","vendorId","vendorResId","businessType")),EventBus.trigger("refreshRatePlan",refreshParam)}}else room.roomCount=roomCount,this.trigger("change");EventBus.trigger("hotelPriceChange")},getPriceListFromDepartsDates:function(departsDates){var obj={};return _.isArray(departsDates)&&_.forEach(departsDates,function(priceItem){obj[priceItem.departsDate]=priceItem.tuniuPrice||priceItem.salePrice}),obj},changePersonNum:function(adultNum,childNum){var hotel=this.get("hotel");this.setHotelRange(hotel,adultNum),this.set({hotel:hotel,adultNum:adultNum,childNum:childNum})},setHotelRange:function(hotel,adultNum){var room=hotel.room;if(hotel.hotelType){var plan=room&&room.ratePlan;if(plan){var maxAdultNum=plan.maxOccupancy||DEFAULT_MAX_OCCUPANCY;if(plan.maxRoomCount=adultNum,plan.minRoomCount=Math.ceil(adultNum/maxAdultNum),PageDataObj.isSignBack&&PageDataObj.hasTakeSeat&&this.get("isFromOrder")){var defaultMinRoomCount=this.get("defaultMinRoomCount");plan.minRoomCount<defaultMinRoomCount&&(plan.minRoomCount=defaultMinRoomCount)}plan.roomCount<plan.minRoomCount?plan.roomCount=plan.minRoomCount:plan.roomCount>plan.maxRoomCount&&(plan.roomCount=plan.maxRoomCount)}}else if(room){var maxAdultNum=room.maxAdultNum;if(room.maxRoomCount=adultNum,room.minRoomCount=Math.ceil(adultNum/maxAdultNum),PageDataObj.isSignBack&&PageDataObj.hasTakeSeat&&this.get("isFromOrder")){var defaultMinRoomCount=this.get("defaultMinRoomCount");room.minRoomCount<defaultMinRoomCount&&(room.minRoomCount=defaultMinRoomCount)}room.roomCount<room.minRoomCount?room.roomCount=room.minRoomCount:room.roomCount>room.maxRoomCount&&(room.roomCount=room.maxRoomCount)}return hotel}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),config=__webpack_require__(6),pageDataObj=config.pageDataObj,eventBus=__webpack_require__(5);module.exports=backbone.Model.extend({defaults:{firstShow:1,isShowMore:!1,busPlaceInfo:void 0,roomAddBudget:void 0,hasRoomAddBudgetFalg:void 0},initialize:function(){var self=this;this.initData(),
this.on("setIsShowMore",function(data){this.set("firstShow",0),this.set("isShowMore",data),this.trigger("render")}),this.on("selectOneRow",function(selectIndex,isCheck){this.selectOneRow(selectIndex,isCheck),this.trigger("render")}),this.on("oneRowSelect",function(index,isCheck){self.oneRowSelect(index,isCheck),eventBus.trigger("changeAddBudget")}),this.changeAdultPeople(pageDataObj)},initData:function(data){data?(this.set("roomAddBudget",data),this.trigger("render")):(pageDataObj.busPlaceInfo&&pageDataObj.busPlaceInfo.length&&this.set("busPlaceInfo",pageDataObj.busPlaceInfo),pageDataObj.roomAddBudget&&this.set("roomAddBudget",pageDataObj.roomAddBudget))},getCanRender:function(){var data=this.toJSON(),hasBusPlace=!_.isEmpty(data.busPlaceInfo),hasRoomAddBudget=!_.isEmpty(data.roomAddBudget)&&data.hasRoomAddBudgetFalg;return hasBusPlace||hasRoomAddBudget},selectOneRow:function(selectIndex,isCheck){if(1==isCheck){var busPlaceInfo=this.get("busPlaceInfo");_.each(busPlaceInfo,function(item){item.isSelect=0}),_.each(busPlaceInfo,function(item,i){selectIndex===i&&(1===isCheck?item.isSelect=1:item.isSelect=0)})}},getSelectRow:function(){var busPlaceInfo=this.get("busPlaceInfo"),isSelectInfo=[];return _.each(busPlaceInfo,function(item){1===item.isSelect&&isSelectInfo.push(item)}),isSelectInfo},getNewData:function(requestData){var roomAddBudgetInfo=this.get("roomAddBudget");requestData.budgetNum=roomAddBudgetInfo.length,eventBus.trigger("requestNewRoomAdd",requestData)},oneRowSelect:function(index,isCheck){var roomAddBudget=this.get("roomAddBudget");0!==isCheck&&(_.each(roomAddBudget,function(item){item.isSelect=0}),_.each(roomAddBudget,function(item,i){i===index&&(item.isSelect=isCheck)}),this.trigger("render"))},changeAdultPeople:function(params){var hasRoomAddBudgetFalg=this.get("hasRoomAddBudgetFalg");this.set("adultNum",params.adultNum),hasRoomAddBudgetFalg=params.adultNum%2!==0,this.set("hasRoomAddBudgetFalg",hasRoomAddBudgetFalg),eventBus.trigger("changeAddBudget"),this.trigger("render")},danShenGou:function(){var adultNum=this.get("adultNum");if(1===adultNum||pageDataObj.nodfc){var roomAddBudget=this.get("roomAddBudget"),danshengouBudget=[];_.each(roomAddBudget,function(item){0!==item.type?item.isSelect=0:(item.isSelect=1,danshengouBudget.push(item))}),this.set("roomAddBudget",roomAddBudget),this.set("danshengouBudget",danshengouBudget)}else this.set("danshengouBudget",[])},getIsSelectRow:function(){var roomAddBudget=this.get("roomAddBudget"),hasRoomAddBudgetFalg=this.get("hasRoomAddBudgetFalg"),checkRow=[];return hasRoomAddBudgetFalg?(_.each(roomAddBudget,function(item){1===item.isSelect&&checkRow.push(item)}),checkRow):checkRow}})},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),eventBus=__webpack_require__(5),config=__webpack_require__(6),pageDataObj=config.pageDataObj,tools=__webpack_require__(16);module.exports=backbone.Model.extend({defaults:{additionList:[],adultNum:2,childNum:0,supportChangeCount:!1,title:"必选项目"},initialize:function(){},initAddition:function(data){var list=[];_.each(data.mustAdditionalItemResources,function(item){item.selectType=0,list.push(item)}),_.each(data.altAdditionalItemResources,function(item){item.selectType=2,list.push(item)}),_.each(data.randomAdditionalItemResources,function(item){item.selectType=3,list.push(item)}),this.set("additionList",list),this.formatData(),this.trigger("needRender")},initAdditionDiy:function(data){var list=[];data=data||{},_.each(data.alreadyAdditionalItemResources,function(item){item.selectType=4,list.push(item)}),this.set({additionList:list,supportChangeCount:!0,title:"已选项目"}),this.formatDataDiy({init:!0}),this.trigger("needRender")},getCanRender:function(){var data=this.toJSON(),hasAddition=_.some(data.additionList,function(item){return item.show});return hasAddition},formatData:function(){this.initPrice(),this.initWhetherShow(),this.initSelectDate({init:!0}),this.initCountRange({init:!0}),this.initWhetherSelect()},formatDataDiy:function(options){this.initPrice(),options=options||{};var init=options.init,data=this.toJSON(),adultNum=data.adultNum,childNum=data.childNum;_.each(data.additionList,function(unit){unit.show=!0,_.each(unit.resList,function(item){var resInfo=item.resInfo,priceComputerType=resInfo.priceComputerType;if(item.show=!0,init&&(item.selectDate--,item.selectDate<0&&(item.selectDate=0)),0==item.minValue&&(item.minValue=1),0==item.minAdultValue&&(item.minAdultValue=1),0==item.minChildValue&&(item.minChildValue=1),"人"==priceComputerType){var minAdultValue=0,maxAdultValue=adultNum,minChildValue=0,maxChildValue=childNum;item.adultResourceCount&&(minAdultValue=1),item.childResourceCount&&(minChildValue=1),_.extend(item,{minAdultValue:minAdultValue,maxAdultValue:maxAdultValue,minChildValue:minChildValue,maxChildValue:maxChildValue})}})}),this.initSelectDate({init:!1})},initWhetherShow:function(){var data=this.toJSON(),adultNum=data.adultNum,childNum=data.childNum;_.each(data.additionList,function(unit){var show=!1;0==unit.selectType&&"cruise2"!=pageDataObj.pageType||_.each(unit.resList,function(item){var resInfo=item.resInfo,priceComputerType=resInfo.priceComputerType;if(childNum||"儿童"!=priceComputerType){var limitMin=resInfo.limitMin;"成人"==priceComputerType?limitMin>adultNum?item.show=!1:(item.show=!0,show=!0):"儿童"==priceComputerType?limitMin>childNum?item.show=!1:(item.show=!0,show=!0):limitMin>adultNum+childNum?item.show=!1:(item.show=!0,show=!0)}else item.show=!1}),unit.show=show})},initSelectDate:function(options){options=options||{};var data=this.toJSON(),init=options.init;_.each(data.additionList,function(unit){_.each(unit.resList,function(item){item.selectDate=init?0:item.selectDate,item.adultPrice=item.resourceDatePrices[item.selectDate].price,item.childPrice=item.resourceDatePrices[item.selectDate].childPrice,item.departDate=item.resourceDatePrices[item.selectDate].departDate})})},initCountRange:function(options){var self=this,data=this.toJSON(),adultNum=data.adultNum,childNum=data.childNum,init=options.init;_.each(data.additionList,function(unit){var selectType=unit.selectType,subType=unit.subType;_.each(unit.resList,function(item){var defaultValue,adultResourceCount,childResourceCount,minValue,maxValue,resInfo=item.resInfo,limitMin=resInfo.limitMin,limitMax=resInfo.limitMax,priceComputerType=resInfo.priceComputerType,selectDate=item.selectDate;item.resourceDatePrices[selectDate].excludeChildFlag;switch(priceComputerType){case"份":case"张":case"台":case"辆":defaultValue=init?Math.min(Math.ceil((adultNum+childNum)/resInfo.passengerCapacity),resInfo.limitMax):item.adultResourceCount,minValue=Math.max(1,limitMin),maxValue=Math.min(adultNum+childNum,limitMax),adultResourceCount=self.getInRangeValue(minValue,maxValue,defaultValue),childResourceCount="",_.extend(item,{adultResourceCount:adultResourceCount,childResourceCount:childResourceCount,minValue:minValue,maxValue:maxValue});break;case"人":var minAdultValue,maxAdultValue,minChildValue,maxChildValue,currentAdultValue,currentChildValue;minAdultValue=1,maxAdultValue=Math.min(adultNum,limitMax),minChildValue=1,maxChildValue=Math.min(childNum,limitMax),init?(adultResourceCount=adultNum,childResourceCount=childNum):(currentAdultValue=item.adultResourceCount,currentChildValue=item.childResourceCount,0!=selectType||subType!=tools.getTypeByCode("asgg")&&subType!=tools.getTypeByCode("qz")||(currentAdultValue=adultNum,currentChildValue=childNum),adultResourceCount=self.getInRangeValue(minAdultValue,maxAdultValue,currentAdultValue),childResourceCount=self.getInRangeValue(minChildValue,maxChildValue,currentChildValue)),_.extend(item,{adultResourceCount:adultResourceCount,childResourceCount:childResourceCount,minAdultValue:minAdultValue,maxAdultValue:maxAdultValue,minChildValue:minChildValue,maxChildValue:maxChildValue});break;case"成人":case"儿童":var tmpNum;"成人"==priceComputerType?tmpNum=adultNum:"儿童"==priceComputerType&&(tmpNum=childNum),defaultValue=init?Math.min(tmpNum,limitMax):item.adultResourceCount,minValue=Math.max(1,resInfo.limitMin),maxValue=Math.min(tmpNum,resInfo.limitMax),adultResourceCount=self.getInRangeValue(minValue,maxValue,defaultValue),childResourceCount="",_.extend(item,{adultResourceCount:adultResourceCount,childResourceCount:childResourceCount,minValue:minValue,maxValue:maxValue})}})})},initWhetherSelect:function(){var data=this.toJSON(),childNum=data.childNum;_.each(data.additionList,function(unit){var hasFindFlag=!1,selectType=unit.selectType;_.each(unit.resList,function(item){var resInfo=item.resInfo,priceComputerType=resInfo.priceComputerType,selectDate=item.selectDate;item.resourceDatePrices[selectDate].excludeChildFlag;0==selectType?"人"==priceComputerType?(item.adultSelect=!0,childNum?item.childSelect=!0:item.childSelect=!1):(item.adultSelect=!0,item.childSelect=!1):3!=selectType&&2!=selectType||(hasFindFlag?(item.adultSelect=!1,item.childSelect=!1):item.show?("人"==priceComputerType?(item.adultSelect=!0,childNum?item.childSelect=!0:item.childSelect=!1):(item.adultSelect=!0,item.childSelect=!1),hasFindFlag=!0):(item.adultSelect=!1,item.childSelect=!1))})})},initPrice:function(){var data=this.toJSON();_.each(data.additionList,function(unit){_.each(unit.resList,function(item){var resInfo=item.resInfo,priceComputerType=resInfo.priceComputerType;"人"==priceComputerType&&_.each(item.resourceDatePrices,function(price){var excludeChildFlag=price.excludeChildFlag;0!=excludeChildFlag&&(price.childPrice=price.price)})})})},changeTourist:function(adultNum,childNum){this.set({adultNum:adultNum,childNum:childNum},{silent:!0}),"self_tour2"==pageDataObj.pageType?this.formatDataDiy({init:!1}):(this.initWhetherShow(),this.initCountRange({init:!0}),this.changeWhetherSelect()),this.trigger("needRender")},changeWhetherSelect:function(){var data=this.toJSON(),childNum=data.childNum;_.each(data.additionList,function(unit){var hasSelected=!1,showAddition=[],selectType=unit.selectType;_.each(unit.resList,function(item){var resInfo=item.resInfo,priceComputerType=resInfo.priceComputerType,selectDate=item.selectDate;item.resourceDatePrices[selectDate].excludeChildFlag;0==selectType?"人"==priceComputerType?(item.adultSelect=!0,childNum?item.childSelect=!0:item.childSelect=!1):(item.adultSelect=!0,item.childSelect=!1):3!=selectType&&2!=selectType||(item.show?("人"==priceComputerType&&(item.adultSelect&&childNum?item.childSelect=!0:item.childSelect=!1),showAddition.push(item)):(item.adultSelect=!1,item.childSelect=!1))}),unit.show&&(hasSelected=_.some(unit.resList,function(item){return 1==item.adultSelect}),hasSelected||unit.resList.forEach(function(item){item.resId==showAddition[0].resId&&(item.adultSelect=!0)}))})},getInRangeValue:function(min,max,val){return Math.min(max,Math.max(min,val))},showAll:function(index){var data=this.toJSON();_.some(data.additionList,function(unit,tmpIndex){if(index==tmpIndex)return unit.showAll=!unit.showAll,!0}),this.trigger("needRender")},getSelectAdditionData:function(){var result=[],data=this.toJSON();return _.each(data.additionList,function(item){_.each(item.resList,function(sub){if(sub.adultSelect||sub.childSelect){var resInfo=sub.resInfo,type=item.subType;type==tools.getTypeByCode("qz")&&delete resInfo.visaMaterial,sub.totalAdultPrice=0,sub.totalChildPrice=0,sub.adultSelect&&(sub.isWifiByDay?sub.totalAdultPrice+=sub.adultResourceCount*resInfo.durationDays*sub.adultPrice:sub.totalAdultPrice+=sub.adultResourceCount*sub.adultPrice),sub.childSelect&&(sub.totalChildPrice+=sub.childResourceCount*sub.childPrice),sub.selectType=item.selectType,result.push(sub)}})}),result},checkAddition:function(){var selectIndex,selectFlag=!0,numFlag=!1,data=this.toJSON(),adultNum=data.adultNum,childNum=data.childNum;return _.each(data.additionList,function(unit,index){var data=unit,selectType=data.selectType,resList=data.resList,subType=data.subType;3!=selectType&&2!=selectType||!data.show||(selectFlag=selectFlag&&_.some(resList,function(item){return item.adultSelect}),selectFlag||(selectIndex=void 0!=selectIndex?selectIndex:index)),3!=selectType||subType!=tools.getTypeByCode("asgg")&&subType!=tools.getTypeByCode("qz")||!data.show||(numFlag=_.some(resList,function(item){return item.adultSelect&&item.adultResourceCount!=adultNum||item.childSelect&&item.childResourceCount!=childNum}))}),void 0!=selectIndex?this.trigger("showError",{type:1,index:selectIndex}):numFlag&&(eventBus.trigger("setNetOrderFlag","addition",!0,"可选岸上观光或签证人数与预订人数不一致转网络单"),eventBus.trigger("sendSaveOrderData")),selectFlag&&!numFlag}})},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),eventBus=__webpack_require__(5),tools=__webpack_require__(16),_=__webpack_require__(8),config=__webpack_require__(6),pageDataObj=config.pageDataObj;__webpack_require__(11);module.exports=backbone.Model.extend({defaults:{list:[],adultNum:2,childNum:0,canChange:!1,changeText:"更多推荐项目",recommendData:null,airplaneData:{},deliveryDate:"",deliveryHour:"",deliveryMinute:"",dateList:[],hourList:[],minuteList:[],deliveryPrice:"",deliveryType:"",pickupInfo:null,deliveryInfo:null,deliverySelected:!1,pickupPrice:"",pickupType:"",pickupSelected:!1,places:[],commonReceiptInfo:[],addressType:"",addressShow:"",addressError:"",pickupAddress:null,deliveryAddress:null,pickupPriceLoading:1,deliveryPriceLoading:1,updateSchemeInfo:null,updateSchemeShowAll:!1,resourceShow:{pickup:!1,delivery:!1,updateScheme:!1},hasRequest:{recommend:!1,updateScheme:!0,addition:!1},renderTime:0,supportChangeCount:!1},initialize:function(){var self=this;this.initData(),this.on("oneRowSelect",function(currentIndex,isSelect){self.oneRowSelect(currentIndex,isSelect),eventBus.trigger("changeUpdate")})},setHasRequest:function(module){var hasRequest=this.get("hasRequest");hasRequest[module]=!0,this.trigger("render")},initData:function(){"cruise2"!=pageDataObj.pageType&&"tour_order2"!=pageDataObj.pageType&&"drive_order2"!=pageDataObj.pageType&&"drive_routine2"!=pageDataObj.pageType||this.set("supportChangeCount",!0),pageDataObj.updateScheme&&(this.set("updateSchemeInfo",pageDataObj.updateScheme),this.initUpdateSchemeShow()),7!=pageDataObj.proMode&&this.setHasRequest("recommend")},initUpdateSchemeShow:function(){var updateSchemeInfo=this.get("updateSchemeInfo");_.each(updateSchemeInfo,function(item,index){0==index?item.show=!0:item.show=!1})},initAddition:function(data){this.set("list",data.normalAdditionalItemResources),this.formatData(),this.setHasRequest("addition")},initAdditionFail:function(){this.setHasRequest("addition")},formatData:function(){this.initPrice(),this.initSelectDate(),this.initWhetherShow(),this.initCountRange()},initWhetherShow:function(){var self=this,data=this.toJSON();data.adultNum,data.childNum;_.each(data.list,function(item){item.show=!1,_.each(item.resList,function(sub){sub.shouldShow=self.shouldShow(sub),sub.show=!1,sub.shouldShow&&(item.show=!0)})})},initSelectDate:function(){var data=this.toJSON();_.each(data.list,function(unit){_.each(unit.resList,function(item){item.selectDate=0,item.adultPrice=item.resourceDatePrices[item.selectDate].price,item.childPrice=item.resourceDatePrices[item.selectDate].childPrice,item.departDate=item.resourceDatePrices[item.selectDate].departDate})})},initCountRange:function(){var self=this,data=this.toJSON(),adultNum=data.adultNum,childNum=data.childNum,supportChangeCount=data.supportChangeCount;_.each(data.list,function(unit){_.each(unit.resList,function(item){var defaultValue,adultResourceCount,childResourceCount,minValue,maxValue,resInfo=item.resInfo,limitMax=resInfo.limitMax,limitMin=resInfo.limitMin,priceComputerType=resInfo.priceComputerType,selectDate=item.selectDate;item.resourceDatePrices[selectDate].excludeChildFlag;switch(priceComputerType){case"份":case"张":case"台":case"辆":var result=Math.ceil((adultNum+childNum)/(resInfo.passengerCapacity||1));defaultValue=supportChangeCount?0==item.adultPrice?result:item.adultResourceCount||0:result,minValue=limitMin,maxValue=Math.min(adultNum+childNum,limitMax),adultResourceCount=self.getInRangeValue(minValue,maxValue,defaultValue),childResourceCount="",_.extend(item,{adultResourceCount:adultResourceCount,childResourceCount:childResourceCount,minValue:minValue,maxValue:maxValue});break;case"人":var minAdultValue,maxAdultValue,minChildValue,maxChildValue,defaultAdultValue,defaultChildValue;if(item.adultPrice&&item.childPrice&&adultNum&&childNum){if(adultNum+childNum>=limitMin){var rangeResult=self.getRangeValue(limitMin,limitMax);minAdultValue=rangeResult.adultMin,maxAdultValue=rangeResult.adultMax,minChildValue=rangeResult.childMin,maxChildValue=rangeResult.childMax}}else minAdultValue=limitMin,maxAdultValue=Math.min(adultNum,limitMax),minChildValue=limitMin,maxChildValue=Math.min(childNum,limitMax);supportChangeCount?(defaultAdultValue=0==item.adultPrice?adultNum:item.adultResourceCount||0,defaultChildValue=0==item.childPrice?childNum:item.childResourceCount||0):(defaultAdultValue=adultNum,defaultChildValue=childNum);var thisResult=self.getDefaultValue(limitMin,limitMax);adultResourceCount=0==item.adultPrice?thisResult.adultNum:self.getInRangeValue(minAdultValue,maxAdultValue,defaultAdultValue),childResourceCount=0==item.childPrice?thisResult.childNum:self.getInRangeValue(minChildValue,maxChildValue,defaultChildValue),_.extend(item,{adultResourceCount:adultResourceCount,childResourceCount:childResourceCount,minAdultValue:minAdultValue,maxAdultValue:maxAdultValue,minChildValue:minChildValue,maxChildValue:maxChildValue});break;case"成人":case"儿童":var tmpNum,tmpPrice;"成人"==priceComputerType?(tmpNum=adultNum,tmpPrice="adultPrice"):"儿童"==priceComputerType&&(tmpNum=childNum,tmpPrice="price"),defaultValue=supportChangeCount?0==item[tmpPrice]?adultNum:item.adultResourceCount||0:tmpNum,minValue=limitMin,maxValue=Math.min(tmpNum,resInfo.limitMax),adultResourceCount=self.getInRangeValue(minValue,maxValue,defaultValue),childResourceCount="",_.extend(item,{adultResourceCount:adultResourceCount,childResourceCount:childResourceCount,minValue:minValue,maxValue:maxValue})}})})},initPrice:function(){var data=this.toJSON();_.each(data.list,function(unit){_.each(unit.resList,function(item){var resInfo=item.resInfo,priceComputerType=resInfo.priceComputerType;"人"==priceComputerType&&_.each(item.resourceDatePrices,function(price){var excludeChildFlag=price.excludeChildFlag;0!=excludeChildFlag&&(price.childPrice=price.price)})})})},changeTourist:function(adultNum,childNum){this.set({adultNum:adultNum,childNum:childNum},{silent:!0}),this.changeWhetherShow(),this.initCountRange(),this.changeWhetherSelect(),this.trigger("render"),this.get("supportChangeCount")&&this.trigger("triggerChange")},calculaThisVisaCount:function(resId,type){var data=this.toJSON(),count={};return _.each(data.list,function(item){var resList=item.resList;_.each(resList,function(res){res.resId==resId&&14==res.resType&&(count[res.resId]={adultCount:res.adultResourceCount,childCount:res.childResourceCount})})}),count},shouldShow:function(sub){var data=this.toJSON(),adultNum=data.adultNum,childNum=data.childNum,resInfo=sub.resInfo,priceComputerType=resInfo.priceComputerType,flag=!1;if(childNum||"儿童"!=priceComputerType){var limitMin=resInfo.limitMin;flag="成人"==priceComputerType?0==sub.adultPrice||!(limitMin>adultNum):"儿童"==priceComputerType?0==sub.childPrice||!(limitMin>childNum):0==sub.adultPrice||!(limitMin>adultNum+childNum)}else flag=!1;return flag},changeWhetherShow:function(){var self=this,data=this.toJSON();data.adultNum,data.childNum;_.each(data.list,function(item){item.show=!1,_.each(item.resList,function(sub){sub.shouldShow=self.shouldShow(sub),sub.currentOperationFlag?(sub.show=sub.shouldShow,sub.show&&(item.show=!0)):sub.show=!1})})},getCanRender:function(){var data=this.toJSON(),hasRequest=_.every(data.hasRequest,function(item){return item}),hasAddition=_.some(data.list,function(item){return item.show}),hasRecommend=Boolean(data.recommendData),hasUpdateScheme=!_.isEmpty(data.updateSchemeInfo);return hasRequest&&(hasAddition||hasRecommend||hasUpdateScheme)},changeCountRange:function(){var self=this,data=this.toJSON(),adultNum=data.adultNum,childNum=data.childNum;_.each(data.list,function(_item){_.each(_item.resList,function(item){var defaultValue,adultResourceCount,childResourceCount,minValue,maxValue,resInfo=item.resInfo,limitMax=resInfo.limitMax,priceComputerType=resInfo.priceComputerType,selectDate=item.selectDate;item.resourceDatePrices[selectDate].excludeChildFlag;switch(priceComputerType){case"份":case"张":case"台":case"辆":defaultValue=item.adultResourceCount,minValue=0,maxValue=Math.min(adultNum+childNum,limitMax),adultResourceCount=self.getInRangeValue(minValue,maxValue,defaultValue),childResourceCount="",_.extend(item,{adultResourceCount:adultResourceCount,childResourceCount:childResourceCount,minValue:minValue,maxValue:maxValue});break;case"人":var minAdultValue,maxAdultValue,minChildValue,maxChildValue,defaultAdultValue,defaultChildValue;minAdultValue=0,maxAdultValue=Math.min(adultNum,limitMax),minChildValue=0,maxChildValue=Math.min(childNum,limitMax),defaultAdultValue=item.adultResourceCount,defaultChildValue=item.childResourceCount,adultResourceCount=self.getInRangeValue(minAdultValue,maxAdultValue,defaultAdultValue),childResourceCount=self.getInRangeValue(minChildValue,maxChildValue,defaultChildValue),_.extend(item,{adultResourceCount:adultResourceCount,childResourceCount:childResourceCount,minAdultValue:minAdultValue,maxAdultValue:maxAdultValue,minChildValue:minChildValue,maxChildValue:maxChildValue});break;case"成人":case"儿童":var tmpNum;"成人"==priceComputerType?tmpNum=adultNum:"儿童"==priceComputerType&&(tmpNum=childNum),defaultValue=item.adultResourceCount,minValue=0,maxValue=Math.min(tmpNum,resInfo.limitMax),adultResourceCount=self.getInRangeValue(minValue,maxValue,defaultValue),childResourceCount="",_.extend(item,{adultResourceCount:adultResourceCount,childResourceCount:childResourceCount,minValue:minValue,maxValue:maxValue})}})})},changeWhetherSelect:function(){var data=this.toJSON(),list=data.list,childNum=data.childNum;_.each(list,function(item){_.each(item.resList,function(sub){var resInfo=sub.resInfo,priceComputerType=resInfo.priceComputerType,selectDate=sub.selectDate;sub.resourceDatePrices[selectDate].excludeChildFlag;sub.show?("人"==priceComputerType&&sub.adultSelect&&(childNum?sub.childSelect=!0:sub.childSelect=!1),0==sub.adultPrice&&sub.adultResourceCount?sub.adultSelect=!0:sub.adultSelect=!1,0==sub.childPrice&&sub.childResourceCount?sub.childSelect=!0:sub.childSelect=!1):(sub.adultSelect=!1,sub.childSelect=!1)})})},initSelectDefaultCount:function(){var data=this.toJSON(),list=data.list;_.each(list,function(item){_.each(item.resList,function(sub){sub.show?(0==sub.adultPrice&&sub.adultResourceCount&&(sub.adultSelect=!0),0==sub.childPrice&&sub.childResourceCount&&(sub.childSelect=!0)):(sub.adultSelect=!1,sub.childSelect=!1)})}),eventBus.trigger("additionOptionalCalculate")},getIsInRange:function(sub,count,type){var priceType=sub.resInfo.priceComputerType,flag=!1;switch(priceType){case"份":case"张":case"台":case"辆":case"成人":case"儿童":"adult"==type&&count>=sub.minValue&&count<=sub.maxValue&&(flag=!0);break;case"人":"adult"==type&&count>=sub.minAdultValue&&count<=sub.maxAdultValue&&(flag=!0),"child"==type&&count>=sub.minChildValue&&count<=sub.maxChildValue&&(flag=!0)}return flag},getSelectAdditionData:function(){var list=this.get("list"),result=[];return _.each(list,function(item){_.each(item.resList,function(sub){if(sub.adultSelect||sub.childSelect){var resInfo=sub.resInfo,type=item.subType;type==tools.getTypeByCode("qz")&&delete resInfo.visaMaterial,sub.totalAdultPrice=0,sub.totalChildPrice=0,sub.adultSelect&&(sub.isWifiByDay?sub.totalAdultPrice+=sub.adultResourceCount*resInfo.durationDays*sub.adultPrice:sub.totalAdultPrice+=sub.adultResourceCount*sub.adultPrice),sub.childSelect&&(sub.totalChildPrice+=sub.childResourceCount*sub.childPrice),result.push(sub)}})}),result},checkAddition:function(){var data=this.toJSON(),list=data.list,adultNum=data.adultNum,childNum=data.childNum,numFlag=!1;return _.each(list,function(model){var resList=model.resList,subType=model.subType;"cruise2"==pageDataObj.pageType&&(subType!=tools.getTypeByCode("asgg")&&subType!=tools.getTypeByCode("qz")||(numFlag=_.some(resList,function(item){return item.adultSelect&&item.adultResourceCount!=adultNum||item.childSelect&&item.childResourceCount!=childNum})))}),numFlag&&(eventBus.trigger("setNetOrderFlag","addition",!0,"可选岸上观光或签证人数与预订人数不一致转网络单"),eventBus.trigger("sendSaveOrderData")),!numFlag},getInRangeValue:function(min,max,val){return 0==val?val:Math.min(max,Math.max(min,val))},getRangeValue:function(limitMin,limitMax){var data=this.toJSON(),adultNum=data.adultNum,childNum=data.childNum;return adultNum<limitMin&&childNum<limitMin?{adultMin:limitMin-childNum,adultMax:Math.min(adultNum,limitMax),childMin:limitMin-adultNum,childMax:Math.min(childNum,limitMax)}:adultNum>=limitMin&&childNum<limitMin?{adultMin:limitMin-childNum,adultMax:Math.min(adultNum,limitMax),childMin:0,childMax:Math.min(childNum,limitMax)}:adultNum<limitMin&&childNum>=limitMin?{adultMin:0,adultMax:Math.min(adultNum,limitMax),childMin:limitMin-adultNum,childMax:Math.min(childNum,limitMax)}:adultNum>=limitMin&&childNum>=limitMin?{adultMin:0,adultMax:Math.min(adultNum,limitMax),childMin:0,childMax:Math.min(childNum,limitMax)}:void 0},getDefaultValue:function(limitMin,limitMax){var data=this.toJSON(),adultNum=data.adultNum,childNum=data.childNum,allNum=adultNum+childNum;return limitMin<=allNum&&allNum<=limitMax?{adultNum:adultNum,childNum:childNum}:allNum<limitMin?{adultNum:limitMin-childNum,childNum:childNum}:allNum>limitMax?limitMax<=adultNum?{adultNum:limitMax,childNum:0}:{adultNum:adultNum,childNum:limitMax-adultNum}:void 0},initRecommend:function(data){this.set("recommendData",data),this.formatRecommendData(),this.setHasRequest("recommend")},initRecommendFail:function(){this.setHasRequest("recommend")},formatRecommendData:function(){var data=this.toJSON(),airplaneData=data.airplaneData,departDate=tools.formatDate(pageDataObj.departDate),dateList=[],hourList=[],minuteList=[],defaultMinuteList=["00","10","20","30","40","50"],currentDate=this.getCurrentDate(),deliveryDate=data.deliveryDate,deliveryHour=data.deliveryHour,deliveryMinute=data.deliveryMinute,selectDate=this.getDepartDate(departDate);for(deliveryDate&&(selectDate=tools.formatDate(deliveryDate));departDate-currentDate>=0;){var year=currentDate.getFullYear(),month=currentDate.getMonth()+1,date=currentDate.getDate();dateList.push(year+"-"+tools.formatMonth(month)+"-"+tools.formatDay(date)),currentDate.setDate(date+1)}currentDate=this.getCurrentDate();var defaultHour;if(+selectDate==+departDate){defaultHour=airplaneData.departTime.split(":")[0]-4;for(var endHour=defaultHour,i=0;i<=endHour;i++)hourList.push(tools.formatHour(i))}else if(+selectDate==+currentDate){defaultHour="00";for(var startHour=currentDate.getHours()+1,i=startHour;i<24;i++)hourList.push(tools.formatHour(i))}else{defaultHour="00";for(var i=0;i<24;i++)hourList.push(tools.formatHour(i))}var defaultMinute,selectHour=deliveryHour||defaultHour;+selectDate==+departDate&&selectHour==defaultHour?(defaultMinute=airplaneData.departTime.split(":")[1],_.some(defaultMinuteList,function(item,index){if(parseInt(defaultMinute)<=parseInt(item))return index--,index<0&&(index=0),defaultMinute=defaultMinuteList[index],!0}),_.each(defaultMinuteList,function(item){parseInt(item)<=parseInt(defaultMinute)&&minuteList.push(item)})):(defaultMinute="00",minuteList=defaultMinuteList);var selectMinute=deliveryMinute||defaultMinute;this.set({dateList:dateList,hourList:hourList,minuteList:minuteList,deliveryDate:tools.parseDate(selectDate),deliveryHour:selectHour,deliveryMinute:selectMinute})},getDepartDate:function(date){var data=this.toJSON(),airplaneData=data.airplaneData,defaultHour=airplaneData.departTime.split(":")[0]-4;return defaultHour<0&&date.setDate(date.getDate()-1),date},getCurrentDate:function(){var date=new Date,hour=date.getHours();return 23==hour&&date.setDate(date.getDate()+1),tools.formatDate(tools.parseDate(date))},getRecommendAddress:function(val,type){var data=this.toJSON(),recommendData=data.recommendData,param={searchText:val,cityName:1==type?recommendData.pickupCityName:recommendData.deliveryCityName},address={address:val,name:val};1==type?this.set({pickupAddress:address}):2==type&&this.set({deliveryAddress:address}),eventBus.trigger("getRecommendAddress",param,type,"default")},getRecommendParam:function(){var data=this.toJSON(),airplaneData=data.airplaneData,param={productId:pageDataObj.productId,orgAirportIataCode:airplaneData.departureAirportCode,dstAirportIataCode:airplaneData.destinationAirportCode,departureAirportTerminal:airplaneData.departureAirportTerminal,arrivalAirportTerminal:airplaneData.arrivalAirportTerminal,startCityName:airplaneData.departureCityName,destCityName:airplaneData.destinationCityName};return param},canRequestRecommend:function(){var data=this.toJSON(),airplaneData=data.airplaneData,adultNum=data.adultNum,childNum=data.childNum;return!(adultNum+childNum>4)&&(!!airplaneData.resType&&(""!=airplaneData.departureAirportCode&&""!=airplaneData.destinationAirportCode&&21==airplaneData.resType))},destroyRecommend:function(){this.set({recommendData:null,deliveryDate:"",deliveryHour:"",deliveryMinute:"",dateList:[],hourList:[],minuteList:[],deliveryPrice:"",deliveryType:"",pickupInfo:null,deliveryInfo:null,deliverySelected:!1,pickupPrice:"",pickupType:"",pickupSelected:!1,places:[],addressType:"",addressShow:"",addressError:"",pickupAddress:null,deliveryAddress:null,pickupPriceLoading:1,deliveryPriceLoading:1}),this.trigger("render"),eventBus.trigger("recommendPriceCalculate")},setRecommendAddress:function(data,type){this.set({places:data.places,addressType:1,addressShow:type,addressError:""}),this.trigger("render",{keepCursor:!0,type:type})},setRecommendAddressFail:function(type){this.set({addressError:type,addressShow:"",addressType:""}),this.trigger("render",{keepCursor:!0,type:type})},showCommonAddress:function(type){this.set({addressType:2,addressShow:type,addressError:""}),this.trigger("render")},useAddress:function(type,index){var address,data=this.toJSON(),places=data.places;data.commonReceiptInfo;_.some(places,function(item,tmpIndex){if(index==tmpIndex)return address=item,!0}),1==type?this.set({pickupAddress:address}):2==type&&this.set({deliveryAddress:address}),this.set({addressShow:"",addressType:""}),this.trigger("render"),this.getNewestPrice(type)},changeRecommendDate:function(val){this.set({deliveryDate:val,deliveryHour:"",deliveryMinute:""}),this.formatRecommendData(),this.trigger("render")},changeRecommendHour:function(val){this.set({deliveryHour:val,deliveryMinute:""}),this.formatRecommendData(),this.trigger("render")},changeRecommendMinute:function(val){this.set({deliveryMinute:val}),this.formatRecommendData(),this.trigger("render")},selectRecommend:function(type){1==type?this.set({pickupSelected:!this.get("pickupSelected")}):2==type&&this.set({deliverySelected:!this.get("deliverySelected")}),this.set({addressShow:"",addressType:""}),this.trigger("render"),eventBus.trigger("recommendPriceCalculate")},getNewestPrice:function(type){var data=this.toJSON(),airplaneData=data.airplaneData,recommendData=data.recommendData,pickupAddress=data.pickupAddress,deliveryAddress=data.deliveryAddress,param={type:type};1==type?_.extend(param,{airportCode:airplaneData.destinationAirportCode,terminalCode:airplaneData.arrivalAirportTerminal,useTime:this.formatTime(airplaneData.arrivalDate,airplaneData.arriveTime.split(":")[0],airplaneData.arriveTime.split(":")[1]),startAddressPoi:{name:recommendData.pickupServer.serviceName,address:recommendData.pickupServer.serviceName,longitude:recommendData.pickupServer.longitude,latitude:recommendData.pickupServer.latitude},destAddressPoi:{name:pickupAddress.name,address:pickupAddress.address,longitude:pickupAddress.poiInfo.lng,latitude:pickupAddress.poiInfo.lat}}):2==type&&_.extend(param,{airportCode:airplaneData.departureAirportCode,
terminalCode:airplaneData.departureAirportTerminal,useTime:this.formatTime(data.deliveryDate,data.deliveryHour,data.deliveryMinute),startAddressPoi:{name:deliveryAddress.name,address:deliveryAddress.address,longitude:deliveryAddress.poiInfo.lng,latitude:deliveryAddress.poiInfo.lat},destAddressPoi:{name:recommendData.deliveryServer.serviceName,address:recommendData.deliveryServer.serviceName,longitude:recommendData.deliveryServer.longitude,latitude:recommendData.deliveryServer.latitude}}),eventBus.trigger("getNewestPrice",param,type,"default"),1==type?this.set({pickupPriceLoading:2}):2==type&&this.set({deliveryPriceLoading:2}),this.trigger("render")},formatTime:function(date,hour,minute){return date+" "+hour+":"+minute+":00"},setInfo:function(data,type){var pickDeliveryInfo=data.pickDeliveryInfo;1==type?this.set({pickupInfo:pickDeliveryInfo,pickupPriceLoading:1}):2==type&&this.set({deliveryInfo:pickDeliveryInfo,deliveryPriceLoading:1}),this.trigger("render"),eventBus.trigger("recommendPriceCalculate")},setInfoFail:function(type){1==type?this.set({pickupInfo:null,pickupPriceLoading:3}):2==type&&this.set({deliveryInfo:null,deliveryPriceLoading:3}),this.trigger("render"),eventBus.trigger("recommendPriceCalculate")},getSelectRecommendData:function(){var result,data=this.toJSON(),airplaneData=data.airplaneData;return(data.pickupSelected||data.deliverySelected)&&(result={recommendData:data.recommendData,airplaneData:airplaneData},data.pickupSelected&&_.extend(result,{pickupInfo:data.pickupInfo,pickupAddress:data.pickupAddress,pickupTime:this.formatTime(airplaneData.arrivalDate,airplaneData.arriveTime.split(":")[0],airplaneData.arriveTime.split(":")[1])}),data.deliverySelected&&_.extend(result,{deliveryInfo:data.deliveryInfo,deliveryAddress:data.deliveryAddress,deliveryTime:this.formatTime(data.deliveryDate,data.deliveryHour,data.deliveryMinute)})),result},checkRecommend:function(){var code,data=this.toJSON();return!data.pickupSelected||data.pickupAddress&&data.pickupInfo?!!(!data.deliverySelected||data.deliveryAddress&&data.deliveryInfo)||(code=data.deliveryAddress||data.deliveryInfo?data.deliveryAddress?5:4:6,this.trigger("showError",{type:"recommend",code:code}),!1):(code=data.pickupAddress||data.pickupInfo?data.pickupAddress?2:1:3,this.trigger("showError",{type:"recommend",code:code}),!1)},oneRowSelect:function(currentIndex,isSelect){var updateSchemeInfo=this.get("updateSchemeInfo"),checkJourneyNum=void 0;_.each(updateSchemeInfo,function(item,index){currentIndex==index&&(checkJourneyNum=item.journeyNum)}),_.each(updateSchemeInfo,function(item,index){item.journeyNum==checkJourneyNum&&(item.isSelect=0)}),_.each(updateSchemeInfo,function(item,index){currentIndex==index&&(item.isSelect=isSelect)}),this.trigger("render")},getSelectUpdateScheme:function(){var updateSchemeInfo=this.get("updateSchemeInfo"),checkUpdate=[];return _.each(updateSchemeInfo,function(item){1===item.isSelect&&checkUpdate.push(item)}),checkUpdate},updateShowMore:function(){this.set({updateSchemeShowAll:!this.get("updateSchemeShowAll")}),this.trigger("render")},changeResourceShow:function(){function resListShow(item){item.resourceShow=!0;var maxFlag=!1;return _.some(item.resList,function(sub){if(sub.shouldShow&&!sub.show&&(sub.show=!0,sub.currentOperationFlag=!0,count++,count>=maxCount))return maxFlag=!0}),maxFlag}var self=this,data=this.toJSON(),recommendData=data.recommendData,updateSchemeInfo=data.updateSchemeInfo,additionData=data.list,resourceShow=data.resourceShow,hasRecommend=Boolean(recommendData),hasVisa=_.some(additionData,function(item){return item.subType==tools.getTypeByCode("qz")}),hasUpdateScheme=!_.isEmpty(updateSchemeInfo),hasAddition=!_.isEmpty(additionData);_.each(additionData,function(item){item.resourceShow=!1});var count=0,maxCount=5;if(hasRecommend&&(resourceShow.pickup=!0,resourceShow.delivery=!0,count+=2),hasVisa&&_.some(additionData,function(item){if(item.subType==tools.getTypeByCode("qz")&&item.show)return resListShow(item)}),hasAddition&&_.each(additionData,function(item){item.subType!=tools.getTypeByCode("qz")&&item.show&&_.each(item.resList,function(sub){self.isFreeRes(sub)&&(item.resourceShow=!0,sub.show=!0,sub.currentOperationFlag=!0,count++)})}),count<maxCount){if(hasUpdateScheme&&(resourceShow.updateScheme=!0,count++,count>=maxCount))return!1;hasAddition&&_.some(additionData,function(item){if(item.subType!=tools.getTypeByCode("qz")&&item.show&&(item.resourceShow=!0,_.some(item.resList,function(sub){if(sub.shouldShow&&!sub.show&&!self.isFreeRes(sub)){if(data.adultNum+data.childNum<sub.resInfo.limitMin&&sub.adultPrice)return;return sub.show=!0,sub.currentOperationFlag=!0,count++,!0}}),count>=maxCount))return!0})}count<maxCount&&(hasUpdateScheme&&_.each(updateSchemeInfo,function(item){if(!item.show&&(item.show=!0,count++,count>=maxCount))return!1}),count<maxCount&&_.some(additionData,function(item){if(item.subType!=tools.getTypeByCode("qz")&&item.show)return resListShow(item)}))},isFreeRes:function(sub){var flag=!1,priceType=sub.resInfo.priceComputerType,adultPrice=sub.adultPrice,childPrice=sub.childPrice;switch(priceType){case"份":case"张":case"台":case"辆":case"成人":0==adultPrice?flag=!0:"";break;case"儿童":0==childPrice?flag=!0:"";break;case"人":0==adultPrice||0==childPrice?flag=!0:""}return flag},setCanChange:function(){var data=this.toJSON(),recommendData=data.recommendData,updateSchemeInfo=data.updateSchemeInfo,additionData=data.list,resourceShow=data.resourceShow,showNum=0,totalShowNum=0;resourceShow.pickup&&showNum++,resourceShow.delivery&&showNum++,resourceShow.updateScheme&&_.each(updateSchemeInfo,function(item){item.show&&showNum++}),_.each(additionData,function(item){item.resourceShow&&item.show&&_.each(item.resList,function(sub){sub.show&&showNum++})}),recommendData&&(totalShowNum+=2),_.isEmpty(updateSchemeInfo)||_.each(updateSchemeInfo,function(){totalShowNum++}),_.each(additionData,function(item){_.each(item.resList,function(sub){sub.shouldShow&&totalShowNum++})}),showNum<totalShowNum?this.set("canChange",!0):this.set("canChange",!1);var changeText="更多",hasMoreAddition=_.some(additionData,function(item){return _.some(item.resList,function(sub){if(!sub.show&&sub.shouldShow)return changeText+=tools.formatText(item.subType),!0})});changeText+=hasMoreAddition?"等推荐项目":"推荐项目",this.set("changeText",changeText)},reset:function(data){var tmpData=this.toJSON(),updateSchemeInfo=data.updateSchemeInfo,additionData=data.list,resourceShow=tmpData.resourceShow,selectPickup=data.pickupSelected,selectDelivery=data.deliverySelected,selectUpdateScheme=_.some(updateSchemeInfo,function(item){return item.isSelect});_.each(resourceShow,function(item,key){resourceShow[key]=!1}),_.each(additionData,function(item){item.resourceShow=!1}),selectPickup&&(resourceShow.pickup=!0),selectDelivery&&(resourceShow.delivery=!0),selectUpdateScheme&&(resourceShow.updateScheme=!0),_.each(additionData,function(item){var selectAddition=_.some(item.resList,function(sub){return sub.adultSelect||sub.childSelect});selectAddition?(item.resourceShow=!0,_.each(item.resList,function(sub){sub.adultSelect||sub.childSelect?(sub.show=!0,sub.currentOperationFlag=!0):(sub.show=!1,sub.currentOperationFlag=!1)})):(item.resourceShow=!1,_.each(item.resList,function(sub){sub.show=!1,sub.currentOperationFlag=!1}))}),data.resourceShow=resourceShow,this.set(data),this.trigger("render"),this.get("supportChangeCount")&&this.trigger("triggerChange"),eventBus.trigger("recommendPriceCalculate"),eventBus.trigger("changeUpdate"),eventBus.trigger("additionOptionalCalculate")}})},function(module,exports,__webpack_require__){var $=__webpack_require__(14),backbone=__webpack_require__(9),eventBus=__webpack_require__(5),tools=__webpack_require__(16),_=__webpack_require__(8),config=__webpack_require__(6),pageDataObj=config.pageDataObj;module.exports=backbone.Model.extend({defaults:{list:[],init:!0,adultNum:2,childNum:0,recommendData:null,airplaneData:{},deliveryDate:"",deliveryHour:"",deliveryMinute:"",dateList:[],hourList:[],minuteList:[],deliveryPrice:"",deliveryType:"",pickupInfo:null,deliveryInfo:null,deliverySelected:!1,pickupPrice:"",pickupType:"",pickupSelected:!1,places:[],commonReceiptInfo:[],addressType:"",addressShow:"",addressError:"",pickupAddress:null,deliveryAddress:null,pickupPriceLoading:1,deliveryPriceLoading:1,updateSchemeInfo:null,updateSchemeShowAll:!1,supportChangeCount:!1},initialize:function(){var self=this;this.on("oneRowSelect",function(currentIndex,isSelect){self.oneRowSelect(currentIndex,isSelect)})},init:function(data){var deepCopy=$.extend(!0,{},data);this.set(deepCopy),this.initWhetherShow(),this.initShowAll(),this.trigger("render")},initWhetherShow:function(){var data=this.toJSON(),adultNum=data.adultNum,childNum=data.childNum;_.each(data.list,function(item){item.show=!1,_.each(item.resList,function(sub){var resInfo=sub.resInfo,priceComputerType=resInfo.priceComputerType;if(childNum||"儿童"!=priceComputerType){var limitMin=resInfo.limitMin;"成人"==priceComputerType?0==sub.adultPrice?(sub.show=!0,item.show=!0):limitMin<=adultNum?(sub.show=!0,item.show=!0):sub.show=!1:"儿童"==priceComputerType?0==sub.childPrice?(sub.show=!0,item.show=!0):limitMin<=childNum?(sub.show=!0,item.show=!0):sub.show=!1:0==sub.adultPrice?(sub.show=!0,item.show=!0):limitMin<=adultNum+childNum?(sub.show=!0,item.show=!0):sub.show=!1}else sub.show=!1})})},initShowAll:function(){var data=this.toJSON(),recommendData=data.recommendData,updateSchemeInfo=data.updateSchemeInfo,additionData=data.list,hasRecommend=(data.resourceShow,Boolean(recommendData)),hasUpdateScheme=(_.some(additionData,function(item){return item.subType==tools.getTypeByCode("qz")}),!_.isEmpty(updateSchemeInfo)),hasAddition=!_.isEmpty(additionData),index=0,count=0,maxCount=10,func=[],onlyOneObj={arr:[],index:null,getOnlyOne:function(){return 1==_.filter(this.arr,function(item){return 1==item}).length}};hasRecommend&&(onlyOneObj.arr.push(1),onlyOneObj.index=index,count+=2,func[index]=function(data){return function(){data.deliverySelected=!0,data.pickupSelected=!0}}(data),index++),hasUpdateScheme&&(onlyOneObj.arr.push(1),onlyOneObj.index=index,_.each(updateSchemeInfo,function(){count++}),func[index]=function(data){return function(){data.updateSchemeShowAll=!0}}(data),index++),hasAddition&&(onlyOneObj.index=index,_.each(additionData,function(item){onlyOneObj.arr.push(1),_.each(item.resList,function(sub){sub.show&&count++})}),func[index]=function(additionData){return function(){_.each(additionData,function(item){item.showAll=!0})}}(additionData),index++),onlyOneObj.getOnlyOne()?func[onlyOneObj.index]():count<=maxCount&&_.each(func,function(fn){fn()})},getIsInRange:function(sub,count,type){var priceType=sub.resInfo.priceComputerType,flag=!1;switch(priceType){case"份":case"张":case"台":case"辆":case"成人":case"儿童":"adult"==type&&count>=sub.minValue&&count<=sub.maxValue&&(flag=!0);break;case"人":"adult"==type&&count>=sub.minAdultValue&&count<=sub.maxAdultValue&&(flag=!0),"child"==type&&count>=sub.minChildValue&&count<=sub.maxChildValue&&(flag=!0)}return flag},formatRecommendData:function(){var data=this.toJSON(),airplaneData=data.airplaneData,departDate=tools.formatDate(pageDataObj.departDate),dateList=[],hourList=[],minuteList=[],defaultMinuteList=["00","10","20","30","40","50"],currentDate=this.getCurrentDate(),deliveryDate=data.deliveryDate,deliveryHour=data.deliveryHour,deliveryMinute=data.deliveryMinute,selectDate=this.getDepartDate(departDate);for(deliveryDate&&(selectDate=tools.formatDate(deliveryDate));departDate-currentDate>=0;){var year=currentDate.getFullYear(),month=currentDate.getMonth()+1,date=currentDate.getDate();dateList.push(year+"-"+tools.formatMonth(month)+"-"+tools.formatDay(date)),currentDate.setDate(date+1)}currentDate=this.getCurrentDate();var defaultHour;if(+selectDate==+departDate){defaultHour=airplaneData.departTime.split(":")[0]-4;for(var endHour=defaultHour,i=0;i<=endHour;i++)hourList.push(tools.formatHour(i))}else if(+selectDate==+currentDate){defaultHour="00";for(var startHour=currentDate.getHours()+1,i=startHour;i<24;i++)hourList.push(tools.formatHour(i))}else{defaultHour="00";for(var i=0;i<24;i++)hourList.push(tools.formatHour(i))}var defaultMinute,selectHour=deliveryHour||defaultHour;+selectDate==+departDate&&selectHour==defaultHour?(defaultMinute=airplaneData.departTime.split(":")[1],_.some(defaultMinuteList,function(item,index){if(parseInt(defaultMinute)<=parseInt(item))return index--,index<0&&(index=0),defaultMinute=defaultMinuteList[index],!0}),_.each(defaultMinuteList,function(item){parseInt(item)<=parseInt(defaultMinute)&&minuteList.push(item)})):(defaultMinute="00",minuteList=defaultMinuteList);var selectMinute=deliveryMinute||defaultMinute;this.set({dateList:dateList,hourList:hourList,minuteList:minuteList,deliveryDate:tools.parseDate(selectDate),deliveryHour:selectHour,deliveryMinute:selectMinute})},getDepartDate:function(date){var data=this.toJSON(),airplaneData=data.airplaneData,defaultHour=airplaneData.departTime.split(":")[0]-4;return defaultHour<0&&date.setDate(date.getDate()-1),date},getCurrentDate:function(){var date=new Date,hour=date.getHours();return 23==hour&&(date=date.setDate(date.getDate()+1)),tools.formatDate(tools.parseDate(date))},getRecommendAddress:function(val,type){var data=this.toJSON(),recommendData=data.recommendData,param={searchText:val,cityName:1==type?recommendData.pickupCityName:recommendData.deliveryCityName},address={address:val,name:val};1==type?this.set({pickupAddress:address}):2==type&&this.set({deliveryAddress:address}),eventBus.trigger("getRecommendAddress",param,type,"list")},setRecommendAddress:function(data,type){this.set({places:data.places,addressType:1,addressShow:type,addressError:""}),this.trigger("render",{keepCursor:!0,type:type})},setRecommendAddressFail:function(type){this.set({addressError:type,addressShow:"",addressType:""}),this.trigger("render",{keepCursor:!0,type:type})},showCommonAddress:function(type){this.set({addressType:2,addressShow:type,addressError:""}),this.trigger("render")},useAddress:function(type,index){var address,data=this.toJSON(),places=data.places;data.commonReceiptInfo;_.some(places,function(item,tmpIndex){if(index==tmpIndex)return address=item,!0}),1==type?this.set({pickupAddress:address}):2==type&&this.set({deliveryAddress:address}),this.set({addressShow:"",addressType:""}),this.trigger("render"),this.getNewestPrice(type)},changeRecommendDate:function(val){this.set({deliveryDate:val,deliveryHour:"",deliveryMinute:""}),this.formatRecommendData(),this.trigger("render")},changeRecommendHour:function(val){this.set({deliveryHour:val,deliveryMinute:""}),this.formatRecommendData(),this.trigger("render")},changeRecommendMinute:function(val){this.set({deliveryMinute:val}),this.formatRecommendData(),this.trigger("render")},selectRecommend:function(type){1==type?this.set({pickupSelected:!this.get("pickupSelected")}):2==type&&this.set({deliverySelected:!this.get("deliverySelected")}),this.set({addressShow:"",addressType:""}),this.trigger("render")},getNewestPrice:function(type){var data=this.toJSON(),airplaneData=data.airplaneData,recommendData=data.recommendData,pickupAddress=data.pickupAddress,deliveryAddress=data.deliveryAddress,param={type:type};1==type?_.extend(param,{airportCode:airplaneData.destinationAirportCode,terminalCode:airplaneData.arrivalAirportTerminal,useTime:this.formatTime(airplaneData.arrivalDate,airplaneData.arriveTime.split(":")[0],airplaneData.arriveTime.split(":")[1]),startAddressPoi:{name:recommendData.pickupServer.serviceName,address:recommendData.pickupServer.serviceName,longitude:recommendData.pickupServer.longitude,latitude:recommendData.pickupServer.latitude},destAddressPoi:{name:pickupAddress.name,address:pickupAddress.address,longitude:pickupAddress.poiInfo.lng,latitude:pickupAddress.poiInfo.lat}}):2==type&&_.extend(param,{airportCode:airplaneData.departureAirportCode,terminalCode:airplaneData.departureAirportTerminal,useTime:this.formatTime(data.deliveryDate,data.deliveryHour,data.deliveryMinute),startAddressPoi:{name:deliveryAddress.name,address:deliveryAddress.address,longitude:deliveryAddress.poiInfo.lng,latitude:deliveryAddress.poiInfo.lat},destAddressPoi:{name:recommendData.deliveryServer.serviceName,address:recommendData.deliveryServer.serviceName,longitude:recommendData.deliveryServer.longitude,latitude:recommendData.deliveryServer.latitude}}),eventBus.trigger("getNewestPrice",param,type,"list"),1==type?this.set({pickupPriceLoading:2}):2==type&&this.set({deliveryPriceLoading:2}),this.trigger("render")},formatTime:function(date,hour,minute){return date+" "+hour+":"+minute+":00"},setInfo:function(data,type){var pickDeliveryInfo=data.pickDeliveryInfo;1==type?this.set({pickupInfo:pickDeliveryInfo,pickupPriceLoading:1}):2==type&&this.set({deliveryInfo:pickDeliveryInfo,deliveryPriceLoading:1}),this.trigger("render")},setInfoFail:function(type){1==type?this.set({pickupInfo:null,pickupPriceLoading:3}):2==type&&this.set({deliveryInfo:null,deliveryPriceLoading:3}),this.trigger("render")},oneRowSelect:function(currentIndex,isSelect){var updateSchemeInfo=this.get("updateSchemeInfo"),checkJourneyNum=void 0;_.each(updateSchemeInfo,function(item,index){currentIndex==index&&(checkJourneyNum=item.journeyNum)}),_.each(updateSchemeInfo,function(item,index){item.journeyNum==checkJourneyNum&&(item.isSelect=0)}),_.each(updateSchemeInfo,function(item,index){currentIndex==index&&(item.isSelect=isSelect)}),this.trigger("render")},updateShowMore:function(){this.set({updateSchemeShowAll:!this.get("updateSchemeShowAll")}),this.trigger("render")},checkRecommend:function(){var code,data=this.toJSON();return!data.pickupSelected||data.pickupAddress&&data.pickupInfo?!!(!data.deliverySelected||data.deliveryAddress&&data.deliveryInfo)||(code=data.deliveryAddress||data.deliveryInfo?data.deliveryAddress?5:4:6,this.trigger("showError",{type:"recommend",code:code}),!1):(code=data.pickupAddress||data.pickupInfo?data.pickupAddress?2:1:3,this.trigger("showError",{type:"recommend",code:code}),!1)}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(14),__webpack_require__(9),__webpack_require__(8),__webpack_require__(5),__webpack_require__(6)],__WEBPACK_AMD_DEFINE_RESULT__=function($,Backbone,_,eventBus,config){var pageDataObj=config.pageDataObj;return Backbone.Model.extend({defaults:function(){return{insuranceInfo:void 0,triggerFlag:1,isShowMore:void 0,isNewInsuranceFlag:!1,insuranceNotice:void 0}},initialize:function(){var self=this;this.initData(pageDataObj),this.changeTitleShow(),this.on("oneRowSelect",function(index,isCheck){self.oneRowSelect(index,isCheck),eventBus.trigger("changeInsurance")}),this.on("clickMoreBtu",function(isShowMore){self.clickMoreBtu(isShowMore)})},initData:function(params){params.insuranceInfo&&params.insuranceInfo.length&&(this.set("insuranceInfo",params.insuranceInfo),params.insuranceNotice&&this.set({insuranceNotice:params.insuranceNotice,isShowMore:1,triggerFlag:0})),this.set("isNewInsuranceFlag",params.isNewInsuranceFlag)},loadSuccess:function(data){data&&!_.isEmpty(data.insuranceInfo)&&(this.set("insuranceInfo",data.insuranceInfo),this.changeTitleShow(),eventBus.trigger("changeInsurance"),this.trigger("render"))},oneRowSelect:function(index,isCheck){var insuranceInfo=this.get("insuranceInfo");_.each(insuranceInfo,function(item,i){i===index&&(item.isSelect=isCheck)}),this.trigger("render")},clickMoreBtu:function(isShowMore){1===isShowMore?this.set("triggerFlag",0):this.set("triggerFlag",1),this.set("isShowMore",isShowMore),this.changeTitleShow(),this.trigger("render")},getIsSelectRow:function(){var insuranceInfo=this.get("insuranceInfo"),checkRow=[];return _.each(insuranceInfo,function(item){1===item.isSelect&&checkRow.push(item)}),checkRow},geTipSug:function(){var insuranceInfo=this.get("insuranceInfo"),canShowTip=!1;_.some(insuranceInfo,function(insure){if(2===insure.insuranceType&&1===insure.isSelect)return canShowTip=!0,!0});var date=new Date,month=date.getMonth()+1,strDate=date.getDate();return month=month>=1&&month<=9?"0"+month:month,strDate=strDate>=1&&strDate<=9?"0"+strDate:strDate,canShowTip=canShowTip&&pageDataObj.departDate==date.getFullYear()+"-"+month+"-"+strDate},changeTitleShow:function(){var insuranceInfo=this.get("insuranceInfo"),isShowMore=this.get("isShowMore"),obj={};_.each(insuranceInfo,function(item){obj[item.type]=obj[item.type]||[],obj[item.type].push(item)}),isShowMore?_.each(obj,function(itemArr){_.each(itemArr,function(item,index){0==index?item.showTitle=!0:item.showTitle=!1,index==itemArr.length-1?item.showBorder=!0:item.showBorder=!1})}):_.each(obj,function(itemArr){var selectedArr=_.filter(itemArr,function(item){return item.isSelect});_.isEmpty(selectedArr)?_.each(itemArr,function(item,index){0==index?item.showTitle=!0:item.showTitle=!1,0==index?item.showBorder=!0:item.showBorder=!1}):_.each(selectedArr,function(item,index){0==index?item.showTitle=!0:item.showTitle=!1,index==selectedArr.length-1?item.showBorder=!0:item.showBorder=!1})})},setGlobalData:function(){var selectedInsurance=!_.isEmpty(this.getIsSelectRow());Backbone.app.set("selectedInsurance",selectedInsurance)}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(14),__webpack_require__(9),__webpack_require__(8),__webpack_require__(5)],__WEBPACK_AMD_DEFINE_RESULT__=function($,Backbone,_,eventBus){return Backbone.Model.extend({defaults:function(){return{favourableInfo:null,defaultAddress:null}},initialize:function(){},loadingSuccess:function(returnData){if(this.set("favourableInfo",returnData),!_.isEmpty(returnData.globalPromotion.data)){var globalData=this.formatGlobalPromotion(returnData);this.checkYouNotMe(globalData.currentName,globalData.isChecked,globalData.checkPromotionInfo)}this.trigger("render"),this.changePriceCalculate()},formatGlobalPromotion:function(data){var selectedData;return _.each(data.globalPromotion.data,function(item){item.selected&&(selectedData=item)}),{currentName:data.globalPromotion.name,isChecked:1,checkPromotionInfo:selectedData}},selectCheckChangeData:function(checkIndex){var favourableInfo=this.get("favourableInfo"),allPromotionIndex=0,currentName="",isChecked=null,checkPromotionInfo=null;favourableInfo.blackCardPromotion&&favourableInfo.blackCardPromotion.data&&_.each(favourableInfo.blackCardPromotion.data,function(oneTypePromotion,typeIndex){allPromotionIndex==checkIndex&&(currentName=favourableInfo.blackCardPromotion.name,oneTypePromotion.selected&&1==oneTypePromotion.selected?(isChecked=0,oneTypePromotion.selected=0):(isChecked=1,oneTypePromotion.selected=1),checkPromotionInfo=oneTypePromotion),allPromotionIndex++}),favourableInfo.globalPromotion.data&&_.each(favourableInfo.globalPromotion.data,function(oneTypePromotion,typeIndex){allPromotionIndex==checkIndex&&(currentName=favourableInfo.globalPromotion.name,oneTypePromotion.selected&&1==oneTypePromotion.selected?(isChecked=0,oneTypePromotion.selected=0):(isChecked=1,oneTypePromotion.selected=1),checkPromotionInfo=oneTypePromotion),allPromotionIndex++}),favourableInfo.proPromotion.data&&_.each(favourableInfo.proPromotion.data,function(onePromotion,index){if(allPromotionIndex==checkIndex){if(currentName=favourableInfo.proPromotion.name,onePromotion.selected&&1==onePromotion.selected)isChecked=0,onePromotion.selected=0,15==onePromotion.type&&favourableInfo.couponPromotion&&(favourableInfo.couponPromotion[0].data.data=Math.abs(favourableInfo.couponPromotion[0].data.oldData));else if(isChecked=1,onePromotion.selected=1,15==onePromotion.type){var newCoupon=0;if(_.each(onePromotion.reductions,function(item){3==item.type&&(newCoupon=item.total_reduction)}),favourableInfo.couponPromotion){var old=favourableInfo.couponPromotion[0].data.data;Math.abs(newCoupon)>favourableInfo.couponPromotion[0].data.userCanUsed&&(newCoupon=favourableInfo.couponPromotion[0].data.userCanUsed),favourableInfo.couponPromotion[0].data.data=Math.abs(newCoupon),favourableInfo.couponPromotion[0].data.oldData=Math.abs(old)}}checkPromotionInfo=onePromotion}allPromotionIndex++}),favourableInfo.returnCash.data&&_.each(favourableInfo.returnCash.data,function(onereturnCash,index){allPromotionIndex==checkIndex&&(currentName=favourableInfo.returnCash.name,onereturnCash.selected&&1==onereturnCash.selected?(isChecked=0,onereturnCash.selected=0):(isChecked=1,onereturnCash.selected=1),checkPromotionInfo=onereturnCash),allPromotionIndex++}),favourableInfo.resPromotion&&_.each(favourableInfo.resPromotion,function(oneTypePromotion,typeIndex){_.each(oneTypePromotion.data,function(onePromotion,index){allPromotionIndex==checkIndex&&(currentName=oneTypePromotion.name,onePromotion.selected&&1==onePromotion.selected?(isChecked=0,onePromotion.selected=0):(isChecked=1,onePromotion.selected=1),checkPromotionInfo=onePromotion),allPromotionIndex++})}),favourableInfo.couponPromotion&&_.each(favourableInfo.couponPromotion,function(oneTypePromotion,typeIndex){allPromotionIndex==checkIndex&&(checkPromotionInfo=null,currentName=oneTypePromotion.name,oneTypePromotion.data.selected&&1==oneTypePromotion.data.selected?(isChecked=0,oneTypePromotion.data.selected=0):(isChecked=1,oneTypePromotion.data.selected=1)),allPromotionIndex++}),favourableInfo.cardsPromotion.data&&_.each(favourableInfo.cardsPromotion.data,function(onePromotion,index){allPromotionIndex==checkIndex&&(currentName=favourableInfo.cardsPromotion.name,onePromotion.selected&&1==onePromotion.selected?(isChecked=0,onePromotion.selected=0):(isChecked=1,onePromotion.selected=1),checkPromotionInfo=onePromotion),allPromotionIndex++}),allPromotionIndex++,favourableInfo.returnCoupon.data&&_.each(favourableInfo.returnCoupon.data,function(onePromotion,index){onePromotion.needCheckFlag&&(allPromotionIndex==checkIndex&&(currentName=favourableInfo.returnCoupon.name,onePromotion.selected&&1==onePromotion.selected?(isChecked=0,onePromotion.selected=0):(isChecked=1,onePromotion.selected=1),checkPromotionInfo=onePromotion),allPromotionIndex++)}),favourableInfo.promotionFreeGifts&&favourableInfo.promotionFreeGifts.data&&_.each(favourableInfo.promotionFreeGifts.data,function(onePromotion){allPromotionIndex==checkIndex&&(currentName=favourableInfo.promotionFreeGifts.name,1==onePromotion.selected?(isChecked=0,onePromotion.selected=0):(isChecked=1,onePromotion.selected=1),checkPromotionInfo=onePromotion),allPromotionIndex++}),this.set("favourableInfo",favourableInfo),this.checkYouNotMe(currentName,isChecked,checkPromotionInfo),this.trigger("render"),this.changePriceCalculate()},selectCheckCompanyPrivilege:function(id){var favourableInfo=this.get("favourableInfo");favourableInfo.companyPrivilege.data&&_.each(favourableInfo.companyPrivilege.data,function(onePromotion,index){onePromotion.campaign_id==id&&(onePromotion.selected&&1==onePromotion.selected?onePromotion.selected=0:onePromotion.selected=1)}),this.set("favourableInfo",favourableInfo),this.trigger("render"),this.changePriceCalculate()},checkYouNotMe:function(currentName,isChecked,checkPromotionInfo){var checkPromotionId=null;if(!_.isNull(checkPromotionInfo)){var checkPromotionId=checkPromotionInfo.campaign_id;checkPromotionInfo.share}var favourableInfo=this.get("favourableInfo");if(favourableInfo.proPromotion.data&&favourableInfo.proPromotion.name===currentName){var coupon=favourableInfo.couponPromotion[0];if(favourableInfo.couponPromotion&&favourableInfo.couponPromotion.length&&1==coupon.data.selected)return void _.each(favourableInfo.proPromotion.data,function(onePromotion,index){onePromotion.campaign_id!=checkPromotionId&&(onePromotion.enable=0)});var resType=1==isChecked?0:1;favourableInfo=this.setAllResourceProStatus(favourableInfo,resType)}var isResFalg=0;if(favourableInfo.resPromotion&&_.each(favourableInfo.resPromotion,function(oneTypePromotion,typeIndex){oneTypePromotion.name==currentName&&(isResFalg=1,_.each(oneTypePromotion.data,function(onePromotion,index){1==isChecked?onePromotion.campaign_id!=checkPromotionId&&(onePromotion.enable=0):0!=onePromotion.is_valid&&(onePromotion.enable=1)}))}),isResFalg){var productType=1==isChecked?0:1;favourableInfo=this.setAllProductProStatus(favourableInfo,productType),favourableInfo=this.setAllCardsProStatus(favourableInfo,productType)}if(favourableInfo.cardsPromotion.data&&favourableInfo.cardsPromotion.name===currentName){var coupon=favourableInfo.couponPromotion[0];if(favourableInfo.couponPromotion&&favourableInfo.couponPromotion.length&&1==coupon.data.selected)return void _.each(favourableInfo.cardsPromotion.data,function(onePromotion,index){onePromotion.campaign_id!=checkPromotionId&&(onePromotion.enable=0)});var resType=1==isChecked?0:1;favourableInfo=this.setAllResourceProStatus(favourableInfo,resType)}if(favourableInfo.proPromotion.name==currentName||favourableInfo.cardsPromotion.name==currentName||favourableInfo.promotionFreeGifts.name==currentName||favourableInfo.returnCoupon.name==currentName||favourableInfo.globalPromotion.name==currentName||favourableInfo.returnCash.name==currentName||favourableInfo.blackCardPromotion.name==currentName){var isAddCouponUse=!1,haveNotCoupontUse=!1,checekShareArr=[],checkReturnArr=favourableInfo.returnCoupon.data&&favourableInfo.returnCoupon.data.length?_.filter(favourableInfo.returnCoupon.data,function(cell){return cell.needCheckFlag}):[],concatArr=(favourableInfo.proPromotion.data||[]).concat(favourableInfo.returnCash.data||[],favourableInfo.globalPromotion.data||[],favourableInfo.blackCardPromotion&&favourableInfo.blackCardPromotion.data||[],favourableInfo.cardsPromotion.data||[],favourableInfo.promotionFreeGifts.data||[],checkReturnArr);_.each(concatArr,function(onePromotion,index){1==onePromotion.selected&&(onePromotion.shares=onePromotion.shares||"",checekShareArr.push({id:onePromotion.campaign_id,shares:onePromotion.shares}),15==onePromotion.type||26==onePromotion.type?isAddCouponUse=!0:haveNotCoupontUse=!0)}),checekShareArr.length?_.each(concatArr,function(onePromotion){var enable=0;if(_.each(checekShareArr,function(oneCheck,index){onePromotion.campaign_id==oneCheck.id&&(enable=1)}),!enable){var oneNotHave=0,twoNotHave=0;_.each(checekShareArr,function(oneCheck,index){oneCheck.shares&&oneCheck.shares.indexOf(onePromotion.campaign_id)!=-1||(oneNotHave=1),onePromotion.shares&&onePromotion.shares.indexOf(oneCheck.id)!=-1||(twoNotHave=1)}),oneNotHave||twoNotHave||(enable=1)}enable?0!=onePromotion.is_valid&&(onePromotion.enable=1):(onePromotion.enable=0,onePromotion.selected=0)}):(_.each(favourableInfo.blackCardPromotion.data,function(onePromotion,index){0!=onePromotion.is_valid&&(onePromotion.enable=1)}),_.each(favourableInfo.globalPromotion.data,function(onePromotion,index){0!=onePromotion.is_valid&&(onePromotion.enable=1)}),_.each(favourableInfo.cardsPromotion.data,function(onePromotion,index){0!=onePromotion.is_valid&&(onePromotion.enable=1)}),_.each(favourableInfo.proPromotion.data,function(onePromotion,index){0!=onePromotion.is_valid&&(onePromotion.enable=1)}),_.each(favourableInfo.returnCash.data,function(onePromotion,index){0!=onePromotion.is_valid&&(onePromotion.enable=1)}),_.each(favourableInfo.promotionFreeGifts.data,function(onePromotion,index){0!=onePromotion.is_valid&&(onePromotion.enable=1)}),_.each(favourableInfo.returnCoupon.data,function(onePromotion,index){0!=onePromotion.is_valid&&(onePromotion.enable=1)})),checekShareArr.length&&haveNotCoupontUse?favourableInfo.couponPromotion[0].data.enable=0:favourableInfo.couponPromotion[0].data.enable=1}if(_.isNull(checkPromotionId)){var productType=1==isChecked?0:1;if(favourableInfo=this.setAllResourceProStatus(favourableInfo,productType),1==isChecked)favourableInfo.proPromotion.data&&favourableInfo.proPromotion.data.length&&_.each(favourableInfo.proPromotion.data,function(oneProPromotion){
15!=oneProPromotion.type&&(oneProPromotion.enable=0)}),favourableInfo.cardsPromotion.data&&favourableInfo.cardsPromotion.data.length&&_.each(favourableInfo.cardsPromotion.data,function(oneProPromotion){15!=oneProPromotion.type&&(oneProPromotion.enable=0)});else{var hasProductPromotion=!1;favourableInfo.proPromotion.data&&_.each(favourableInfo.proPromotion.data,function(onePromotion,index){1==onePromotion.selected&&(hasProductPromotion=!0)}),favourableInfo.returnCash.data&&_.each(favourableInfo.returnCash.data,function(onePromotion,index){1==onePromotion.selected&&(hasProductPromotion=!0)}),favourableInfo.cardsPromotion.data&&_.each(favourableInfo.cardsPromotion.data,function(onePromotion,index){1==onePromotion.selected&&(hasProductPromotion=!0)}),favourableInfo.promotionFreeGifts.data&&_.each(favourableInfo.promotionFreeGifts.data,function(onePromotion,index){1==onePromotion.selected&&(hasProductPromotion=!0)}),favourableInfo.returnCoupon.data&&_.each(favourableInfo.returnCoupon.data,function(onePromotion,index){1==onePromotion.selected&&(hasProductPromotion=!0)}),hasProductPromotion||(favourableInfo=this.setAllProductProStatus(favourableInfo,productType),favourableInfo=this.setAllCashProStatus(favourableInfo,productType),favourableInfo=this.setAllCardsProStatus(favourableInfo,productType),favourableInfo=this.setAllGiftsProStatus(favourableInfo,productType),favourableInfo=this.setAllReturnProStatus(favourableInfo,productType))}}this.set("favourableInfo",favourableInfo)},setAllProductProStatus:function(favourableInfo,isChecked){return 0!=isChecked&&1!=isChecked?favourableInfo:(favourableInfo.proPromotion.data&&_.each(favourableInfo.proPromotion.data,function(onePromotion,index){onePromotion.enable=isChecked}),favourableInfo)},setAllCashProStatus:function(favourableInfo,isChecked){return 0!=isChecked&&1!=isChecked?favourableInfo:(favourableInfo.returnCash.data&&_.each(favourableInfo.returnCash.data,function(onePromotion,index){onePromotion.enable=isChecked}),favourableInfo)},setAllCardsProStatus:function(favourableInfo,isChecked){return 0!=isChecked&&1!=isChecked?favourableInfo:(favourableInfo.cardsPromotion.data&&_.each(favourableInfo.cardsPromotion.data,function(onePromotion,index){onePromotion.enable=isChecked}),favourableInfo)},setAllGiftsProStatus:function(favourableInfo,isChecked){return 0!=isChecked&&1!=isChecked?favourableInfo:(favourableInfo.cardsPromotion.data&&_.each(favourableInfo.promotionFreeGifts.data,function(onePromotion,index){onePromotion.enable=isChecked}),favourableInfo)},setAllReturnProStatus:function(favourableInfo,isChecked){return 0!=isChecked&&1!=isChecked?favourableInfo:(favourableInfo.returnCoupon.data&&_.each(favourableInfo.returnCoupon.data,function(onePromotion,index){onePromotion.enable=isChecked}),favourableInfo)},setAllResourceProStatus:function(favourableInfo,isChecked){return 0!=isChecked&&1!=isChecked?favourableInfo:(favourableInfo.resPromotion&&_.each(favourableInfo.resPromotion,function(oneTypePromotion,typeIndex){_.each(oneTypePromotion.data,function(onePromotion,index){onePromotion.enable=isChecked})}),favourableInfo)},getSelectPromotion:function(){var hasChecked=this.get("hasChecked"),selectedPromotion=[],coupon={coupon:0,travleCoupon:0},promotionInfo=this.get("favourableInfo");if(promotionInfo){var globalPromotion=promotionInfo.globalPromotion,proPromotion=promotionInfo.proPromotion,returnCash=promotionInfo.returnCash,resPromotion=promotionInfo.resPromotion,couponPromotion=promotionInfo.couponPromotion,cardsPromotion=promotionInfo.cardsPromotion,returnCoupon=promotionInfo.returnCoupon,companyPrivilege=promotionInfo.companyPrivilege,promotionFreeGifts=promotionInfo.promotionFreeGifts,blackCardPromotion=promotionInfo.blackCardPromotion;if(!_.isEmpty(blackCardPromotion)){var blackCardData=blackCardPromotion.data;blackCardData&&blackCardData.length&&_.each(blackCardData,function(onePro){1==onePro.selected&&selectedPromotion.push(onePro)})}if(!_.isEmpty(globalPromotion)){var globalData=globalPromotion.data;globalData&&globalData.length&&_.each(globalData,function(onePro){1==onePro.selected&&selectedPromotion.push(onePro)})}if(!_.isEmpty(proPromotion)){var proData=proPromotion.data;proData&&proData.length&&_.each(proData,function(onePro){1==onePro.selected&&selectedPromotion.push(onePro)})}if(!_.isEmpty(returnCash)){var proData=returnCash.data;proData&&proData.length&&_.each(proData,function(onePro){1==onePro.selected&&selectedPromotion.push(onePro)})}if(_.isEmpty(resPromotion)||_.each(resPromotion,function(oneTypeRes){var resData=oneTypeRes.data;resData&&resData.length&&_.each(resData,function(oneRes){1==oneRes.selected&&selectedPromotion.push(oneRes)})}),_.isEmpty(couponPromotion)||_.each(couponPromotion,function(oneCouponeRes){"抵用券"==oneCouponeRes.name?1==oneCouponeRes.data.selected&&(coupon.coupon=oneCouponeRes.data.data):hasChecked&&(coupon.travleCoupon=oneCouponeRes.data.useUsed+(+oneCouponeRes.data.orderUsedValue||0))}),!_.isEmpty(cardsPromotion)){var cardsData=cardsPromotion.data;cardsData&&cardsData.length&&_.each(cardsData,function(onePro){1==onePro.selected&&selectedPromotion.push(onePro)})}if(!_.isEmpty(returnCoupon)){var couponData=returnCoupon.data;couponData&&couponData.length&&_.each(couponData,function(onePro){1==onePro.selected&&selectedPromotion.push(onePro)})}if(!_.isEmpty(companyPrivilege)){var companyData=companyPrivilege.data;companyData&&companyData.length&&_.each(companyData,function(onePro){1==onePro.selected&&selectedPromotion.push(onePro)})}if(!_.isEmpty(promotionFreeGifts)){var freeGiftsData=promotionFreeGifts.data;freeGiftsData&&freeGiftsData.length&&_.each(freeGiftsData,function(onePro){1==onePro.selected&&selectedPromotion.push(onePro)})}}return{promotionInfo:selectedPromotion,coupon:coupon}},useTravelCoupon:function(coupon){var favourableInfo=this.get("favourableInfo"),hasChecked=this.get("hasChecked");if(coupon||0===coupon){coupon=Math.abs(coupon);var travelCouponError=!1;if(favourableInfo.couponPromotion&&favourableInfo.couponPromotion.length&&favourableInfo.couponPromotion[1]&&favourableInfo.couponPromotion[1].data.orderCanUsedValue){var userCanUsed=favourableInfo.couponPromotion[1].data.orderCanUsedValue;coupon>userCanUsed?(favourableInfo.couponPromotion[1].data.useUsed=userCanUsed,coupon=userCanUsed,travelCouponError=!0,this.trigger("travelCouponLimitError",userCanUsed)):favourableInfo.couponPromotion[1].data.useUsed=coupon}else this.trigger("travelCouponLimitError",0),coupon=0;if(0!==coupon&&!hasChecked)if(travelCouponError){setTimeout(function(){eventBus.trigger("sendCheckMsg","first")},3e3)}else eventBus.trigger("sendCheckMsg","first");this.set("favourableInfo",favourableInfo),this.changePriceCalculate()}},sendMsgAgain:function(){eventBus.trigger("sendCheckMsg","again")},checkMsgCode:function(code){eventBus.trigger("checkMsgCode",code)},checkIsSuccess:function(data){if(1==data){this.set("hasChecked",!0);var needReCheck=this.get("needReCheck");this.set("needReCheck",!1),this.changePriceCalculate(),this.trigger("checkMsgSuccess"),this.setTime(),needReCheck&&eventBus.trigger("saveOrder")}else this.trigger("checkMsgFail")},addPromotionCode:function(code){code?eventBus.trigger("addPromotionCodeService",code):this.trigger("validateError",3)},charge:function(id,pwd){var blankReg=/(^\s+|\s+$)/g;id=(id||"").replace(blankReg,""),id?pwd?eventBus.trigger("addTravelPromotion",id,pwd):this.trigger("validateError",2):this.trigger("validateError",1)},chargeError:function(){this.trigger("chargeError")},chargeTooOffen:function(){this.trigger("chargeTooOffen")},needLogin:function(){eventBus.trigger("openLogin")},getCardsData:function(){eventBus.trigger("getBindsCardsData")},postBindCardsData:function(data){eventBus.trigger("postBindCardsData",data)},getCompanyPrivilege:function(){eventBus.trigger("needGetCompanyPrivilege")},setCompanyPrivilege:function(data){var favourableInfo=this.get("favourableInfo");favourableInfo.companyPrivilege=data,this.trigger("render")},changePriceCalculate:function(){var selectpromotion=this.getSelectPromotion();selectpromotion.promotionInfo=selectpromotion.promotionInfo.filter(function(item){return"27"!=item.type}),eventBus.trigger("changePromotion",selectpromotion.promotionInfo,selectpromotion.coupon.coupon,selectpromotion.coupon.travleCoupon)},setDefaultAddress:function(address){var fav=this.get("favourableInfo");fav&&(fav.defaultAddress=address),this.set("defaultAddress",address),this.trigger("changeAddress")},compareAddress:function(id){var address=this.get("defaultAddress");address.address_id==id&&(this.set("defaultAddress",null),this.trigger("hideAddress"))},setTime:function(){var self=this,time=6e5;setTimeout(function(){self.set("needReCheck",!0)},time)},checkNeedReCheck:function(){var needReCheck=this.get("needReCheck");return!needReCheck||(eventBus.trigger("sendCheckMsg","first"),!1)},clearCheckInfo:function(){this.set({hasChecked:!1,needReCheck:!1}),this.changePriceCalculate()},deleteBlackCardPro:function(blackCardInfo){var blackCardProIDs=blackCardInfo&&blackCardInfo.priceList.map(function(item){return item.id})||[],favourableInfo=this.get("favourableInfo");blackCardProIDs&&blackCardProIDs.length&&favourableInfo.blackCardPromotion.data&&_.each(favourableInfo.blackCardPromotion.data,function(oneTypePromotion,typeIndex){blackCardProIDs.indexOf(oneTypePromotion.campaign_id)!==-1&&(oneTypePromotion.selected=0)}),blackCardProIDs&&blackCardProIDs.length&&favourableInfo.proPromotion.data&&_.each(favourableInfo.proPromotion.data,function(oneTypePromotion,typeIndex){blackCardProIDs.indexOf(oneTypePromotion.campaign_id)!==-1&&(oneTypePromotion.selected=0)}),this.set("favourableInfo",favourableInfo),this.trigger("render"),this.changePriceCalculate()}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(5)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,EventBus){return Backbone.Model.extend({defaults:{list:null,isShowInput:!1,updaterAddress:null,hasPostRequest:!1,canShouMore:!1,hasFoucus:!1},init:function(data){_.some(data,function(item){if(item.isDefault)return item.selected=!0,EventBus.trigger("setFavDefaultAddress",item),!0}),this.set("list",data)},resetSelectObj:function(i){var list=this.get("list");_.each(list,function(item,index){i==index?item.selected=!0:item.selected=!1}),EventBus.trigger("setFavDefaultAddress",list[i])},selectedData:function(i){var list=this.get("list");return _.each(list,function(item,index){i==index?item.selected=!0:item.selected=!1}),list[i]},isSelected:function(i){var selected=!1,list=this.get("list");return _.some(list,function(item,index){if(index==i)return selected=item.selected,!0}),selected},deleteAddress:function(i){var list=this.get("list");list=list.slice(0,i).concat(list.slice(i+1,list.length)),this.set("list",list),this.set("isShowInput",!1),this.trigger("render")},openPanel:function(){this.trigger("render")},resetDefaultAddress:function(i){var list=this.get("list");_.each(list,function(item,index){i==index?item.isDefault=!0:item.isDefault=!1}),EventBus.trigger("resetDefaultAddress",list[i])},addList:function(data,res){var list=this.get("list");list.push({address_id:res.addressId,user_name:data.receiver_name,provinceName:data.provinceName,cityName:data.cityName,address:data.address,tel:data.tel_num,isDefault:0}),this.reset(),this.trigger("render")},updateAddress:function(data){var list=this.get("list");_.each(list,function(item){data.addressId==item.address_id&&(item.user_name=data.receiver_name,item.provinceName=data.provinceName,item.cityName=data.cityName,item.address=data.address,item.tel=data.tel_num)}),this.reset(),this.set("updaterAddress",null),this.trigger("render")},reset:function(){this.set({hasFoucus:!1,isShowInput:!1})}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(14),__webpack_require__(9),__webpack_require__(8),__webpack_require__(50),__webpack_require__(6),__webpack_require__(5)],__WEBPACK_AMD_DEFINE_RESULT__=function($,Backbone,_,Validator,config,eventBus){var IsLogin=config.isLogin,pageDataObj=config.pageDataObj;return Backbone.Model.extend({defaults:function(){return{name:"",companyName:void 0,mobile:void 0,phoneAreaCode:void 0,phoneCode:void 0,email:void 0,telCountryId:40,intlCode:"0086",id:"",isTeamTour:"",isCompanyTour:!1}},initialize:function(){if(1!=pageDataObj.form&&1!=pageDataObj.custom||(this.set("isTeamTour",!0),1==pageDataObj.form&&pageDataObj.formType&&1===pageDataObj.formType[0].isSelected&&this.set("isCompanyTour",!0)),IsLogin.status){var userInfo=pageDataObj.userInfo;userInfo&&(this.set("name",userInfo.realName||""),this.set("mobile",userInfo.tel),this.set("email",userInfo.email),this.set("telCountryId",userInfo.telCountryId),userInfo.intlCode&&this.set("intlCode",userInfo.intlCode),2==pageDataObj.operationFlag&&this.set("id",userInfo.id))}var self=this;this.__registed=IsLogin.status,this.on("change:mobile",function(){IsLogin.status||eventBus.trigger("judgeIsMember",{tel:self.get("mobile"),intlCode:self.get("intlCode")})})},judgeIsMember:function(){var self=this;!IsLogin.status&&self.get("mobile")&&eventBus.trigger("judgeIsMember",{tel:self.get("mobile"),intlCode:self.get("intlCode")})},isRegister:function(){return this.__registed},setContact:function(data){this.set({name:data.data.userInfo.name,mobile:data.data.userInfo.tel,email:data.data.userInfo.email}),data.data.userInfo.telCountryId&&this.set({telCountryId:data.data.userInfo.telCountryId}),data.data.userInfo.intlCode&&this.set({intlCode:data.data.userInfo.intlCode}),this.trigger("reset")},clearContact:function(){this.set({name:"",mobile:"",email:"",intlCode:"0086"})},checkIsMember:function(data){1==data?(this.__registed=!0,this.trigger("registed")):2==data?this.__registed=!0:(this.__registed=!1,this.trigger("unregisted"))},validatorAll:function(){var isPast=!0,contactInfo=this.toJSON();if(Validator.validateName(contactInfo.name)){if(2==pageDataObj.operationFlag&&contactInfo.name)return void eventBus.trigger("contactCustomerServiceModifyTip");isPast=!1}else contactInfo.mobile?contactInfo.email||2==pageDataObj.operationFlag&&(isPast=!1):isPast=!1;return isPast||this.trigger("validatorAll"),isPast},getJudgeCrm:function(data){eventBus.trigger("needGetJudgeCrm",data)},setCrm:function(data){if(!data.telNum)return!1;var telData={telNum:data.telNum,intlCode:this.get("intlCode")};this.getJudgeCrm(telData)},getSubmitData:function(){var data=this.toJSON();return data.intlTel=data.intlCode+data.mobile,data},validateLogin:function(){return!(!IsLogin.status&&this.isRegister())||(eventBus.trigger("openLogin"),!1)},changeCompanyExist:function(isCompanyTour){this.set("isCompanyTour",isCompanyTour),isCompanyTour||this.set("companyName",void 0),this.trigger("teamTourTypeChanged")}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_RESULT__=function(){var Validator={validateName:function(name){var errors=["验证通过","姓名为空","姓名长度不符合4-20字符内","姓名只能包含中文、英文和空格"];if(name=name.replace(/(^\s*)/g,""),""==name)return errors[1];if(Validator.strlen(name)>20||Validator.strlen(name)<4)return errors[2];var expression=new RegExp("^[一-龥A-Za-z ]+$");return expression.test(name)?null:errors[3]},validateTel:function(tel){var errors=["验证通过","手机为空","手机号码错误"];return""==tel?errors[1]:0==new RegExp("^1[0-9]{10,10}$").test(tel)?errors[2]:null},validateInternationTel:function(tel){var errors=["验证通过","手机为空","手机号码错误"];return""==tel?errors[1]:0==/^\d{5,11}$/.test(tel)?errors[2]:null},validatePhone:function(area_code,phone){var errors=["验证通过","区号错误,3~4位数字","座机号错误,7~8位数字"];if(""!=area_code||""!=phone){var reg1=/^\d{3,4}$/,reg2=/^\d{7,8}$/;if(!reg1.test(area_code))return errors[1];if(!reg2.test(phone))return errors[2]}return null},validateAreaCode:function(area_code){var errors=["验证通过","区号错误,3~4位数字"];if(""!=area_code){var reg1=/^\d{3,4}$/;if(!reg1.test(area_code))return errors[1]}return null},validateTelPhone:function(phone){var errors=["验证通过","座机号错误,7~8位数字"];if(""!=phone){var reg2=/^\d{7,8}$/;if(!reg2.test(phone))return errors[1]}return null},validateEmail:function(email){var errors=["验证通过","邮箱为空","邮箱格式错误"];if(""!=email){var patrn=/(?=^.{5,255}$)(^([\w\!\#\$\%\&\'\*\+\-\.\/\?\^\_\`\{\|\}\~]+)@([a-zA-Z0-9\-]+\.)+([a-zA-Z0-9\-]+)$)/;if(!patrn.exec(email))return errors[2]}return null},validatePostcode:function(postcode){var errors=["验证通过","邮编为空","邮编错误,6位数字"],expression=new RegExp("^[0-9]{6,6}$");return 1==expression.test(postcode)?null:""!=postcode?errors[2]:errors[1]},strlen:function(str){for(var len=0,i=0;i<str.length;i++)str.charCodeAt(i)>255||str.charCodeAt(i)<0?len+=2:len++;return len},validateIdCard:function(IDCard){var errors=["验证通过","身份证为空","验证错误"];return""==IDCard?errors[1]:0==new RegExp("(^[0-9]*[1-9][0-9]*$)").test(IDCard)?errors[2]:null},validateAddress:function(value){var errors=["验证通过","地址为空"];return""==value?errors[1]:null},validateTitle:function(value){var errors=["验证通过","发票抬头为空"];return""==value?errors[1]:null},validateArriveNum:function(value){var errors=["验证通过","请正确填写抵达班次"];return""==value?errors[1]:null},validateDepartNum:function(value){var errors=["验证通过","请正确填写离开班次"];return""==value?errors[1]:null},validateArriveTime:function(value){var errors=["验证通过","请正确填写抵达时间"];return""==value?errors[1]:null},validateDepartTime:function(value){var errors=["验证通过","请正确填写离开时间"];return""==value?errors[1]:null}};return Validator}.call(exports,__webpack_require__,exports,module),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(8),__webpack_require__(6),__webpack_require__(52),__webpack_require__(5),__webpack_require__(16),__webpack_require__(11)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,_,config,Passenger,eventBus,tools,constant){var pageDataObj=config.pageDataObj;return Backbone.Collection.extend({model:Passenger,defaults:function(){},initialize:function(){pageDataObj.temporarilyCard&&pageDataObj.cardTypeList.push({name:"稍后提供",value:999}),this.adultNum=pageDataObj.adultNum,this.childNum=pageDataObj.childNum,this.freeChildNum=pageDataObj.freeChildNum,_.extend(this,pageDataObj.touristsFlag),"cruise2"==pageDataObj.pageType?this.comparator="":this.comparator="type",this.hasForeignOrOld=0,this.hasForeign=0,this.hasOdler=0,this.hasYounger=0,this.showAgeCheckBox=!0;this.on("nameSet",function(model,name){this.getNameCount(name,model.cid)?model.showErr("name",5):model.finalSet("name",name)}),this.on("cardNoSet",function(model,cardNo){this.getCardNoCount(cardNo,model)?(model.showErr("Other",3),model.set({cardNoRepeat:1},{silent:!0})):(model.finalSet("cardNo",cardNo),model.set({cardNoRepeat:0},{silent:!0}),this.changeShowAgeCheckBox())}),this.on("onBirthdayCheck",function(model){this.changeShowAgeCheckBox()}),this.on("mobileNoSet",function(model){var age=model.getAge().deltaAge;0==this.getMobileNoCount()?age&&(age>=70||age<12)?model.showErr("Mobile",2):1==Backbone.app.get("isSelectTran")||21==Backbone.app.get("resType")||1==pageDataObj.singleFlightFlag?model.showErr("Mobile",7):model.showErr("Mobile",2):age&&age<70&&age>=12&&(1!=Backbone.app.get("isSelectTran")&&21!=Backbone.app.get("resType")&&1!=pageDataObj.singleFlightFlag||model.showErr("Mobile",7))}),this.on("needRemove",function(model){var type=model.toJSON().type;model.doRemove(),"back2"==pageDataObj.pageType?this.numChange(type,this[type+"Num"]):"step2"==pageDataObj.bookStep&&3==pageDataObj.operationFlag&&this.setDelStatus2(),this.changeSerial(),this.changeDeleteFlag(type,0)}),this.on("beforeSelectResource",function(resId,data,model){var num=this.getRseourceSelectNum(resId),maxNum=0;for(var k in model.toJSON().resource)resId==model.toJSON().resource[k].resId&&(maxNum=model.toJSON().resource[k].adultResourceCount);num<maxNum&&model.finalSet("resource",data),num==maxNum-1&&this.setModelSetBindLimit(resId)}),this.on("unBindTicket",function(resId){this.setModelUnSetBindLimit(resId)}),this.on("needCheckOrderStatus",function(){if(pageDataObj.savingOrder){var num=0;_.each(this.toJSON(),function(oneTourist){1!=oneTourist.userStatus.chinesePingyinName&&num++});num==this.toJSON().length&&(eventBus.trigger("saveOrder"),pageDataObj.savingOrder=0)}}),this.on("calUiStatus",function(){var showFavors=this.some(function(pass){var data=pass.toJSON();return"expanded"==data.uiStatus});eventBus.trigger("changeFavorStatus",showFavors)}),this.on("add remove",function(){this.trigger("calUiStatus")})},changeShowAgeCheckBox:function(){var allHasAgeTag=!0,hasOlderTag=!1,hasYoungerTag=!1,maxAgeLimit=pageDataObj.maxAgeLimit||80,minAgeLimit=pageDataObj.minAgeLimit||0;this.each(function(item,index){var ageInfo=item.getAge();ageInfo.hasAge?(+maxAgeLimit<=ageInfo.deltaAge&&(hasOlderTag=!0),+minAgeLimit>=ageInfo.deltaAge&&(hasYoungerTag=!0)):allHasAgeTag=!1}),this.showAgeCheckBox=!allHasAgeTag,this.hasOdler=hasOlderTag,this.hasYounger=hasYoungerTag,this.showAgeCheckBox?$(".is-has-older, .is-has-younger").show():$(".is-has-older, .is-has-younger").hide(),this.hasForeignOrOld=this.hasOdler||this.hasYounger||this.hasForeign},initPassenger:function(initData){if("step2"==pageDataObj.bookStep&&3==pageDataObj.operationFlag)return this.initPassengerByData(pageDataObj.touristInfos),void this.setDelStatus2();for(var i=0;i<initData.adultNum;i++)this.addAdult();if(_.indexOf(constant.TRAIN_PRO_MODE,pageDataObj.proMode)!=-1){if(initData.normalChildNum)for(var k=0;k<initData.normalChildNum;k++)this.addChild();if(initData.freeChildNum)for(var j=0;j<initData.freeChildNum;j++)this.addFreeChild()}else{if(initData.childNum)for(var k=0;k<initData.childNum;k++)this.addChild();if(initData.freeChildNum)for(var j=0;j<initData.freeChildNum;j++)this.addFreeChild()}},initCruisePassenger:function(data){var self=this;_.each(data,function(item,index){_.each(item.lists,function(room,roomIndex){var obj={cruise:{cabinIndex:index,roomTypeName:item.roomName,minCapacity:item.startNum,maxCapacity:item.maxCapacity,resourceId:item.resourceId,roomIndex:roomIndex,uuid:room.uuid}};item.lists.length>1&&(obj.cruise.roomTypeName+="：舱房"+(roomIndex+1));for(var i=0;i<room.adultNum;i++)obj.serial=i+1,self.addAdult(obj);for(;i<room.adultNum+room.childNum;i++)obj.serial=i+1,self.addChild(obj);for(;i<room.adultNum+room.childNum+room.freeChildNum;i++)obj.serial=i+1,self.addFreeChild(obj)})})},changeText:function(data){this.each(function(tourist,index){0==index&&tourist.set("resType",data)})},showVisaUser:function(resName){this.each(function(tourist,index){var resNames=$.extend(!0,[],resName);tourist.setVisaResName(resNames)})},selectThisVisa:function(cid,thisIndex,type){this.each(function(tourist,index){tourist.cid==cid&&tourist.selectVisa(thisIndex,1,type)})},cancelSelectThisVisa:function(cid,thisIndex,type){this.each(function(tourist,index){tourist.cid==cid&&tourist.selectVisa(thisIndex,0,type)})},cancelAllVisa:function(resId,type){this.each(function(tourist,index){var visaResName=tourist.get("visaResName");_.each(visaResName,function(item,index){item.resId==resId&&item.type==type&&tourist.selectVisa(index,0,type)})})},getAllVisaCount:function(resId,type){var adultCount=0,childCount=0;return this.each(function(tourist,index){var tourists=tourist.toJSON();if(tourists.type==type){var visaResName=tourist.get("visaResName");_.each(visaResName,function(item,index){item.resId==resId&&item.selected&&("adult"==type?adultCount++:childCount++)})}}),{adultCount:adultCount,childCount:childCount}},initPassengerByData:function(touristList){var self=this,defaultAdultNum=0,defaultChildNum=0,defaultFreeChildNum=0,defaultNormalChildNum=0;_.each(touristList,function(tourist){var touristTypeKey=tourist.type,cardValidDate=tourist.cardValidDate,birthDate=tourist.birthDate;0==touristTypeKey?(tourist.type="adult",tourist.labelText="成人",defaultAdultNum++):tourist.isFreeChild?(tourist.type="freeChild",tourist.labelText="免票儿童",defaultFreeChildNum++,defaultChildNum++):(tourist.type="child",tourist.labelText="儿童",defaultNormalChildNum++,defaultChildNum++),cardValidDate&&(tourist.cardValidDate_year=cardValidDate.split("-")[0],tourist.cardValidDate_month=cardValidDate.split("-")[1],tourist.cardValidDate_day=cardValidDate.split("-")[2]),birthDate&&(tourist.birthDate_year=birthDate.split("-")[0],tourist.birthDate_month=birthDate.split("-")[1],tourist.birthDate_day=birthDate.split("-")[2]),tourist.serial=self.length+1,tourist.isTrain=2==pageDataObj.proMode,tourist.isChild=touristTypeKey,tourist.hasTakeSeat=pageDataObj.hasTakeSeat;var pass=new Passenger(tourist);pass.getEnglishNameList(tourist.name),self.add(pass)}),Backbone.app.set({defaultAdultNum:defaultAdultNum,defaultChildNum:defaultChildNum,defaultFreeChildNum:defaultFreeChildNum,defaultNormalChildNum:defaultNormalChildNum})},fillTourists:function(params){for(var defaultAdultNum=Backbone.app.get("defaultAdultNum"),defaultChildNum=Backbone.app.get("defaultChildNum"),defaultFreeChildNum=Backbone.app.get("defaultFreeChildNum"),defaultNormalChildNum=Backbone.app.get("defaultNormalChildNum");params.adultNum>defaultAdultNum;)this.addAdult(),defaultAdultNum++;for(;params.normalChildNum>defaultNormalChildNum;)this.addChild(),defaultNormalChildNum++,defaultChildNum++;for(;params.freeChildNum>defaultFreeChildNum;)this.addFreeChild(),defaultFreeChildNum++,defaultChildNum++;for(;params.childNum>defaultChildNum;)this.addChild(),defaultChildNum++},setDelStatus:function(params){var defaultAdultNum=Backbone.app.get("defaultAdultNum"),defaultChildNum=Backbone.app.get("defaultChildNum"),defaultFreeChildNum=Backbone.app.get("defaultFreeChildNum"),defaultNormalChildNum=Backbone.app.get("defaultNormalChildNum");"number"==typeof params.adultNum&&params.adultNum<defaultAdultNum&&this.changeDeleteFlag("adult",1),("number"==typeof params.childNum&&params.childNum<defaultChildNum||"number"==typeof params.normalChildNum&&params.normalChildNum<defaultNormalChildNum)&&this.changeDeleteFlag("child",1),"number"==typeof params.freeChildNum&&params.freeChildNum<defaultFreeChildNum&&this.changeDeleteFlag("freeChild",1)},setDelStatus2:function(){var adultNum=this.reduce(function(item){return 1==item.type?1:0},0);this.each(function(model){var data=model.toJSON();1==adultNum&&1==data.type?model.set("canDelete",!1):model.set("canDelete",!0)})},removeOne:function(model){this.remove(model),model.destroy()},changePassenger:function(touristType,type,num){if("minus"==type)if("child"==touristType)for(var i=0;i<=num;i++)this.reduceAdult();else if("normalChild"==touristType)for(var k=0;k<num;k++)this.reduceChild();else if("freeChild"==touristType)for(var j=0;j<num;j++)this.reduceFreeChild()},changeSerial:function(){this.each(function(tourist,index){tourist.setSerial(index+1)})},getRseourceSelectNum:function(resId){var num=0;return this.each(function(pass){for(var i in pass.toJSON().resource)pass.toJSON().resource[i].resId==resId&&pass.toJSON().resource[i].select&&num++}),num},setModelUnSetBindLimit:function(resId){this.each(function(pass){pass.removeBindLimit(resId)})},setModelSetBindLimit:function(resId){this.each(function(pass){pass.addBindLimit(resId)})},addAdult:function(obj){var pass=new Passenger(_.extend({serial:this.length+1,type:"adult",labelText:"成人",isTrain:2==pageDataObj.proMode,isChild:0,isFreeChild:0,cardType:pageDataObj.defaultCardType,uiStatus:"expanded"},obj));this.add(pass)},addChild:function(obj){var labelText;labelText=2==pageDataObj.proMode?"儿童含票":"儿童";var pass=new Passenger(_.extend({serial:this.length+1,type:"child",labelText:labelText,isTrain:2==pageDataObj.proMode,isChild:1,isFreeChild:0,cardType:pageDataObj.defaultCardType,uiStatus:"expanded"},obj));this.add(pass)},addFreeChild:function(obj){var labelText;labelText="儿童免票";var pass=new Passenger(_.extend({serial:this.length+1,type:"freeChild",labelText:labelText,isTrain:2==pageDataObj.proMode,isChild:0,isFreeChild:1,cardType:pageDataObj.defaultCardType,uiStatus:"expanded"},obj));this.add(pass)},reduceAdult:function(){var reducePass,reduceTouristArr=[];this.each(function(tourist){"adult"==tourist.toJSON().type&&reduceTouristArr.push(tourist)}),reducePass=_.last(reduceTouristArr),this.removeOne(reducePass),this.changeSerial()},reduceChild:function(){var reducePass,reduceTouristArr=[];this.each(function(tourist){"child"==tourist.toJSON().type&&reduceTouristArr.push(tourist)}),reducePass=_.last(reduceTouristArr),this.removeOne(reducePass),this.changeSerial()},reduceFreeChild:function(){var reducePass,reduceTouristArr=[];this.each(function(tourist){"freeChild"==tourist.toJSON().type&&reduceTouristArr.push(tourist)}),reducePass=_.last(reduceTouristArr),this.removeOne(reducePass),this.changeSerial()},numChange:function(type,num){switch(type){case"adult":this.adultNum=num;var adultTouristNum=this.getTouristNum("adult");this.changeTouristNum(num,adultTouristNum,this.addAdult,this.reduceAdult,"adult");break;case"child":this.childNum=num;var childTouristNum=this.getTouristNum("child");this.changeTouristNum(num,childTouristNum,this.addChild,this.reduceChild,"child");break;case"freeChild":this.freeChildNum=num;var freeChildTouristNum=this.getTouristNum("freeChild");this.changeTouristNum(num,freeChildTouristNum,this.addFreeChild,this.reduceFreeChild,"freeChild")}},changeTouristNum:function(newNum,oldNum,addFunc,reduceFunc,type){if(newNum>oldNum)addFunc.apply(this),this.changeDeleteFlag(type,0);else if(newNum==oldNum)this.changeDeleteFlag(type,0);else{var pass=this.getLastEmpty(type);pass?(pass.doRemove(),this.changeSerial()):this.changeDeleteFlag(type,1)}},changeDeleteFlag:function(type,flag){this.each(function(pass){pass.toJSON().type==type&&pass.set("canDelete",flag)})},setResType:function(data,type){if(type){var selectType;"21"!=data&&21!=data||(selectType=data),"21"!=type&&21!=type||(selectType=type),Backbone.app.set("resType",selectType),this.each(function(item,index){0==index&&item.set("resType",selectType)})}else Backbone.app.set("resType",data),this.each(function(item,index){0==index&&item.set("resType",data)})},getTouristNum:function(type){var num=0;return this.each(function(pass){pass.toJSON().type==type&&num++}),num},getLastEmpty:function(type){for(var returnPass=null,i=this.models.length-1;i>=0;i--){var pass=this.models[i];if(pass.isEmpty()&&pass.toJSON().type==type){returnPass=pass;break}}return returnPass},getFirstEmpty:function(proMod,favorType,userFlag,data,favorFlag){if("adult"==favorType){var emptyPass,flag=!0,num=0;this.each(function(pass){flag&&pass.isEmpty(userFlag,data,favorFlag)&&"adult"==pass.toJSON().type&&(emptyPass=pass,flag=!1)}),this.each(function(pass){!pass.isEmpty(userFlag,data,favorFlag)||"child"!=pass.toJSON().type&&"freeChild"!=pass.toJSON().type||num++});var data={num:num,pass:emptyPass};return data}var emptyPass,flag=!0,num=0;this.each(function(pass){flag&&pass.isEmpty(userFlag,data,favorFlag)&&("child"==pass.toJSON().type||"freeChild"==pass.toJSON().type)&&(emptyPass=pass,flag=!1)}),this.each(function(pass){flag&&pass.isEmpty(userFlag,data,favorFlag)&&"adult"==pass.toJSON().type&&(emptyPass=pass,flag=!1)});var data={num:num,pass:emptyPass};return data},getNameCount:function(name,id){var num=0;return this.each(function(tourist){tourist.toJSON().name==name&&tourist.cid!=id&&num++}),num},getCardNoCount:function(cardNo,model){var num=0;return this.each(function(tourist){tourist.toJSON().cardNo==cardNo&&tourist.cid!=model.cid&&6!=model.toJSON().cardType&&num++;
}),num},getMobileNoCount:function(){var num=0;return this.each(function(tourist){tourist.toJSON().mobileNo&&num++}),num},isSelectOne:function(data){var flag=!1;return _.some(data,function(item){if(item&&21==item.resType&&1==item.isSelected)return flag=!0,!0}),flag},getAllPassengerData:function(visaMaterialData){var data=[],flag=!0,flagTypes=!0,showFlag=!1,allPhone=this.getAllAdultPhone(),specialNameFlag=!0;if(this.each(function(tourist){var thisAge=tourist.getAge();1!=Backbone.app.get("isSelectTran")&&21!=Backbone.app.get("resType")&&1!=pageDataObj.singleFlightFlag||(thisAge.deltaAge>=70&&(!tourist.get("mobileNo")||""==tourist.get("mobileNo"))||thisAge.deltaAge<12)&&(thisAge.deltaAge<12&&(showFlag=!0),tourist.set({mobileNo:allPhone,intlTel:tourist.get("intlCode")+allPhone},{silent:!0}));var validateResult=tourist.validatorAll();if(validateResult.flag){var touristData=tourist.getSendData(visaMaterialData,showFlag);data.push(touristData)}else 2!=pageDataObj.operationFlag||validateResult.flagType||(flagTypes=!1),validateResult.specialNameFlag===!1&&(specialNameFlag=!1),flag=!1}),!flag)return 2!=pageDataObj.operationFlag||flagTypes?specialNameFlag?{err:"touristErr"}:{err:"specialNameErr"}:{err:"modifyErr"};var isNeedCheckVisa=_.some(this.models,function(item){if(!_.isEmpty(item.get("visaResName"))&&1==item.get("showSwitch").showVisaUser)return!0});if(isNeedCheckVisa&&this.checkVisaAndSeelect())return{err:"touristErr"};var hasPhone=!1,self=this;if(this.each(function(tourist){1==tourist.checkMobile(tourist.toJSON().mobileNo)&&(hasPhone=!0)}),!hasPhone){var flag=_.every(this.models,function(item){return item.getAge().deltaAge>=12&&item.getAge().deltaAge<70});if(!flag||1!=Backbone.app.get("isSelectTran")&&21!=Backbone.app.get("resType")&&1!=pageDataObj.singleFlightFlag){var isAllNoModify=self.checkIsAllNoModify();return isAllNoModify&&2==pageDataObj.operationFlag?{err:"noPhoneModify"}:{err:"noPhone"}}return{err:"notEmpty"}}if(17==pageDataObj.proMode&&Backbone.app.get("selectedTrain")){var trainAdultNum=0,trainChildNum=0,trainFreeChildNum=0,canTakeMostChild=4,canTakeMostFreeChild=1;if(this.each(function(tourist){var isChild=tourist.get("isChild"),isFreeChild=tourist.get("isFreeChild"),heightIndex=tourist.get("heightIndex");1==isFreeChild?trainFreeChildNum++:0==isChild?1==heightIndex?trainAdultNum++:2==heightIndex?trainChildNum++:3==heightIndex&&(trainFreeChildNum=0):trainChildNum++}),trainChildNum>canTakeMostChild*trainAdultNum||trainFreeChildNum>canTakeMostFreeChild*trainAdultNum)return{err:"trainNumErr"}}if(11!=pageDataObj.tagType){var hasAdult=_.some(this.models,function(tourist){var birthDate=tourist.toJSON().birthDate;return 17==pageDataObj.proMode&&Backbone.app.get("selectedTrain")?1==tourist.toJSON().heightIndex:!birthDate||tourist.checkIsAdult(birthDate)});if(!hasAdult)return 17==pageDataObj.proMode&&Backbone.app.get("selectedTrain")?{err:"trainNumErr"}:{err:"noAdult"}}if("cruise2"==pageDataObj.pageType){var age=pageDataObj.childAgeStandard,roomlist=this.getCruiseRoomList(),hasAdultFlag=_.every(roomlist,function(item){return _.some(item.person,function(person){var currentAge=person.getAge();return!currentAge.hasAge||currentAge.deltaAge>=age})});if(!hasAdultFlag)return{err:"cruiseNoAdult"}}if(pageDataObj.hasCustomerLimit){var ticketerInfoOk=!1;if(this.each(function(tourist){1==tourist.get("isTicketer")&&(ticketerInfoOk=tourist.checkTicketerInfo(tourist))}),!ticketerInfoOk)return{err:"noTicketInfo"}}var bindFlag=0,resource=[];pageDataObj.resParams&&(resource=pageDataObj.resParams&&pageDataObj.resParams.selectTicket||[]);var bindNum=0;for(var k in resource){var maxNum=resource[k].adultResourceCount,num=0,resId=resource[k].resId;this.each(function(tourist){for(var i in tourist.toJSON().resource)tourist.toJSON().resource[i].resId==resId&&tourist.toJSON().resource[i].select&&num++}),num==maxNum&&bindNum++}if(bindNum==resource.length&&(bindFlag=1),!bindFlag)return{err:"notBindAllResource"};var needDeleteChild=!1,deleteFlag=this.some(function(pass){var flag=1==pass.get("canDelete")&&!pass.get("hasTakeSeat");return flag&&"adult"!=pass.get("type")&&(needDeleteChild=!0),flag});return deleteFlag&&!needDeleteChild?{err:"needDeleteTourist"}:deleteFlag&&needDeleteChild?{err:"needDeleteChildTourist"}:{data:data}},checkVisaAndSeelect:function(){var allSelectCount,self=this,allVisaCount={},allIndex=0;return this.each(function(tourist,index){if(0==index){var visaResNames=tourist.get("visaResName");_.each(visaResNames,function(visa,index){allVisaCount[visa.resId]={adultCount:visa.adultResourceCount||0,childCount:visa.childResourceCount||0}})}}),allSelectCount=self.getAllSelectCount(allVisaCount),this.each(function(tourist,index){tourist.clearVisaError()}),_.each(allSelectCount,function(item,index){allVisaCount[index].adultCount&&item.adultCount<allVisaCount[index].adultCount&&(self.showVisaError(allVisaCount[index].adultCount,index,"adult"),allIndex++),allVisaCount[index].childCount&&item.childCount<allVisaCount[index].childCount&&(self.showVisaError(allVisaCount[index].childCount,index,"child"),allIndex++)}),allIndex},clearVisaAndSelect:function(){var allSelectCount,self=this,allVisaCount={};this.each(function(tourist,index){if(0==index){var visaResNames=tourist.get("visaResName");_.each(visaResNames,function(visa,index){allVisaCount[visa.resId]={adultCount:visa.adultResourceCount||0,childCount:visa.childResourceCount||0}})}}),allSelectCount=self.getAllSelectCount(allVisaCount),_.each(allSelectCount,function(item,index){allVisaCount[index].adultCount&&item.adultCount==allVisaCount[index].adultCount&&self.clearAllVisaError(allVisaCount[index].adultCount,index,"adult"),allVisaCount[index].childCount&&item.childCount==allVisaCount[index].childCount&&self.clearAllVisaError(allVisaCount[index].childCount,index,"child")})},getAllSelectCount:function(obj){var self=this,arr={};return _.each(obj,function(item,index){var adultCount=0,childCount=0;self.each(function(tourist){var visaResNames=tourist.get("visaResName");_.isEmpty(visaResNames)||_.each(visaResNames,function(visa,i){visa.resId==index&&visa.selected&&("adult"==visa.type?adultCount++:childCount++)})}),arr[index]={adultCount:adultCount||0,childCount:childCount||0}}),arr},showVisaError:function(count,resId,flag){this.each(function(tourist,index){var data=tourist.toJSON(),visaResNames=tourist.get("visaResName");_.each(visaResNames,function(item,i){item.resId==resId&&data.type==flag&&(item.selected||tourist.showVisaError(i,count))})})},clearAllVisaError:function(count,resId,flag){this.each(function(tourist,index){var data=tourist.toJSON(),visaResNames=tourist.get("visaResName");_.each(visaResNames,function(item,i){item.resId==resId&&data.type==flag&&tourist.clearVisaError(i)})})},checkIsAllNoModify:function(){return _.every(this.models,function(tourist){return tourist.get("mobileNoModify")})},getJudStatus:function(){var result={};return _.some(this.models,function(tourist){var o=tourist.getJudgment();0!=o.tourFlag&&(result=o)}),result},getAllAdultPhone:function(){var arr,flag=_.every(this.models,function(item){var thisAge=item.getAge().deltaAge;return thisAge>=70||thisAge<12});return flag?_.some(this.models,function(item){if(item.get("mobileNo")&&""!=item.get("mobileNo"))return arr=item.get("mobileNo"),!0}):_.some(this.models,function(item){var thisAge=item.getAge().deltaAge;if(thisAge>=12&&thisAge<70&&item.get("mobileNo")&&""!=item.get("mobileNo"))return arr=item.get("mobileNo"),!0}),arr},goToOrder:function(){eventBus.trigger("validPostOrder")},changeTicketResource:function(data){var ticketList=_.filter(data,function(cell){return cell.subType==tools.getTypeByCode("mp")}),count=pageDataObj.adultNum+pageDataObj.childNum,selectTicket=[];ticketList&&ticketList.length&&ticketList.forEach(function(item){var cell=item.resInfo,flag="1"!=cell.isTouristName&&"1"!=cell.isTouristPhone||parseInt(item.adultResourceCount)==count?0:1,_cell={name:item.resName,adultResourceCount:item.adultResourceCount,resId:item.resId,needBind:flag,isTouristPhone:cell.isTouristPhone,needPsptId:cell.touristCertificateType?1:0};selectTicket.push(_cell)}),pageDataObj.resParams={selectTicket:selectTicket},this.each(function(pass){pass.changeTicketResource()})},getIsRepeat:function(data,nowData,index){return!(data.indexOf(nowData)>-1&&data.indexOf(nowData)!=index)},checkIsOldOrChild:function(data){var thisAge,ageLength=data.length;return thisAge=ageLength>15?this.checkAge(data):this.checkAges(data),!(thisAge>=70||thisAge<12)},checkAge:function(UUserCard){var myDate=new Date,month=myDate.getMonth()+1,day=myDate.getDate(),age=myDate.getFullYear()-UUserCard.substring(6,10)-1;return(UUserCard.substring(10,12)<month||UUserCard.substring(10,12)==month&&UUserCard.substring(12,14)<=day)&&age++,age},checkAges:function(strBirthday){var returnAge,strBirthdayArr=strBirthday.split("-"),birthYear=strBirthdayArr[0],birthMonth=strBirthdayArr[1],birthDay=strBirthdayArr[2],d=new Date,nowYear=d.getFullYear(),nowMonth=d.getMonth()+1,nowDay=d.getDate();if(nowYear==birthYear)returnAge=0;else{var ageDiff=nowYear-birthYear;if(ageDiff>0)if(nowMonth==birthMonth){var dayDiff=nowDay-birthDay;returnAge=dayDiff<0?ageDiff-1:ageDiff}else{var monthDiff=nowMonth-birthMonth;returnAge=monthDiff<0?ageDiff-1:ageDiff}else returnAge=-1}return returnAge},checkIsRepeat:function(data,pass){if((1==Backbone.app.get("isSelectTran")||21==Backbone.app.get("resType")||1==pageDataObj.singleFlightFlag)&&data.mobileNo){var isAdult=this.checkIsOldOrChild(data.birthDate);isAdult&&_.some(this.models,function(item){var age=item.getAge().deltaAge;if(age&&age>=12&&age<70&&item.get("mobileNo")&&item.get("mobileNo")==data.mobileNo&&item!=pass)return item.trigger("needLayerShowRepeat"),!0})}},getCruiseRoomList:function(){var self=this,arr=[];if("cruise2"==pageDataObj.pageType){var o;this.each(function(model,index){var data=model.toJSON();1==data.serial&&(o={person:[]}),o.person.push(model);var next=self.models[index+1];next&&1!=next.get("serial")||arr.push($.extend(!0,{},o))})}return arr},fillTouristInfo:function(){this.each(function(item){})},getSpecialNameError:function(){var result={title:"",name:"",index:0},map={2:"“先生”",3:"“女士”",4:"“小姐”",5:"“男士”"},hasFindFirst=!1;return this.each(function(model,index){var data=model.toJSON(),specialNameFlag=data.specialNameFlag,title=map[specialNameFlag],name=data.name;title&&(hasFindFirst||(hasFindFirst=!0,result.index=index),result.title.indexOf(title)==-1&&(result.title+=title+"、"),result.name+=name+"、")}),result.title=result.title.substr(0,result.title.length-1),result.name=result.name.substr(0,result.name.length-1),result},notNeedCheckSpecialName:function(){this.each(function(model){model.set("needCheckSpecialName",!1,{silent:!0})})},getIsGangAoAndInSideAirplane:function(){var isGangAo=pageDataObj.cardRelationData.isGangAo,globalData=Backbone.app.toJSON(),selectedAir=globalData.selectedAir||pageDataObj.cardRelationData.selectedAir,inSideAirplane=_.some(selectedAir,function(item){return item&&0==item.internationalFlag});return isGangAo&&inSideAirplane}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(8),__webpack_require__(6),__webpack_require__(5)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,_,config,eventBus){function getDeltaAge(birth,end){var tempDate,startDate=birth.getDate(),startMonth=birth.getMonth(),startYear=birth.getFullYear(),endDate=end.getDate(),endMonth=end.getMonth(),endYear=end.getFullYear(),deltaDate=endDate-startDate;deltaDate<0&&(tempDate=new Date(endYear+"/"+(endMonth+1)+"/1"),tempDate.setDate(0),deltaDate+=tempDate.getDate(),endMonth-=1,endMonth<0&&(endYear-=1));var deltaMonth=endMonth-startMonth;deltaMonth<0&&(deltaMonth+=12,endYear-=1);var deltaYear=endYear-startYear;return deltaYear<0&&(deltaYear=0),{year:deltaYear||0,month:deltaMonth||0,date:deltaDate||0}}var pageDataObj=config.pageDataObj,undefined=void 0;return Backbone.Model.extend({defaults:function(){var date=new Date;return date.setMonth(date.getMonth()+6),{cardTypeMap:{0:{name:"暂无证件",value:0},1:{name:"身份证",value:1},2:{name:"护照",value:2},3:{name:"军官证",value:3},4:{name:"港澳通行证",value:4},7:{name:"台胞证",value:7},8:{name:"回乡证",value:8},9:{name:"户口簿",value:9},10:{name:"出生证明",value:10},11:{name:"台湾通行证",value:11},999:{name:"稍后提供",value:999}},heightOption:["请选择您的身高","身高＞1.5米","身高1.2米-1.5米","身高＜1.2米"],heightIndex:0,serial:0,canDelete:0,name:"",englishFirstName:"",englishLastName:"",lastNameArray:[],type:1,cardType:null,cardNo:"",birthDate_year:"1985",birthDate_month:"01",birthDate_day:"01",birthDate:"1985-01-01",cardValidDate_year:date.getFullYear(),cardValidDate_month:date.getMonth()+1,cardValidDate_day:date.getDate(),needBindResource:0,resource:null,customerPropertyId:"",customerPropertyName:"",telCountryId:"40",intlCode:"0086",isTicketer:0,sex:0,mobileNo:"",country:"中国",showSwitch:{showWriteTips:0,showCardType:0,showCardNum:0,showEnglishName:0,showPingyin:0,showBirthday:0,showCardValid:0,showMobile:0,showCountry:0,showSex:0,showGiveLater:0,showCountryList:0,showSignType:0,showSignAddr:0,showHeight:0,showVisaUser:0},visaResName:[],visaResCount:0,userStatus:{chinesePingyinName:0},basechineseName:null,backEditing:"back2"==pageDataObj.pageType,uiStatus:"back2"==pageDataObj.pageType?"collapsed":"expanded",visaTypes:[],signType:1,signAddr:"",nowInputSignAddr:!0,personId:"",resType:undefined,cruise:null,InfoFlag:2==pageDataObj.operationFlag,needSaveCommon:!1,needCheckSpecialName:!0,specialNameFlag:1}},initialize:function(){this.changeTicketResource(),this.setNewCardType(this.getCardTypeList()),"adult"==this.get("type")?this.set({birthDate_year:"1985",birthDate_month:"01",birthDate_day:"01",birthDate:"1985-01-01"}):this.set({birthDate_year:"2010",birthDate_month:"01",birthDate_day:"01",birthDate:"2010-01-01"}),this.set("visaTypes",$.extend(!0,[],pageDataObj.visaTypes))},appModelEvents:{"change:selectedAir":function(){var data=Backbone.app.toJSON();this.setChildAgeRange(data),this.trigger("changeValidator"),this.trigger("needRender"),this.trigger("changeTips")},"change:selectedTrain":function(){this.trigger("needRender")},"change:selectedBusTicket":function(){this.trigger("needRender")},"change:selectedTicket":function(){this.trigger("needRender")},"change:selectedInsurance":function(){this.trigger("needRender")}},setChildAgeRange:function(data){var hasAir=_.some(data.selectedAir,function(item){return!!item});hasAir?(Backbone.app.set("minChildAge",2),Backbone.app.set("maxChildAge",12)):(Backbone.app.set("minChildAge",0),Backbone.app.set("maxChildAge",18))},getCardTypeList:function(data){var baseList=[];return data&&2==pageDataObj.operationFlag&&data.cardTypeListModify.length&&(baseList=data.cardTypeListModify),this.mergeCardTypeList(baseList)},setNewCardType:function(cardTypeList){var cardType=this.get("cardType"),resourceLimits=pageDataObj.resourceLimits,key="cardLimit",afterGroupResLimit=resourceLimits.afterGroupResLimit[key],ifHasLast=_.some(cardTypeList,function(item){return item.value==cardType});if(!ifHasLast)if(_.isEmpty(afterGroupResLimit))this.set("cardType",cardTypeList[0].value);else{var resultList=[];_.each(cardTypeList,function(item){resultList.push(item.value)}),resultList=_.intersection(resultList,afterGroupResLimit),_.isEmpty(resultList)?this.set("cardType",cardTypeList[0].value):this.set("cardType",resultList[0])}},mergeCardTypeList:function(baseList){function aOrb(a,b){var result=a;return result===undefined&&(result=b),result}var cardTypeMap=this.get("cardTypeMap"),params=[],type=this.get("type"),globalData=Backbone.app.toJSON(),base=_.map(baseList,function(item){return item.value}),resourceLimits=pageDataObj.resourceLimits,key="cardLimit",groupResLimit=resourceLimits.groupResLimit[key],flightLimit=resourceLimits.flightLimit,gangAoFlightLimitForInSide=resourceLimits.gangAoFlightLimitForInSide,gangAoFlightLimitForOutSide=resourceLimits.gangAoFlightLimitForOutSide,taiWanFlightLimit=resourceLimits.taiWanFlightLimit,trainLimit=resourceLimits.TrainLimit[key],busLimit=resourceLimits.busLimit[key],menPiaoLimtForTiceker=resourceLimits.menPiaoLimtForTiceker[key],menPiaoLimitForTourist=resourceLimits.menPiaoLimitForTourist[key],insuranceLimit=resourceLimits.insuranceLimit[key],sortLimitCard=resourceLimits.sortLimitCard[key],cardRelationData=pageDataObj.cardRelationData,isGangAo=cardRelationData.isGangAo,isTaiWan=cardRelationData.isTaiWan,isMainland="中国"==this.get("country");isGangAo?flightLimit=isMainland?gangAoFlightLimitForInSide:gangAoFlightLimitForOutSide:isTaiWan&&(flightLimit=taiWanFlightLimit);var selectedAir,selectedTrain,selectedBusTicket,selectedTicket,selectedInsurance;selectedAir=aOrb(globalData.selectedAir,cardRelationData.selectedAir),selectedTrain=aOrb(globalData.selectedTrain,cardRelationData.selectedTrain),selectedBusTicket=aOrb(globalData.selectedBusTicket,cardRelationData.selectedBusTicket),selectedTicket=aOrb(globalData.selectedTicket,cardRelationData.selectedTicket),selectedInsurance=aOrb(globalData.selectedInsurance,cardRelationData.selectedInsurance),_.isEmpty(base)?"":params.push(base),_.isEmpty(groupResLimit)?"":params.push(groupResLimit);var hasAir=_.some(selectedAir,function(item){return!!item});hasAir&&_.each(selectedAir,function(item){if(item){var type=item.type,internationalFlag=item.internationalFlag,limit=flightLimit[internationalFlag][type][key];_.isEmpty(limit)?"":params.push(limit)}}),selectedTrain&&(_.isEmpty(trainLimit)?"":params.push(trainLimit)),selectedBusTicket&&(_.isEmpty(busLimit)?"":params.push(busLimit)),selectedTicket&&(this.get("isTicketer")?_.isEmpty(menPiaoLimtForTiceker)?"":params.push(menPiaoLimtForTiceker):_.isEmpty(menPiaoLimitForTourist)?"":params.push(menPiaoLimitForTourist)),selectedInsurance&&(_.isEmpty(insuranceLimit)?"":params.push(insuranceLimit));var resultList=_.intersection.apply(_,params);_.isEmpty(resultList)&&(resultList=_.union.apply(_,params));var resultSortList=[];_.isEmpty(resultList)?resultSortList=[0]:!selectedTrain||hasAir||selectedTicket||selectedInsurance||"child"!=type&&"freeChild"!=type?_.each(sortLimitCard,function(item){_.some(resultList,function(item2){if(item2==item)return resultSortList.push(item2),!0})}):resultSortList=[0];var resultCardtypeList=_.map(resultSortList,function(key){return cardTypeMap[key]});return resultCardtypeList},removeBindLimit:function(resId){var allResource=this.get("resource");for(var k in allResource){var cell=allResource[k];cell.resId==resId&&(cell.canNotBind=0)}this.set("resource",allResource),this.trigger("needRender")},addBindLimit:function(resId){var allResource=this.get("resource");for(var k in allResource){var cell=allResource[k];cell.resId==resId&&(cell.select||(cell.canNotBind=1))}this.set("resource",allResource),this.trigger("needRender")},changeTicketResource:function(){var resource=[];if(pageDataObj&&pageDataObj.resParams&&pageDataObj.resParams.selectTicket)for(var k in pageDataObj.resParams.selectTicket)resource.push($.extend({},pageDataObj.resParams.selectTicket[k]));for(var k in resource)"0"==resource[k].needBind&&this.toJSON().serial<parseInt(resource[k].adultResourceCount)+1&&(resource[k].select=1);var needBindObj=_.find(resource,function(cell){return"1"==cell.needBind});needBindObj?this.set("needBindResource",1):this.set("needBindResource",0),this.set("resource",resource),this.trigger("needRender")},checkBirthDay:function(birth,now){var ageData=this.getAge();ageData.hasAge&&"adult"!=this.get("type")&&(ageData.deltaAge>=Backbone.app.get("maxChildAge")||ageData.deltaAge<Backbone.app.get("minChildAge"))&&(1==this.get("cardType")?this.showErr("ID",6):this.showErr("birthDate",2)),this.trigger("onBirthdayCheck")},load:function(data){var prevIsFavor=this.isFavor;this.__isRareName=!1,this.__load=!0,this.set("personId",data.uid),data.cardValidDate&&(data.cardValidDate_year=data.cardValidDate.split("-")[0],data.cardValidDate_month=data.cardValidDate.split("-")[1],data.cardValidDate_day=data.cardValidDate.split("-")[2]),data.birthDate?this.set({birthDate_year:data.birthDate.split("-")[0],birthDate_month:data.birthDate.split("-")[1],birthDate_day:data.birthDate.split("-")[2]}):2==pageDataObj.operationFlag&&("adult"==data.favorType?data.birthDate="1985-01-01":data.birthDate="2010-01-01"),this.set({originCardType:data.cardType,originCardNo:data.cardNo,cardId:data.cardId});var _cardType=_.find(this.getCardTypeList(data),function(cell){return cell.value==data.cardType});_cardType||(data.cardType=this.getCardTypeList()[0].value,data.cardNo=null),data.intlCode||(data.intlCode=this.get("intlCode")),data.telCountryId||(data.telCountryId=this.get("telCountryId")),9==data.sex&&(data.sex=0),data.isFavor=!0,this.isFavor=prevIsFavor,this.set(data),this.getEnglishNameList(data.name),this.isFavor=prevIsFavor,data.cardNo&&this.trigger("cardNoSet",this,data.cardNo)},unselect:function(){this.relFavor=null,this.isFavor&&(this.remove(),this.isFavor=!1)},select:function(favor){this.relFavor=favor},remove:function(){this.trigger("requestRemove",this)},doRemove:function(){this.destroy()},clear:function(){var date=new Date,defaultCardType=1,self=this;date.setMonth(date.getMonth()+6);var arr=[];if(pageDataObj&&pageDataObj.resParams&&pageDataObj.resParams.selectTicket)for(var k in pageDataObj.resParams.selectTicket)arr.push($.extend({},pageDataObj.resParams.selectTicket[k]));defaultCardType=this.get("isTicketer")?pageDataObj.defaultTickerCardType:pageDataObj.defaultCardType;var cardValidDate_year,cardValidDate_month,cardValidDate_day,telCountryId,intlCode,sex,signAddr,personId="",name="",englishFirstName="",englishLastName="",cardNo="",birthDate_year="",birthDate_month="",birthDate_day="",mobileNo="",country="中国";this.get("InfoFlag")?(name=this.get("name"),englishFirstName=this.get("englishFirstNameModify")?this.get("englishFirstName"):"",englishLastName=this.get("englishLastNameModify")?this.get("englishLastName"):"",cardNo=this.get("cardNoModify")?this.get("cardNo"):"",birthDate_year=this.get("birthDateModify")?this.get("birthDate_year"):"",birthDate_month=this.get("birthDateModify")?this.get("birthDate_month"):"",birthDate_day=this.get("birthDateModify")?this.get("birthDate_day"):"",cardValidDate_year=this.get("cardValidDateModify")?this.get("cardValidDate_year"):"",cardValidDate_month=this.get("cardValidDateModify")?this.get("cardValidDate_month"):"",cardValidDate_day=this.get("cardValidDateModify")?this.get("cardValidDate_day"):"",telCountryId=this.get("telCountryIdModify")?this.get("telCountryId"):"",intlCode=this.get("intlCodeModify")?this.get("intlCode"):"",sex=this.get("sexModify")?this.get("sex"):"",mobileNo=this.get("mobileNoModify")?this.get("mobileNo"):"",defaultCardType=this.get("cardType"),country=this.get("needCountryModify")?this.get("country"):"",signAddr=this.get("hkmacIssueOrganModify")?this.get("signAddr"):""):(cardValidDate_year=date.getFullYear(),cardValidDate_month=date.getMonth()+1,cardValidDate_day=date.getDate(),telCountryId="40",intlCode="0086",sex=0,signAddr=""),this.set({personId:personId,name:name,englishFirstName:englishFirstName,englishLastName:englishLastName,lastNameArray:[],cardType:defaultCardType,cardNo:cardNo,birthDate_year:birthDate_year,birthDate_month:birthDate_month,birthDate_day:birthDate_day,cardValidDate_year:cardValidDate_year,cardValidDate_month:cardValidDate_month,cardValidDate_day:cardValidDate_day,needBindResource:0,resource:arr,customerPropertyId:"",customerPropertyName:"",telCountryId:telCountryId,intlCode:intlCode,sex:sex,mobileNo:mobileNo,country:country,showSwitch:{showWriteTips:0,showCardType:0,showCardNum:0,showEnglishName:0,showPingyin:0,showBirthday:0,showCardValid:0,showMobile:0,showCountry:0,showSex:0,showGiveLater:0,showCountryList:0,showSignType:0,showSignAddr:0},userStatus:{chinesePingyinName:0},signType:1,signAddr:signAddr,nowInputSignAddr:!0,needSaveCommon:!1,heightIndex:0,isFavor:!1});var resource=this.toJSON().resource;for(var k in resource)"0"==resource[k].needBind&&this.toJSON().serial<parseInt(resource[k].adultResourceCount)+1&&(resource[k].select=1);this.setNewCardType(this.getCardTypeList());var needBindObj=_.find(resource,function(cell){return"1"==cell.needBind});needBindObj&&this.set("needBindResource",1),this.get("InfoFlag")?this.set({birthDate_year:self.get("birthDateModify")?self.get("birthDate_year"):"",birthDate_month:self.get("birthDateModify")?self.get("birthDate_month"):"",birthDate_day:self.get("birthDateModify")?self.get("birthDate_day"):"",birthDate:self.get("birthDateModify")?self.get("birthDate"):""}):"adult"==this.get("type")?this.set({birthDate_year:"1985",birthDate_month:"01",birthDate_day:"01",birthDate:"1985-01-01"}):this.set({birthDate_year:"2010",birthDate_month:"01",birthDate_day:"01",birthDate:"2010-01-01"}),this.trigger("hasChange")},deleteItem:function(){this.trigger("needRemove",this)},doRemove:function(){this.destroy()},setName:function(name){this.trigger("nameSet",this,name)},setCardsNo:function(cardNo){this.trigger("cardNoSet",this,cardNo)},setMobileNo:function(mobileNo){this.trigger("mobileNoSet",this,name)},setSerial:function(serial){this.set({serial:serial})},showErr:function(key,flag){this.set("uiStatus","expanded"),this.trigger("needShowErr",key,flag)},finalSet:function(key,value){"name"==key&&this.set({name:value}),"cardNo"==key&&this.set({cardNo:value},{silent:!0}),"resource"==key&&this.set({resource:value})},checkCommon:function(str){return""==str?2:1},checkJunguanzheng:function(id){var pat;return id?(pat=/^[0-9]{8,8}$/,pat.test(id)?1:3):2},checkName:function(name,_name){if(name+="",name=name.replace(/(^\s*)/g,""),""==name)return 2;if(this.strlen(name)>22||this.strlen(name)<4)return 3;var expression=new RegExp("^[一-龥A-Za-z]+$");return expression.test(name)?1:4},getEnglishNameList:function(name){var data={cid:this.cid,name:name};this.changeStatus("chinesePingyinName",1),eventBus.trigger("check_Ajax_Name",data)},checkEnglishName:function(name){var reg;return name=name.replace(/^\s/g,"").replace(/\s$/g,""),reg=/^[A-Za-z]+$/,name&&reg.test(name)?1:2},checkEnglishFirstName:function(name){return this.checkEnglishName(name)},checkEnglishLastName:function(name){return this.checkEnglishName(name)},getJudgment:function(){var tourFlag=0,name=this.toJSON().name;if(this.toJSON().cardType&&1==this.toJSON().cardType){var cardNo=this.toJSON().cardNo,card_year=cardNo.slice(6,10),card_month=cardNo.slice(10,12),card_day=cardNo.slice(12,14),now=new Date,card_birth=new Date(card_year,card_month,card_day),cardDeltaAge=getDeltaAge(card_birth,now).year;cardDeltaAge<2?tourFlag=1:"child"==this.toJSON().type&&cardDeltaAge>=12?tourFlag=2:"adult"==this.toJSON().type&&cardDeltaAge>=2&&cardDeltaAge<12&&(tourFlag=3)}else{var year=this.toJSON().birthDate_year,month=parseInt(this.toJSON().birthDate_month)-1,day=this.toJSON().birthDate_day,now=new Date,birth=new Date(year,month,day),deltaAge=getDeltaAge(birth,now).year;deltaAge<2?tourFlag=1:"child"==this.toJSON().type&&deltaAge>=12?tourFlag=2:"adult"==this.toJSON().type&&deltaAge>=2&&deltaAge<12&&(tourFlag=3)}return{name:name,tourFlag:tourFlag}},checkHKMacao:function(id){var pat;return id?(pat=/^[a-zA-Z0-9]{2,21}$/,pat.test(id)?1:3):2},checkTWMacao:function(id){var pat;return id?(pat=/^[TL][0-9]{8,10}$/,pat.test(id)?1:3):2},checkTW:function(id){var pat1=/^[a-zA-Z0-9]{8}$/,pat2=/^[a-zA-Z0-9]{10}$/;return id?pat1.test(id)||pat2.test(id)?1:3:2},checkPassport:function(id){var pat1,pat2;return id?(pat1=/^[a-zA-Z]{5,17}$/,pat2=/^[a-zA-Z0-9]{5,17}$/,pat1.test(id)||pat2.test(id)?1:3):2},checkChushengzhengming:function(id){if(!id)return 2;var pat=/^[0-9]{8,8}$/;return pat.test(id)?1:3},checkHukouben:function(idcard){var Y,JYM,JYM_X,ereg,Errors,area,S,M,M_X,idcard_array;pageDataObj.internationalRoute,this.toJSON().name_flag;if(!idcard)return 2;if(Errors=[1,3,3,3,3],area={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"},idcard_array=idcard.split(""),null==area[parseInt(idcard.substr(0,2))])return Errors[4];var result=1;switch(idcard.length){case 15:ereg=(parseInt(idcard.substr(6,2))+1900)%4==0||(parseInt(idcard.substr(6,2))+1900)%100==0&&(parseInt(idcard.substr(6,2))+1900)%400==0?/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}$/:/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}$/,result=ereg.test(idcard)?1:Errors[2];break;case 18:ereg=parseInt(idcard.substr(6,4))%4==0||parseInt(idcard.substr(6,4))%100==0&&parseInt(idcard.substr(6,4))%4==0?/^[1-9][0-9]{5}(19|20)[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}[0-9Xx]$/:/^[1-9][0-9]{5}(19|20)[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}[0-9Xx]$/,ereg.test(idcard)?(S=7*(parseInt(idcard_array[0])+parseInt(idcard_array[10]))+9*(parseInt(idcard_array[1])+parseInt(idcard_array[11]))+10*(parseInt(idcard_array[2])+parseInt(idcard_array[12]))+5*(parseInt(idcard_array[3])+parseInt(idcard_array[13]))+8*(parseInt(idcard_array[4])+parseInt(idcard_array[14]))+4*(parseInt(idcard_array[5])+parseInt(idcard_array[15]))+2*(parseInt(idcard_array[6])+parseInt(idcard_array[16]))+parseInt(idcard_array[7])+6*parseInt(idcard_array[8])+3*parseInt(idcard_array[9]),Y=S%11,M="F",JYM="10x98765432",JYM_X="10X98765432",M=JYM.substr(Y,1),M_X=JYM_X.substr(Y,1),result=M==idcard_array[17]||M_X==idcard_array[17]?1:Errors[3]):result=Errors[2];break;default:result=Errors[1]}return result},checkHuixiangzheng:function(id){if(!id)return 3;var reg=/^[A-Za-z0-9]+$/;return reg.test(id)?1:3},checkMobile:function(tel,data){var telCountryId=this.get("telCountryId");return telCountryId&&"40"!=telCountryId&&40!=telCountryId?""==tel?2:0==/^\d{5,11}$/.test(tel)?3:1:""==tel?data?7:2:0==new RegExp("^1[0-9]{10,10}$").test(tel)?data?7:3:1},checkTicketerInfo:function(pass){return!pageDataObj.ticketFlag||(1!=pageDataObj.isCustomerPhone||pass.toJSON().mobileNo?!(pageDataObj.hasCustomerLimit&&!pass.get("cardNo"))||(pass.showErr("ID",7),!1):(pass.showErr("Mobile",5),!1))},checkIdCard:function(idcard){var Y,JYM,JYM_X,ereg,Errors,area,S,M,M_X,idcard_array;pageDataObj.internationalRoute,this.toJSON().name_flag;if(!idcard)return 2;if(Errors=[1,3,3,3,3,6],area={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"},idcard_array=idcard.split(""),null==area[parseInt(idcard.substr(0,2))])return Errors[4];var result=1;switch(idcard.length){case 15:ereg=(parseInt(idcard.substr(6,2))+1900)%4==0||(parseInt(idcard.substr(6,2))+1900)%100==0&&(parseInt(idcard.substr(6,2))+1900)%400==0?/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}$/:/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}$/,result=ereg.test(idcard)&&this.checkIdBirth(idcard)?1:ereg.test(idcard)&&!this.checkIdBirth(idcard)?Errors[5]:Errors[2];break;case 18:ereg=parseInt(idcard.substr(6,4))%4==0||parseInt(idcard.substr(6,4))%100==0&&parseInt(idcard.substr(6,4))%4==0?/^[1-9][0-9]{5}(19|20)[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}[0-9Xx]$/:/^[1-9][0-9]{5}(19|20)[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}[0-9Xx]$/,
ereg.test(idcard)?(S=7*(parseInt(idcard_array[0])+parseInt(idcard_array[10]))+9*(parseInt(idcard_array[1])+parseInt(idcard_array[11]))+10*(parseInt(idcard_array[2])+parseInt(idcard_array[12]))+5*(parseInt(idcard_array[3])+parseInt(idcard_array[13]))+8*(parseInt(idcard_array[4])+parseInt(idcard_array[14]))+4*(parseInt(idcard_array[5])+parseInt(idcard_array[15]))+2*(parseInt(idcard_array[6])+parseInt(idcard_array[16]))+parseInt(idcard_array[7])+6*parseInt(idcard_array[8])+3*parseInt(idcard_array[9]),Y=S%11,M="F",JYM="10x98765432",JYM_X="10X98765432",M=JYM.substr(Y,1),M_X=JYM_X.substr(Y,1),result=M!=idcard_array[17]&&M_X!=idcard_array[17]||!this.checkIdBirth(idcard)?M!=idcard_array[17]&&M_X!=idcard_array[17]||this.checkIdBirth(idcard)?Errors[3]:Errors[5]:1):result=Errors[2];break;default:result=Errors[1]}return result},checkIdBirth:function(cardId){var cardInfo=this.certificateNoParse(cardId);return"adult"==this.get("type")||!(cardInfo.age>=Backbone.app.get("maxChildAge")||cardInfo.age<Backbone.app.get("minChildAge"))},certificateNoParse:function(certificateNo){var pat=/^\d{6}(((19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[1-2][0-9]|3[0-1])\d{3}([0-9]|x|X))|(\d{2}(0[1-9]|1[0-2])(0[1-9]|[1-2][0-9]|3[0-1])\d{3}))$/;if(!pat.test(certificateNo))return null;var parseInner=function(certificateNo,idxSexStart,birthYearSpan){var res={},idxSex=1-certificateNo.substr(idxSexStart,1)%2;res.sex="1"==idxSex?"女":"男";var year=(2==birthYearSpan?"19":"")+certificateNo.substr(6,birthYearSpan),month=certificateNo.substr(6+birthYearSpan,2),day=certificateNo.substr(8+birthYearSpan,2);res.birthday=year+"-"+month+"-"+day,res.year=year,res.month=month,res.day=day;var d=new Date,monthFloor=d.getMonth()+1<parseInt(month,10)||d.getMonth()+1==parseInt(month,10)&&d.getDate()<parseInt(day,10)?1:0;return res.age=d.getFullYear()-parseInt(year,10)-monthFloor,res};return parseInner(certificateNo,15==certificateNo.length?14:16,15==certificateNo.length?2:4)},strlen:function(str){for(var len=0,i=0;i<str.length;i++)str.charCodeAt(i)>255||str.charCodeAt(i)<0?len+=2:len++;return len},isEmpty:function(userFlag,data,favorFlag){var favorsArr=this.checkNoModifyDataIsEqual(data,this.toJSON());return userFlag&&this.get("InfoFlag")?!favorsArr:!(this.get("name")||this.get("showSwitch").showCardType&&this.get("cardNo"))},checkNoModifyDataIsEqual:function(data1,data2){var arr1=this.pickOutNoModifyData(data1),arr2=this.pickOutNoModifyData(data2);return!_.isEqual(arr1,arr2)},pickOutNoModifyData:function(data){var arr=[];return _.each(pageDataObj.checkInfo,function(item,index){arr.push(data[item])}),arr},validateChildDate:function(){var year=this.toJSON().birthDate_year,month=parseInt(this.toJSON().birthDate_month)-1,day=this.toJSON().birthDate_day,now=new Date,birth=new Date(year,month,day),deltaAge=getDeltaAge(birth,now).year;return deltaAge<18?1:2},validateChildDateFromCard:function(){var cardNo=this.get("cardNo");if(cardNo){var reg=/\d{6}(\d{4})(\d{2})(\d{2})[\da-zA-Z]{3,4}/,match=cardNo.match(reg);if(match){var now=new Date,birth=new Date(match[1],match[2],match[3]),deltaAge=getDeltaAge(birth,now).year;return deltaAge<18?1:2}return 1}return 1},validateMaxAge:function(){var year=this.toJSON().birthDate_year,month=parseInt(this.toJSON().birthDate_month)-1,day=this.toJSON().birthDate_day,now=new Date,birth=new Date(year,month,day),deltaAge=getDeltaAge(birth,now).year,maxAgeLimit=parseInt(pageDataObj.maxAgeLimit);return maxAgeLimit&&deltaAge>maxAgeLimit?2:1},validateMinAge:function(){var ageData=this.getAge();if(ageData.hasAge){var minAgeLimit=parseInt(pageDataObj.minAgeLimit);return minAgeLimit&&ageData.deltaAge<minAgeLimit?3:1}return 1},validateCardValidDate:function(cardType){var year=this.toJSON().cardValidDate_year,month=this.toJSON().cardValidDate_month,day=this.toJSON().cardValidDate_day,date=(new Date,new Date(year+"/"+month+"/"+day)),backDate=new Date(pageDataObj.backDate);if(2===cardType)backDate.setMonth(backDate.getMonth()+6);else if(4!=cardType&&7!=cardType&&8!=cardType&&11!=cardType)return 1;return date<backDate?2===cardType?2:3:1},validatorAll:function(){var data=this.toJSON(),operationFlag=2==pageDataObj.operationFlag,flag=!0,flagType=!0,errkey="",showSwitch=this.changeShowSwitch(this.getCardTypeList()),ageData=this.getAge(),result={flag:flag,msg:"",flagType:flagType};if(1!=this.checkName(data.name))return flag=!1,this.showErr("name",this.checkName(data.name)),operationFlag&&data.nameModify&&(result.flagType=!1),result.flag=!1,result.msg="name__"+this.checkName(data.name),result;if(pageDataObj.needCheckName){if(1==data.userStatus.chinesePingyinName)return result.flag=!1,result.msg="name__正在校验生僻字,接口未返回",result;if(0==data.userStatus.chinesePingyinName)return result.flag=!1,result.msg="name__未校验生僻字",result}if(this.get("needCheckSpecialName")||1==pageDataObj.operationFlag){var specialNameFlag=this.checkSpecialName(data.name);if(this.set("specialNameFlag",specialNameFlag,{silent:!0}),1!=specialNameFlag)return result.flag=!1,result.msg="name__先生女士校验错误",result.specialNameFlag=!1,result}var phoneFlag=1,resource=data.resource,needPhone=0,isShowEmpty=!1,age=this.getAge(),hasHeight=!0;if(_.each(resource,function(cell){"1"==cell.isTouristPhone&&1==cell.select}),"back2"==pageDataObj.pageType&&(1==Backbone.app.get("isSelectTran")||21==Backbone.app.get("resType"))){var flag=this.checkMobile(data.mobileNo);age.deltaAge&&age.deltaAge>=12&&age.deltaAge<70&&(2==flag||3===flag)&&(needPhone=0,isShowEmpty=!0)}if(needPhone&&(phoneFlag=this.checkMobile(data.mobileNo,isShowEmpty)),17==pageDataObj.proMode&&Backbone.app.get("selectedTrain")&&(this.checkHasHeight(data)||(hasHeight=!1)),hasHeight||(this.showErr("height",1),result.flag=!1,result.msg="heightIndex"+data.heightIndex),1!=phoneFlag)return flag=!1,2==phoneFlag?phoneFlag=4:7==phoneFlag&&(phoneFlag=7),this.showErr("Mobile",phoneFlag),operationFlag&&data.mobileNoModify&&(result.flagType=!1),result.flag=!1,result.msg="mobileNo__"+this.checkMobile(data.mobileNo)+"__"+data.mobileNo,result;var cardType=parseInt(data.cardType);if(showSwitch.showCardNum){var cardTypeFlag=1;switch(cardType){case 1:cardTypeFlag=this.checkIdCard(data.cardNo),errkey="ID";break;case 2:cardTypeFlag=this.checkPassport(data.cardNo),errkey="Passport";break;case 3:cardTypeFlag=this.checkJunguanzheng(data.cardNo),errkey="Arm";break;case 4:cardTypeFlag=this.checkHKMacao(data.cardNo),errkey="HKMacao";break;case 7:cardTypeFlag=this.checkTW(data.cardNo),errkey="TW";break;case 8:cardTypeFlag=this.checkHuixiangzheng(data.cardNo),errkey="Huixiangzheng";break;case 9:cardTypeFlag=this.checkHukouben(data.cardNo),errkey="Hukouben";break;case 10:cardTypeFlag=this.checkChushengzhengming(data.cardNo),errkey="Chushengzhengming";break;case 11:cardTypeFlag=this.checkTWMacao(data.cardNo),errkey="TWMacao"}if(1!=cardTypeFlag)return flag=!1,this.showErr(errkey,cardTypeFlag),operationFlag&&data.cardNoModify&&(result.flagType=!1),result.flag=!1,result.msg="cardNo__"+cardTypeFlag+"__"+data.cardType+"__"+data.cardNo,result;if(("child"==data.type||"freeChild"==data.type)&&ageData.hasAge&&(ageData.deltaAge>=Backbone.app.get("maxChildAge")||ageData.deltaAge<Backbone.app.get("minChildAge")))return 1==this.get("cardType")?this.showErr("ID",4):this.showErr("birthDate",2),operationFlag&&data.cardNo&&data.cardNoModify&&(result.flagType=!1),operationFlag&&data.birthDate&&data.birthDateModify&&(result.flagType=!1),result.flag=!1,result.msg="cardNo__"+cardTypeFlag+"__"+data.cardType+"__"+data.cardNo,result;if(1==data.cardNoRepeat)return flag=!1,this.showErr("Other",3),operationFlag&&data.cardNo&&data.cardNoModify&&(result.flagType=!1),flag}if(showSwitch.showEnglishName||showSwitch.showPingyin){if(1!=this.checkEnglishLastName(data.englishLastName))return flag=!1,this.showErr("englishLastName",this.checkEnglishLastName(data.englishLastName)),operationFlag&&data.englishLastNameModify&&(result.flagType=!1),result.flag=!1,result.msg="checkEnglishLastName__"+this.checkEnglishLastName(data.englishLastName)+"__"+data.englishLastName,result;if(1!=this.checkEnglishFirstName(data.englishFirstName))return flag=!1,this.showErr("englishFirstName",this.checkEnglishFirstName(data.englishFirstName)),operationFlag&&data.englishFirstNameModify&&(result.flagType=!1),result.flag=!1,result.msg="checkEnglishFirstName__"+this.checkEnglishFirstName(data.englishFirstName)+"__"+data.englishFirstName,result}if(showSwitch.showCardValid){var cardValidFlag=1;if(cardValidFlag=this.validateCardValidDate(cardType),1!=cardValidFlag)return flag=!1,this.showErr("validData",cardValidFlag),operationFlag&&data.cardValidDateModify&&(result.flagType=!1),result.flag=!1,result.msg="validateCardValidDate__"+this.validateCardValidDate(cardType),result}if(showSwitch.showSignAddr&&"L签"==this.get("signType")&&this.get("nowInputSignAddr")){var flag=this.checkSignAddr(data.signAddr);if(1!=flag)return this.showErr("Sign",flag),operationFlag&&data.hkmacIssueOrganModify&&(result.flagType=!1),result.flag=!1,result.msg="checkSign__"+flag,result}return result},checkIsAdult:function(val){var timeStamp,birth_year=parseInt(val.split("-")[0]),birth_month=parseInt(val.split("-")[1]),birth_day=parseInt(val.split("-")[2]),currentTime=(new Date).getTime(),after_year=birth_year+18,after_month=birth_month,after_day=birth_day;return 2==birth_month&&29==birth_day&&after_year%4!=0&&(after_day=28),timeStamp=new Date((after_year+"-"+after_month+"-"+after_day).replace(/-/g,"/")).getTime(),currentTime>=timeStamp},getAge:function(){var cardType=this.get("cardType"),cardNo=this.get("cardNo"),birthDay=this.get("birthDate"),ageData={hasAge:0,deltaAge:{}};if(1==cardType){if(!cardNo||18!=cardNo.length&&15!=cardNo.length)return ageData;if(18==cardNo.length){var reg=/\d{6}(\d{4})(\d{2})(\d{2})[\da-zA-Z]{3,4}/,match=cardNo.match(reg);if(match){var now=new Date,birth=new Date(match[1],+match[2]-1,match[3]),deltaAge=getDeltaAge(birth,now);return ageData.hasAge=1,ageData.deltaAge=deltaAge.year,ageData}return ageData}var reg=/\d{6}(\d{2})(\d{2})(\d{2})[\da-zA-Z]{3,4}/,match=cardNo.match(reg);if(match){var now=new Date,birth=new Date(match[1],"19"+match[2]-1,match[3]);return deltaAge=getDeltaAge(birth,now),ageData.hasAge=1,ageData.deltaAge=deltaAge.year,ageData}return ageData}if(999!=cardType&&0!=cardType&&birthDay){var now=new Date,match=birthDay.split("-"),birth=new Date(match[0],match[1]-1,match[2]);return deltaAge=getDeltaAge(birth,now),ageData.hasAge=1,ageData.deltaAge=deltaAge.year,ageData}return ageData},changeStatus:function(key,value){var oldStatus=_.extend({},this.get("userStatus"));oldStatus[key]=value,this.set("userStatus",oldStatus),"chinesePingyinName"==key&&3==value&&this.trigger("needCheckOrderStatus")},checkAge:function(UUserCard){var myDate=new Date,month=myDate.getMonth()+1,day=myDate.getDate(),age=myDate.getFullYear()-UUserCard.substring(6,10)-1;return(UUserCard.substring(10,12)<month||UUserCard.substring(10,12)==month&&UUserCard.substring(12,14)<=day)&&age++,age},getChineseList:function(isLastName){var baseChinsesName=this.get("basechineseName");if(baseChinsesName){if(isLastName){var nameList=[];return _.each(baseChinsesName.lastName,function(oneLaseName,index){var cell={chineseName:oneLaseName.chineseName,englishName:oneLaseName.englishName,index:index};nameList.push(cell)}),nameList}if(baseChinsesName.lastName.length>1)var selectLaseName=_.find(baseChinsesName.lastName,function(oneLaseName){return 1==oneLaseName.select});else var selectLaseName=baseChinsesName.lastName[0];return selectLaseName.firstNameList}},changeShowSwitch:function(cardTypeList){var touristData=this.toJSON(),showSwitch=touristData.showSwitch;this.getAge();"adult"==touristData.type?showSwitch.showMobile=1:showSwitch.showMobile=0,17==pageDataObj.proMode&&Backbone.app.get("selectedTrain")&&(showSwitch.showHeight=1),_.isEmpty(touristData.visaResName)?showSwitch.showVisaUser=0:showSwitch.showVisaUser=1,2==pageDataObj.operationFlag?touristData.englishLastName||touristData.englishFirstName||0==touristData.englishFirstNameModify||0==touristData.englishLastNameModify?showSwitch.showEnglishName=1:showSwitch.showEnglishName=0:pageDataObj.internationalRoute?showSwitch.showEnglishName=1:showSwitch.showEnglishName=0,pageDataObj.internationalRoute?showSwitch.showWriteTips=1:showSwitch.showWriteTips=0,pageDataObj.needCountry?showSwitch.showCountryList=1:showSwitch.showCountryList=0;var cardType=parseInt(touristData.cardType);1==cardTypeList.length&&0==cardTypeList[0].value?2==pageDataObj.operationFlag?"0"==cardTypeList[0].value?showSwitch.showCardType=0:showSwitch.showCardType=1:showSwitch.showCardType=0:showSwitch.showCardType=1;var noCardNumList=[0,999];_.indexOf(noCardNumList,+cardType)==-1?showSwitch.showCardNum=1:showSwitch.showCardNum=0;var noCardValid=[0,1,3,7,8,6,9,10,999];_.indexOf(noCardValid,cardType)==-1?showSwitch.showCardValid=1:showSwitch.showCardValid=0;var noBirthdayList=[0,1,9,999];_.indexOf(noBirthdayList,cardType)==-1?showSwitch.showBirthday=1:showSwitch.showBirthday=0,2==pageDataObj.operationFlag&&0==touristData.birthDateModify&&_.indexOf([1,9],cardType)==-1&&(showSwitch.showBirthday=1);var noSexList=[0,1,9,999];_.indexOf(noSexList,cardType)==-1?showSwitch.showSex=1:showSwitch.showSex=0,pageDataObj.internationalRoute&&999!=cardType?showSwitch.showGiveLater=1:showSwitch.showGiveLater=0;var selectedAir=Backbone.app.get("selectedAir"),sankeAirplane=function(selectedAir){return _.some(selectedAir,function(item){return item&&21==item.type})}(selectedAir);return 2==touristData.userStatus.chinesePingyinName&&sankeAirplane&&!pageDataObj.internationalRoute?showSwitch.showPingyin=1:showSwitch.showPingyin=0,_.isEmpty(this.get("visaTypes"))||4!=cardType?(showSwitch.showSignType=0,showSwitch.showSignAddr=0):(showSwitch.showSignType=1,2==this.get("signType")?showSwitch.showSignAddr=1:showSwitch.showSignAddr=0),showSwitch.showSaveCommon=!0,this.set("showSwitch",showSwitch),showSwitch},setVisaResName:function(data){var type=this.get("type");_.each(data,function(item){var adultRule=item.adultResourceCount&&item.adultResourceCount!=item.adultNum,childRule=item.childResourceCount&&item.childResourceCount!=item.childNum;item.show=!1,item.selected=!1,item.type=type,(adultRule&&"adult"==type||childRule&&"child"==type)&&(item.show=!0),(!adultRule&&"adult"==type||!childRule&&"child"==type)&&(item.selected=!0)}),this.set("visaResName",data,{silent:!0}),this.trigger("needRender")},getSendData:function(visaMaterialData,flag){var touristData=this.toJSON(),showSwitch=this.get("showSwitch"),returnData={};if(returnData.name=touristData.name,returnData.isChild=touristData.isChild,returnData.isFreeChild=touristData.isFreeChild,(showSwitch.showMobile&&touristData.mobileNo||flag)&&touristData.intlCode&&touristData.mobileNo&&(returnData.intlCode=touristData.intlCode,returnData.mobileNo=touristData.mobileNo,returnData.intlTel=touristData.intlCode+touristData.mobileNo,returnData.telCountryId=touristData.telCountryId),visaMaterialData&&visaMaterialData.hasVisaMaterial){var companyCode=visaMaterialData.companyCode,companyName=visaMaterialData.companyName;touristData.companyCode=companyCode,touristData.companyName=companyName}if(returnData.cardType=touristData.cardType,showSwitch.showCardNum&&(returnData.cardNo=touristData.cardNo),returnData.cardId=0,!touristData.isFavor||touristData.cardType==touristData.originCardType&&touristData.cardNo==touristData.originCardNo||(returnData.cardId=touristData.cardId),(showSwitch.showEnglishName||showSwitch.showPingyin)&&(returnData.englishFirstName=touristData.englishFirstName,returnData.englishLastName=touristData.englishLastName),(showSwitch.showBirthday||0==touristData.cardType||999==touristData.cardType)&&(returnData.birthDate=touristData.birthDate),showSwitch.showCardValid){var year=touristData.cardValidDate_year,month=touristData.cardValidDate_month,day=touristData.cardValidDate_day,cardValidDate=year+"-"+this.getTwoBitsString(month)+"-"+this.getTwoBitsString(day);returnData.cardValidDate=cardValidDate}if(returnData.country=touristData.country,showSwitch.showSex&&(returnData.sex=touristData.sex),returnData.isTicketer=touristData.isTicketer,touristData.personId?returnData.personId=touristData.personId:"",returnData.resource=touristData.resource,showSwitch.showSignType&&(pageDataObj.isMacLine?returnData.macvisaType=this.get("signType"):returnData.hkvisaType=this.get("signType"),this.get("nowInputSignAddr")?returnData.hkmacIssueOrgan=this.get("signAddr"):returnData.signAddr=""),showSwitch.showHeight&&(returnData.heightIndex=touristData.heightIndex),showSwitch.showVisaUser){var visaArr=[];_.each(touristData.visaResName,function(item){item.selected&&visaArr.push(item.resId)}),returnData.visaResNames=visaArr}return returnData.cruise=touristData.cruise,returnData.needSaveCommon=touristData.needSaveCommon,returnData},getTwoBitsString:function(num){return num+="",1==num.length?"0"+num:num},getCountryList:function(charset){var countrylist=pageDataObj.countries||[],returnData={msg:"输入中英文代码搜索或↑↓选择",charset:charset,countrylist:[]},realCharset=charset.trim().toLowerCase(),expressionEnglish=new RegExp("^[A-Za-z]+$"),expressionChinese=new RegExp("^[一-龥]+$");if(charset)if(expressionEnglish.test(charset)){var returnList=[];_.each(countrylist,function(oneCountry){var englishName=oneCountry.englishName.toLowerCase();0==englishName.indexOf(realCharset)&&returnList.push(oneCountry)}),returnList.length?(returnData.countrylist=returnList,returnData.msg="正在检索"+charset):returnData.msg="对不起,找不到"+charset}else if(expressionChinese.test(charset)){var returnList=[];_.each(countrylist,function(oneCountry){var englishName=oneCountry.name;0==englishName.indexOf(realCharset)&&returnList.push(oneCountry)}),returnList.length?(returnData.countrylist=returnList,returnData.msg="正在检索"+charset):returnData.msg="对不起,找不到"+charset}else returnData.msg="对不起,找不到"+charset;else returnData.countrylist=countrylist;return returnData},selectLastName:function(index){var baseChinsesName=this.get("basechineseName");baseChinsesName&&baseChinsesName.lastName&&_.each(baseChinsesName.lastName,function(oneName,_index){_index==index?oneName.select=1:oneName.select=0}),this.set("basechineseName",baseChinsesName)},setSignType:function(val){this.set("signType",val)},checkSignAddr:function(val){return""==val?2:1},setSignAddr:function(val){this.set("signAddr",val,{silent:!0})},laterInputSignAddr:function(){this.set("nowInputSignAddr",!1)},nowInputSignAddr:function(){this.set("nowInputSignAddr",!0)},saveCommon:function(){var needSaveCommon=this.get("needSaveCommon");this.set("needSaveCommon",!needSaveCommon)},cancelThis:function(resId){var visaResName=this.get("visaResName");this.get("type");_.each(visaResName,function(item){item.resId==resId&&(item.selected=0)}),this.trigger("needRender")},calculaVisaCount:function(thisIndex,resId){var type=this.get("type");eventBus.trigger("calculaVisaCount",{cid:this.cid,thisIndex:thisIndex,resId:resId,type:type})},selectVisa:function(thisIndex,flag,type){var visaResName=this.get("visaResName");visaResName[+thisIndex].selected=flag,flag&&(visaResName[+thisIndex].error=""),this.set("visaResName",visaResName),this.trigger("needRender")},checkSpecialName:function(name){var flag=1;return name=name||"",name.indexOf("先生")>-1?flag=2:name.indexOf("女士")>-1?flag=3:name.indexOf("小姐")>-1?flag=4:name.indexOf("男士")>-1&&(flag=5),flag},checkHasHeight:function(data){var flag=!1;return+data.heightIndex&&(flag=!0),flag},showVisaError:function(index,count){var visaResNames=this.get("visaResName");_.each(visaResNames,function(item,i){i==index&&(item.error="请选择"+count+"位签证使用人")}),this.trigger("needRender")},clearVisaError:function(index){var visaResNames=this.get("visaResName");_.each(visaResNames,function(item,i){i==index&&(item.error="")}),this.trigger("needRender")}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(54)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,Favor){return Backbone.Collection.extend({model:Favor,initialize:function(){},checkIsRepeat:function(data){var flag=!1;return _.some(this.models,function(model,index){if(model.toJSON().uid!=data.uid)return flag=!model.checkIsOnePeople(model.toJSON(),data),flag?model.unselect():"",flag}),flag},selectDefault:function(){_.each(this.models,function(item,index){item.toJSON().isSelected&&item.setDefaultFavor(index)})}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(5),__webpack_require__(6)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,eventBus,config){function checkCard(infoData,conditions){var cardLimit=conditions.acceptableIDCardType,valid=!0;return cardLimit&&(valid=_.some(cardLimit.split(","),function(limit){return CardValueMap[limit]==infoData.cardType})),valid?1:3}function checkBirthDay(infoData,conditons,deadline){var d,delta,condition=conditons.passengerAgeLimit,typeCondition=conditons.applicableTravelerCategory,year=infoData.birthYear,month=infoData.birthMonth,date=infoData.birthDate,valid=!0;return 0==year||0==month||0==date?1:(d=new Date(year,month-1,date),delta=getDeltaAge(d,deadline).year,typeCondition&&(typeCondition=typeCondition.split(","),valid=_.some(typeCondition,function(ptype){if("成人"==ptype&&delta>=12||"儿童"==ptype&&delta<12)return!0}),!valid)?2:(condition&&(valid=_.some(condition,function(range){return range=range.split("-"),delta>=range[0]&&delta<=range[1]})),valid?1:4))}function getDeltaAge(birth,end){var tempDate,startDate=birth.getDate(),startMonth=birth.getMonth(),startYear=birth.getFullYear(),endDate=end.getDate(),endMonth=end.getMonth(),endYear=end.getFullYear(),deltaDate=endDate-startDate;deltaDate<0&&(tempDate=new Date(endYear+"/"+(endMonth+1)+"/1"),tempDate.setDate(0),deltaDate+=tempDate.getDate(),endMonth-=1,endMonth<0&&(endYear-=1));var deltaMonth=endMonth-startMonth;deltaMonth<0&&(deltaMonth+=12,endYear-=1);var deltaYear=endYear-startYear;return deltaYear<0&&(deltaYear=0),{year:deltaYear||0,month:deltaMonth||0,date:deltaDate||0}}var pageDataObj=config.pageDataObj,CardValueMap={"身份证":1,"护照":2,"军官证":3,"港澳通行证":4,"台胞证":7,"户口簿":9,"出生证明":10,"回乡证":11};return Backbone.Model.extend({defaults:function(){return{name:"",psptType:1,psptId:"",birthday:"",isUserClick:1}},initialize:function(){this.set({favorType:this.getType()})},beforeSelect:function(flag){eventBus.trigger("beforeSelectFavor",this,flag)},select:function(pass){this.selected||(this.selected=!0,this.relPass=pass,this.trigger("select"))},beforeUnselect:function(){eventBus.trigger("beforeUnselectFavor",this)},unselect:function(){this.selected&&(this.selected=!1,this.relPass=null,this.trigger("unselect"))},disable:function(){this.__disabled=!0,this.trigger("disabled")},isDisabled:function(){return this.__disabled},addCondition:function(conditions,deadline){this.__conditions=conditions,this.deadline=new Date(deadline.replace(/\-/g,"/")),this.checkCondition()},checkCondition:function(){var conditions=this.__conditions||{},infoData=this.toJSON(),isValid=1;1===isValid&&(isValid=checkCard(infoData,conditions)),1===isValid&&(isValid=checkBirthDay(infoData,conditions,this.deadline)),this.limitType=isValid,1!==isValid&&this.disable()},getType:function(){var favorType="adult",infoData=this.toJSON();if(2!=pageDataObj.operationFlag||infoData.birthDate){if(infoData.birthDate){var b=infoData.birthDate,d=new Date(b),maxChildAge=Backbone.app.get("maxChildAge"),maxAgeFlag=new Date-d.setFullYear(d.getFullYear()+maxChildAge);maxAgeFlag<0&&(favorType="child")}}else 1==infoData.touristType&&(favorType="child");return favorType},getCanSelectFlag:function(){var infoData=this.toJSON(),canSelect=1;if(infoData.birthDate){var b=infoData.birthDate,d=new Date(b),minChildAge=Backbone.app.get("minChildAge"),ageFlag=new Date-d.setFullYear(d.getFullYear()+minChildAge);ageFlag<0&&(canSelect=!1)}return canSelect},getLimitMsg:function(){var limitType=this.limitType,conditions=this.__conditions,msg="";switch(limitType){case 2:msg="不符合该产品仅支持"+conditions.applicableTravelerCategory+"的购票要求。";break;case 3:msg="不符合该产品仅支持"+conditions.acceptableIDCardType+"的购票要求。";break;case 4:msg="不符合该产品仅支持"+conditions.passengerAgeLimit.replace(/\,/g,"和")+"的购票要求。"}return msg},checkIsOnePeople:function(data1,data2){var arr1=this.pickOutNoModifyData(data1),arr2=this.pickOutNoModifyData(data2);return!_.isEqual(arr1,arr2)},pickOutNoModifyData:function(data){var arr=[];return _.each(pageDataObj.checkInfo,function(item,index){arr.push(data[item])}),arr},setDefaultFavor:function(i){this.trigger("setDefaultFavors",i)},getIsLimitTourist:function(){var arr1=[],checkInfo=pageDataObj.checkInfo,data=this.toJSON(),limitData=pageDataObj.orderTouristList;return _.each(checkInfo,function(item,index){arr1.push(data[item])}),_.some(limitData,function(item){var arr=[];return _.each(checkInfo,function(value,index){arr.push(item[index])}),_.isEqual(arr1,arr)})}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(14),__webpack_require__(5),__webpack_require__(9),__webpack_require__(8),__webpack_require__(6)],__WEBPACK_AMD_DEFINE_RESULT__=function($,EventBus,Backbone,_,_config){var pageDataObj=_config.pageDataObj;return Backbone.Model.extend({defaults:function(){return{invoiceListInfo:void 0,isShowReceiptAddress:!1,isShowContactInfo:!1,isNeedReceipt:!1,isShowSpecialInfo:!1,invoiceListInfo:[],receiptAddress:void 0,list:[],isShowInput:!1,receiptMethod:void 0,receiptType:void 0,receiptContent:void 0,receiptTitle:"",contactInfo:void 0,specialReceiptInfo:void 0,identificationNumber:0,receipRAddress:"",registerPhone:"",registerBank:"",bankAccount:"",contactPhone:pageDataObj.userInfo&&pageDataObj.userInfo.tel||"",contactEmail:pageDataObj.userInfo&&pageDataObj.userInfo.email||"",canShouMore:!1,receiptEntityType:2,receiptTitleList:pageDataObj.receiptLists||[],custLevel:pageDataObj.custLevel,isBlackCard:pageDataObj.isBlackCard&&(1==pageDataObj.proType||2==pageDataObj.proType||8==pageDataObj.proType||10==pageDataObj.proType)}},initialize:function(){var self=this;this.set("isShowContactInfo",!0),this.set("invoiceListInfo",pageDataObj.invoiceListInfo),_.each(pageDataObj.invoiceListInfo.invoice_method,function(item,index){2==item.paramValue&&self.set("receiptMethod",item)}),_.each(pageDataObj.invoiceListInfo.guest_invoice_type,function(item,index){2==item.paramValue&&self.set("receiptType",item)}),_.each(pageDataObj.invoiceListInfo.invoice_contents,function(item,index){2==item.paramValue&&self.set("receiptContent",item)}),this.on("needReceipt",function(isNeedReceipt){self.needReceipt(isNeedReceipt)})},needLogin:function(){EventBus.trigger("openLogin")},validatorAll:function(data){var isPass=!0,receipInfo=this.toJSON();if(!receipInfo.isNeedReceipt)return isPass;if(2==receipInfo.receiptMethod.paramValue){var partten=/^1[3,5,7,8]\d{9}$/;receipInfo.contactPhone&&partten.test(receipInfo.contactPhone)||(isPass=!1)}else if(receipInfo.receiptAddress||(isPass=!1),1==receipInfo.receiptType.paramValue){receipInfo.receipRAddress&&receipInfo.registerPhone&&receipInfo.registerBank&&receipInfo.bankAccount&&receipInfo.identificationNumber||(isPass=!1);var parttenId=/^[0-9A-Za-z]]{15,20}$/;parttenId.test(receipInfo.identificationNumber)||(isPass=!1)}if(2==receipInfo.receiptType.paramValue&&2==receipInfo.receiptEntityType){receipInfo.identificationNumber&&receipInfo.receiptTitle||(isPass=!1);var parttenId=/^[A-Za-z0-9]{15,20}$/;parttenId.test(receipInfo.identificationNumber)||(isPass=!1)}return isPass||this.trigger("validatorAll"),isPass},init:function(data){var self=this,hasDefaultAddress=!1;_.some(data,function(item){if(item.isDefault)return item.selected=!0,self.setReceiptAddress(item),hasDefaultAddress=!0,!0}),!hasDefaultAddress&&data instanceof Array&&data[0]&&(data[0].selected=!0,self.setReceiptAddress(data[0])),this.set("list",data)},setReceiptMethod:function(targetValue){var self=this;_.each(pageDataObj.invoiceListInfo.invoice_method,function(item,index){item.paramValue==targetValue&&self.set("receiptMethod",item)}),this.reset(),2==targetValue?(this.set("isShowContactInfo",!0),this.setReceiptType(2)):this.set("isShowReceiptAddress",!0),1==targetValue&&1==this.get("receiptType").paramValue&&this.set("isShowSpecialInfo",!0),this.trigger("needRender"),this.changeReceiptDeliveryFee()},changeReceiptDeliveryFee:function(custLevel){if(!custLevel)var custLevel=pageDataObj.custLevel;this.get("isNeedReceipt")&&this.get("receiptMethod")&&1==this.get("receiptMethod").paramValue&&!custLevel&&!this.get("isBlackCard")?EventBus.trigger("changeReceiptDeliveryFee",1):EventBus.trigger("changeReceiptDeliveryFee",0)},setReceiptEntityType:function(ReceiptEntityType){this.set("receiptEntityType",ReceiptEntityType),this.trigger("needRender")},setReceiptType:function(targetValue){var self=this;_.each(pageDataObj.invoiceListInfo.guest_invoice_type,function(item,index){item.paramValue==targetValue&&self.set("receiptType",item)}),1==targetValue?this.set("isShowSpecialInfo",!0):this.set("isShowSpecialInfo",!1),this.trigger("needRender")},setReceiptContent:function(targetValue){var self=this;_.each(pageDataObj.invoiceListInfo.invoice_contents,function(item,index){item.paramValue==targetValue&&self.set("receiptContent",item)}),this.trigger("needRender")},setReceiptAddress:function(data){this.set("receiptAddress",data)},needReceipt:function(isNeedReceipt){this.set("isNeedReceipt",isNeedReceipt),this.changeReceiptDeliveryFee()},resetSelectObj:function(i){var list=this.get("list");_.each(list,function(item,index){i==index?item.selected=!0:item.selected=!1}),this.set("receiptAddress",list[i])},deleteAddress:function(i){var list=this.get("list");list=list.slice(0,i).concat(list.slice(i+1,list.length)),this.set("list",list),this.set("isShowInput",!1),this.set("canShouMore",!1),this.trigger("needRender")},openPanel:function(){this.trigger("needRender")},getReceiptTitleList:function(key){var receiptTitleList=this.get("receiptTitleList"),returnList=[];return key?_.each(receiptTitleList,function(oneReceiptTitleList){oneReceiptTitleList&&oneReceiptTitleList.invoice_title&&oneReceiptTitleList.invoice_title.indexOf(key)!=-1&&returnList.push(oneReceiptTitleList)}):_.each(receiptTitleList,function(oneReceiptTitleList){oneReceiptTitleList&&oneReceiptTitleList.invoice_title&&returnList.push(oneReceiptTitleList)}),returnList},resetDefaultAddress:function(i){var list=this.get("list");_.each(list,function(item,index){i==index?item.isDefault=!0:item.isDefault=!1}),EventBus.trigger("resetDefaultAddress",list[i])},addList:function(data,res){var list=this.get("list");list.push({address_id:res.addressId,user_name:data.receiver_name,provinceName:data.provinceName,cityName:data.cityName,address:data.address,tel:data.tel_num,isDefault:0});var isShowSpecialInfo=this.get("isShowSpecialInfo");this.reset(),this.resetSelectObj(list.length-1),this.set("isShowReceiptAddress",!0),this.set("canShouMore",!1),this.set("isShowSpecialInfo",isShowSpecialInfo),this.trigger("needRender")},updateAddress:function(data){var list=this.get("list");_.each(list,function(item){data.addressId==item.address_id&&(item.user_name=data.receiver_name,item.provinceName=data.provinceName,item.cityName=data.cityName,item.address=data.address,item.tel=data.tel_num)}),this.set("updaterAddress",null),this.trigger("needRender")},reset:function(){this.set({isShowInput:!1,isShowReceiptAddress:!1,isShowContactInfo:!1,isShowSpecialInfo:!1,canShouMore:!1})}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),
!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(5)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,EventBus){return Backbone.Model.extend({defaults:{destGroupFlag:!1},initData:function(data){this.set(data,{silent:!0}),this.trigger("needRender")}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),config=__webpack_require__(6),pageDataObj=config.pageDataObj;module.exports=backbone.Model.extend({defaults:{info:"",show:pageDataObj.salerId&&pageDataObj.telNum},initialize:function(){},changeInfo:function(val){this.set("info",val)}})},function(module,exports,__webpack_require__){var Backbone=__webpack_require__(9),config=__webpack_require__(6),tools=__webpack_require__(16),_=__webpack_require__(8),pageDataObj=config.pageDataObj;module.exports=Backbone.Model.extend({defaults:{agree:!1,contractName:"",btnDisabled:!1,operationFlag:pageDataObj.operationFlag,isTeamTour:"",isFastOrder:pageDataObj.isFastOrder,buttonText:"提交订单"},initialize:function(){1!=pageDataObj.form&&1!=pageDataObj.custom||this.set("isTeamTour",!0),2==pageDataObj.operationFlag&&tools.safeEventTrack("出现_底部按钮____提交")},initContract:function(data){var name="";_.isEmpty(data.bookNote)||(name+="预订须知、"),name+="旅游合同、",_.isEmpty(data.addition)||(name+="保险条款、"),_.isEmpty(data.addition)||(name+="保险经纪委托合同及客户告知书、"),_.isEmpty(data.orderNotice)||(name+="特别预订提示、"),name+="安全提示、",name=name.substring(0,name.length-1),this.set("contractName",name),this.trigger("render")},agree:function(){var agree=this.get("agree");this.set("agree",!agree),this.trigger("render")},changeBtnDisabled:function(flag){this.set("btnDisabled",flag),this.trigger("render")},changeBtnText:function(text){this.set("buttonText",text),this.trigger("render")}})},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),_=__webpack_require__(8),config=__webpack_require__(6),pageDataObj=config.pageDataObj;module.exports=backbone.Model.extend({defaults:{index:0},initialize:function(){},init:function(data){this.set(data),_.isEmpty(data.bookNote)&&this.set("index",1)},changeContent:function(index){this.set("index",index),this.trigger("render")},getParam:function(data){data=data||{};var insuranceData=data.insuranceData,obj={productId:pageDataObj.productId,orderId:pageDataObj.orderId,tmpId:pageDataObj.tmpId,type:"json",productName:pageDataObj.productName,childNum:pageDataObj.childNum,adultNum:pageDataObj.adultNum,freeChildNum:pageDataObj.freeChildNum,departDate:pageDataObj.departDate,departCityCode:pageDataObj.departCity,selectInSurance:insuranceData,departCityName:pageDataObj.departCityName,journeyId:pageDataObj.journeyId,version:2};return obj}})},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),eventBus=__webpack_require__(5),config=__webpack_require__(6),pageDataObj=config.pageDataObj,tools=__webpack_require__(16);module.exports=backbone.Model.extend({defaults:{netOrderFlag:{airplane:{flag:!1,info:""},cruise:{flag:!1,info:""},hotel:{flag:!1,info:""},addition:{flag:!1,info:""}}},initialize:function(){},saveSign:function(data){eventBus.trigger("needSign",data)},checkPaySwitch:function(data){eventBus.trigger("checkPaySwitch",data)},setNetOrderFlag:function(module,flag,msg){var netOrderFlag=this.get("netOrderFlag"),obj=netOrderFlag[module];obj.flag=flag,obj.info=msg},getPostData:function(data){function checkAllInList(){return 7==pageDataObj.proMode&&airplaneData.isFromOrder&&!airplaneData.isInList?(postData.memo="客人新增机票资源查询不到，系统未发起占位",!1):2==pageDataObj.proMode&&trainData.isFromOrder&&!trainData.isInList?(postData.memo="客人新增火车票资源查询不到，系统未发起占位",!1):3==pageDataObj.proMode&&busData.isFromOrder&&!busData.isInList?(postData.memo="客人新增汽车票资源查询不到，系统未发起占位",!1):!(multiTransportData.isCombinedTransport&&multiTransportData.isFromOrder&&!multiTransportData.isInList)||(postData.memo="客人新增联运资源查询不到，系统未发起占位",!1)}var self=this;data=data||{};var productData=data.productData,priceCalculateData=data.priceCalculateData,airplaneData=data.airplaneData,trainData=data.trainData,busData=data.busData,multiTransportData=data.multiTransportData,transportData=data.transportData,hotelsData=data.hotelsData,busPlaceData=data.busPlaceData,roomAddBudgetData=data.roomAddBudgetData,additionRequiredData=data.additionRequiredData,recommendData=data.recommendData,additionOptionalData=data.additionOptionalData,updateSchemeData=data.updateSchemeData,insuranceData=data.insuranceData,favourableData=data.favourableData,deliveryAddressData=data.deliveryAddressData,contactData=data.contactData,isRegister=data.isRegister,touristsData=data.touristsData,hasForeignOrOld=data.hasForeignOrOld,receiptData=data.receiptData,visaMaterialData=data.visaMaterialData,remarkData=data.remarkData,trafficData=data.trafficData,packageData=data.packageData,transportTimeFlag=data.transportTimeFlag,cruiseData=data.cruiseData,postData={};postData.version=2,postData.routeId=productData.productId,postData.adultNum=productData.adultNum,postData.childrenNum=productData.childNum,postData.freeChildNum=productData.freeChildNum,postData.departDate=productData.departDate,postData.fromUrl=document.referrer,postData.departCity=productData.departCity,postData.departCityName=productData.departCityName,postData.backCity=productData.backCity,postData.backCityName=productData.backCityName,postData.orderId=productData.orderId,postData.tmpId=data.tmpId,postData.resParams=data.resParams,postData.endTime=pageDataObj.endTime,postData.isRegister=isRegister,postData.telNum=pageDataObj.telNum,postData.orderType=pageDataObj.orderType;var resource={};if(trafficData&&!_.isEmpty(trafficData.selectAir)&&(airplaneData=trafficData.selectAir),airplaneData){var isTs=self.getAirplaneTs(airplaneData.listData);resource.resourceFlightTicket=[];var flightLock=0,flightLockId=null;_.each(airplaneData.listData,function(item,index){var airType=item.airType,resType=item.resType;if(!("self_tour2"==pageDataObj.pageType&&isTs&&"1"==pageDataObj.mainResParams.checkResFaild&&(self.setNetOrderFlag("airplane",!0,"团散机票验舱验价失败转网络单"),21==resType)||flightLockId&&item.resId==flightLockId)){if(1==airType&&(flightLockId=item.resId),1==flightLock)return flightLock=0;2==airType&&(flightLock=1);var formatFlightInfo={resType:item.resType,resName:"",resourceId:item.resId,externalInfo:null==item.externalInfo?"":item.externalInfo,adultCount:productData.adultNum,childCount:productData.childNum,startDate:item.departDate,flightNo:item.flightNo,airType:airType,price:2==airType?item.totalPrice:item.price,childPrice:2==airType?item.totalChildPrice:item.childPrice,journeyId:item.journeyId};item.isInternational?_.isEmpty(airplaneData.resIds)?formatFlightInfo.checkedResids={}:formatFlightInfo.checkedResids=airplaneData.resIds[index]:formatFlightInfo.extraInfo=item.extraInfo,item.solutionId&&(formatFlightInfo.solutionId=item.solutionId),item.stockType&&(formatFlightInfo.stockType=item.stockType);var sameRes=_.filter(resource.resourceFlightTicket,function(cell){return cell.resourceId==item.resId});_.isEmpty(sameRes)&&resource.resourceFlightTicket.push(formatFlightInfo)}})}if(trafficData&&!_.isEmpty(trafficData.selectTrain)&&(trainData=trafficData.selectTrain),trainData&&(resource.resourceTrainTickets=_.map(trainData,function(trainData){var price,startDate;return price=trainData.price,startDate=trainData.departDate,{resType:8,resName:"",resourceId:price.resId,adultCount:productData.adultNum,normalChildCount:productData.normalChildNum,adultPrice:price.adultPrice,normalChildPrice:price.normalChildPrice,startDate:startDate}})),trafficData&&!_.isEmpty(trafficData.selectBus)&&(busData=trafficData.selectBus),busData&&!_.isEmpty(busData.listData)&&(resource.resourceBus={},resource.resourceBus.subResType=busData.resType,resource.resourceBus.selectBusPkgFlag=busData.selectBusPkgFlag?1:0,resource.resourceBus.isNew=busData.isNew?1:0,resource.resourceBus.isCheckFailed=busData.isCheckFailed?1:0,resource.resourceBus.listData=busData.listData?_.map(busData.listData,function(item){return{resId:item.resId,busStopId:item.busStopId,departCityCode:item.dptRegionCode,departCityName:item.dptRegionName,destCityCode:item.dstRegionCode,destCityName:item.dstRegionName,departDate:item.departDate,departTime:item.dptTime,departStopName:item.departStopName,isIndividualBus:item.isPack?0:1,ticketType:item.ticketType,isPresell:item.preSale?1:0,vendorIds:item.vendorIdList,depStation:item.dptStation,depStationCode:item.dptStationCode,depStopAddress:item.dptStationAddress,dstStation:item.dstStation,dstStationCode:item.dstStationCode,dstStationAddress:item.dstStationAddress,scheduleId:item.scheduleId,costTime:item.costTime,adultPrice:item.price,childPrice:item.price}}):[]),trafficData&&!_.isEmpty(trafficData.selectMultiTransport)&&(multiTransportData=trafficData.selectMultiTransport),multiTransportData&&_.each(multiTransportData.list,function(item,index){if(item&&item.isSelected){var o;if(1==item.transportType){if(0!=index&&2==item.airType)return!1;o={resType:item.resType,resName:"",resourceId:item.resId,extraInfo:item.extraInfo,externalInfo:null==item.externalInfo?"":item.externalInfo,adultCount:multiTransportData.person[item.transportType].adultNum,childCount:multiTransportData.person[item.transportType].childNum,startDate:item.departDate,flightNo:item.flightNo,airType:item.airType},item.solutionId&&(o.solutionId=item.solutionId),item.stockType&&(o.stockType=item.stockType),resource.combinedFlightTicket=resource.combinedFlightTicket||[],resource.combinedFlightTicket.push(o)}else o={resType:8,resName:"",resourceId:item.resId,adultCount:multiTransportData.person[item.transportType].adultNum,normalChildCount:multiTransportData.person[item.transportType].childNum,adultPrice:item.adultPrice,normalChildPrice:item.normalChildPrice,startDate:item.departDate},resource.combinedTrainTicket=resource.combinedTrainTicket||[],resource.combinedTrainTicket.push(o)}}),transportTimeFlag&&(postData.transportTimeFlag=transportTimeFlag),transportData&&(resource.resourceTransport=[],transportData.price)){var _transPortCell={journeyId:transportData.journeyId,resId:transportData.resId,adultPrice:transportData.price,conCityCode:transportData.conCityCode,conCityName:transportData.conCityName};resource.resourceTransport.push(_transPortCell)}cruiseData&&(postData.checkRoom=cruiseData.checkRoom,postData.cruiseVendorId=data.cruiseVendorId),_.isEmpty(hotelsData)||(resource.resourceHotelRoom=_.map(hotelsData,function(item){var hotel=item.hotel,room=hotel.room,result={};if(result.journeyId=hotel.journeyId,result.startDate=hotel.departDate,result.endDate=hotel.backDate,result.hotelId=hotel.hotelId,result.isIndividualHotel=hotel.hotelType,result.hotelType=hotel.hotelType,hotel.hotelType){var plan=room&&room.ratePlan;plan&&(result.roomId=room.roomId,result.resourceId=item.resId,result.resName=plan.ratePlanName,result.adultCount=plan.roomCount,result.price=plan.priceList,result.vendorResId=plan.vendorResId,result.vendorId=plan.vendorId,result.resourceHotelRoom={hotelChineseName:hotel.chineseName,hotelEnglishName:hotel.englishName,roomName:plan.ratePlanName,bedName:plan.bedType,breakfastNum:plan.breakfastNum,starName:hotel.starName,network:plan.network,gift:plan.gift},result.cancelTime=tools.transformNull(item.cancelTime),result.isJibao=plan.isJiBao)}else result.resourceId=room.roomId,result.resName=room.name,result.adultCount=room.roomCount,result.price=room.priceList;return result})),resource.resourcePackage=[],packageData&&_.each(packageData.selectPackage,function(item){var resData={resId:item.resId};resource.resourcePackage.push(resData)}),postData.busPlace=this.formatBusPlace(busPlaceData),roomAddBudgetData&&(resource.resourceRoomCharge=[],roomAddBudgetData&&roomAddBudgetData.length&&_.each(roomAddBudgetData,function(item){resource.resourceRoomCharge=item.resId,postData.dfcType=parseInt(item.type)+1}));var qz=tools.getTypeByCode("qz"),mp=tools.getTypeByCode("mp"),ddwl=tools.getTypeByCode("ddwl"),notAdditionTypes=[qz,mp,ddwl],additionData=_.filter(additionRequiredData,function(item){return _.indexOf(notAdditionTypes,item.subType)==-1}).concat(_.filter(additionOptionalData,function(item){return _.indexOf(notAdditionTypes,item.subType)==-1}));_.isEmpty(additionData)||(resource.resourceAddService=[],_.each(additionData,function(item){resource.resourceAddService.push({resId:item.resId,subType:item.resSubType,num:item.adultSelect?item.adultResourceCount:0,childNum:item.childSelect?item.childResourceCount:0,price:item.adultPrice,childPrice:item.childPrice,use_time:item.departDate,endDate:item.isWifiByDay?pageDataObj.backDate:""})}));var visaData=_.filter(additionRequiredData,function(item){return item.subType==qz}).concat(_.filter(additionOptionalData,function(item){return item.subType==qz}));resource.resourceVisa=[],_.each(visaData,function(item){resource.resourceVisa.push({resId:item.resId,resName:item.resName,adultNum:item.adultSelect?item.adultResourceCount:0,childrenNum:item.childSelect?item.childResourceCount:0})}),_.isEmpty(pageDataObj.visaData)||_.each(pageDataObj.visaData,function(item){resource.resourceVisa.push({resId:item.resId,resName:item.resName})});var ticketData=_.filter(additionRequiredData,function(item){return item.subType==mp}).concat(_.filter(additionOptionalData,function(item){return item.subType==mp}));resource.resourceTicket=_.isEmpty(ticketData)?[]:_.map(ticketData,function(item){var resInfo=item.resInfo,o={bookNotice:resInfo.bookNotice,isLowest:item.isLowest,isTouristName:resInfo.isTouristName,isTouristPhone:resInfo.isTouristPhone,limitMax:resInfo.limitMax,limitMin:resInfo.limitMin,name:resInfo.name,needPsptId:resInfo.touristCertificateType?1:0,playTimeList:item.resourceDatePrices,play_time:item.resourceDatePrices[item.selectDate].departDate,price:item.resourceDatePrices[item.selectDate].price,resId:item.resId,selectNum:item.adultResourceCount,spotCode:resInfo.spotCode,spotName:resInfo.spotName,ticketName:resInfo.name};return o});var localData=_.filter(additionRequiredData,function(item){return item.subType==ddwl}).concat(_.filter(additionOptionalData,function(item){return item.subType==ddwl}));if(resource.resourceLocal=_.isEmpty(localData)?[]:_.map(localData,function(item){var o=_.clone(item),price=o.resourceDatePrices[item.selectDate];return o.use_time=price.departDate,o.useTimeList=o.resourceDatePrices,o.price=price.price,o.childPrice=price.childPrice,o.adultCount=1==o.adultSelect?o.adultResourceCount:0,o.childCount=1==o.childSelect?o.childResourceCount:0,o.resInfo=null,o}),recommendData){resource.transferFlightInfo=[];var recommendBaseInfo=recommendData.recommendData,recommendAirplaneData=recommendData.airplaneData,pickupInfo=recommendData.pickupInfo,pickupAddress=recommendData.pickupAddress,deliveryInfo=recommendData.deliveryInfo,deliveryAddress=recommendData.deliveryAddress;pickupInfo&&pickupAddress&&resource.transferFlightInfo.push({type:1,vehicleGroupCode:pickupInfo.vehicleGroupInfo.vehicleGroupCode,totalPrice:pickupInfo.totalPrice,supplierCode:pickupInfo.suppilerInfo.supplierCode,cancelDeadLine:pickupInfo.cancelDeadLine,distance:pickupInfo.distance,estTime:pickupInfo.estTime,priceMark:pickupInfo.priceMark,payDeadLine:pickupInfo.payDeadLine,vendorCode:pickupInfo.vendorCode,useTime:recommendData.pickupTime,flightNumber:recommendAirplaneData.arriveFlightNo,poiCityName:recommendBaseInfo.pickupCityName,poiName:pickupAddress.name,poiAddress:pickupAddress.address,poiLongitude:pickupAddress.poiInfo.lng,poiLatitude:pickupAddress.poiInfo.lat,poiCityCode:productData.backCity,airportCode:recommendAirplaneData.destinationAirportCode,terminalCode:recommendAirplaneData.arrivalAirportTerminal}),deliveryInfo&&deliveryAddress&&resource.transferFlightInfo.push({type:2,vehicleGroupCode:deliveryInfo.vehicleGroupInfo.vehicleGroupCode,totalPrice:deliveryInfo.totalPrice,supplierCode:deliveryInfo.suppilerInfo.supplierCode,cancelDeadLine:deliveryInfo.cancelDeadLine,distance:deliveryInfo.distance,estTime:deliveryInfo.estTime,priceMark:deliveryInfo.priceMark,payDeadLine:deliveryInfo.payDeadLine,vendorCode:deliveryInfo.vendorCode,useTime:recommendData.deliveryTime,flightNumber:recommendAirplaneData.departFlightNo,poiCityName:recommendBaseInfo.deliveryCityName,poiName:deliveryAddress.name,poiAddress:deliveryAddress.address,poiLongitude:deliveryAddress.poiInfo.lng,poiLatitude:deliveryAddress.poiInfo.lat,poiCityCode:productData.backCity,airportCode:recommendAirplaneData.destinationAirportCode,terminalCode:recommendAirplaneData.arrivalAirportTerminal})}if(resource.resourceTour=[],updateSchemeData&&updateSchemeData.length&&_.each(updateSchemeData,function(item){resource.resourceTour.push(item.resId)}),resource.resourceInsurance={},insuranceData&&insuranceData.length&&_.each(insuranceData,function(item){resource.resourceInsurance[item.resId]=item.airRange}),postData.promotionList=this.formatPromotion(favourableData),postData.voucherCoupon=favourableData.coupon.coupon,postData.travelVoucherCoupon=favourableData.coupon.travleCoupon,deliveryAddressData&&(postData.returnGiftOrderInfo={receiveProvinceCode:deliveryAddressData.provinceCode,receiveProvinceName:deliveryAddressData.provinceName,receiveCityCode:deliveryAddressData.cityCode,receiveCityName:deliveryAddressData.cityName,receiveDistrictCode:"",receiveDistrictName:"",receiveDetailAddress:deliveryAddressData.address,receiveTel:deliveryAddressData.tel,receiveName:deliveryAddressData.user_name,receivePostCode:"",giftSendState:"",giftSendCertificate:""}),postData.contactList=this.formatContact(contactData),postData.hasPassengers=pageDataObj.hasPassengers,postData.passergersData=touristsData,"self_tour2"==pageDataObj.pageType&&(postData.isL=backbone.app.get("isL")),receiptData&&receiptData.isNeedReceipt?(postData.invoiceList=[{receiptMethod:receiptData.receiptMethod,receiptTitle:receiptData.receiptTitle,receiptContent:receiptData.receiptContent,amount:receiptData.amount,receiptType:receiptData.receiptType}],2==receiptData.receiptMethod.paramValue&&(postData.invoiceList[0].contactPhone=receiptData.contactPhone,postData.invoiceList[0].contactEmail=receiptData.contactEmail,postData.invoiceList[0].receiverName=postData.contactList[0].name),1==receiptData.receiptType.paramValue?(postData.invoiceList[0].taxpayerIdentity=receiptData.identificationNumber,postData.invoiceList[0].companyAddress=receiptData.receipRAddress,postData.invoiceList[0].companyTel=receiptData.registerPhone,postData.invoiceList[0].companyBankName=receiptData.registerBank,postData.invoiceList[0].companyBankAccount=receiptData.bankAccount):(postData.invoiceList[0].taxpayerIdentity=receiptData.identificationNumber,postData.invoiceList[0].personalOrEnterprise=receiptData.receiptEntityType,1==receiptData.receiptEntityType&&(postData.invoiceList[0].receiptTitle=contactData.name)),1==receiptData.receiptMethod.paramValue&&(postData.delivery=this.formatDelivery(receiptData.receiptAddress)),postData.invoiceList[0].receiptFee=!!priceCalculateData.priceData.receiptDeliveryFee):(postData.invoiceList=[],postData.delivery={}),visaMaterialData&&visaMaterialData.hasVisaMaterial&&(postData.companyCode=visaMaterialData.companyCode,postData.companyName=visaMaterialData.companyName),postData.resource=resource,postData.groupCost=priceCalculateData.priceData.sumPrice,postData.totalResPrice=data.totalResPrice,remarkData&&(postData.remark=remarkData.info),postData.isNetOrderFlag=pageDataObj.isNetOrderFlag||!1,postData.memo="","back2"==pageDataObj.pageType&&pageDataObj.hasTakeSeat){var adultNum,childNum,normalChildNum,freeChildNum;2==pageDataObj.proMode?(adultNum=productData.adultNum,normalChildNum=productData.normalChildNum,freeChildNum=productData.freeChildNum,(adultNum>pageDataObj.adultNum||normalChildNum>pageDataObj.normalChildNum||freeChildNum>pageDataObj.freeChildNum)&&(postData.isNetOrderFlag=!checkAllInList())):(adultNum=productData.adultNum,childNum=productData.childNum,(adultNum>pageDataObj.adultNum||childNum>pageDataObj.childNum)&&(postData.isNetOrderFlag=!checkAllInList()))}var changeFlightCheckRule=backbone.app.get("changeFlightCheckRule");if(airplaneData&&airplaneData.checkTimes>=3||changeFlightCheckRule&&airplaneData&&airplaneData.isNetOrderFlag||multiTransportData&&multiTransportData.checkTimes>=2){var message="机票验舱验价失败转网络单；";(airplaneData&&airplaneData.checkTimes>=3||changeFlightCheckRule&&airplaneData&&airplaneData.isNetOrderFlag)&&(message+="航班信息：",_.each(airplaneData.listData,function(item,index){message+="第"+(index+1)+"程："+item.airlineName+item.flightNo+"，"+item.departTime+"-"+item.arriveTime+"，预定时价格:"+item.price+"； "})),multiTransportData&&multiTransportData.checkTimes>=3&&(message+="联运机票：",_.each(multiTransportData.listData,function(item,index){message+="第"+(index+1)+"程："+item.airlineName+item.flightNo+"，"+item.departTime+"-"+item.arriveTime+"，预定时价格:"+item.price+"； "})),this.setNetOrderFlag("airplane",!0,message),postData.isNetOrderFlag=!0}postData.hasPregnantOrOld=hasForeignOrOld,hasForeignOrOld&&(postData.isNetOrderFlag=!0,postData.memo="有外籍游客或出游人年龄不符合限制条件。");var netOrderFlag=this.get("netOrderFlag");for(var key in netOrderFlag){var item=netOrderFlag[key];if(item.flag){postData.isNetOrderFlag=!0,postData.memo=item.info;break}}if("self_tour2"==pageDataObj.pageType&&17==pageDataObj.proMode){var isGoNext=!0;if(!_.isEmpty(trafficData.selectAir)&&!_.isEmpty(trafficData.selectAir.listData)&&!_.isEmpty(trafficData.selectTrain)){var allAirFlag=productData.adultNum==pageDataObj.selectAirAdult&&productData.childNum==pageDataObj.selectAirChild,allTrainFlag=productData.adultNum==pageDataObj.selectTrainAdult&&productData.childNum==pageDataObj.selectTrainChild;allAirFlag||allTrainFlag||(postData.isNetOrderFlag=!0,isGoNext=!1,postData.memo="出游人数与资源份数不一致")}if(!_.isEmpty(trafficData.selectAir)&&!_.isEmpty(trafficData.selectAir.listData)&&isGoNext){var airFlag=productData.adultNum==pageDataObj.selectAirAdult&&productData.childNum==pageDataObj.selectAirChild;airFlag||(postData.isNetOrderFlag=!0,isGoNext=!1,postData.memo="出游人数与机票资源份数成人儿童不一致")}if(!_.isEmpty(trafficData.selectTrain)&&isGoNext){var trainFlag=productData.adultNum==pageDataObj.selectTrainAdult&&productData.childNum==pageDataObj.selectTrainChild;trainFlag||(postData.isNetOrderFlag=!0,postData.memo="出游人数与火车票资源份数成人儿童不一致")}}return postData.journeyId=data.journeyId,postData},formatBusPlace:function(busPlaceData){var busPlaceFormat={};return busPlaceData&&busPlaceData.length&&(busPlaceFormat=busPlaceData[0]),busPlaceFormat},formatPromotion:function(promotion){var returnData=[];return promotion.promotionInfo&&promotion.promotionInfo.length&&_.each(promotion.promotionInfo,function(onePro){var oneFormatPro={promotionId:onePro.campaign_id,promotionType:onePro.type,promotionFlag:onePro.promotionFlag};onePro.resource_id?(oneFormatPro.resourceId=onePro.resource_id,oneFormatPro.campaignType=2):oneFormatPro.campaignType=1,returnData.push(oneFormatPro)}),returnData},formatContact:function(contactData){var formatContactInfo={name:contactData.name,mobile:contactData.mobile,email:contactData.email,intlCode:contactData.intlCode,telCountryId:contactData.telCountryId,intlTel:""+contactData.intlCode+ +contactData.mobile};return contactData.phoneAreaCode&&contactData.phoneCode&&(formatContactInfo.tel=contactData.phoneAreaCode+"-"+contactData.phoneCode),[formatContactInfo]},formatDelivery:function(receiptData){var formatDelivery={};return formatDelivery={receiverName:receiptData.user_name,provinceCode:receiptData.provinceCode,provinceName:receiptData.provinceName,cityCode:receiptData.cityCode,cityName:receiptData.cityName,deliveryEndAddress:receiptData.address,deliveryType:1,telNum:receiptData.tel}},getAirplaneTs:function(listData){var isT=!1,isS=!1;return _.each(listData,function(item){var airType=item.airType;1==airType&&(isT=!0),2!=airType&&3!=airType||(isS=!0)}),isT&&isS}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(14),__webpack_require__(9)],__WEBPACK_AMD_DEFINE_RESULT__=function($,Backbone){return Backbone.Model.extend({defaults:function(){return{reOrderInfo:null}},initialize:function(){},initData:function(data){data&&data.length&&this.set("reOrderInfo",data),this.trigger("render")}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(14),__webpack_require__(9),__webpack_require__(8),__webpack_require__(63),__webpack_require__(17)],__WEBPACK_AMD_DEFINE_RESULT__=function($,Backbone,_,tpl,Layer){return Backbone.View.extend({initialize:function(){this.listenTo(this.model,"render",this.render)},render:function(){var html=tpl(this.model.toJSON()),self=this;self.dialog=$.layer({type:1,guide:2,title:"",closeBtn:[0,0],btns:0,area:["auto","auto"],zIndex:99999999,border:0,page:{html:html},success:function(wrap){wrap=$(wrap),self.contents=wrap,self.cosleBtn=wrap.find(".J_reorder_close"),self.cosleBtn.click(function(){self.close()}),$(window).trigger("resize")}})},close:function(){Layer.close(this.dialog),this.dialog=null}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,reOrderInfo=($utils.$helpers,$data.reOrderInfo),lastOrderInfo=$data.lastOrderInfo,$escape=$utils.$escape,i=$data.i,oneOrder=$data.oneOrder,$out="";if(reOrderInfo&&reOrderInfo.length){$out+='\r\n<div class="check_order" id="J_reorder">\r\n    <header class="float-header">\r\n        <h2 class="active">预订提示</h2>\r\n        <span><i class="icon book-close J_reorder_close"></i></span>\r\n    </header>\r\n    <div class="order_list">\r\n\r\n        <div class="order_cont">\r\n            ';var lastOrderInfo=reOrderInfo[0];$out+='\r\n            <p class="order_item pre_tip">您之前已经预订过<span class="order_orange">',$out+=$escape(lastOrderInfo.adult),$out+="成人\r\n                    ",lastOrderInfo.child&&($out+="\r\n                    ",$out+=$escape(lastOrderInfo.child),$out+="儿童\r\n                    "),$out+="\r\n                    ",$out+=$escape(lastOrderInfo.departDate),$out+='出发的本方向产品</span>，订单如下</p>\r\n            <div class="order_table_content">\r\n                <table class="tab_order_item">\r\n                    <tr>\r\n                        <td class="gray w1">订单编号</td>\r\n                        <td class="gray w1">下单时间</td>\r\n                        <td class="gray w2"><span class="td_list">产品名称</span></td>\r\n                        <td class="gray w1">价格</td>\r\n                        <td class="gray w1">订单状态</td>\r\n                        <td class="gray w1">操作</td>\r\n                    </tr>\r\n                    ';for(var i=0;i<reOrderInfo.length;i++){$out+="\r\n                    ";var oneOrder=reOrderInfo[i];$out+='\r\n                    <tr>\r\n                        <td class="w1">',$out+=$escape(oneOrder.orderId),$out+='</td>\r\n                        <td class="w1">\r\n                            <p>',$out+=$escape(oneOrder.timeDate),$out+='</p>\r\n                            <p class="order_link">',$out+=$escape(oneOrder.timeTime),$out+='</p>\r\n                        </td>\r\n                        <td class="w2"><p class="td_list">',$out+=$escape(oneOrder.name),$out+='</p></td>\r\n                        <td class="w1 order_orange">￥',$out+=$escape(oneOrder.price),$out+='</td>\r\n                        <td class="w1">',$out+=$escape(oneOrder.status),$out+='</td>\r\n                        <td class="w1"><a href="',$out+=$escape(oneOrder.detail),$out+=$escape(oneOrder.orderId),$out+='" target="_blank"\r\n                                          class="order_green">查看</a></td>\r\n                    </tr>\r\n                    '}$out+='\r\n                </table>\r\n            </div>\r\n            <p class="order_orange order_tip">· 建议您先查看订单，如需修改订单，请拨打4007-999-999</p>\r\n            <p class="order_btn"><a href="javascript:;" class="J_reorder_close">继续预订</a></p>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}return new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),eventBus=__webpack_require__(5),tpl=__webpack_require__(65);module.exports=backbone.View.extend({el:"#m-header",events:{"click .f-login":"toLogin","click .f-register":"toRegister"},initialize:function(){this.render(),this.listenTo(this.model,"render",this.render)},render:function(){var data=this.model.toJSON(),html=tpl(data);this.$el.html(html).show()},toLogin:function(){eventBus.trigger("openLogin")},toRegister:function(){}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,isLogin=($utils.$helpers,$data.isLogin),$escape=$utils.$escape,name=$data.name,imgName=$data.imgName,pageType=$data.pageType,isTeamTour=$data.isTeamTour,imgName2=$data.imgName2,altStr=$data.altStr,bookStep=$data.bookStep,isFastOrder=$data.isFastOrder,$out="";$out+='<div class="m-login hide">\r\n    <div class="m-login-content">\r\n        <div class="login-and-register">\r\n            ',isLogin?($out+="\r\n            ",$out+=$escape(name),$out+="\r\n            "):$out+='\r\n            您好！请<a href="javascript:;" class="f-login">登录</a>或<a href="javascript:;" class="f-register">注册</a>\r\n            ',$out+='\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="m-content">\r\n    <div class="m-content-back-logo">\r\n        <a id="logo" href="//www.tuniu.com" target="_blank" title="途牛旅游网">\r\n            ';var imgName="logo-tour-order.png";"self_tour2"==pageType&&(imgName="logo-self-tour.png"),"drive_order2"!=pageType&&"drive_routine2"!=pageType||(imgName="logo-drive-order.png"),"cruise2"==pageType&&(imgName="logo-cruise.png"),isTeamTour&&(imgName="logo-team-tour.png"),$out+='\r\n            <img class="tn_logo" src="//img3.tuniucdn.com/img/201707171538/bookOnline/',$out+=$escape(imgName),$out+='" alt="途牛旅游网">\r\n        </a>\r\n    </div>\r\n    <div class="m-content-nav">\r\n        ';var imgName2="process3_1.png",altStr="第一步：填写订单";
return"step1"==bookStep&&(isTeamTour&&(imgName2="team4_1.png",altStr="第一步：填写需求"),isFastOrder&&(imgName2="process2_1.png",altStr="第一步：填写订单"),"cruise2"==pageType&&(imgName2="process4_1.png",altStr="第一步：填写订单")),"step2"==bookStep&&(imgName2="process4_2.png",altStr="第二步：完善出游人"),$out+='\r\n        <img class="tn_logo ',isTeamTour&&($out+=" teamTour "),$out+='"\r\n             src="//img3.tuniucdn.com/img/201510131901/bookOnline/',$out+=$escape(imgName2),$out+='" alt="',$out+=$escape(altStr),$out+='">\r\n    </div>\r\n</div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),tpl=(__webpack_require__(5),__webpack_require__(67)),config=__webpack_require__(6),pageDataObj=config.pageDataObj;module.exports=backbone.View.extend({el:"#m-top-info",events:{},initialize:function(){this.render()},render:function(){var html,data=this.model.toJSON();data.operationFlag=pageDataObj.operationFlag,html=tpl(data),this.$el.html(html).show(),this.whetherNeedScroll()},whetherNeedScroll:function(){var noticeWrapper=this.$el.find(".notice-wrapper");if(noticeWrapper.length){var width=noticeWrapper.width(),contentWidth=noticeWrapper.find(".first").width()-noticeWrapper.find(".content-space").width();contentWidth<=width?(noticeWrapper.find(".notice_content").addClass("static"),noticeWrapper.find(".second").addClass("hide"),noticeWrapper.find(".third").addClass("hide")):(noticeWrapper.find(".notice_content").removeClass("static"),noticeWrapper.find(".second").removeClass("hide"),noticeWrapper.find(".third").removeClass("hide"))}}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,bookStep=($utils.$helpers,$data.bookStep),operationFlag=$data.operationFlag,days=$data.days,$escape=$utils.$escape,needRenderNotice=$data.needRenderNotice,isFastOrder=$data.isFastOrder,headerNotice=$data.headerNotice,isCustom=$data.isCustom,productName=$data.productName,productId=$data.productId,$out="";return"step2"==bookStep&&4!=operationFlag&&($out+='\r\n<div class="step2-panel">\r\n    <p class="title-text">\r\n        <img src="//ssl3.tuniucdn.com/img/201604072050/bookOnline/w-line.png">\r\n        <em>完善出游人信息</em>\r\n        <img src="//ssl3.tuniucdn.com/img/201604072050/bookOnline/w-line.png">\r\n    </p>\r\n\r\n    ',2==operationFlag&&days&&($out+='\r\n    <p class="title-subtitle">为了保证您的正常出游，请在出游前<em>',$out+=$escape(days),$out+="天</em>之前补充完出游信息</p>\r\n    "),$out+="\r\n</div>\r\n"),$out+="\r\n\r\n",needRenderNotice&&!isFastOrder&&($out+='\r\n<div class="notice_top_header">\r\n    <span class="icon notice2-icon"></span>\r\n    <div class="notice-wrapper">\r\n\t\t\t<span class="notice_content">\r\n\t\t\t\t<span class="first">',$out+=$escape(headerNotice),$out+='<span class="content-space"></span></span>\r\n                <span class="second">',$out+=$escape(headerNotice),$out+='<span class="content-space"></span></span>\r\n                <span class="third">',$out+=$escape(headerNotice),$out+='<span class="content-space"></span></span>\r\n\t\t\t</span>\r\n    </div>\r\n</div>\r\n'),$out+="\r\n\r\n","1"==isCustom&&($out+='\r\n   <div class="product-info">\r\n        <p class="product-name"><i class="icon name-icon"></i>',$out+=$escape(productName),$out+='</p>\r\n        <p class="product-num">编号：',$out+=$escape(productId),$out+="</p>\r\n   </div>\r\n"),$out+="\r\n\r\n",isFastOrder&&"step1"==bookStep&&($out+='\r\n<div class="step2-panel">\r\n    <p class="title-text">\r\n        <img src="//ssl3.tuniucdn.com/img/201604072050/bookOnline/w-line.png">\r\n        <em>产品预订</em>\r\n        <img src="//ssl3.tuniucdn.com/img/201604072050/bookOnline/w-line.png">\r\n    </p>\r\n\r\n    <p class="title-subtitle">提交订单后，客服会与您确认最终的订单价格</p>\r\n</div>\r\n'),new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(14),__webpack_require__(7),__webpack_require__(70),__webpack_require__(71),__webpack_require__(69),__webpack_require__(6),__webpack_require__(5),__webpack_require__(24),__webpack_require__(11),__webpack_require__(17)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,$,Template,cost_summary,detail,popDetail,config,eventBus,Scrollbar,constant,Layer){var pageDataObj=config.pageDataObj;return Backbone.View.extend({el:"#m-price-calculate",events:{},initialize:function(){this.model.toJSON();this.renderContainer(),this.listenTo(this.model,"change: user_tel",this.model.changeUserTel()),this.listenTo(this.model,"render",this.render)},renderContainer:function(){var html=cost_summary();this.$el.html(html),this.render()},render:function(){var data=this.model.toJSON();data.canNotSubmit=pageDataObj.canNotSubmit,data.isResLoading=pageDataObj.isResLoading,data.proMode=pageDataObj.proMode;var html=detail(data);this.$el.find(".price-infor").html(html),this.responsive(),this.$el.find(".price-info").tScroll({delta:10,fixedScrollObjHeight:!1})},fixedNumber:function(num){var str;"string"==typeof num?(str=num,num=+num):"number"==typeof num&&(str=num.toString());var reg=/\.\d*/g,match=str.match(reg);return match&&match[0]&&match[0].length>3?+num.toFixed(2):num},hideFirstPayment:function(){this.model.set({financeData:void 0}),this.model.trigger("render")},responsive:function(){function calculate(){var result,el=self.$el,$body=$("body"),rect=el[0].getBoundingClientRect(),top=rect.top,h2=el.find(".price-title"),touristInfo=el.find(".book-tourist-info"),cost=el.find(".price-info"),action=el.find(".total-price"),footer=$(".footer"),copyRight=$(".copyright"),height=$(window).height(),fixed="fixed"==el.css("position"),footerStatic=$body.hasClass("footer-static");fixed?(result=height-h2.innerHeight(!0)-touristInfo.innerHeight(!0)-action.outerHeight(!0)-footer.innerHeight(!0)-20-10,footerStatic&&(result-=copyRight.outerHeight(!0))):(result=height-top-h2.innerHeight(!0)-touristInfo.innerHeight(!0)-action.outerHeight(!0)-footer.innerHeight(!0)-20-10,footerStatic&&(result-=copyRight.outerHeight(!0))),cost.css("max-height",result);var $payFirst=self.$el.find(".total-price-detail2");if($payFirst.length){var rect2=$payFirst[0].getBoundingClientRect(),bottom2=rect2.bottom,targetBottom=height-footer.innerHeight(!0)-10;if(bottom2>targetBottom){var delta=bottom2-targetBottom,panelTop=parseInt($payFirst.css("top")),triangle1=$payFirst.find(".z"),triangle2=$payFirst.find(".j"),triangleTop=parseInt(triangle1.css("top"));panelTop-=delta,triangleTop+=delta,$payFirst.css("top",panelTop+"px"),triangle1.css("top",triangleTop+"px"),triangle2.css("top",triangleTop+"px")}}}var self=this;clearInterval(self.responsiveTimer),self.responsiveTimer=setInterval(function(){calculate()},100),calculate()},showNewPrice:function(blackCardInfo){var html=popDetail(blackCardInfo),index=html.indexOf("price_pop_detail")+18,data=this.model.toJSON();data.canNotSubmit=pageDataObj.canNotSubmit,data.isResLoading=pageDataObj.isResLoading,data.proMode=pageDataObj.proMode,data.blackCardInfo=blackCardInfo,html=html.substring(0,index)+detail(data)+html.substring(index);var self=this;self.dialog=$.layer({type:1,guide:2,title:"",closeBtn:[0,0],btns:0,area:["auto","auto"],zIndex:99999999,border:0,page:{html:html},success:function(wrap){wrap=$(wrap),wrap.find(".price_pop_detail").tScroll({delta:10,fixedScrollObjHeight:!1}),self.closeBtn=wrap.find(".price_pop_close"),self.noBtn=wrap.find(".no"),self.yesBtn=wrap.find(".yes"),self.noBtn.click(function(){self.close()}),self.closeBtn.click(function(){self.close()}),self.yesBtn.click(function(){eventBus.trigger("noBlackCardInfoSaveOrder",blackCardInfo),self.close()}),$(window).trigger("resize")}})},close:function(){Layer.close(this.dialog),this.dialog=null}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,reason=($utils.$helpers,$data.reason),$escape=$utils.$escape,$out="";return $out+='<div class="price_pop_wrapper">\n<div class="price_pop">\n\t<div class="title">\n\t\t订单金额发生变化\n\t</div>\n\t<div class="content">\n\t\t ',reason&&($out+='\n\t\t<div class="tip">\n\t\t\t',$out+=$escape(reason),$out+=" , 该订单无法享受黑卡优惠，订单金额将发生变化。是否按最新价格提交订单？\n\t\t</div>\n\t\t"),$out+='\n\t\t<div class="price_pop_detail"></div>\n\t</div>\n\t<div class="price_footer">\n\t\t<div class="yes">提交订单</div>\n\t\t<div class="no">暂不提交</div>\n\t</div>\n</div>\n<div class="icon close-icon price_pop_close">\n</div>\n</div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,$out=($utils.$helpers,"");return $out+='<div class="settlement-infor">\r\n   <div class="info-left"></div><div class="info-middle">结算信息</div><div class="info-right"></div>\r\n</div>\r\n<div class="price-infor">\r\n    \r\n</div>\r\n',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,hasAdult=($utils.$helpers,$data.hasAdult),priceData=$data.priceData,hasChild=$data.hasChild,adultNum=$data.adultNum,childNum=$data.childNum,pageType=$data.pageType,mustIncludeTotalPrice=$data.mustIncludeTotalPrice,_=$data._,allResPrice=($data.prev,$data.next,$data.allResPrice),trafficTotalPrice=$data.trafficTotalPrice,hotelTotalPrice=$data.hotelTotalPrice,packageTotalPrice=$data.packageTotalPrice,$escape=$utils.$escape,helperShowPrice=$data.helperShowPrice,mustTotalPrice=$data.mustTotalPrice,hotelRoomCountInfo=$data.hotelRoomCountInfo,hotelCount=$data.hotelCount,additionCount=($data.item,$data.additionCount),elseAdditionCount=$data.elseAdditionCount,constant=$data.constant,proMode=$data.proMode,tourTotalPrice=$data.tourTotalPrice,mustTotalAdultPrice=$data.mustTotalAdultPrice,mustTotalChildPrice=$data.mustTotalChildPrice,mustAdultPrice=$data.mustAdultPrice,mustChildPrice=$data.mustChildPrice,hotelPriceDiff=$data.hotelPriceDiff,newAdultPrice=$data.newAdultPrice,newChildPrice=$data.newChildPrice,newNormalChildPrice=$data.newNormalChildPrice,newFreeChildPrice=$data.newFreeChildPrice,totalPrice=$data.totalPrice,airplaneAdultPrice=($data.room,$data.airplaneAdultPrice),airplaneChildPrice=$data.airplaneChildPrice,trainAdultPrice=$data.trainAdultPrice,trainChildPrice=$data.trainChildPrice,multiTransport=$data.multiTransport,multiTransportShow=$data.multiTransportShow,multiTransportPrice=$data.multiTransportPrice,helperIsShowFree=$data.helperIsShowFree,additionRequiredShow=($data.price,$data.hotelRatePlan,$data.hotelRoom,$data.additionRequiredShow),additionRequiredTitle=$data.additionRequiredTitle,totalOptionalSelectedPrice=($data.flag,$data.totalOptionalSelectedPrice),pickupInfo=$data.pickupInfo,deliveryInfo=$data.deliveryInfo,recommendData=$data.recommendData,optionalTotalPrice=$data.optionalTotalPrice,updateSchemeTotalPrice=$data.updateSchemeTotalPrice,insuranceTotalPrice=$data.insuranceTotalPrice,blackCardInfoIds=$data.blackCardInfoIds,blackCardInfo=$data.blackCardInfo,blackCardPrice=$data.blackCardPrice,favourableTotalPrice=$data.favourableTotalPrice,trainChildTimeStandard=($data.isToDelete,$data.trainChildTimeStandard),financeData=$data.financeData,last=$data.last,$out=($data.index,"");$out+='<div class="price-main"> \n    ';var hasAdult=!!priceData.baseInfo.adultNum,hasChild=!!priceData.baseInfo.childNum,adultNum=priceData.baseInfo.adultNum,childNum=priceData.baseInfo.childNum;if($out+='\n\n    <div class="price-info">\n        ',"self_tour2"==pageType){var mustIncludeTotalPrice=0;_.isEmpty(priceData.additionRequired)||(mustIncludeTotalPrice=_.reduce(priceData.additionRequired,function(prev,next){return next.mealInclude?0==next.selectType?prev:prev+next.totalAdultPrice+next.totalChildPrice:prev},0));var allResPrice=trafficTotalPrice+hotelTotalPrice+packageTotalPrice+mustIncludeTotalPrice;$out+="\n           ",allResPrice&&($out+='\n                <div class="panel">\n                    <p class="price-detail-title">\n                        <span class="title">基础套餐</span>\n                        <span class="main">\n                            ',$out+=$escape(helperShowPrice(allResPrice)),$out+='\n                        </span>\n                    </p>\n                    <p class="price-detail">\n                        <span class="base-subtitle">套餐的机票/火车票/汽车票、酒店及套餐包含的项目，价格中已包含机票的民航发展基金税费</span>\n                        <div class="clear-float"></div>\n                    </p>\n                </div>\n            '),$out+="\n        "}else if("drive_routine2"==pageType){$out+="\n         ";var mustTotalPrice=_.reduce(priceData.additionRequired,function(prev,next){return 0==next.selectType&&"cruise2"!=pageType?prev:prev+next.totalAdultPrice+next.totalChildPrice},0);if($out+='\n        <div class="panel">\n            <p class="price-detail-title">\n                <span class="title">套餐价格</span>\n                <span class="main">\n                    ',$out+=$escape(helperShowPrice(hotelTotalPrice+mustTotalPrice)),$out+="\n                </span>\n            </p>\n            ",!_.isEmpty(hotelRoomCountInfo)){var hotelCount=0;_.each(hotelRoomCountInfo,function(item){hotelCount+=+item.roomCount}),$out+='\n             <p class="price-detail">\n              <span class="subtitle">酒店入住',$out+=$escape(hotelCount),$out+="间</span>\n             </p> \n             &nbsp;&nbsp;  \n            "}if($out+="\n\n            ",!_.isEmpty(priceData.additionRequired)){var additionCount=0,elseAdditionCount=0;_.each(priceData.additionRequired,function(item){4==item.resType?additionCount+=+item.adultResourceCount:(elseAdditionCount+=+item.adultResourceCount,elseAdditionCount+=+item.childResourceCount)}),$out+="\n            ",additionCount&&($out+='\n             <p class="price-detail">\n              <span class="subtitle">门票数量',$out+=$escape(additionCount),$out+="张</span>\n             </p> \n             &nbsp;&nbsp;  \n            "),$out+=" \n            ",elseAdditionCount&&($out+='\n             <p class="price-detail">\n              <span class="subtitle">附加项目',$out+=$escape(elseAdditionCount),$out+="份</span>\n             </p> \n             &nbsp;&nbsp;  \n            "),$out+=" \n            "}$out+='\n            <div class="clear-float"></div>\n        </div>\n        '}else{if($out+="\n\n        ",_.indexOf(constant.TRAIN_PRO_MODE,proMode)!=-1)var tourTotalPrice=adultNum*priceData.baseInfo.adultPrice+priceData.baseInfo.normalChildNum*priceData.baseInfo.normalChildPrice+priceData.baseInfo.freeChildNum*priceData.baseInfo.freeChildPrice;else var tourTotalPrice=adultNum*priceData.baseInfo.adultPrice+childNum*priceData.baseInfo.childPrice;var mustTotalAdultPrice=0,mustTotalChildPrice=0;"cruise2"!=pageType&&(mustTotalAdultPrice=_.reduce(priceData.additionRequired,function(prev,next){return 0==next.selectType?prev+next.totalAdultPrice:prev},0),mustTotalChildPrice=_.reduce(priceData.additionRequired,function(prev,next){return 0==next.selectType?prev+next.totalChildPrice:prev},0));var mustTotalPrice=mustTotalAdultPrice+mustTotalChildPrice;tourTotalPrice+=mustTotalPrice,tourTotalPrice+=hotelTotalPrice;var mustAdultPrice=mustTotalAdultPrice/adultNum,mustChildPrice=mustTotalChildPrice/childNum,hotelPriceDiff=hotelTotalPrice/adultNum,newAdultPrice=priceData.baseInfo.adultPrice+mustAdultPrice+hotelPriceDiff,newChildPrice=priceData.baseInfo.childPrice+mustChildPrice,newNormalChildPrice=priceData.baseInfo.normalChildPrice+mustChildPrice,newFreeChildPrice=priceData.baseInfo.freeChildPrice+mustChildPrice;$out+="\n        ",(hasAdult&&newAdultPrice||hasChild&&newChildPrice||priceData.baseInfo.normalChildNum&&newNormalChildPrice||priceData.baseInfo.freeChildNum&&newFreeChildPrice)&&($out+='\n        <div class="panel">\n            <p class="price-detail-title">\n                <span class="title">出游团费</span>\n                <span class="main">\n                    ',$out+=$escape(helperShowPrice(tourTotalPrice,2)),$out+="\n                </span>\n            </p>\n            ",hasAdult&&priceData.baseInfo.adultPrice&&($out+='\n            <p class="price-detail">成人',$out+=$escape(helperShowPrice(newAdultPrice,2)),$out+="x",$out+=$escape(adultNum),$out+="</p>\n            "),$out+="\n\n            ",priceData.baseInfo.normalChildNum||priceData.baseInfo.freeChildNum?($out+="\n            ",priceData.baseInfo.normalChildNum&&priceData.baseInfo.normalChildPrice&&($out+='\n            <p class="price-detail">儿童（含车票）',$out+=$escape(helperShowPrice(newNormalChildPrice,2)),$out+="x",$out+=$escape(priceData.baseInfo.normalChildNum),$out+="</p>\n            "),$out+="\n            ",priceData.baseInfo.freeChildNum&&priceData.baseInfo.freeChildPrice&&($out+='\n            <p class="price-detail">儿童（免车票）',$out+=$escape(helperShowPrice(newFreeChildPrice,2)),$out+="x",$out+=$escape(priceData.baseInfo.freeChildNum),$out+="</p>\n            "),$out+="\n            "):hasChild&&priceData.baseInfo.childPrice&&($out+='\n            <p class="price-detail">儿童',$out+=$escape(helperShowPrice(newChildPrice,2)),$out+="x",$out+=$escape(childNum),$out+="</p>\n            "),$out+="\n        </div>\n        "),$out+="\n        "}if($out+="\n\n        ",!_.isEmpty(priceData.cruise)){$out+='\n        <div class="panel">\n            <p class="price-detail-title">\n                <span class="title">邮轮</span>\n                <span class="main">\n                    ';var totalPrice=0;_.each(priceData.cruise,function(item){_.each(item.lists,function(room){totalPrice+=room.totalPrice})}),$out+="\n                    ",$out+=$escape(helperShowPrice(totalPrice)),$out+="\n                </span>\n            </p>\n\n            ",_.each(priceData.cruise,function(item){$out+="\n            ",_.each(item.lists,function(room){$out+='\n            <p class="price-detail">\n                <span class="subtitle">',$out+=$escape(room.resName),$out+="</span>\n                ",$out+=$escape(helperShowPrice(room.totalPrice/room.roomCount,2)),$out+="x",$out+=$escape(room.roomCount),$out+="\n            </p>\n            "}),$out+="\n            "}),$out+="\n        </div>\n        "}if($out+="\n\n        ",!_.isEmpty(priceData.cruiseAirTickets)){$out+='\n        <div class="panel">\n            ';var airplaneAdultPrice=0,airplaneChildPrice=0;_.each(priceData.cruiseAirTickets,function(item){airplaneAdultPrice+=item.price,airplaneChildPrice+=item.childPrice}),$out+='\n            <p class="price-detail-title">\n                <span class="title">机票</span>\n                <span class="main">\n                    ',$out+=$escape(helperShowPrice(adultNum*airplaneAdultPrice+childNum*airplaneChildPrice)),$out+="\n                </span>\n            </p>\n            ",hasAdult&&($out+='\n            <p class="price-detail">\n                <span class="subtitle"></span>\n                成人',$out+=$escape(helperShowPrice(airplaneAdultPrice,2)),$out+="x",$out+=$escape(adultNum),$out+="\n            </p>\n            "),$out+="\n            ",hasChild&&($out+='\n            <p class="price-detail">\n                <span class="subtitle"></span>\n                儿童',$out+=$escape(helperShowPrice(airplaneChildPrice,2)),$out+="x",$out+=$escape(childNum),$out+="\n            </p>\n            "),$out+="\n        </div>\n        "}if($out+="\n\n        ",!_.isEmpty(priceData.cruiseTrainTickets)){$out+='\n        <div class="panel">\n            ';var trainAdultPrice=0,trainChildPrice=0;_.each(priceData.cruiseTrainTickets,function(item){trainAdultPrice+=item.price.adultPrice,trainChildPrice+=item.price.normalChildPrice}),$out+='\n            <p class="price-detail-title">\n                <span class="title">火车票</span>\n                <span class="main">\n                    ',$out+=$escape(helperShowPrice(adultNum*trainAdultPrice+priceData.baseInfo.normalChildNum*trainChildPrice)),$out+="\n                </span>\n            </p>\n            ",hasAdult&&($out+='\n            <p class="price-detail">\n                <span class="subtitle"></span>\n                成人',$out+=$escape(helperShowPrice(trainAdultPrice,2)),$out+="x",$out+=$escape(adultNum),$out+="\n            </p>\n            "),$out+="\n            ",priceData.baseInfo.normalChildNum&&($out+='\n            <p class="price-detail">\n                <span class="subtitle"></span>\n                儿童',$out+=$escape(helperShowPrice(trainChildPrice,2)),$out+="x",$out+=$escape(priceData.baseInfo.normalChildNum),$out+="\n            </p>\n            "),$out+="\n        </div>\n        "}$out+="\n\n        ",priceData.airTickets&&(hasAdult&&priceData.airTickets.adultPrice||hasChild&&priceData.airTickets.childPrice)&&($out+='\n        <div class="panel">\n            <p class="price-detail-title">\n                <span class="title">机票差额</span>\n                <span class="main">\n                    ',$out+=$escape(helperShowPrice(adultNum*priceData.airTickets.adultPrice+childNum*priceData.airTickets.childPrice)),$out+="\n                </span>\n            </p>\n            ",hasAdult&&($out+='\n            <p class="price-detail">\n                <span class="subtitle"></span>\n                成人',$out+=$escape(helperShowPrice(priceData.airTickets.adultPrice,2)),$out+="x",$out+=$escape(adultNum),$out+="\n            </p>\n            "),$out+="\n            ",hasChild&&($out+='\n            <p class="price-detail">\n                <span class="subtitle"></span>\n                儿童',$out+=$escape(helperShowPrice(priceData.airTickets.childPrice,2)),$out+="x",$out+=$escape(childNum),$out+="\n            </p>\n            "),$out+="\n        </div>\n        "),$out+="\n\n        ",priceData.trainTickets&&priceData.trainTickets.diffPrice&&(priceData.trainTickets.diffPrice.adultPrice||priceData.trainTickets.diffPrice.normalChildPrice)&&($out+='\n        <div class="panel">\n            <p class="price-detail-title">\n                <span class="title">火车票差额</span>\n                <span class="main">\n                    ',$out+=$escape(helperShowPrice(priceData.trainTickets.diffSumPrice.adultPrice+priceData.trainTickets.diffSumPrice.normalChildPrice)),$out+="\n                </span>\n            </p>\n            ",hasAdult&&($out+='\n            <p class="price-detail">\n                <span class="subtitle"></span>\n                成人',$out+=$escape(helperShowPrice(priceData.trainTickets.diffPrice.adultPrice,2)),$out+="x",$out+=$escape(adultNum),$out+="\n            </p>\n            "),$out+="\n            ",priceData.baseInfo.normalChildNum&&($out+='\n            <p class="price-detail">\n                <span class="subtitle"></span>\n                儿童',$out+=$escape(helperShowPrice(priceData.trainTickets.diffPrice.normalChildPrice,2)),$out+="x",$out+=$escape(priceData.baseInfo.normalChildNum),$out+="\n            </p>\n            "),$out+="\n        </div>\n        "),$out+="\n\n        ",priceData.busTickets&&(priceData.busTickets.diffSumPrice.adultPrice||priceData.busTickets.diffSumPrice.normalChildPrice)&&($out+='\n        <div class="panel">\n            <p class="price-detail-title">\n                <span class="title">汽车票差额</span>\n                <span class="main">\n                    ',$out+=$escape(helperShowPrice(priceData.busTickets.diffSumPrice.adultPrice+priceData.busTickets.diffSumPrice.childPrice)),$out+="\n                </span>\n            </p>\n            ",hasAdult&&($out+='\n            <p class="price-detail">\n                <span class="subtitle"></span>\n                成人',$out+=$escape(helperShowPrice(priceData.busTickets.diffPrice.adultPrice,2)),$out+="x",$out+=$escape(adultNum),$out+="\n            </p>\n            "),$out+="\n            ",hasChild&&($out+='\n            <p class="price-detail">\n                <span class="subtitle"></span>\n                儿童',$out+=$escape(helperShowPrice(priceData.busTickets.diffPrice.childPrice,2)),$out+="x",$out+=$escape(childNum),$out+="\n            </p>\n            "),$out+="\n        </div>\n        "),$out+="\n\n        ";var multiTransport=priceData.multiTransport,multiTransportShow=_.some(multiTransport,function(item){return item.adultPrice&&item.adultNum||item.childPrice&&item.childNum});if(multiTransportShow){$out+='\n        <div class="panel">\n            <p class="price-detail-title">\n                <span class="title">推荐交通</span>\n                <span class="main">\n                    ';var multiTransportPrice=_.reduce(multiTransport,function(prev,next){return prev+next.adultNum*next.adultPrice+next.childNum*next.childPrice},0);$out+="\n                    ",$out+=$escape(helperShowPrice(multiTransportPrice)),$out+="\n                </span>\n            </p>\n            ",_.each(multiTransport,function(item){$out+="\n            ",item.adultPrice&&item.adultNum&&($out+='\n            <p class="price-detail">\n                <span class="subtitle"></span>\n                成人',$out+=$escape(helperShowPrice(item.adultPrice,2)),$out+="x",$out+=$escape(item.adultNum),$out+="\n            </p>\n            "),$out+="\n            ",item.childPrice&&item.childNum&&($out+='\n            <p class="price-detail">\n                <span class="subtitle"></span>\n                儿童',$out+=$escape(helperShowPrice(item.childPrice,2)),$out+="x",$out+=$escape(item.childNum),$out+="\n            </p>\n            "),$out+="\n            "}),$out+="\n        </div>\n        "}if($out+="\n\n        ",priceData.transport&&priceData.transport.name&&($out+='\n        <div class="panel">\n            <p class="price-detail-title">\n                <span class="title">联运费用</span>\n                <span class="main">\n                    ',$out+=$escape(helperIsShowFree(priceData.transport.allPrice)),$out+='\n                </span>\n            </p>\n            <p class="price-detail">\n                <span class="subtitle" title="',$out+=$escape(priceData.transport.name),$out+='">',$out+=$escape(priceData.transport.name),$out+="</span>\n                ",$out+=$escape(helperShowPrice(priceData.transport.price,2)),$out+="x",$out+=$escape(priceData.transport.touristNum),$out+="\n            </p>\n        </div>\n        "),$out+="\n\n        ",!_.isEmpty(priceData.cruiseHotel)){$out+='\n        <div class="panel">\n            <p class="price-detail-title">\n                <span class="title">酒店</span>\n                <span class="main">\n                    ';var hotelTotalPrice=_.reduce(priceData.cruiseHotel,function(prev,next){var price;if(next.hotel.hotelType){var hotelRatePlan=next.hotel.room.ratePlan;price=hotelRatePlan.roomCount*hotelRatePlan.price}else{var hotelRoom=next.hotel.room;price=hotelRoom.roomCount*hotelRoom.price}return prev+price},0);$out+="\n                    ",$out+=$escape(helperShowPrice(hotelTotalPrice,2)),$out+="\n                </span>\n            </p>\n            ",_.each(priceData.cruiseHotel,function(item){if($out+='\n            <p class="price-detail">\n                <span class="subtitle" title="',$out+=$escape(item.hotel.chineseName),$out+='">',$out+=$escape(item.hotel.chineseName),$out+="</span>\n                ",item.hotel.hotelType){$out+="\n                ";var hotelRatePlan=item.hotel.room.ratePlan;$out+="\n                ",$out+=$escape(helperShowPrice(hotelRatePlan.price,2)),$out+="x",$out+=$escape(hotelRatePlan.roomCount),$out+="\n\n                "}else{$out+="\n                ";var hotelRoom=item.hotel.room;$out+="\n                ",$out+=$escape(helperShowPrice(hotelRoom.price,2)),$out+="x",$out+=$escape(hotelRoom.roomCount),$out+="\n                "}$out+="\n            </p>\n            "}),$out+="\n        </div>\n        "}$out+="\n\n        ",priceData.dfc&&($out+='\n        <div class="panel">\n            <p class="price-detail-title only-title">\n                <span class="title">单房差费用</span>\n                <span class="main">\n                    ',$out+=$escape(helperIsShowFree(priceData.dfc.price)),$out+="\n                </span>\n            </p>\n        </div>\n        "),$out+="\n\n        ";var additionRequiredShow;if(additionRequiredShow="cruise2"!=pageType?"drive_routine2"!=pageType&&_.some(priceData.additionRequired,function(item){
return 0!=item.selectType}):!_.isEmpty(priceData.additionRequired),$out+="\n        ",additionRequiredShow){$out+='\n        <div class="panel">\n            <p class="price-detail-title">\n                <span class="title">',$out+=$escape(additionRequiredTitle),$out+='</span>\n                <span class="main">\n                    ';var mustTotalPrice=_.reduce(priceData.additionRequired,function(prev,next){return"self_tour2"==pageType&&next.mealInclude?prev:0==next.selectType&&"cruise2"!=pageType?prev:prev+next.totalAdultPrice+next.totalChildPrice},0);$out+="\n                    ",$out+=$escape(helperShowPrice(mustTotalPrice)),$out+="\n                </span>\n            </p>\n\n            ",_.each(priceData.additionRequired,function(item){if($out+="\n                ",0!=item.selectType||"cruise2"==pageType){var flag="self_tour2"==pageType&&item.mealInclude;$out+="    \n\n                    ",item.adultSelect&&($out+='\n                        <p class="price-detail">\n                            <span class="subtitle" title="',$out+=$escape(item.resName),$out+='">',$out+=$escape(item.resName),$out+="</span>\n                            ",flag?($out+="\n                                套餐包含x",$out+=$escape(item.adultResourceCount),$out+="\n                            "):($out+="\n\n                                ",item.isWifiByDay?($out+="\n                                ",$out+=$escape(helperIsShowFree(item.adultPrice,2,!0)),$out+="x",$out+=$escape(item.adultResourceCount),$out+="x",$out+=$escape(item.resInfo.durationDays),$out+="\n                                "):($out+="\n                                ",$out+=$escape("人"==item.resInfo.priceComputerType&&item.adultPrice?"成人":"儿童"==item.resInfo.priceComputerType&&item.childPrice?"儿童":""),$out+=$escape(helperIsShowFree(item.adultPrice,2,!0)),$out+="x",$out+=$escape(item.adultResourceCount),$out+="\n                                "),$out+="\n\n                            "),$out+="\n                        </p>\n                    "),$out+="\n                    ",item.childSelect&&($out+='\n                        <p class="price-detail">\n                            <span class="subtitle"></span>\n                            ',flag?($out+="\n                               套餐包含x",$out+=$escape(item.childResourceCount),$out+="\n                            "):($out+="\n                               ",item.childPrice&&($out+="儿童"),$out+=$escape(helperIsShowFree(item.childPrice,2,!0)),$out+="x",$out+=$escape(item.childResourceCount),$out+="\n                            "),$out+="\n                        </p>\n                    "),$out+="\n\n                "}$out+="\n            "}),$out+="\n        </div>\n        "}if($out+="\n\n        ",!_.isEmpty(priceData.transferService)||!_.isEmpty(priceData.additionOptional)||!_.isEmpty(priceData.updateScheme)){$out+='\n        <div class="panel">\n            <p class="price-detail-title">\n                <span class="title">推荐项目</span>\n                <span class="main">\n                    ';var totalOptionalSelectedPrice=0;if(!_.isEmpty(priceData.transferService)){var pickupInfo=priceData.transferService.pickupInfo,deliveryInfo=priceData.transferService.deliveryInfo,recommendData=priceData.transferService.recommendData;pickupInfo&&(totalOptionalSelectedPrice+=pickupInfo.totalPrice),deliveryInfo&&(totalOptionalSelectedPrice+=deliveryInfo.totalPrice)}if(!_.isEmpty(priceData.additionOptional)){var optionalTotalPrice=_.reduce(priceData.additionOptional,function(prev,next){return prev+next.totalAdultPrice+next.totalChildPrice},0);totalOptionalSelectedPrice+=optionalTotalPrice}if(!_.isEmpty(priceData.updateScheme)){var updateSchemeTotalPrice=_.reduce(priceData.updateScheme,function(prev,next){return prev+next.adultPrice*adultNum+next.childPrice*childNum},0);totalOptionalSelectedPrice+=updateSchemeTotalPrice}$out+="\n                    ",$out+=$escape(helperShowPrice(totalOptionalSelectedPrice,2)),$out+="\n                </span>\n            </p>\n            ",_.isEmpty(priceData.transferService)||($out+="\n            ",pickupInfo&&($out+='\n            <p class="price-detail">\n                <span class="subtitle" title="',$out+=$escape(recommendData.pickupCityName),$out+='接机">',$out+=$escape(recommendData.pickupCityName),$out+="接机</span>\n                ",$out+=$escape(helperShowPrice(pickupInfo.totalPrice,2)),$out+="x1\n            </p>\n            "),$out+="\n            ",deliveryInfo&&($out+='\n            <p class="price-detail">\n                <span class="subtitle" title="',$out+=$escape(recommendData.deliveryCityName),$out+='送机">',$out+=$escape(recommendData.deliveryCityName),$out+="送机</span>\n                ",$out+=$escape(helperShowPrice(deliveryInfo.totalPrice,2)),$out+="x1\n            </p>\n            "),$out+="\n            "),$out+="\n\n            ",_.each(priceData.updateScheme,function(item){$out+="\n            ",hasAdult&&($out+='\n            <p class="price-detail">\n                <span class="subtitle" title="',$out+=$escape(item.name),$out+='">',$out+=$escape(item.name),$out+="</span>\n                成人",$out+=$escape(helperShowPrice(item.adultPrice,2)),$out+="x",$out+=$escape(adultNum),$out+="\n            </p>\n            "),$out+="\n            ",hasChild&&0!=item.childPrice&&($out+='\n            <p class="price-detail">\n                <span class="subtitle"></span>\n                儿童',$out+=$escape(helperShowPrice(item.childPrice,2)),$out+="x",$out+=$escape(childNum),$out+="\n            </p>\n            "),$out+="\n            "}),$out+="\n\n            ",_.each(priceData.additionOptional,function(item){$out+="\n            ",item.adultSelect&&($out+='\n            <p class="price-detail">\n                <span class="subtitle" title="',$out+=$escape(item.resName),$out+='">',$out+=$escape(item.resName),$out+="</span>\n                ",item.isWifiByDay?($out+="\n                ",$out+=$escape(helperIsShowFree(item.adultPrice,2,!0)),$out+="x",$out+=$escape(item.adultResourceCount),$out+="x",$out+=$escape(item.resInfo.durationDays),$out+="\n                "):($out+="\n                ",$out+=$escape("人"==item.resInfo.priceComputerType&&item.adultPrice?"成人":"儿童"==item.resInfo.priceComputerType&&item.childPrice?"儿童":""),$out+=$escape(helperIsShowFree(item.adultPrice,2,!0)),$out+="x",$out+=$escape(item.adultResourceCount),$out+="\n                "),$out+="\n            </p>\n            "),$out+="\n            ",item.childSelect&&($out+='\n            <p class="price-detail">\n                ',item.adultSelect||($out+='\n                <span class="subtitle" title="',$out+=$escape(item.resName),$out+='">',$out+=$escape(item.resName),$out+="</span>\n                "),$out+="\n                ",item.childPrice&&($out+="儿童"),$out+=$escape(helperIsShowFree(item.childPrice,2,!0)),$out+="x",$out+=$escape(item.childResourceCount),$out+="\n            </p>\n            "),$out+="\n            "}),$out+="\n        </div>\n        "}if($out+="\n\n        ",!_.isEmpty(priceData.insurance)){$out+='\n        <div class="panel">\n            <p class="price-detail-title">\n                <span class="title">保险费用</span>\n                <span class="main">\n                    ';var insuranceTotalPrice=_.reduce(priceData.insurance,function(prev,next){return prev+next.price*next.airRange*(adultNum+childNum)},0);$out+="\n                    ",$out+=$escape(helperShowPrice(insuranceTotalPrice)),$out+="\n                </span>\n            </p>\n\n            ",_.each(priceData.insurance,function(item){$out+='\n            <p class="price-detail">\n                <span class="subtitle" title="',$out+=$escape(item.name),$out+='">',$out+=$escape(item.name),$out+="</span>\n                ",$out+=$escape(helperShowPrice(item.price*item.airRange,2)),$out+="x",$out+=$escape(adultNum+childNum),$out+="\n            </p>\n            "}),$out+="\n        </div>\n        "}if($out+="\n\n        ",!_.isEmpty(priceData.promotionList)){$out+='\n        <div class="panel">\n            <p class="price-detail-title">\n                <span class="title">优惠金额</span>\n                <span class="main">\n                    ';var blackCardInfoIds=blackCardInfo&&blackCardInfo.priceList.map(function(item){return item.id})||[],blackCardPrice=0,favourableTotalPrice=_.reduce(priceData.promotionList,function(prev,next){return blackCardInfoIds.indexOf(next.promotionId)!=-1?(blackCardPrice+=next.price,prev):5!=next.type?prev+next.price:prev},0);blackCardInfoIds&&blackCardInfoIds.length&&(blackCardInfo.price=blackCardPrice),$out+="\n                    ",$out+=$escape(helperShowPrice(favourableTotalPrice)),$out+="\n                </span>\n            </p>\n\n            ",_.each(priceData.promotionList,function(item){var isToDelete=blackCardInfoIds.indexOf(item.promotionId)!=-1;$out+='\n            <p class="price-detail">\n                \n                ',isToDelete?($out+='\n                    <span class="subtitle delete" title="',$out+=$escape(item.name),$out+='">',$out+=$escape(item.name),$out+="</span>\n                "):($out+='\n                    <span class="subtitle" title="',$out+=$escape(item.name),$out+='">',$out+=$escape(item.name),$out+="</span>\n                "),$out+="\n                ",5==item.type?($out+="\n                返",$out+=$escape(helperShowPrice(item.price,2)),$out+="优惠券\n                "):7==item.type?$out+="\n                   限时赠送\n                ":($out+="\n                    ",isToDelete?($out+='\n                      <span class="delete"> ',$out+=$escape(helperShowPrice(item.price,2)),$out+="</span>\n                    "):($out+="\n                        ",$out+=$escape(helperShowPrice(item.price,2)),$out+="\n                    "),$out+="\n                "),$out+="\n            </p>\n            "}),$out+="\n        </div>\n        "}if($out+="\n        ",priceData.receiptDeliveryFee&&($out+='\n        <div class="panel">\n            <p class="price-detail-title">\n                <span class="title">邮寄服务费</span>\n                <span class="main">\n                    ',$out+=$escape(helperShowPrice(priceData.receiptDeliveryFee)),$out+="\n                </span>\n            </p>\n        </div>\n        "),$out+='\n    </div>\n</div>\n<div class="total-price">\n    <div class="price-wrapepr">总价\n        ',"self_tour2"!=pageType&&"tour_order2"!=pageType||blackCardInfo&&blackCardInfo.price||($out+='\n        <div class="jtxz-detail-hover">\n            <i class="icon notice2-icon"></i>\n            <div class="jtxz-detail2">               \n                <p class="YD_mgb">\n                    ',$out+=$escape(trainChildTimeStandard),$out+='                        \n                </p>                \n                <span class="z">◆</span>\n                <span class="j">◆</span>\n            </div>\n        </div>\n        '),$out+="\n\n        ",blackCardInfo&&blackCardInfo.price?($out+='\n            <div class="price">\n            <span class="delete">',$out+=$escape(helperShowPrice(priceData.sumPrice>0?priceData.sumPrice:0,2)),$out+='</span>\n            <span class="new">',$out+=$escape(helperShowPrice(priceData.sumPrice-blackCardInfo.price>0?priceData.sumPrice-blackCardInfo.price:0,2)),$out+="</span>\n            </div>\n        "):($out+='\n            <span class="price">',$out+=$escape(helperShowPrice(priceData.sumPrice>0?priceData.sumPrice:0,2)),$out+="</span>\n        "),$out+='\n        <div class="clear-float"></div>\n    </div>\n    ',financeData&&(!blackCardInfo||blackCardInfo.success!==!1)){$out+='\n    <span class="payments">\n        （<span class="stages-price total-price-hover">\n        ';var last=financeData.periods[financeData.periods.length-1];$out+="\n            ",$out+=$escape(last.desc[1]),$out+="，",$out+=$escape(financeData.periods.length),$out+='种分期可选\n            <div class="total-price-detail2 T_width2">\n                <p class="tips">可选期数(',$out+=$escape(financeData.periods.length),$out+="种分期)</p>\n\n                ",_.each(financeData.periods,function(item,index){$out+='\n                <div class="panel ',index==financeData.periods-1&&($out+="last"),$out+='">\n                    <div class="main panel-left"><span>',$out+=$escape(item.desc[0]),$out+='</span></div>\n                    <div class="main panel-right">\n                         <p class="tips1">',$out+=$escape(item.desc[1]),$out+='</p>\n                         <p class="tips2">',$out+=$escape(item.desc[2]),$out+='</p>\n                    </div>\n                    <div class="clear-float"></div>\n                </div>\n                '}),$out+='\n\n                <span class="z">◆</span>\n                <span class="j">◆</span>\n            </div>\n     </span>）\n    </span>\n    '}return $out+="\n</div>",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(73),__webpack_require__(17),__webpack_require__(5),__webpack_require__(6),__webpack_require__(16)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,AirplaneTemplate,Layer,eventBus,config,tools){var pageDataObj=config.pageDataObj;return Backbone.View.extend({el:"#m-airplane",events:{"click .m-more":"moreAirplane"},initialize:function(){7!=pageDataObj.proMode&&14!=pageDataObj.proMode||this.render(),this.listenTo(this.model,"needRender",this.render),this.listenTo(this.model,"error",this.showError),this.listenTo(this.model,"change:changePriceTip",this.render)},render:function(){var model=this.model,html=AirplaneTemplate(model.toJSON());this.$el.html(html).show(),this.responsive()},showError:function(data,diffPrice,isFromOrder){this.closeAll(),void 0!=diffPrice&&(diffPrice=diffPrice<0?"-￥"+-diffPrice:"+￥"+diffPrice);var msg={check:{1:"您预订的本次航班的舱位已经售空，请重新获取航班",2:"您预订的机票价格核对有误，请重新获取航班",3:"很抱歉，航班价格变化频繁，该航班价格发生变动："+diffPrice+"，请确认价格",4:"请求错误，请稍后重试"},timeout:{1:"抱歉，页面操作时间过长，请重新获取航班"},totalLeft:{1:"您所选择的航班余位不足,请更换航班"}},tip="机票信息异常，请更改机票或更改产品",type=data.type,code=data.code;data&&(tip=msg[type][code]);var changeFlightCheckRule=Backbone.app.get("changeFlightCheckRule"),self=this;if(changeFlightCheckRule&&3!=code&&"check"==type)var index=tools.layer({btns:2,btn:["立即更换","暂不更换"],msg:tip,icon:2,yes:function(){Layer.close(index),self.moreAirplane()},no:function(){Layer.close(index),self.model.set({hasCheck:1,isNetOrderFlag:!0},{silent:!0}),isFromOrder&&eventBus.trigger("sendSaveOrderData")}});else var index=tools.layer({msg:tip,yes:function(){Layer.close(index),"check"==type&&(3==code&&eventBus.trigger("saveOrder"),1!=code&&2!=code||eventBus.trigger("refreshAirplaneAndList")),"timeout"==type&&eventBus.trigger("refreshAirplane")}});$("html,body").animate({scrollTop:$("#m-airplane").offset().top},500)},showLoading:function(){this.model.showLoading()},loadError:function(){this.model.loadError()},moreAirplane:function(){this.clearDelayCheck(),this.clearLoop(),eventBus.trigger("moreAirplane")},setLoop:function(){var self=this;this.clearLoop(),self.loopIndex=setTimeout(function(){self.showError({type:"timeout",code:1})},3e5)},clearLoop:function(){this.loopIndex&&clearTimeout(self.loopIndex)},setDelayCheck:function(){var self=this;this.model.set({hasCheck:!1,isChecked:!1}),self.timeoutIndex=setTimeout(function(){eventBus.trigger("checkAirplane","airplane"),self.timeoutIndex=null},4e4)},clearDelayCheck:function(){this.timeoutIndex&&clearTimeout(this.timeoutIndex)},hideChangeBtn:function(){this.model.hideChangeBtn()},responsive:function(){},showCheckLoading:function(){Layer.load("正在验证，请稍后...")},hideCheckLoading:function(){this.closeAll()},closeAll:function(){eventBus.trigger("closeAllExceptReOrder")}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,canChange=($utils.$helpers,$data.canChange),changePriceTip=$data.changePriceTip,$escape=$utils.$escape,titleDesc=$data.titleDesc,loading=$data.loading,loadingMsg=$data.loadingMsg,fail=$data.fail,failMsg=$data.failMsg,listData=($data.onlyGoBack,$data.listData),itemData=($data.numArray,$data.itemData),itemType=$data.itemType,i=$data.i,_=$data._,k=$data.k,helperIsExist=$data.helperIsExist,isHasPurchaseNotes=$data.isHasPurchaseNotes,freeLuggageStr=$data.freeLuggageStr,resType=$data.resType,stockType=$data.stockType,$string=$utils.$string,$out="";if($out+='<h2>\r\n    <a class="m-more ',canChange||($out+="hide"),$out+='">更改航班<i class="icon more-icon"></i></a>\r\n    <span class="icon air-icon"></span>\r\n    <span class="m-title">航班信息</span>\r\n    ',changePriceTip?($out+='\r\n    <span class="m-tip">',$out+=$escape(changePriceTip),$out+="</span>\r\n    "):($out+="\r\n       ",titleDesc&&($out+='\r\n        <span class="m-title-desc">',$out+=$escape(titleDesc),$out+="</span>\r\n      "),$out+="\r\n    "),$out+='\r\n\r\n</h2>\r\n<div class="modular-body">\r\n    ',loading)$out+='\r\n    <div class="load-panel">\r\n        <p class="load-img"></p>\r\n        <p class="load-tip">',$out+=$escape(loadingMsg),$out+="</p>\r\n    </div>\r\n    ";else if(fail)$out+='\r\n    <div class="load-error-panel">\r\n        <p class="load-error-img"></p>\r\n        <p class="load-tip">\r\n            ',$out+=$escape(failMsg),$out+="\r\n        </p>\r\n    </div>\r\n    ";else{$out+='\r\n    <div class="flight_journeys">\r\n        ';for(var itemData=(listData.length<=2,null),itemType="",i=0;i<listData.length;i++){if(_.isEmpty(listData[i].transferInfo)?(itemData=listData[i],itemType="normal"):(itemData=listData[i].transferInfo,itemType="transfer"),$out+='\r\n        <div class="flight_journey ',$out+=$escape(i==listData.length-1?"last":""),$out+='">\r\n            ',"transfer"==itemType){$out+="\r\n            ";for(var k=0;k<itemData.length;k++){$out+="\r\n             ",(itemData[k].onTimeRate||itemData[k].billTypeName)&&($out+='\r\n                             <div class="flight_timerate">\r\n                             ',itemData[k].onTimeRate&&($out+='\r\n                                 <span class="timeRate">准点率:',$out+=$escape(itemData[k].onTimeRate),$out+="%</span>\r\n                              "),$out+="\r\n\r\n                            ",itemData[k].billTypeName&&($out+='\r\n                                 <span class="billTypeName">',$out+=$escape(itemData[k].billTypeName),$out+="</span>\r\n                            "),$out+="\r\n                         </div>\r\n                         "),$out+='\r\n            <table class="flight_info">\r\n                <tr>\r\n                    <td class="route">\r\n                        <div class="trip f-ol"\r\n                             title="',$out+=$escape(itemData[k].departureCityName),$out+="-",$out+=$escape(itemData[k].destinationCityName),$out+='">\r\n                            ',$out+=$escape(itemData[k].departureCityName),$out+="-",$out+=$escape(itemData[k].destinationCityName),$out+='\r\n                        </div>\r\n                        <div class="time">',$out+=$escape(itemData[k].departDate),$out+='</div>\r\n                    </td>\r\n\r\n                    <td class="flight">\r\n                        <div class="company f-ol"\r\n                             title="',$out+=$escape(itemData[k].airlineName),$out+='">\r\n                            ',itemData[k].sAirComImageUrl?($out+='\r\n                              <img src="',$out+=$escape(itemData[k].sAirComImageUrl),$out+='" class="airplane-company-icon">\r\n                            '):($out+='\r\n                              <i class="airplane-company-icon airport_',$out+=$escape(itemData[k].flightCode),$out+='"></i>\r\n                            '),$out+="\r\n                            ",$out+=$escape(itemData[k].airlineName),$out+='\r\n                        </div>\r\n                        <div class="number">\r\n                            <span class="flightNo f-ol f-bb ',itemData[k].codeshare&&($out+="short"),$out+='">\r\n                                ',$out+=$escape(itemData[k].flightNo),$out+=" ",$out+=$escape(itemData[k].airplaneTypeName),$out+='\r\n                            </span>\r\n\r\n                            <div class="flightNo_detail">\r\n                                                            <table>\r\n                                                               <tr>\r\n                                                                  <th>机型名称</th>\r\n                                                                  <th>飞机类型</th>\r\n                                                                  <th>餐食</th>\r\n                                                               </tr>\r\n                                                               <tr>\r\n                                                                  <td>',$out+=$escape(itemData[k].flightNo),$out+="</td>\r\n                                                                  <td>",$out+=$escape(itemData[k].airplaneTypeName),$out+="</td>\r\n                                                                  <td>\r\n                                                                   ",helperIsExist(itemData[k].hasMeal)?($out+="\r\n                                                                    ",$out+=$escape(itemData[k].hasMeal?"是":"否"),$out+="\r\n                                                                      "):$out+="\r\n                                                                       ___\r\n                                                                   ",$out+='\r\n                                                                  </td>\r\n                                                               </tr>\r\n                                                            </table>\r\n<span class="z">◆</span>\r\n                                <span class="j">◆</span>\r\n                                                        </div>\r\n\r\n                            ',itemData[k].codeshare&&($out+='\r\n                            <span class="flight-share tour-stop-hover">\r\n                            共享\r\n                            <div class="stop-over-info T_width2">\r\n                                <p>\r\n                                    ',$out+=$escape(itemData[k].airlineName),$out+=$escape(itemData[k].flightNo),$out+="\r\n                                    ，实际由",$out+=$escape(itemData[k].sAirComName),$out+=$escape(itemData[k].codeshare),$out+='承运\r\n                                </p>\r\n                                <span class="z">◆</span>\r\n                                <span class="j">◆</span>\r\n                            </div>\r\n                        </span>\r\n                            '),$out+='\r\n\r\n                        </div>\r\n                    </td>\r\n\r\n                    <td class="stop">\r\n                        <div class="where f-ol" title="',$out+=$escape(itemData[k].departureAirportName),$out+='">',$out+=$escape(itemData[k].departureAirportName),$out+='</div>\r\n                        <div class="when">',$out+=$escape(itemData[k].departTime),$out+="</div>\r\n                    </td>\r\n\r\n                    ",itemData[k].stopTip?($out+='\r\n                    <td class="arrow">\r\n                        <div>\r\n                        <span class="tour-stop-tips">\r\n                            <span class="tour-stop-hover">经停\r\n                                <div class="stop-over-info">\r\n                                   <table class="stop-over-table">\r\n                                       <tr class="info-title">\r\n                                           <td class="airport">经停机场</td>\r\n                                           ',itemData[k].stopTip.arriveTime&&($out+='\r\n                                           <td class="arrival-time">到达时间</td>\r\n                                           <td class="take-off-time">起飞时间</td>\r\n                                           '),$out+='\r\n                                           <td class="stop-time">停留时间</td>\r\n                                       </tr>\r\n\r\n                                       <tr class="info-content">\r\n                                           <td class="airport-detail">',$out+=$escape(itemData[k].stopTip.stopAirportName),$out+="</td>\r\n                                           ",itemData[k].stopTip.arriveTime&&($out+='\r\n                                           <td class="arrival-detail">\r\n                                              <p class="time">',$out+=$escape(itemData[k].stopTip.arriveTime),$out+="</p>\r\n                                               <p>",$out+=$escape(itemData[k].stopTip.arriveDate),$out+='</p>\r\n                                           </td>\r\n                                           <td class="take-off-detail">\r\n                                               <p class="time">',$out+=$escape(itemData[k].stopTip.departTime),$out+="</p>\r\n                                               <p>",$out+=$escape(itemData[k].stopTip.departDate),$out+="</p>\r\n                                           </td>\r\n                                           "),$out+='\r\n                                           <td class="stop-time-detail">',$out+=$escape(itemData[k].stopTip.durationTime),$out+='</td>\r\n                                       </tr>\r\n                                   </table>\r\n                                    <span class="z">◆</span>\r\n                                    <span class="j">◆</span>\r\n                                </div>\r\n                            </span>\r\n                         </span>\r\n\r\n                            <span class="tour-stop-time">',$out+=$escape(itemData[k].duration),$out+="</span>\r\n                        </div>\r\n                    </td>\r\n                    "):($out+='\r\n                    <td class="arrow">\r\n                        <div>\r\n                            <span class="tour-stop-time">',$out+=$escape(itemData[k].duration),$out+="</span>\r\n                        </div>\r\n                    </td>\r\n                    "),$out+='\r\n\r\n                    <td class="stop">\r\n                        <div class="where f-ol" title="',$out+=$escape(itemData[k].destinationAirportName),$out+='">',$out+=$escape(itemData[k].destinationAirportName),$out+='</div>\r\n                        <div class="when">\r\n                            ',$out+=$escape(itemData[k].arriveTime),$out+="\r\n\r\n                            ",1!=itemData[k].arriveDay&&itemData[k].arriveDay!=-1||($out+='\r\n                            <span class="T_arrive_day">\r\n                                ',$out+=$escape(1==itemData[k].arriveDay?"+1":"-1"),$out+="\r\n                            </span>\r\n                            "),$out+='\r\n                        </div>\r\n                    </td>\r\n\r\n                    <td class="level">\r\n                        <div class="f-ol" title="',$out+=$escape(itemData[k].cabinType),$out+='">',$out+=$escape(itemData[k].cabinType),$out+='</div>\r\n                        <div class="comments jtxz-detail-hover">\r\n                            <i class="icon notice2-icon"></i><em class="f-bb">\r\n                                ';var isHasPurchaseNotes=1===listData[i].airType&&listData[i].purchaseNotes||itemData.travelerCategory,freeLuggageStr="无行李额";listData[i].freeLuggage>0&&listData[i].freeLuggage<20?freeLuggageStr="行李额低":(listData[i].freeLuggage>=20||listData[i].luggageLimitStatement||listData[i].baggageInfo)&&(freeLuggageStr="行李额"),$out+="\r\n                                ",7==resType?($out+="\r\n                                   ",$out+=isHasPurchaseNotes||isHasPurchaseNotes&&3===stockType?"\r\n                                      限制/行李额    \r\n                                   ":isHasPurchaseNotes||3!==stockType?"\r\n                                      行李额\r\n                                   ":"\r\n                                      行李额/现询\r\n                                   ",$out+="\r\n                                "):21==resType&&($out+="\r\n                                   ",isHasPurchaseNotes||isHasPurchaseNotes&&2===listData[i].airType?($out+="\r\n                                      限制/",$out+=$escape(freeLuggageStr),$out+="\r\n                                   "):isHasPurchaseNotes||2!==listData[i].airType?($out+="\r\n                                      ",$out+=$escape(freeLuggageStr),$out+="\r\n                                   "):($out+="\r\n                                      ",$out+=$escape(freeLuggageStr),$out+="\r\n                                   "),$out+="\r\n                                "),$out+='\r\n                            </em>\r\n                            <div class="jtxz-detail2 T_width2">\r\n                                ',2===listData[i].airType?$out+='\r\n                                <p class="YD_title">往返优惠</p>\r\n                                <p class="YD_mgb">此航班往返程为指定航班，您可以根据需要自行选择</p>\r\n                                ':3===stockType&&($out+='\r\n                                <p class="YD_title">现询</p>\r\n                                <p class="YD_mgb">此航班为现询航班，需客服确认后才能确认是否有位置，如果需要立即确认，请选择其他航班。</p>\r\n                                '),$out+="\r\n\r\n                                ",1===listData[i].airType&&listData[i].purchaseNotes?($out+='\r\n                                <p class="YD_title">预订限制</p>\r\n                                <p class="YD_mgb">',$out+=$string(listData[i].purchaseNotes),$out+="</p>\r\n                                "):($out+="\r\n                                ",itemData[k].travelerCategory&&($out+='\r\n                                <p class="YD_title">预订限制</p>\r\n                                <p class="YD_mgb">该机票为特价票，限出游人类型为：',$out+=$escape(itemData[k].travelerCategory),$out+="</p>\r\n                                "),$out+="\r\n                                "),$out+='\r\n\r\n                                <p class="YD_title">行李额说明</p>\r\n                                ',(listData[i].freeLuggage||0==listData[i].freeLuggage)&&listData[i].freeLuggageUnit||listData[i].luggageLimitStatement||listData[i].baggageInfo?($out+='\r\n                                <p class="YD_mgb">\r\n                                    ',listData[i].freeLuggage?($out+="\r\n                                    ",$out+=$escape(listData[i].freeLuggage),$out+=$escape(listData[i].freeLuggageUnit),$out+="以下免托运行李费用\r\n                                    "):listData[i].luggageLimitStatement?($out+="\r\n                                    ",$out+=$escape(listData[i].luggageLimitStatement),$out+="\r\n                                    "):listData[i].baggageInfo?($out+="\r\n                                    ",$out+=$escape(listData[i].baggageInfo),
$out+="\r\n                                    "):$out+="\r\n                                    无免费托运行李额\r\n                                    ",$out+="\r\n                                </p>\r\n                                "):$out+='\r\n                                <p class="YD_mgb">如需了解行李额信息，请您致电4007-999-999咨询。</p>\r\n                                ',$out+="\r\n                                ",listData[i].overloadLuggage&&($out+='\r\n                                <p class="YD_mgb next-line">',$out+=$escape(listData[i].overloadLuggage),$out+="</p>\r\n                                "),$out+='\r\n\r\n                                <span class="z">◆</span>\r\n                                <span class="j">◆</span>\r\n                            </div>\r\n                        </div>\r\n                    </td>\r\n\r\n\r\n                </tr>\r\n            </table>\r\n            ',itemData[k].transfer&&($out+='\r\n            <div class="transfer-info">\r\n                <div class="transfer-tips">\r\n                    <span class="transfer-city"><i class="icon city-icon"></i>中转城市：',$out+=$escape(itemData[k].transfer.city),$out+='</span>\r\n                    <span class="transfer-time"><i class="icon time-icon"></i>停留时间：',$out+=$escape(itemData[k].transfer.duration),$out+="</span>\r\n                    ",listData[i].visaTips&&($out+='\r\n                       <span class="transfer-visa"><i class="icon transfer-visa-icon"></i>',$out+=$escape(listData[i].visaTips),$out+="</span>\r\n                    "),$out+="\r\n                    ",itemData[k].transferTips&&($out+='\r\n                    <span class="transfer-tip jtxz-detail-hover">\r\n                    中转提示\r\n\r\n                    <div class="jtxz-detail2">\r\n                        <p class="YD_mgb">\r\n                            ',$out+=$escape(itemData[k].transferTips),$out+='\r\n                        </p>\r\n                        <span class="z">◆</span>\r\n                        <span class="j">◆</span>\r\n                    </div>\r\n                </span>\r\n                    '),$out+="\r\n                </div>\r\n            </div>\r\n            "),$out+="\r\n            "}$out+="\r\n            "}else{$out+="\r\n            ",(itemData.onTimeRate||itemData.billTypeName)&&($out+='\r\n                                         <div class="flight_timerate">\r\n                                             ',itemData.onTimeRate&&($out+='\r\n                                                                              <span class="timeRate">准点率:',$out+=$escape(itemData.onTimeRate),$out+="%</span>\r\n                                                                           "),$out+="\r\n\r\n                                             ",itemData.billTypeName&&($out+='\r\n                                                  <span class="billTypeName">',$out+=$escape(itemData.billTypeName),$out+="</span>\r\n                                             "),$out+="\r\n                                         </div>\r\n              "),$out+='\r\n            <table class="flight_info">\r\n                <tr>\r\n                    <td class="route">\r\n                        <div class="trip f-ol"\r\n                             title="',$out+=$escape(itemData.departureCityName),$out+="-",$out+=$escape(itemData.destinationCityName),$out+='">\r\n                            ',$out+=$escape(itemData.departureCityName),$out+="-",$out+=$escape(itemData.destinationCityName),$out+='\r\n                        </div>\r\n                        <div class="time">',$out+=$escape(itemData.departDate),$out+='</div>\r\n                    </td>\r\n\r\n                    <td class="flight">\r\n                        <div class="company f-ol"\r\n                             title="',$out+=$escape(itemData.airlineName),$out+='">\r\n                             ',itemData.sAirComImageUrl?($out+='\r\n                              <img src="',$out+=$escape(itemData.sAirComImageUrl),$out+='" class="airplane-company-icon">\r\n                            '):($out+='\r\n                              <i class="airplane-company-icon airport_',$out+=$escape(itemData.flightCode),$out+='"></i>\r\n                            '),$out+="\r\n                            ",$out+=$escape(itemData.airlineName),$out+='\r\n                        </div>\r\n                        <div class="number">\r\n                            <span class="flightNo f-ol f-bb',itemData.codeshare&&($out+="short"),$out+='">\r\n                                ',$out+=$escape(itemData.flightNo),$out+=" ",$out+=$escape(itemData.airplaneTypeName),$out+='\r\n                            </span>\r\n\r\n                            <div class="flightNo_detail">\r\n                                <table>\r\n                                   <tr>\r\n                                      <th>机型名称</th>\r\n                                      <th>飞机类型</th>\r\n                                      <th>餐食</th>\r\n                                   </tr>\r\n                                   <tr>\r\n                                      <td>',$out+=$escape(itemData.flightNo),$out+="</td>\r\n                                      <td>",$out+=$escape(itemData.airplaneTypeName),$out+="</td>\r\n                                      <td>\r\n                                       ",helperIsExist(itemData.hasMeal)?($out+="\r\n                                        ",$out+=$escape(itemData.hasMeal?"是":"否"),$out+="\r\n                                          "):$out+="\r\n                                           ___\r\n                                       ",$out+='\r\n                                      </td>\r\n                                   </tr>\r\n                                </table>\r\n                                <span class="z">◆</span>\r\n                                                                <span class="j">◆</span>\r\n                            </div>\r\n\r\n                            ',itemData.codeshare&&($out+='\r\n                            <span class="flight-share tour-stop-hover">\r\n                            共享\r\n                            <div class="stop-over-info T_width2">\r\n                                <p>\r\n                                    ',$out+=$escape(itemData.airlineName),$out+=$escape(itemData.flightNo),$out+="\r\n                                    ，实际由",$out+=$escape(itemData.sAirComName),$out+=$escape(itemData.codeshare),$out+='承运\r\n                                </p>\r\n                                <span class="z">◆</span>\r\n                                <span class="j">◆</span>\r\n                            </div>\r\n                        </span>\r\n                            '),$out+='\r\n\r\n                        </div>\r\n                    </td>\r\n\r\n                    <td class="stop">\r\n                        <div class="where f-ol" title="',$out+=$escape(itemData.departureAirportName),$out+='">',$out+=$escape(itemData.departureAirportName),$out+='</div>\r\n                        <div class="when">',$out+=$escape(itemData.departTime),$out+="</div>\r\n                    </td>\r\n\r\n                    ",itemData.stopTip?($out+='\r\n                    <td class="arrow">\r\n                        <div>\r\n                        <span class="tour-stop-tips">\r\n                            <span class="tour-stop-hover">经停\r\n                                <div class="stop-over-info">\r\n                                   <table class="stop-over-table">\r\n                                       <tr class="info-title">\r\n                                           <td class="airport">经停机场</td>\r\n                                           ',itemData.stopTip.arriveTime&&($out+='\r\n                                           <td class="arrival-time">到达时间</td>\r\n                                           <td class="take-off-time">起飞时间</td>\r\n                                           '),$out+='\r\n                                           <td class="stop-time">停留时间</td>\r\n                                       </tr>\r\n\r\n                                       <tr class="info-content">\r\n                                           <td class="airport-detail">',$out+=$escape(itemData.stopTip.stopAirportName),$out+="</td>\r\n                                           ",itemData.stopTip.arriveTime&&($out+='\r\n                                           <td class="arrival-detail">\r\n                                              <p class="time">',$out+=$escape(itemData.stopTip.arriveTime),$out+="</p>\r\n                                               <p>",$out+=$escape(itemData.stopTip.arriveDate),$out+='</p>\r\n                                           </td>\r\n                                           <td class="take-off-detail">\r\n                                               <p class="time">',$out+=$escape(itemData.stopTip.departTime),$out+="</p>\r\n                                               <p>",$out+=$escape(itemData.stopTip.departDate),$out+="</p>\r\n                                           </td>\r\n                                           "),$out+='\r\n                                           <td class="stop-time-detail">',$out+=$escape(itemData.stopTip.durationTime),$out+='</td>\r\n                                       </tr>\r\n                                   </table>\r\n                                    <span class="z">◆</span>\r\n                                    <span class="j">◆</span>\r\n                                </div>\r\n                            </span>\r\n                         </span>\r\n\r\n                            <span class="tour-stop-time">',$out+=$escape(itemData.duration),$out+="</span>\r\n                        </div>\r\n                    </td>\r\n                    "):($out+='\r\n                    <td class="arrow">\r\n                        <div>\r\n                            <span class="tour-stop-time">',$out+=$escape(itemData.duration),$out+="</span>\r\n                        </div>\r\n                    </td>\r\n                    "),$out+='\r\n\r\n                    <td class="stop">\r\n                        <div class="where f-ol" title="',$out+=$escape(itemData.destinationAirportName),$out+='">',$out+=$escape(itemData.destinationAirportName),$out+='</div>\r\n                        <div class="when">\r\n                            ',$out+=$escape(itemData.arriveTime),$out+="\r\n\r\n                            ",1!=itemData.arriveDay&&itemData.arriveDay!=-1||($out+='\r\n                            <span class="T_arrive_day">\r\n                                ',$out+=$escape(1==itemData.arriveDay?"+1":"-1"),$out+="\r\n                            </span>\r\n                            "),$out+='\r\n                        </div>\r\n                    </td>\r\n\r\n                    <td class="level">\r\n                        <div class="f-ol" title="',$out+=$escape(itemData.cabinType),$out+='">',$out+=$escape(itemData.cabinType),$out+='</div>\r\n                        <div class="comments jtxz-detail-hover">\r\n                            <i class="icon notice2-icon"></i><em class="f-bb">\r\n                            ';var isHasPurchaseNotes=1===listData[i].airType&&listData[i].purchaseNotes||itemData.travelerCategory,freeLuggageStr="无行李额";listData[i].freeLuggage>0&&listData[i].freeLuggage<20?freeLuggageStr="行李额低":(listData[i].freeLuggage>=20||listData[i].luggageLimitStatement||listData[i].baggageInfo)&&(freeLuggageStr="行李额"),$out+="\r\n                            ",7==resType?($out+="\r\n                               ",$out+=isHasPurchaseNotes||isHasPurchaseNotes&&3===stockType?"\r\n                                  限制/行李额    \r\n                               ":isHasPurchaseNotes||3!==stockType?"\r\n                                  行李额\r\n                               ":"\r\n                                  行李额/现询\r\n                               ",$out+="\r\n                            "):21==resType&&($out+="\r\n                               ",isHasPurchaseNotes||isHasPurchaseNotes&&2===listData[i].airType?($out+="\r\n                                  限制/",$out+=$escape(freeLuggageStr),$out+="\r\n                               "):isHasPurchaseNotes||2!==listData[i].airType?($out+="\r\n                                  ",$out+=$escape(freeLuggageStr),$out+="\r\n                               "):($out+="\r\n                                  ",$out+=$escape(freeLuggageStr),$out+="\r\n                               "),$out+="\r\n                            "),$out+='\r\n                            </em>\r\n                            <div class="jtxz-detail2 T_width2">\r\n                                ',2===listData[i].airType?$out+='\r\n                                <p class="YD_title">往返优惠</p>\r\n                                <p class="YD_mgb">此航班往返程为指定航班，您可以根据需要自行选择</p>\r\n                                ':3===stockType&&($out+='\r\n                                <p class="YD_title">现询</p>\r\n                                <p class="YD_mgb">此航班为现询航班，需客服确认后才能确认是否有位置，如果需要立即确认，请选择其他航班。</p>\r\n                                '),$out+="\r\n\r\n                                ",1===listData[i].airType&&listData[i].purchaseNotes?($out+='\r\n                                <p class="YD_title">预订限制</p>\r\n                                <p class="YD_mgb">',$out+=$string(listData[i].purchaseNotes),$out+="</p>\r\n                                "):($out+="\r\n                                ",itemData.travelerCategory&&($out+='\r\n                                <p class="YD_title">预订限制</p>\r\n                                <p class="YD_mgb">该机票为特价票，限出游人类型为：',$out+=$escape(itemData.travelerCategory),$out+="</p>\r\n                                "),$out+="\r\n                                "),$out+='\r\n\r\n                                <p class="YD_title">行李额说明</p>\r\n                                ',(listData[i].freeLuggage||0==listData[i].freeLuggage)&&listData[i].freeLuggageUnit||listData[i].luggageLimitStatement||listData[i].baggageInfo?($out+='\r\n                                <p class="YD_mgb">\r\n                                ',listData[i].freeLuggage?($out+="\r\n                                    ",$out+=$escape(listData[i].freeLuggage),$out+=$escape(listData[i].freeLuggageUnit),$out+="以下免托运行李费用\r\n                                "):listData[i].luggageLimitStatement?($out+="\r\n                                    ",$out+=$escape(listData[i].luggageLimitStatement),$out+="\r\n                                "):listData[i].baggageInfo?($out+="\r\n                                    ",$out+=$escape(listData[i].baggageInfo),$out+="\r\n                                "):$out+="\r\n                                    无免费托运行李额\r\n                                ",$out+="\r\n                                </p>\r\n                                "):$out+='\r\n                                <p class="YD_mgb">如需了解行李额信息，请您致电4007-999-999咨询。</p>\r\n                                ',$out+="\r\n                                ",listData[i].overloadLuggage&&($out+='\r\n                                <p class="YD_mgb next-line">',$out+=$escape(listData[i].overloadLuggage),$out+="</p>\r\n                                "),$out+='\r\n\r\n                                <span class="z">◆</span>\r\n                                <span class="j">◆</span>\r\n                            </div>\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n            '}$out+="\r\n        </div>\r\n        "}$out+="\r\n    </div>\r\n    "}return $out+="\r\n</div>",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(75),__webpack_require__(17),__webpack_require__(5),__webpack_require__(16)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,tpl,Layer,eventBus,tools){return Backbone.View.extend({el:"#m-float-airplane",events:{"click .T_cancel":"cancel","click .float-header h2":"changeType","click .package .select":"selectPackage","click .custom .cf-c-items .select":"selectIndividual","click .cf-c-checkbox":"filter","click .cf-c-moreopt":"toggleFilter","click .sort":"sort","click .stop_zj":"showTransferDetail","click .cf-winbtns-ok":"confirm","click .cf-c-subtitle .select":"reselectIndividual"},initialize:function(){this.listenTo(this.model,"needRender",this.render),this.listenTo(this.model,"showLoading",this.showLoading),this.listenTo(this.model,"loadError",this.loadError)},render:function(showMoreFilter){layer.closeAll();var data=this.model.toJSON(),html=tpl(data);this.$el.html(html).show(),this.responsive(),this.changeConfirmBtnStatus(),this.hideSomeFilter(showMoreFilter)},showLoading:function(){Layer.load("请稍后...")},loadError:function(){Layer.closeAll(),tools.layer({msg:"无可更改航班，请刷新页面重试或更换产品"})},changeType:function(e){var obj=$(e.currentTarget),selectType=obj.data("selecttype");this.model.changeType(selectType),this.responsive(),this.changeConfirmBtnStatus()},selectPackage:function(e){var obj=$(e.currentTarget);if(!obj.parent().hasClass("T_disabled")){var operation=this.$el.find(".cf-detail-operation");operation.find(".btn").removeClass("selected"),operation.find(".btn .text").text("选择"),obj.addClass("selected"),obj.find(".text").text("已选"),this.changeConfirmBtnStatus()}},selectIndividual:function(e){var journeyIndex,obj=$(e.currentTarget),airType=obj.data("type"),airplaneId=obj.data("id");if(!obj.hasClass("T_disabled")){journeyIndex=this.model.get("individualData").journeyIndex;var airTypeList=this.model.get("airTypeList")||[];airTypeList[journeyIndex]=airType,this.model.set("airTypeList",airTypeList),this.model.format(++journeyIndex,{airType:airType,airplaneId:airplaneId})}},reselectIndividual:function(e){var obj=$(e.currentTarget),journeyIndex=$(obj).data("index"),airType=this.model.get("airTypeList")[journeyIndex];this.model.set("journeyIndexSelect",journeyIndex),this.model.format(journeyIndex,{airType:airType})},filter:function(e){var obj=$(e.target),disabled=obj.hasClass("T_disabled");if(!disabled){var key=obj.data("key"),type=obj.parents("li").data("type"),showMoreFilter=!1;this.$el.find(".cf-c-options .cf-c-option").each(function(index,item){if(index>3)return $(item).hasClass("hide")||(showMoreFilter=!0),!1}),this.model.filter(type,key),this.render(showMoreFilter),this.changeDisabled()}},sort:function(e){var obj=$(e.target),type=obj.attr("sort-key"),showMoreFilter=!1;this.$el.find(".cf-c-options .cf-c-option").each(function(index,item){if(index>3)return $(item).hasClass("hide")||(showMoreFilter=!0),!1}),this.model.sort(type),this.render(showMoreFilter)},hideSomeFilter:function(isShow){this.$el.find(".cf-c-options .cf-c-option").each(function(index,item){index>3&&(isShow?$(item).removeClass("hide"):$(item).addClass("hide"))}),isShow?this.$el.find(".cf-c-moreopt").text("收起").addClass("T_active"):this.$el.find(".cf-c-moreopt").text("更多选项").removeClass("T_active")},toggleFilter:function(e){var obj=$(e.target);if("更多选项"==obj.text().trim())obj.text("收起").addClass("T_active"),obj.prevAll().removeClass("hide");else{obj.text("更多选项").removeClass("T_active");var parent=obj.parent();parent.find(".cf-c-option").each(function(index,option){index>3&&$(option).addClass("hide")})}},changeDisabled:function(){var zf,self=this,zz=[];if(self.$el.find(".cf-c-option").each(function(index,item){var type=$(item).data("type");"routeLineList"==type&&$(item).find(".cf-c-checkbox").each(function(_index,_item){"1"==$(_item).data("key")&&(zf=_item)}),"transferCityList"!=type&&"transferDurationList"!=type||$(item).find(".cf-c-checkbox").each(function(_index,_item){zz.push(_item)})}),zf&&!_.isEmpty(zz)){$(zf).hasClass("T_active")?_.each(zz,function(item){$(item).addClass("T_disabled")}):_.each(zz,function(item){$(item).removeClass("T_disabled")});var zzActive=!1;_.some(zz,function(item){if($(item).hasClass("T_active"))return zzActive=!0,!0}),zzActive?$(zf).addClass("T_disabled"):$(zf).removeClass("T_disabled")}},showTransferDetail:function(e){var obj=$(e.target);obj.parents("table").next().toggle()},responsive:function(){var self=this,resize=function(){var height=$(window).height();self.$el.find(".cf-content").css({height:height-182})};$(window).off("resize.airplaneList").on("resize.airplaneList",function(){resize()}),resize()},changeConfirmBtnStatus:function(){var airType,header=this.$el.find(".float-header"),body=this.$el.find(".cf-content"),confirmBtn=this.$el.find(".cf-winbtns-ok"),selectPkg=!1,individualData=this.model.get("individualData");if(header.children("h2").each(function(index,item){$(item).hasClass("active")&&(airType=$(item).hasClass("package")?1:2)}),1==airType)body.find(".cf-detail-operation .btn").each(function(index,item){if($(item).hasClass("selected"))return selectPkg=!0,!1}),selectPkg?confirmBtn.removeClass("disabled"):confirmBtn.addClass("disabled");else{var hasSelected=_.some(individualData.list,function(item){return _.some(item.cabinTypeRes,function(cabin){return cabin.selected})});hasSelected?confirmBtn.removeClass("disabled"):confirmBtn.addClass("disabled")}},confirm:function(e){var airType,pkgIndex,obj=$(e.target),header=this.$el.find(".float-header"),individualData=this.model.get("individualData"),journeyIndex=individualData.journeyIndex,journeyLength=individualData.journeyLength;if(!obj.hasClass("disabled")){if(header.children("h2").each(function(index,item){$(item).hasClass("active")&&(airType=$(item).hasClass("package")?1:2)}),1==airType)this.$el.find(".cf-detail-operation .btn").each(function(index,item){if($(item).hasClass("selected"))return pkgIndex=+$(item).data("index"),!1});else if(this.$el.find(".custom .btn").each(function(index,item){if($(item).hasClass("selected"))return $(item).click(),!1}),journeyIndex<journeyLength-1)return;this.model.changeAirplane(airType,pkgIndex),this.$el.hide(),this.model.destroyAll(),eventBus.trigger("airplaneListClosed")}},cancel:function(){this.$el.hide(),this.model.destroyAll(),eventBus.trigger("airplaneListClosed")}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,pkgFlight=($utils.$helpers,$data.pkgFlight),selectType=$data.selectType,group=$data.group,individualFlight=$data.individualFlight,$escape=$utils.$escape,isInternationalFlag=$data.isInternationalFlag,i=$data.i,item=$data.item,k=$data.k,item2=$data.item2,helperIsExist=$data.helperIsExist,isHasPurchaseNotes=$data.isHasPurchaseNotes,$string=$utils.$string,helperAirplaneShowPrice=$data.helperAirplaneShowPrice,selected=$data.selected,resIds=$data.resIds,totalNum=$data.totalNum,adultNum=$data.adultNum,childNum=$data.childNum,totalLeftDisabled=$data.totalLeftDisabled,atLeastNumDisabled=$data.atLeastNumDisabled,btnText=$data.btnText,_=$data._,cityNameList=$data.cityNameList,individualData=($data.index,$data.individualData),helperGetJourney=$data.helperGetJourney,filter=($data.selectData,$data.filter),helperFormatFilterName=($data.key,$data.helperFormatFilterName),departTimeSortData=($data.sub,$data.departTimeSortData),helperGetSortInfo=$data.helperGetSortInfo,arriveTimeSortData=$data.arriveTimeSortData,priceSortData=$data.priceSortData,disabled=($data.freeLuggageStr,$data.disabled),$out="";if($out+='<div class="float-bg"></div>\n<div class="float-content">\n\n    <header class="float-header">\n        <h2 class="package ',pkgFlight||($out+="hide"),$out+=" ",1==selectType&&($out+="active"),$out+='" data-selectType="1">推荐组合</h2>\n        <h2 class="custom ',group||individualFlight||($out+="hide"),$out+=" ",2==selectType&&($out+="active"),$out+='" data-selectType="2">自由组合</h2>\n        <span><i class="icon book-close T_cancel"></i></span>\n    </header>\n\n    <div class="cf-content">\n        ',1==selectType){$out+='\n        <div class="package">\n            <div class="cf-c-subtitle selectJounery">\n                <span class="first">选择去/返程：</span>\n                <span>',$out+=$escape(pkgFlight.departureCityName),$out+=" — ",$out+=$escape(pkgFlight.destinationCityName),$out+="/",$out+=$escape(pkgFlight.destinationCityName),$out+=" — ",$out+=$escape(pkgFlight.departureCityName),$out+='</span>\n            </div>\n\n            <div class="cf-c-sort">\n                <span>共<i class="cf-c-sort-nm">',$out+=$escape(pkgFlight.flightlist.length),$out+='</i>个推荐组合</span>\n            </div>\n\n            <ul class="result-list">\n                <li class="one-list head">\n                    <div class="flight-info ">航班信息</div>\n                    <div class="flight-start-time"> ',$out+=$escape(isInternationalFlag?"当地起飞时间":"起飞时间"),$out+='\n                        <i class="sort-icon"></i>\n                    </div>\n                    <div class="flight-during">&nbsp;</div>\n                    <div class="flight-end-time"> ',$out+=$escape(isInternationalFlag?"当地到达时间":"到达时间"),$out+='<i class="sort-icon"></i> </div>\n                    <div class="seat-ctn">\n                        <div class="flight-cabin">舱位</div>\n                        <div class="flight-describe ">&nbsp;</div>\n                        <div class="flight-diff-price">差价 <i class="sort-icon"></i> </div>\n                        <div class="flight-select"></div>\n                    </div>\n                </li>\n            </ul>\n\n            ';for(var i=0;i<pkgFlight.flightlist.length;i++){var item=pkgFlight.flightlist[i];$out+='\n            <div class="cf-c-items">\n                <div class="cf-c-item">\n                    <div class="cf-c-item-main">\n                        ';for(var k=0;k<pkgFlight.flightlist[i].listData.length;k++){var item2=item.listData[k];$out+="\n                        ",(item2.onTimeRate||item2.billTypeName)&&($out+='\n                                 <div class="flight_timerate">\n                                    ',item2.onTimeRate&&($out+='\n                                       <span class="timeRate">准点率:',$out+=$escape(item2.onTimeRate),$out+="%</span>\n                                     "),$out+="\n\n                                    ",item2.billTypeName&&($out+='\n                                         <span class="billTypeName">',$out+=$escape(item2.billTypeName),$out+="</span>\n                                    "),$out+="\n                                 </div>\n                        "),$out+='\n                        <ul>\n                            <li class="T_airplane cf-detail-col2">\n                                <div class="cf-detail-company">\n                                    <i class="airplane-company-icon airport_',$out+=$escape(item2.flightCode),$out+='"></i>\n                                    ',$out+=$escape(item2.airlineName),$out+='\n                                </div>\n                                <div class="cf-detail-nm">\n                                     <span class="flightNo f-ol f-bb">',$out+=$escape(item2.flightNo),$out+="&nbsp;",$out+=$escape(item2.airplaneTypeName),$out+='</span>\n                                     <div class="flightNo_detail">\n                                                                                                 <table>\n                                                                                                    <tr>\n                                                                                                       <th>机型名称</th>\n                                                                                                       <th>飞机类型</th>\n                                                                                                       <th>餐食</th>\n                                                                                                    </tr>\n                                                                                                    <tr>\n                                                                                                       <td>',$out+=$escape(item2.flightNo),$out+="</td>\n                                                                                                       <td>",$out+=$escape(item2.airplaneTypeName),$out+="</td>\n                                                                                                       <td>\n                                                                                                        ",helperIsExist(item2.hasMeal)?($out+="\n                                                                                                         ",$out+=$escape(item2.hasMeal?"是":"否"),$out+="\n                                                                                                           "):$out+="\n                                                                                                            ___\n                                                                                                        ",$out+='\n                                                                                                       </td>\n                                                                                                    </tr>\n                                                                                                 </table>\n                                     <span class="z">◆</span>\n                                                                     <span class="j">◆</span>\n                                                                                             </div>\n                                </div>\n                            </li>\n\n                            <li class=" T_depart_time">\n                                <span class="cf-detail-time">',$out+=$escape(item2.departTime),$out+='</span>\n                                <span class="cf-detail-airport">',$out+=$escape(item2.departureAirportName),$out+='</span>\n                            </li>\n\n                            <li class=" cf-detail-arrow">\n\n                                ',item2.stopTip&&($out+='\n                                <div class="tour-stop-hover">\n                                    <span class="cf-detail-stopover">经停</span>\n\n                                    <div class="stop-over-info">\n                                        <table class="stop-over-table">\n                                            <tr class="info-title">\n                                                <td class="airport">经停机场</td>\n                                                <td class="stop-time">停留时间</td>\n                                            </tr>\n\n                                            <tr class="info-content">\n                                                <td class="airport-detail">',
$out+=$escape(item2.stopTip.stopAirportName),$out+='</td>\n                                                <td class="stop-time-detail">',$out+=$escape(item2.stopTip.durationTime),$out+='</td>\n                                            </tr>\n                                        </table>\n                                        \n                                        <span class="z">◆</span>\n                                        <span class="j">◆</span>\n                                    </div>\n                                </div>\n                                '),$out+='\n                                <div class="T_duration">',$out+=$escape(item2.duration),$out+='</div>\n                            </li>\n\n                            <li class="T_arrive_time">\n                        <span class="cf-detail-time">\n                            ',$out+=$escape(item2.arriveTime),$out+="\n\n                            ",1!=item2.arriveDay&&item2.arriveDay!=-1||($out+='\n                            <span class="T_arrive_day">\n                                ',$out+=$escape(1==item2.arriveDay?"+1":"-1"),$out+="\n                            </span>\n                            "),$out+='\n                        </span>\n                                <span class="cf-detail-airport">',$out+=$escape(item2.destinationAirportName),$out+='</span>\n                            </li>\n\n                            <li class="T_cabin">\n                                <span class="cf-detail-level">',$out+=$escape(item2.cabinType),$out+='</span>\n                            </li>\n\n                            <div class="clearfix"></div>\n                        </ul>\n                        '}$out+='\n                    </div>\n\n                    <span class="T_rule cf-detail-notice">\n\n            <div class="T_text jtxz-detail-hover">\n                <i class="icon notice2-icon"></i><em class="f-bb">\n                   ';var isHasPurchaseNotes=item.listData[0].purchaseNotes;$out+="\n                   ",$out+=isHasPurchaseNotes||isHasPurchaseNotes&&3==item.stockType?"\n                      限制/行李额\n                   ":(isHasPurchaseNotes||3!=item.stockType,"\n                      行李额\n                   "),$out+='\n                </em>\n                <div class="jtxz-detail2 T_width2">\n                    ',3==item.stockType&&($out+='\n                    <p class="YD_title">现询</p>\n                        <p class="YD_mgb">此航班为现询航班，需客服确认后才能确认是否有位置，如果需要立即确认，请选择其他航班。</p>\n                    '),$out+="\n                    ",item.listData[0].purchaseNotes&&($out+='\n                    <p class="YD_title">预订限制</p>\n                        <p class="YD_mgb">',$out+=$string(item.listData[0].purchaseNotes),$out+="</p>\n                    "),$out+='\n\n                    <p class="YD_title">行李额说明</p>\n                    ',item.listData[0].luggageLimitStatement?($out+='\n                    <p class="YD_mgb">\n                    ',$out+=$escape(item.listData[0].luggageLimitStatement),$out+="\n                    </p>\n                    "):$out+='\n                    <p class="YD_mgb">如需了解行李额信息，请您致电4007-999-999咨询。</p>\n                    ',$out+="\n                    ",item.listData[0].overloadLuggage&&($out+='\n                    <p class="YD_mgb next-line">',$out+=$escape(item.listData[0].overloadLuggage),$out+="</p>\n                    "),$out+='\n                    <span class="z">◆</span>\n                    <span class="j">◆</span>\n                </div>\n            </div>\n        </span>\n\n                    <span class="cf-detail-difference">\n            ',$out+=$string(helperAirplaneShowPrice(item.diffAdultPrice+item.diffChildPrice)),$out+="\n        </span>\n\n                    ";var selected=item.listData[0].resId==resIds[0],totalNum=adultNum+childNum,totalLeftDisabled=item.totalLeft<totalNum&&3!=item.stockType&&2!=item.stockType,atLeastNumDisabled=item.listData[0].minBookingNum>totalNum;$out+='\n                    <div class="cf-detail-operation ',(totalLeftDisabled||atLeastNumDisabled)&&($out+="T_disabled"),$out+='">\n                        <div class="btn select ',$out+=$escape(selected?"selected":""),$out+='" data-index="',$out+=$escape(i),$out+='">\n                            <span class="tn_fontface"></span>\n                            ';var btnText=selected?"已选":"选择";atLeastNumDisabled&&(btnText=item.listData[0].minBookingNum+"人起订"),$out+='\n                            <span class="text">',$out+=$escape(btnText),$out+='</span>\n                        </div>\n\n                        <div class="T_left_count">\n                            ',2==item.stockType?$out+="\n                            <div>余位充足</div>\n                            ":item.totalLeft<10&&($out+="\n\n                            ",item.totalLeft>=adultNum+childNum?($out+="\n                            <div>余位",$out+=$escape(item.totalLeft),$out+="</div>\n                            "):($out+='\n                            <div class="T_not">余位',$out+=$escape(item.totalLeft),$out+='</div>\n                            <div class="T_not">余位不足</div>\n                            '),$out+="\n\n                            "),$out+='\n                        </div>\n                    </div>\n\n                    <div class="clearfix"></div>\n                </div>\n\n                <div class="clearfix"></div>\n            </div>\n            '}$out+="\n        </div>\n        "}else{if($out+='\n        <div class="custom">\n\n            ',_.each(cityNameList,function(item,index){if($out+='\n            <div class="cf-c-subtitle\n                        ',index>individualData.journeyIndex&&($out+="hide"),$out+="\n                        ",index==individualData.journeyIndex&&($out+="selectJounery"),$out+='\n                        ">\n                <span class="first">\n                    ',$out+=$escape(index<individualData.journeyIndex?"已选":"选择"),$out+=$escape(helperGetJourney(index,individualData.journeyLength)),$out+="程：\n                </span>\n                <span>",$out+=$escape(item.departureCityName),$out+="—",$out+=$escape(item.destinationCityName),$out+="</span>\n                ",index<individualData.journeyIndex){$out+="\n                ";var selectData=individualData.selectedData[index];$out+="\n                ",selectData&&($out+='\n                <span class="select-info">',$out+=$escape(selectData.airlineName),$out+='</span>\n                <span class="select-info">',$out+=$escape(selectData.flightNo),$out+='</span>\n                <span class="select-info">',$out+=$escape(selectData.departTime),$out+="-",$out+=$escape(selectData.arriveTime),$out+='</span>\n                <span class="select-info">',$out+=$escape(selectData.cabinType),$out+="</span>\n                "),$out+="\n                "}$out+="\n                ",index<individualData.journeyIndex&&($out+='\n                <div class="T_select">\n                    <div class="btn select" data-index="',$out+=$escape(index),$out+='">\n                        重新选择\n                    </div>\n                </div>\n                '),$out+="\n            </div>\n            "}),$out+="\n\n            ",individualData.journeyIndex<individualData.journeyLength){$out+="\n\n            ";var filter=individualData.filter[individualData.journeyIndex];$out+="\n            ",_.isEmpty(filter)||($out+='\n            <ul class="cf-c-options">\n                ',_.each(filter,function(item,key){$out+="\n                ",_.isEmpty(item)||($out+='\n                <li class="cf-c-option" data-type="',$out+=$escape(key),$out+='">\n                    <span class="cf-c-optionheader">',$out+=$escape(helperFormatFilterName(key)),$out+="</span>\n                    <ul>\n                        ",_.each(item,function(sub){$out+='\n                        <li class="cf-c-checkbox ',sub.selected&&($out+="T_active"),$out+='" data-key="',$out+=$escape(sub.key),$out+='">\n                            ',$out+=$escape(sub.viewName),$out+="\n                        </li>\n                        "}),$out+='\n                    </ul>\n                    <div class="clearfix"></div>\n                </li>\n                '),$out+="\n                "}),$out+='\n                <li class="cf-c-moreopt ',_.keys(filter).length<=4&&($out+="hide"),$out+='">\n                    更多选项\n                </li>\n                <div class="clearfix"></div>\n            </ul>\n            '),$out+='\n\n            <div class="result-info">\n                <div class="text-right">机票价格中已含民航发展基金、燃油费及税费</div>\n                <div class="text-left">为你找到',$out+=$escape(individualData.list.length),$out+='个航班</div>\n            </div>\n\n            <ul class="result-list">\n                <li class="one-list head">\n                    ';var departTimeSortData=helperGetSortInfo(individualData.sort,"departTime"),arriveTimeSortData=helperGetSortInfo(individualData.sort,"arriveTime"),priceSortData=helperGetSortInfo(individualData.sort,"price");$out+='\n                    <div class="flight-info ">航班信息</div>\n                    <div class="flight-start-time sort ',departTimeSortData&&departTimeSortData.selected&&departTimeSortData.val==-1?$out+="sort-desc":departTimeSortData&&departTimeSortData.selected&&1==departTimeSortData.val&&($out+="sort-asc"),$out+='" sort-key="departTime"> ',$out+=$escape(isInternationalFlag?"当地起飞时间":"起飞时间"),$out+='\n                        <i class="sort-icon"></i>\n                    </div>\n                    <div class="flight-during">&nbsp;</div>\n                    <div class="flight-end-time  sort ',arriveTimeSortData&&arriveTimeSortData.selected&&arriveTimeSortData.val==-1?$out+="sort-desc":arriveTimeSortData&&arriveTimeSortData.selected&&1==arriveTimeSortData.val&&($out+="sort-asc"),$out+='" sort-key="arriveTime"> ',$out+=$escape(isInternationalFlag?"当地到达时间":"到达时间"),$out+='<i class="sort-icon"></i> </div>\n                    <div class="seat-ctn">\n                        <div class="flight-cabin">舱位</div>\n                        <div class="flight-describe ">&nbsp;</div>\n                        <div class="flight-diff-price sort ',priceSortData&&priceSortData.selected&&priceSortData.val==-1?$out+="sort-desc":priceSortData&&priceSortData.selected&&1==priceSortData.val&&($out+="sort-asc"),$out+='" sort-key="price">差价 <i class="sort-icon"></i> </div>\n                        <div class="flight-select"></div>\n                    </div>\n                </li>\n\n            </ul>\n\n            <div class="cf-c-items">\n                ',_.each(individualData.list,function(item){$out+="\n                ",(item.onTimeRate||item.billTypeName)&&($out+='\n                                                 <div class="flight_timerate">\n                                                    ',item.onTimeRate&&($out+='\n                                                       <span class="timeRate">准点率:',$out+=$escape(item.onTimeRate),$out+="%</span>\n                                                     "),$out+="\n\n                                                    ",item.billTypeName&&($out+='\n                                                         <span class="billTypeName">',$out+=$escape(item.billTypeName),$out+="</span>\n                                                    "),$out+="\n                                                 </div>\n                                        "),$out+='\n                <div class="T_main">\n                    <table>\n                        <tr class="T_border">\n\n\n                            <td class="T_airplane">\n                                <div class="T_first">\n                                    <i class="airplane-company-icon airport_',$out+=$escape(item.flightCode),$out+='"></i>\n                                    ',$out+=$escape(item.airlineName),$out+='\n                                </div>\n                                <div class="T_second">\n                                    <span class="flightNo f-ol f-bb">',$out+=$escape(item.flightNo),$out+='</span>\n                                    <div class="flightNo_detail">\n                                                                                                <table>\n                                                                                                   <tr>\n                                                                                                      <th>机型名称</th>\n                                                                                                      <th>飞机类型</th>\n                                                                                                      <th>餐食</th>\n                                                                                                   </tr>\n                                                                                                   <tr>\n                                                                                                      <td>',$out+=$escape(item.flightNo),$out+="</td>\n                                                                                                      <td>",$out+=$escape(item.airplaneTypeName),$out+="</td>\n                                                                                                      <td>\n                                                                                                       ",helperIsExist(item.hasMeal)?($out+="\n                                                                                                        ",$out+=$escape(item.hasMeal?"是":"否"),$out+="\n                                                                                                          "):$out+="\n                                                                                                           ___\n                                                                                                       ",$out+='\n                                                                                                      </td>\n                                                                                                   </tr>\n                                                                                                </table>\n                                    <span class="z">◆</span>\n                                                                    <span class="j">◆</span>\n                                                                                            </div>\n                                    ',item.codeshare&&($out+='\n                                    <span class="flight-share tour-stop-hover">\n                                        共享\n\n                                        <div class="stop-over-info T_width2">\n                                            <p class="notice">\n                                                ',$out+=$escape(item.airlineName),$out+=$escape(item.flightNo),$out+="，实际由",$out+=$escape(item.sAirComName),$out+=$escape(item.codeshare),$out+='承运\n                                            </p>\n                                            <span class="z">◆</span>\n                                            <span class="j">◆</span>\n                                        </div>\n                                    </span>\n                                    '),$out+='\n                                </div>\n                            </td>\n\n                            <td class="T_depart_time">\n                                <div class="T_first T_bold">',$out+=$escape(item.departTime),$out+='</div>\n                                <div class="T_second">',$out+=$escape(item.departureAirportName),$out+='</div>\n                            </td>\n\n                            <td class="T_pic">\n\n                                <div>\n                                    ',_.isEmpty(item.stopTip)||($out+='\n                                    <span class="tour-stop-hover T_stop">\n                                        经停\n                                        <div class="stop-over-info">\n\n                                        <table class="stop-over-table">\n                                            <tr class="info-title">\n                                                <td class="airport">经停机场</td>\n                                                ',item.stopTip.arriveTime&&($out+='\n                                                <td class="arrival-time">到达时间</td>\n                                                <td class="take-off-time">起飞时间</td>\n                                                '),$out+='\n                                                <td class="stop-time">停留时间</td>\n                                            </tr>\n\n                                            <tr class="info-content">\n                                                <td class="airport-detail">',$out+=$escape(item.stopTip.stopAirportName),$out+="</td>\n                                                ",item.stopTip.arriveTime&&($out+='\n                                                <td class="arrival-detail">\n                                                    <p class="time">',$out+=$escape(item.stopTip.arriveTime),$out+="</p>\n                                                    <p>",$out+=$escape(item.stopTip.arriveDate),$out+='</p>\n                                                </td>\n                                                <td class="take-off-detail">\n                                                    <p class="time">',$out+=$escape(item.stopTip.departTime),$out+="</p>\n                                                    <p>",$out+=$escape(item.stopTip.departDate),$out+="</p>\n                                                </td>\n                                                "),$out+='\n                                                <td class="stop-time-detail">',$out+=$escape(item.stopTip.durationTime),$out+='</td>\n                                            </tr>\n                                        </table>\n\n                                        <span class="z">◆</span>\n                                        <span class="j">◆</span>\n                                    </div>\n                                    </span>\n                                    '),$out+="\n\n                                    ",_.isEmpty(item.transfer)||($out+='\n                                    <div class="stop_zj"></div>\n                                    <div class="stop_zj">中转</div>\n                                    '),$out+='\n                                </div>\n                                <div class="T_duration">',$out+=$escape(item.duration),$out+='</div>\n\n                            </td>\n\n                            <td class="T_arrive_time">\n                                <div class="T_first T_bold">\n                                    ',$out+=$escape(item.arriveTime),$out+="\n\n                                    ",1!=item.arriveDay&&item.arriveDay!=-1||($out+='\n                                    <span class="T_arrive_day">\n                        ',$out+=$escape(1==item.arriveDay?"+1":"-1"),$out+="\n                    </span>\n                                    "),$out+='\n                                </div>\n                                <div class="T_second">',$out+=$escape(item.destinationAirportName),$out+='</div>\n                            </td>\n\n                            <td class="T_right">\n                                ',_.each(item.cabinTypeRes,function(item2){$out+='\n                                <div class="T_para">\n                                    <div class="T_inline T_cabin">\n                                        ',$out+=$escape(item2.cabinType),$out+='\n                                    </div>\n                                    <div class="T_inline T_rule">\n                                <span class="jtxz-detail-hover">\n                                <i class="icon notice2-icon"></i><em class="f-bb">\n                                    ';var isHasPurchaseNotes=item2.travelerCategory,freeLuggageStr="无行李额";item2.freeLuggage>0&&item2.freeLuggage<20?freeLuggageStr="行李额低":(item2.freeLuggage>=20||item2.baggageInfo)&&(freeLuggageStr="行李额"),$out+="\n                                   ",isHasPurchaseNotes||isHasPurchaseNotes&&2==item.airType?($out+="\n                                      限制/",$out+=$escape(freeLuggageStr),$out+="\n                                   "):isHasPurchaseNotes||2!=item.airType?($out+="\n                                      ",$out+=$escape(freeLuggageStr),$out+="\n                                   "):($out+="\n                                      ",$out+=$escape(freeLuggageStr),$out+="\n                                   "),$out+='\n                                </em>\n\n                                 <div class="jtxz-detail2 T_width2">\n                                     ',2==item.airType&&($out+='\n                                     <p class="YD_title">往返优惠</p>\n                                        <p class="YD_mgb">此航班往返程为指定航班，您可以根据需要自行选择</p>\n                                     '),$out+="\n\n                                     ",item2.travelerCategory&&($out+='\n                                     <p class="YD_title">预订限制</p>\n                                        <p class="YD_mgb">该机票为特价票，限出游人类型为：',$out+=$escape(item2.travelerCategory),$out+="</p>\n                                     "),$out+='\n\n                                     <p class="YD_title">行李额说明</p>\n                                     ',(item2.freeLuggage||0==item2.freeLuggage)&&item2.freeLuggageUnit||item2.baggageInfo?($out+='\n                                     <p class="YD_mgb">\n                                         ',item2.freeLuggage?($out+="\n                                         ",$out+=$escape(item2.freeLuggage),$out+=$escape(item2.freeLuggageUnit),$out+="以下免托运行李费用\n                                         "):item2.baggageInfo?($out+="\n                                         ",$out+=$escape(item2.baggageInfo),$out+="\n                                         "):$out+="\n                                         无免费托运行李额\n                                         ",$out+="\n                                     </p>\n                                     "):$out+='\n                                     <p class="YD_mgb">如需了解行李额信息，请您致电4007-999-999咨询。</p>\n                                     ',$out+="\n                                     ",item2.overloadLuggage&&($out+='\n                                     <p class="YD_mgb next-line">',$out+=$escape(item2.overloadLuggage),$out+="</p>\n                                     "),$out+='\n                                     <span class="z">◆</span>\n                                     <span class="j">◆</span>\n                                 </div>\n                             </span>\n                                    </div>\n\n                                    <div class="T_inline T_price">\n                                        <div>',$out+=$string(helperAirplaneShowPrice(item2.diffAdultPrice+item2.diffChildPrice)),$out+='</div>\n                                    </div>\n\n                                    <div class="T_inline T_select">\n                                        ',item2.selected?($out+='\n                                        <div class="btn select selected" data-type="',$out+=$escape(item.airType),$out+='" data-id="',$out+=$escape(item2.resId),$out+='">\n                                            √已选\n                                        </div>\n                                        '):($out+='\n                                        <div class="btn select ',item2.disabled&&($out+="T_disabled"),$out+='" data-type="',$out+=$escape(item.airType),$out+='" data-id="',$out+=$escape(item2.resId),$out+='">\n                                            <span class="tn_fontface"></span>\n                                            选择\n                                        </div>\n                                        '),$out+="\n\n                                        ",item2.totalLeft<10&&($out+='\n                                        <div class="T_rest">余位',$out+=$escape(item2.totalLeft),$out+="</div>\n                                        "),$out+="\n                                    </div>\n                                </div>\n                                "}),$out+="\n                            </td>\n                        </tr>\n                    </table>\n\n                    ",_.isEmpty(item.transferInfo)||($out+='\n                    <div class="T_zj_detail">\n                        <span class="T_orange_triangle"></span>\n                        <table>\n                            ',_.each(item.transferInfo,function(item2){$out+='\n                            <tr>\n                                <td class="T_city_fuck">\n                                    <div class="T_first">\n                                        ',$out+=$escape(item2.departDate),$out+='\n                                    </div>\n                                    <div class="T_second">\n                                        ',$out+=$escape(item2.departureCityName),$out+=" — ",$out+=$escape(item2.destinationCityName),$out+='\n                                    </div>\n                                </td>\n                                <td class="T_airplane">\n                                    <div class="T_first">\n                                        <i class="airplane-company-icon airport_',$out+=$escape(item2.flightCode),$out+='"></i>\n                                        ',$out+=$escape(item2.airlineName),$out+='\n                                    </div>\n                                    <div class="T_second">\n                                      ',(item2.onTimeRate||item2.billTypeName)&&($out+='\n                                                                                       <div class="flight_timerate">\n                                                                                          ',item2.onTimeRate&&($out+='\n                                                                                             <span class="timeRate">准点率:',$out+=$escape(item2.onTimeRate),$out+="%</span>\n                                                                                           "),$out+="\n\n                                                                                          ",item2.billTypeName&&($out+='\n                                                                                               <span class="billTypeName">',$out+=$escape(item2.billTypeName),$out+="</span>\n                                                                                          "),$out+="\n                                                                                       </div>\n                                                                              "),$out+='\n                                     <span class="flightNo f-ol f-bb">',$out+=$escape(item2.flightNo),$out+='</span>\n                                     <div class="flightNo_detail">\n                                                                                                                                      <table>\n                                                                                                                                         <tr>\n                                                                                                                                            <th>机型名称</th>\n                                                                                                                                            <th>飞机类型</th>\n                                                                                                                                            <th>餐食</th>\n                                                                                                                                         </tr>\n                                                                                                                                         <tr>\n                                                                                                                                            <td>',$out+=$escape(item2.flightNo),$out+="</td>\n                                                                                                                                            <td>",$out+=$escape(item2.airplaneTypeName),$out+="</td>\n                                                                                                                                            <td>\n                                                                                                                                             ",helperIsExist(item2.hasMeal)?($out+="\n                                                                                                                                              ",$out+=$escape(item2.hasMeal?"是":"否"),$out+="\n                                                                                                                                                "):$out+="\n                                                                                                                                                 ___\n                                                                                                                                             ",$out+='\n                                                                                                                                            </td>\n                                                                                                                                         </tr>\n                                                                                                                                      </table>\n                                                                          <span class="z">◆</span>\n                                                                                                          <span class="j">◆</span>\n                                                                                                                                  </div>\n                                    </div>\n                                </td>\n                                <td class="T_depart_time">\n                                    <div class="T_first T_bold">\n                                        ',$out+=$escape(item2.departTime),$out+='\n                                    </div>\n                                    <div class="T_second">\n                                        ',$out+=$escape(item2.departureAirportName),$out+='\n                                    </div>\n                                </td>\n                                <td class="T_pic">\n                                    <div class="T_duration">',$out+=$escape(item2.duration),$out+='</div>\n                                </td>\n                                <td class="T_arrive_time">\n                                    <div class="T_first T_bold">\n                                        ',$out+=$escape(item2.arriveTime),$out+="\n\n                                        ",item2.arriveDay&&($out+='\n                                        <span class="T_arriveDay jtxz-detail-hover">\n                            ',$out+=$escape(item2.arriveDay),$out+="\n                        </span>\n                                        "),$out+='\n                                    </div>\n                                    <div class="T_second">\n                                        ',
$out+=$escape(item2.destinationAirportName),$out+='\n                                    </div>\n                                </td>\n                                <td class="T_cabin">\n                                    ',$out+=$escape(item2.cabinType),$out+="\n                                </td>\n                            </tr>\n\n                            ",item2.transfer&&($out+='\n                            <tr>\n                                <td colspan="6">\n                                    <div class="T_middle">\n                                        <span class="T_left">中转城市：',$out+=$escape(item2.transfer.city),$out+="</span>\n                                        <span>中转时间：",$out+=$escape(item2.transfer.duration),$out+="</span>\n                                        ",item.visaTips&&($out+='\n                                        <span class="T_right">',$out+=$escape(item.visaTips),$out+="</span>\n                                        "),$out+="\n                                    </div>\n                                </td>\n                            </tr>\n                            "),$out+="\n\n                            "}),$out+="\n                        </table>\n\n                        ",(item.transferTips||item.visaTips)&&($out+='\n                        <div class="T_note">\n                            ',item.transferTips&&($out+="\n                            <div>不同机场：中转机场不在同一机场，请注意。</div>\n                            "),$out+="\n                            ",item.visaTips&&($out+="\n                            <div>过境签：此行程需要过境转机，中国大陆公民过境韩国，可能需要申请该过境签证，请确认签证无误。</div>\n                            "),$out+="\n                        </div>\n                        "),$out+="\n\n                    </div>\n                    "),$out+="\n\n                </div>\n                "}),$out+="\n\n                ",individualData.list.length||($out+='\n                <h4 class="T_no_data">没有找到符合条件的航班，换个条件再试试吧~</h4>\n                '),$out+="\n\n            </div>\n            "}$out+="\n        </div>\n        "}return $out+='\n    </div>\n    <div class="cf-winbtns">\n        <div class="cf-winbtns-ok ',disabled&&($out+="disabled"),$out+='">确认</div>\n        <div class="cf-winbtns-cancel T_cancel">取消</div>\n    </div>\n</div>\n',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(77),__webpack_require__(5),__webpack_require__(17),__webpack_require__(6),__webpack_require__(16),__webpack_require__(78),__webpack_require__(79)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,TrainTemplate,EventBus,Layer,config,tools,container,floatTip){var pageDataObj=config.pageDataObj;return Backbone.View.extend({el:"#m-train",events:{"click .m-more":"getTrainList"},initialize:function(){this.renderContainer(),this.listenTo(this.model,"needRenderContainer",this.renderContainer),this.listenTo(this.model,"needRender",this.render)},renderContainer:function(){if(2==pageDataObj.proMode||15==pageDataObj.proMode||17==pageDataObj.proMode){var data=this.model.toJSON(),html=container(data);this.$el.html(html).show()}},render:function(){var data=this.model.toJSON(),html=TrainTemplate(data);if(this.$el.find(".modular-body").html(html),$(".s-seatLimit").each(function(i,item){$(item).floatTip(".float-tip-train",{alignment:"right",offset:{x:20,y:0}})}),"back2"==pageDataObj.pageType){this.model.get("canChange")||this.$el.find(".m-more").addClass("hide");var el=this.$el.find(".m-title-desc").eq(0);this.model.get("isFromOrder")?el.addClass("hide"):el.html("此车次为默认推荐，请确认车次")}},getTrainList:function(){this.model.toJSON();EventBus.trigger("openTrainSelectPanel",{traficSeq:1},!0)},show:function(){this.$el.show(),this.$(".load-panel").removeClass("hide")},hideLoading:function(){this.$(".load-panel").addClass("hide")},showLoadError:function(){this.$(".load-error-panel").removeClass("hide")},checkLeftNumber:function(orderNum,type){if(this.model.get("isFromOrder"))return{success:!1};var data=this.model.get("list")||[],integerArr=["一","二","三","四","五","六","七","八"],len=data.length,firstTraSeq=1,nextFlag=!0,msg="",dataTips=[];if(2==len)data[0].price.leftNumber<orderNum?dataTips.push("去程"):"",data[0].price.leftNumber<orderNum?nextFlag=!nextFlag:"",data[1].price.leftNumber<orderNum?dataTips.push("返程"):"",nextFlag?firstTraSeq=2:"";else for(var i=0;i<len;i++)data[i].price.leftNumber<orderNum&&(dataTips.push("第"+integerArr[i]+"程"),nextFlag&&(firstTraSeq=i+1,nextFlag=!nextFlag));return msg="当前"+dataTips.join("、")+"车次余位不足，请您选择其他车次",type=type?type:0,type&&dataTips.length?{success:!0,msg:msg,data:{traficSeq:firstTraSeq}}:type&&!dataTips.length?{success:!1}:void(!type&&dataTips.length&&EventBus.trigger("checkTrainReChoose",msg,{traficSeq:firstTraSeq}))},showChangeDialog:function(msg,data){tools.layer({btn:["更改车次"],icon:2,msg:msg,yes:function(){EventBus.trigger("openTrainSelectPanel",data,!0),Layer.closeAll()}})},showCheckLoading:function(){Layer.load("正在验证，请稍后...")},hideCheckLoading:function(){Layer.closeAll()},hideTrainModular:function(){this.$el.hide()}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,list=($utils.$helpers,$data.list),i=$data.i,$escape=$utils.$escape,showXz=$data.showXz,isCorrectTime=$data.isCorrectTime,showYw=$data.showYw,isPageShowTrain=$data.isPageShowTrain,$out="";if(list&&list.length){$out+="\r\n";for(var i=0;i<list.length;i++){$out+='\r\n<div class="selected-train clearfix',i<list.length-1&&($out+=" first"),$out+='">\r\n\t<div class="date column">\r\n\t\t<span class="order-place f-ol" title="',$out+=$escape(list[i].departCityName),$out+="-",$out+=$escape(list[i].destCityName),$out+='">',$out+=$escape(list[i].departCityName),$out+="-",$out+=$escape(list[i].destCityName),$out+='</span>\r\n\t\t<span class="order-date">',$out+=$escape(list[i].departDate),$out+='</span>\r\n\t</div>\r\n\t<div class="trainNo column">',$out+=$escape(list[i].trainNum),$out+='</div>\r\n\t<div class="departure column">\r\n\t\t<span class="departurePlace f-ol ',$out+=$escape(list[i].departDepartTime?"":"vertical-center"),$out+='">',$out+=$escape(list[i].departStationName),$out+="</span>\r\n\t\t",list[i].departDepartTime&&($out+='\r\n\t\t<span class="departureTime ',$out+=$escape(list[i].isUnsureTicket?"unSureTicketTime":""),$out+='">',$out+=$escape(list[i].departDepartTime),$out+="</span>\r\n\t\t"),$out+='\r\n\t</div>\r\n\t<div class="duration column">\r\n\t    ',list[i].duration?$out+='\r\n\t    <span class="tips">历时</span>\r\n\t    ':($out+='\r\n\t    <span class="tips">时间待定\r\n\t\t\t<div class="childCount-tips jtxz-detail-hover">\r\n                <i class="icon notice2-icon"></i>\r\n                <div class="jtxz-detail2">\r\n                    <p class="YD_mgb">',$out+=$escape(list[i].durationTextDetail),$out+='</p>\r\n                    <span class="z">◆</span>\r\n                    <span class="j">◆</span>\r\n                </div>\r\n            </div>\r\n\t    </span>\r\n\t    '),$out+='\r\n\t    <span class="text"><em class="f-ol" title="',$out+=$escape(list[i].duration),$out+='">',$out+=$escape(list[i].duration),$out+='</em></span>\r\n\t</div>\r\n\t<div class="arrival column">\r\n\t\t<span class="arrivalPlace f-ol ',$out+=$escape(list[i].destArriveTime?"":"vertical-center"),$out+='" title="',$out+=$escape(list[i].destStationName),$out+='">\r\n\t\t    ',$out+=$escape(list[i].destStationName),$out+="\r\n\t\t</span>\r\n\t\t",list[i].destArriveTime&&($out+='\r\n\t\t<span class="arrivalTime ',$out+=$escape(list[i].isUnsureTicket?"unSureTicketTime":""),$out+='">\r\n\t\t\t',$out+=$escape(list[i].destArriveTime),$out+="\r\n\t\t\t",list[i].durationDay>1&&($out+='\r\n\t\t\t<i class="T_first_train_duration">+',$out+=$escape(list[i].durationDay-1),$out+="</i>\r\n\t\t\t"),$out+="\r\n\t\t</span>\r\n\t\t"),$out+='\r\n\t</div>\r\n\t<div class="seatType column f-ol" title="',$out+=$escape(list[i].price.seatName),$out+='">',$out+=$escape(list[i].price.seatName),$out+="</div>\r\n\t";var showXz=!list[i].price.isStockTicket&&isCorrectTime,showYw=void 0!=list[i].price.leftNumber&&isPageShowTrain;$out+='\r\n\t<div class="seatLeft column ',showXz&&showYw&&($out+="two-line"),$out+='">\r\n\t\t',showXz&&($out+='\r\n\t\t<div class="seatLimit">\r\n\t\t\t<span class="s-seatLimit">限制</span>\r\n\t\t</div>\r\n\t\t'),$out+="\r\n\r\n\t\t",showYw&&($out+="\r\n\t\t<div>\r\n\t\t\t ",$out+=list[i].price.leftNumber>20?"\r\n                有票\r\n             ":0==list[i].price.leftNumber?"\r\n                没票\r\n             ":"\r\n                票量紧张\r\n             ",$out+="\r\n\t\t</div>\r\n\t\t"),$out+="\r\n\t</div>\r\n</div>\r\n"}$out+="\r\n"}return new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,unsureInfoShow=($utils.$helpers,$data.unsureInfoShow),$out="";return $out+='<h2>\r\n    <a class="m-more">更改火车票<i class="icon more-icon"></i></a>\r\n    <span class="icon train-icon"></span>\r\n    <span class="m-title">火车票信息</span>\r\n    <span class="m-title-desc">火车票车次为默认匹配，您可自行选择车次、座位等级和价格，合理安排行程</span>\r\n</h2>\r\n<div class="modular-body mix-traffic">\r\n\r\n</div>\r\n\r\n<div class="load-panel hide">\r\n    <p class="load-img"></p>\r\n    <p class="load-tip">正在加载火车票...</p>\r\n</div>\r\n\r\n<div class="load-error-panel hide">\r\n    <p class="load-error-img"></p>\r\n    <p class="load-tip">\r\n        很抱歉，车票信息异常，建议您更换日期或浏览其他产品\r\n    </p>\r\n</div>\r\n\r\n<h3 class=\'info\'>\r\n    <span class="prompt">温馨提示：</span>\r\n    ',unsureInfoShow&&($out+='\r\n    <span class="note">您选购的是待定信息车次，车票具体信息以实际出票为准，在车票紧张的情况下，可能会出同城市其他车站车票，不影响您的正常出游，请知悉。</span>\r\n    '),$out+='\r\n    <span class="note">付款成功后将努力为您出票，若未购票成功将会全额退还订单费用。</span>\r\n</h3>\r\n\r\n<div class="jtxz-detail2 float-tip-train hide">\r\n    <p class="YD_mgb">因12306晚间23:00-06:00不支持预订火车票，无法占位成功 ，该时段的订单将在次日工作时间处理。</p>\r\n    <i class="icon top-triangle-icon"></i>\r\n</div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(14)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,$){var FloatTip=function(attributes){this.initialize(attributes)};return FloatTip.defaultAttributes={alignment:"center",offset:{x:0,y:0}},_.extend(FloatTip.prototype,{initialize:function(attributes){this.attributes=_.extend({},FloatTip.defaultAttributes,attributes),this.getInitialRefs(),this.fixBinding(),this.aop(),this.bindEvents()},getInitialRefs:function(){this.refs={$target:$(this.attributes.target),$tip:$(this.attributes.tipSelector)}},fixBinding:function(){_.bindAll(this,"onMouseEnter","onMouseLeave")},aop:function(){this.show=_.wrap(this.show,function(show){show.apply(this),this.locate()})},bindEvents:function(){this.refs.$target.on("mouseenter",this.onMouseEnter).on("mouseleave",this.onMouseLeave)},onMouseEnter:function(){this.show()},onMouseLeave:function(){this.hide()},locate:function(){var left,top,target=this.refs.$target[0],tip=this.refs.$tip[0],targetRect=target.getBoundingClientRect(),tipRect=tip.getBoundingClientRect(),targetWidth=targetRect.width||targetRect.right-targetRect.left,tipWidth=tipRect.width||tipRect.right-tipRect.left;switch(this.attributes.alignment){case"center":left=targetRect.left+targetWidth/2-tipWidth/2,top=targetRect.bottom;break;case"right":left=targetRect.left+targetWidth/2-tipWidth,top=targetRect.bottom}left+=this.attributes.offset.x,top+=this.attributes.offset.y,this.refs.$tip.css({left:left,top:top})},show:function(){this.refs.$tip.removeClass("hide")},hide:function(){this.refs.$tip.addClass("hide")}}),$.fn.floatTip=function(tipSelector,option){var attributes=_.extend({target:this,tipSelector:tipSelector},option);new FloatTip(attributes)},FloatTip}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(81),__webpack_require__(82),__webpack_require__(18),__webpack_require__(7),__webpack_require__(5),__webpack_require__(24),__webpack_require__(83)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,TrainMenuTemplate,TrainListTemplate,Layer,Template,EventBus,Scroll,container){return Backbone.View.extend({el:"#m-float-train",initialize:function(){this.renderContainer(),this.listenTo(this.model,"needRender",this.render),this.listenTo(this.model,"change:list",this.renderList),this.$el.on("click",".T_menu label[data-menuid]",$.proxy(this.filter,this)),this.$el.on("click",".T_show_all > a",this.showAllFilter),this.$el.on("click",".T_select > button",$.proxy(this.selectOne,this)),this.$el.on("click",".book-close",$.proxy(this.closeMoreTrain,this)),this.$el.on("click",".T_cancel",$.proxy(this.closeMoreTrain,this)),this.$el.on("click",".T_confirm",$.proxy(this.confirm,this)),this.$el.on("click",".T_selected .T_select > button",$.proxy(this.reselect,this))},init:function(){var self=this;self.layerIndex=Layer.open({type:1,title:!1,closeBtn:0,area:["1000px","620px"],content:self.$el}),self.$el.show(),self.$el.find(".T_main").hide(),self.$el.find(".T_loading").show()},renderContainer:function(){var data=this.model.toJSON(),html=container(data);this.$el.html(html)},render:function(){this.$el.find(".T_main").empty(),this.renderMenu(),this.renderList(),this.renderButton(),this.$el.find(".T_main").TScroll(),$(".T_limit_under").each(function(i,item){$(item).floatTip(".float-tip-train",{alignment:"right",offset:{x:20,y:0}})})},renderMenu:function(){var data=this.model.toJSON(),html=TrainMenuTemplate(data);this.$el.find(".T_main .T_selected").remove(),this.$el.find(".T_main .T_menu").remove(),this.$el.find(".T_loading").hide(),this.$el.find(".T_main").append(html).show()},renderList:function(){var data=this.model.toJSON(),html=TrainListTemplate(data);this.$el.find(".T_main .T_list").remove(),this.$el.find(".T_main .T_empty_error").remove(),this.$el.find(".T_slide").length?this.$el.find(".T_slide").append(html):this.$el.find(".T_main").append(html)},renderButton:function(){var data=this.model.toJSON(),obj=this.$el.find(".T_button > button").eq(0);data.traficSeq<data.defaultTrain.length&&obj.text("下一程"),data.traficSeq==data.defaultTrain.length&&obj.text("确定"),obj.attr("disabled",!1)},noData:function(){var html='<div class="T_no_data">未查询到火车票，请稍后再试！</div>';this.$el.find(".T_loading").hide(),this.$el.find(".T_main").html(html).show();var obj=this.$el.find(".T_button > button").eq(0);obj.text("--"),obj.attr("disabled",!0)},closeMoreTrain:function(){Layer.close(this.layerIndex),this.model.set({selectedTrain:[],traficSeq:1},{silent:!0})},showAllFilter:function(){$(this).parent().siblings(".T_hide").toggle(),$(this).hide(),$(this).siblings().css("display","inline-block")},selectOne:function(e){var obj=$(e.currentTarget);obj.hasClass("T_no_active")||(this.$el.find(".T_select > button").each(function(index,item){$(item).removeClass("T_active").children(".T_text").text("选择")}),obj.addClass("T_active").children(".T_text").text("已选"))},filter:function(e){var self=this,obj=$(e.currentTarget),id=(obj.siblings(".T_name").data("type"),+obj.data("menuid"));if(99==id)obj.hasClass("T_active")||(obj.addClass("T_active"),obj.siblings().removeClass("T_active"));else{var allLabel=obj.siblings(".T_all");obj.hasClass("T_active")?(obj.removeClass("T_active"),obj.siblings().hasClass("T_active")||allLabel.addClass("T_active")):(obj.addClass("T_active"),allLabel.hasClass("T_active")&&allLabel.removeClass("T_active"))}var postData=self.getPostData();EventBus.trigger("refreshMoreTrain",postData)},getPostData:function(){var self=this,postData={traficSeq:self.model.get("traficSeq"),filter:{trainTypes:[],seats:[],departureStations:[],arrivalStations:[],departureTimes:[],arrivalTimes:[],departStationTypes:[]}};return this.$el.find(".T_menu label").each(function(index,item){if($(item).hasClass("T_active")){var id,type=$(item).siblings(".T_name").data("type");id="departureTimes"==type||"arrivalTimes"==type?$(item).data("menuid"):+$(item).data("menuid"),99!=id&&(postData.filter[type]?postData.filter[type].push(id):postData.filter[type]=[])}}),0==_.keys(postData.filter).length&&delete postData.filter,postData},confirm:function(e){var self=this,obj=$(e.currentTarget),selectedObj=$(".T_train_list .T_select > button.T_active"),selectedTrain=self.model.get("selectedTrain"),defaultTrain=self.model.get("defaultTrain"),traficSeq=self.model.get("traficSeq");if(selectedObj.length){var index=selectedObj.index(),indexId=selectedObj.parents(".T_train_list").data("indexid");_.some(this.model.get("list"),function(item){if(item.indexId==indexId){var o=_.extend({},item);return o.id=o.prices[index].resId,o.seatType=o.prices[index].seat,o.departCityName=o.departureCityName,o.destCityName=o.arrivalCityName,o.resourceDatePrices=[],o.prices[index].departDate=o.departDate,o.resourceDatePrices.push(o.prices[index]),selectedTrain[traficSeq-1]=o,!0}})}else selectedTrain[traficSeq-1]=defaultTrain[traficSeq-1];"下一程"==obj.text()&&(obj.attr("disabled",!0),traficSeq++,self.model.set("traficSeq",traficSeq,{silent:!0}),EventBus.trigger("openTrainSelectPanel",{traficSeq:traficSeq})),"确定"==obj.text()&&(Layer.close(this.layerIndex),selectedTrain[0]=selectedTrain[0]?selectedTrain[0]:defaultTrain[0],EventBus.trigger("changeTrainSuccess",selectedTrain),self.model.set({selectedTrain:[],traficSeq:1},{silent:!0}))},reselect:function(e){var obj=$(e.currentTarget),traficSeq=obj.parents("tr").data("traficseq");obj.attr("disabled",!0),this.model.set("traficSeq",traficSeq,{silent:!0}),this.$el.find(".T_button .T_confirm").text("下一程"),EventBus.trigger("openTrainSelectPanel",{traficSeq:traficSeq})}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,selectedTrain=($utils.$helpers,$data.selectedTrain),_=$data._,$escape=($data.item,$data.index,$utils.$escape),helperFormatSeatType=$data.helperFormatSeatType,defaultTrain=$data.defaultTrain,helperNumToChinese=$data.helperNumToChinese,traficSeq=$data.traficSeq,filter=$data.filter,$out=($data.menu,"");if($out+='<div class="T_selected">\r\n    ',selectedTrain&&selectedTrain.length&&($out+='\r\n    <div class="T_top">\r\n        ',_.each(selectedTrain,function(item,index){$out+='\r\n        <div class="T_head">\r\n            <span class="T_border"></span>\r\n            <span>选择第',$out+=$escape(index+1),$out+="程：</span>\r\n            ",$out+=$escape(item.departCityName),$out+=" — ",$out+=$escape(item.destCityName),$out+='\r\n        </div>\r\n        <table>\r\n            <tr class="T_train_list" data-traficseq="',$out+=$escape(index+1),$out+='">\r\n                <td class="T_city_fuck">\r\n                    <div>',$out+=$escape(item.departDate),$out+='</div>\r\n                    <div class="T_second">',$out+=$escape(item.departCityName),$out+=" — ",$out+=$escape(item.destCityName),$out+='</div>\r\n                </td>\r\n                <td class="T_train_num">',$out+=$escape(item.trainNum),$out+='</td>\r\n                <td class="T_departure_date">\r\n                    <div>',$out+=$escape(item.departDepartTime),$out+='</div>\r\n                    <div class="T_second">',$out+=$escape(item.departStationName),$out+='</div>\r\n                </td>\r\n                <td class="T_middle">\r\n                    <span class="T_go_icon"></span>\r\n                    ',$out+=$escape(item.duration),$out+='\r\n                </td>\r\n                <td class="T_arrival_date">\r\n                    <div>',$out+=$escape(item.destArriveTime),$out+='</div>\r\n                    <div class="T_second">',$out+=$escape(item.destStationName),$out+='</div>\r\n                </td>\r\n                <td class="T_seat_type">',$out+=$escape(helperFormatSeatType(item.seatType)),$out+='</td>\r\n                <td class="T_select">\r\n                    <button>重新选择</button>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n        '}),$out+="\r\n    </div>\r\n    "),$out+="\r\n    ",!_.isEmpty(defaultTrain)){$out+='\r\n    <div class="T_head_current">\r\n        <span class="T_border"></span>\r\n        <span> 选择第',$out+=$escape(helperNumToChinese(traficSeq-1)),$out+="程：</span>\r\n        ";var selectedTrain=defaultTrain[traficSeq-1];$out+="\r\n        ",$out+=$escape(selectedTrain.departCityName),$out+=" — ",$out+=$escape(selectedTrain.destCityName),$out+="\r\n    </div>\r\n    "}return $out+="\r\n</div>\r\n",_.isEmpty(filter)||($out+='\r\n<div class="T_menu">\r\n    ',_.each(filter,function(item){$out+="\r\n    ",item.sub&&item.sub.length>0&&($out+='\r\n    <div class="',"trainTypes"!=item.id&&"seats"!=item.id&&($out+="T_hide"),$out+='">\r\n        <label class="T_name" data-type="',$out+=$escape(item.id),$out+='">',$out+=$escape(item.name),$out+='</label>\r\n        <label class="T_all T_active" data-menuid="99">全部</label>\r\n        ',_.each(item.sub,function(menu){$out+='\r\n        <label data-menuid="',$out+=$escape(menu.id),$out+='">\r\n            <span class="T_select"></span>',$out+=$escape(menu.name),$out+="\r\n        </label>\r\n        "}),$out+="\r\n    </div>\r\n    "),$out+="\r\n    "}),$out+="\r\n    ",filter.length>2&&($out+='\r\n    <div class="T_show_all">\r\n        <a href="javascript:;">\r\n            展开筛选项\r\n            <span class="T_triangle"></span>\r\n        </a>\r\n        <a href="javascript:;">\r\n            收起\r\n            <span class="T_black_triangle enabled"></span>\r\n        </a>\r\n    </div>\r\n    '),$out+="\r\n</div>\r\n"),new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,_=($utils.$helpers,$data._),list=$data.list,$escape=($data.item,$utils.$escape),helperFormatSeatType=($data.price,$data.index,$data.helperFormatSeatType),peopleLimit=$data.peopleLimit,defaultTrain=($data.selectedTrain,$data.defaultTrain),traficSeq=$data.traficSeq,isCorrectTime=($data.relativePrice,$data.isCorrectTime),allCanChoose=$data.allCanChoose,$out="";return _.isNull(list)?$out+='\r\n<div class="T_empty_error">\r\n    没有符合条件的车次，请更改筛选条件\r\n</div>\r\n':($out+='\r\n<div class="T_list">\r\n    <table>\r\n        <tr>\r\n            <th>时间/出发城市/到达城市</th>\r\n            <th>车次</th>\r\n            <th>出发车站/出发时间</th>\r\n            <th></th>\r\n            <th>到达车站/到达时间</th>\r\n            <th>座席</th>\r\n            <th>余位</th>\r\n            <th>差价</th>\r\n            <th></th>\r\n            <th>选择</th>\r\n        </tr>\r\n        ',_.each(list,function(item){$out+='\r\n        <tr class="T_train_list" data-indexid="',$out+=$escape(item.indexId),$out+='">\r\n            <td class="T_city_fuck">\r\n                <div>',$out+=$escape(item.departDate),$out+='</div>\r\n                <div class="T_second">',$out+=$escape(item.departureCityName),$out+=" — ",$out+=$escape(item.arrivalCityName),$out+='</div>\r\n            </td>\r\n            <td class="T_train_num ',item.isUnsureTicket&&($out+="unsureTicket"),$out+='">',$out+=$escape(item.trainNum),$out+='</td>\r\n            <td class="T_departure_date">\r\n                <div class="',$out+=$escape(item.isUnsureTicket?"unSureTicketTime":""),$out+='">',$out+=$escape(item.departDepartTime),$out+='</div>\r\n                <div class="T_second ',$out+=$escape(item.departDepartTime?"":"T_no_margin"),$out+='">',$out+=$escape(item.departStationName),$out+='</div>\r\n            </td>\r\n            <td class="T_middle">\r\n                <span class="T_go_icon"></span>\r\n                ',$out+=$escape(item.duration?item.duration:item.durationText),$out+="\r\n                ",item.durationText&&"时间待定"==item.durationText&&($out+='\r\n                    <div class="childCount-tips jtxz-detail-hover">\r\n                        <i class="icon notice2-icon"></i>\r\n                        <div class="jtxz-detail2 timeInfo">\r\n                            <div class="out-div">\r\n                                <div class="train-arrow">\r\n                                </div> \r\n                                <span class="durationDetail">',$out+=$escape(item.durationTextDetail),$out+="</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                "),$out+='\r\n            </td>\r\n            <td class="T_arrival_date">\r\n                <div class="',$out+=$escape(item.isUnsureTicket?"unSureTicketTime":""),$out+='">\r\n                    ',$out+=$escape(item.destArriveTime),$out+="\r\n                    ",item.durationDay>1&&($out+='\r\n                    <i class="T_first_train_duration">+',$out+=$escape(item.durationDay-1),$out+="</i>\r\n                    "),$out+='\r\n                </div>\r\n                <div class="T_second ',$out+=$escape(item.destArriveTime?"":"T_no_margin"),$out+='">',$out+=$escape(item.destStationName),$out+='</div>\r\n            </td>\r\n            <td class="T_seat_type">\r\n                ',_.each(item.prices,function(price,index){$out+='\r\n                <div class="',index>0&&($out+="T_second"),$out+='">',$out+=$escape(helperFormatSeatType(price.seat)),$out+="</div>\r\n                "}),$out+='\r\n            </td>\r\n            <td class="T_seat_type">\r\n                ',_.each(item.prices,function(price,index){$out+='\r\n                <div class="',index>0&&($out+="T_second"),$out+='">\r\n                    ',$out+=price.leftNumber>20?"\r\n                    有票\r\n                    ":0==price.leftNumber?"\r\n                    没票\r\n                    ":"\r\n                    票量紧张\r\n                    ",$out+="\r\n                    ",price.leftNumber<peopleLimit&&($out+="(余位不足)"),$out+="\r\n                </div>\r\n                "}),$out+='\r\n            </td>\r\n            <td class="T_price">\r\n                ';var selectedTrain=defaultTrain[traficSeq-1];$out+="\r\n                ",_.each(item.prices,function(price,index){$out+="\r\n                ";var relativePrice=price.adultPrice-selectedTrain.price.adultPrice;relativePrice=0==relativePrice?"+￥0":relativePrice>0?"+￥"+relativePrice:"-￥"+-relativePrice,$out+='\r\n                <div class="',index>0&&($out+="T_second"),$out+='">',$out+=$escape(relativePrice),$out+="</div>\r\n                "}),$out+='\r\n            </td>\r\n            <td class="T_price">\r\n                ',_.each(item.prices,function(price,index){$out+="\r\n                ",!price.isStockTicket&&isCorrectTime&&($out+='\r\n                <div class="T_limit_under ',index>0&&($out+=" T_second"),$out+='">限制</div>\r\n                '),$out+="\r\n                "}),$out+='\r\n            </td>\r\n            <td class="T_select">\r\n                ',_.each(item.prices,function(price,index){$out+="\r\n                ",item.indexId==selectedTrain.indexId&&price.seat==selectedTrain.seatType?($out+='\r\n                <button class="T_active ',index>0&&($out+="T_second"),price.leftNumber<peopleLimit&&!allCanChoose&&($out+=" T_no_active"),$out+='">\r\n                    <span class="T_select_white"></span><span class="T_text">已选</span>\r\n                </button>\r\n                '):($out+='\r\n                <button class="',index>0&&($out+="T_second"),price.leftNumber<peopleLimit&&!allCanChoose&&($out+=" T_no_active"),$out+='">\r\n                    <span class="T_select_white"></span><span class="T_text">选择</span>\r\n                </button>\r\n                '),$out+="\r\n                "}),$out+="\r\n            </td>\r\n        </tr>\r\n        "}),$out+="\r\n    </table>\r\n</div>\r\n"),$out+="\r\n\r\n",new String($out)}return function(){var obj={};
arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,$out=($utils.$helpers,"");return $out+='<header class="float-header">\r\n    <h2 class="active">更换火车票</h2>\r\n    <span><i class="icon book-close"></i></span>\r\n</header>\r\n\r\n<div class="T_loading"></div>\r\n\r\n<div class="T_main hide">\r\n\r\n</div>\r\n\r\n<div class="T_button">\r\n    <button class="T_confirm">--</button>\r\n    <button class="T_cancel">取消</button>\r\n</div>\r\n\r\n',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(5),__webpack_require__(85),__webpack_require__(17),__webpack_require__(6),__webpack_require__(86)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,EventBus,busTemplate,Layer,config,container){var pageDataObj=config.pageDataObj;return Backbone.View.extend({el:"#m-bus",events:{"click .m-more":"moreBus"},initialize:function(){3==pageDataObj.proMode&&this.renderContainer(),this.listenTo(this.model,"change",this.render)},renderContainer:function(){var data=this.model.toJSON(),html=container(data);this.$el.html(html).show()},render:function(){var data=this.model.toJSON();data.haveChange&&this.$el.find(".m-more").removeClass("hide");var html=busTemplate(data);this.$el.find(".load-panel").addClass("hide"),this.$el.show().find(".chose-bus-list tbody").html(html)},loadError:function(){this.$el.show(),this.$el.find(".load-panel").addClass("hide"),this.$el.find(".load-error-panel").removeClass("hide"),$(".J_departDate").find(".s_cnum").css({border:"1px solid #eddbb3"}),$(".T_tri_pop").show()},moreBus:function(){this.model.get("isNew")?EventBus.trigger("newMoreBus"):EventBus.trigger("moreBus")},showCheckLoading:function(){Layer.load("正在验证，请稍后...")},hideCheckLoading:function(){Layer.closeAll()},show:function(){this.$el.removeClass("hide"),this.$(".load-panel").removeClass("hide")}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,_=($utils.$helpers,$data._),listData=$data.listData,$escape=($data.item,$data.index,$utils.$escape),helperTimeTransfer=$data.helperTimeTransfer,$out="";return $out+=" ",_.each(listData,function(item,index){$out+='\r\n <tr class="temp">\r\n     <td class="date">',$out+=$escape(item.departDate),$out+='</td>\r\n     <td class="bus-text-left">\r\n         <span class="f-ol" title="',$out+=$escape(item.departStopName),$out+=$escape(helperTimeTransfer(item.departTime)),$out+='">\r\n         ',$out+=$escape(item.departStopName),$out+='<em class="f-fw">',$out+=$escape(helperTimeTransfer(item.departTime)),$out+='</em>\r\n         </span>\r\n     </td>\r\n     <td class="td-icon"><i class="icon text-icon"></i></td>\r\n     <td class="bus-text-right">\r\n         <span class="f-ol" title="',$out+=$escape(item.arriveStopName),$out+=$escape(helperTimeTransfer(item.arriveTime)),$out+='">\r\n         ',$out+=$escape(item.arriveStopName),$out+='<em class="f-fw">',$out+=$escape(helperTimeTransfer(item.arriveTime)),$out+='</em>\r\n         </span>\r\n     </td>\r\n     <td class="bus-text-gray2 f-ol">',$out+=$escape(item.vehicleType?item.vehicleType:""),$out+="</td>\r\n </tr>\r\n "}),new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,$out=($utils.$helpers,"");return $out+='<h2>\r\n    <a class="m-more hide">更改汽车票<i class="icon more-icon"></i></a>\r\n    <span class="icon bus-icon"></span>\r\n    <span class="m-title">汽车票信息</span>\r\n</h2>\r\n<div class="modular-body">\r\n    <div class="has-bus-tickets">\r\n        <table class="chose-bus-list">\r\n            <tbody>\r\n\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n</div>\r\n\r\n<div class="load-panel">\r\n    <p class="load-img"></p>\r\n    <p class="load-tip">正在为您加载低价汽车票，请稍等....</p>\r\n</div>\r\n\r\n<div class="load-error-panel hide">\r\n    <p class="load-error-img"></p>\r\n    <p class="load-tip">\r\n        汽车票已售罄，您可以选择更换团期或重新选择其他线路\r\n    </p>\r\n</div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(5),__webpack_require__(17),__webpack_require__(88),__webpack_require__(16)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,EventBus,Layer,busListTemplate,tools){return Backbone.View.extend({el:"#m-float-bus",events:{"click .bus-select-btn":"select","click .bus-confirm":"confirm","click .T_cancel":"cancel"},initialize:function(){this.listenTo(this.model,"render",this.render),this.listenTo(this.model,"loadError",this.loadError)},render:function(){var data=this.model.toJSON(),html=busListTemplate(data);this.$el.html(html).show(),this.responsive()},showLoading:function(){this.layerLoading=Layer.load("请稍后...")},hideLoading:function(){Layer.close(this.layerLoading)},loadError:function(){tools.layer({msg:"无可更改车票，请刷新页面重试或更换产品",icon:2})},responsive:function(){var self=this,resize=function(){var container=self.$el.find(".T_content"),height=container.innerHeight();container.css({marginTop:-height/2})};$(window).on("resize",function(){resize()}),resize()},select:function(e){var obj=$(e.currentTarget),index=obj.data("index");this.model.select(index)},confirm:function(e){var obj=$(e.currentTarget);obj.hasClass("disabled")||(this.model.confirm(),this.$el.hide())},cancel:function(){this.$el.hide()}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,_=($utils.$helpers,$data._),list=$data.list,selectedIndex=($data.item,$data.index,$data.rowspan,$data.selected,$data.selectedIndex),$escape=($data.item2,$data.index2,$utils.$escape),helperShowPrice=$data.helperShowPrice,disabled=$data.disabled,$out="";return $out+='<div class="float-bg"></div>\r\n<div class="float-content">\r\n\r\n    <header class="float-header">\r\n        <h2 class="active">更改汽车票</h2>\r\n        <span><i class="icon book-close T_cancel"></i></span>\r\n    </header>\r\n\r\n    <div class="panel_body">\r\n        <table class="tbl-bus-list">\r\n            <thead>\r\n            <tr>\r\n                <td>日期</td>\r\n                <td>出发时间</td>\r\n                <td class="bus-word-left">发车站</td>\r\n                <td>耗时</td>\r\n                <td>到达时间</td>\r\n                <td class="bus-word-left">到达站</td>\r\n                <td>车型</td>\r\n                <td>差价</td>\r\n                <td>&nbsp;</td>\r\n            </tr>\r\n            </thead>\r\n            <tbody>\r\n            ',_.each(list,function(item,index){var rowspan=item.listData.length,selected=selectedIndex===index;$out+="\r\n\r\n            ",_.each(item.listData,function(item2,index2){$out+='\r\n            <tr class="',0!=index&&0==index2&&($out+="dash-line"),$out+='">\r\n                <td>',$out+=$escape(item2.departDate),$out+="</td>\r\n                <td>",$out+=$escape(item2.departTime),$out+='</td>\r\n                <td class="bus-word-bold bus-word-left">',$out+=$escape(item2.departStopName),$out+='</td>\r\n                <td class="bus-word-gray bus-text-arrow">',$out+=$escape(item2.duration),$out+="</td>\r\n                <td>",$out+=$escape(item2.arriveTime),$out+='</td>\r\n                <td class="bus-word-bold bus-word-left">',$out+=$escape(item2.arriveStopName),$out+='</td>\r\n                <td class="bus-word-gray2">',$out+=$escape(item2.busNum),$out+="</td>\r\n                ",0==index2&&($out+='\r\n                <td rowspan="',$out+=$escape(rowspan),$out+='" class="bus-diff-price bus-word-blod">',$out+=$escape(helperShowPrice(item.diffPrice)),$out+='</td>\r\n                <td rowspan="',$out+=$escape(rowspan),$out+='">\r\n                    <a class="bus-select-btn ',selected&&($out+="bus-btn-selected"),$out+='" data-index="',$out+=$escape(index),$out+='">\r\n                        ',$out+=selected?"\r\n                        √已选择\r\n                        ":"\r\n                        选择\r\n                        ",$out+="\r\n                    </a>\r\n                </td>\r\n                "),$out+="\r\n            </tr>\r\n            "}),$out+="\r\n            "}),$out+='\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n    <div class="bus-btns">\r\n        <a class="bus-btn bus-confirm ',disabled&&($out+="disabled"),$out+='">确认</a>\r\n        <a class="bus-btn bus-cancel T_cancel">取消</a>\r\n    </div>\r\n</div>\r\n',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(5),__webpack_require__(17),__webpack_require__(90),__webpack_require__(7),__webpack_require__(91),__webpack_require__(16)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,EventBus,Layer,busListIndTemplate,Template,container,tools){return Backbone.View.extend({el:"#m-float-bus-new",events:{"click .T_cancel":"cancel","click .custom .cf-c-items .select":"selectIndividual","click .cf-winbtns-ok":"confirm","click .cf-c-checkbox":"filter","click .cf-c-subtitle .select":"reselectIndividual","click .sort":"sort"},initialize:function(){this.renderContainer(),this.listenTo(this.model,"render",this.render),this.listenTo(this.model,"loadError",this.loadError)},renderContainer:function(){var data=this.model.toJSON(),html=container(data);this.$el.html(html)},render:function(){var data=this.model.toJSON(),header=this.$el.find(".float-header"),body=this.$el.find(".cf-content"),indTemplateHtml=busListIndTemplate(data);header.find(".custom").removeClass("hide").addClass("active"),body.find(".custom").html(indTemplateHtml).removeClass("hide"),this.$el.show(),this.responsive(),this.changeConfirmBtnStatus()},getTitleHtml:function(key){var titleHtml='<p class="journey-text-ctn">',cityNameList=this.model.get("cityList"),cityNameIndexName=["一","二","三","四","五","六","七","八","九","十"];return _.each(cityNameList,function(cell,index){titleHtml+='<span data-index="'+index+'"',titleHtml+='class="one-journey ',index==key?titleHtml+="selectJounery":index>key&&(titleHtml+="disable"),titleHtml+='">第'+cityNameIndexName[index]+"程 ",titleHtml+=cityNameList[index].departCityName+"-"+cityNameList[index].destCityName,titleHtml+="</span>"}),titleHtml+="</p>"},responsive:function(){var self=this,resize=function(){var height=$(window).height();self.$el.find(".cf-content").css({height:height-182})};$(window).on("resize",function(){resize()}),resize()},changeConfirmBtnStatus:function(){var journeyIndex=(this.model.get("resType"),this.model.get("journeyIndex")),indSelected=this.model.get("indSelected")||[],indList=this.model.get("individualList"),confirmBtn=this.$el.find(".cf-winbtns-ok");indSelected[journeyIndex]?confirmBtn.removeClass("disabled"):confirmBtn.addClass("disabled"),_.some(indList[journeyIndex],function(list){if(list.selected)return void confirmBtn.removeClass("disabled")})},selectIndividual:function(e){var selectedData,obj=$(e.currentTarget),unique_id=obj.data("index"),body=this.$el.find(".cf-content .custom"),indList=this.model.get("individualList"),journeyIndex=this.model.get("journeyIndex");this.btnIsSelect(body,obj),_.each(indList[journeyIndex],function(list){list.unique_id==unique_id?(list.selected=!0,selectedData=list):list.selected=!1}),this.model.structIndData(selectedData),this.changeConfirmBtnStatus()},btnIsSelect:function(body,e){body.find(".T_select .btn").removeClass("selected"),body.find(".T_select .btn").removeClass("selected"),body.find(".T_select .btn .text").text("选择"),e.addClass("selected"),e.find(".text").text("√已选")},indReRender:function(){var header=this.$el.find(".float-header"),body=this.$el.find(".cf-content"),indTemplateHtml=busListIndTemplate(this.model.toJSON());this.model.get("journeyIndex");header.find(".custom").removeClass("hide").addClass("active"),body.find(".custom").html(indTemplateHtml),this.changeConfirmBtnStatus()},confirm:function(e){var obj=$(e.currentTarget),journeyIndex=this.model.get("journeyIndex");if(!obj.hasClass("disabled")){if(this.$el.find(".custom .cf-c-items .select.selected").trigger("click"),journeyIndex+1<this.model.get("individualList").length)return this.model.set({journeyIndex:++journeyIndex}),void this.indReRender();this.model.dataChange(),this.$el.hide(),this.model.destroy()}},filter:function(e){var inputParam,obj=$(e.currentTarget),type=obj.data("type"),index=obj.data("key");inputParam=!obj.hasClass("T_active"),obj.toggleClass("T_active"),this.model.setFilterKey(type,index,inputParam),this.indReRender()},sort:function(e){this.model.sort(),this.indReRender()},reselectIndividual:function(e){var obj=$(e.currentTarget),journeyIndex=$(obj).data("index");this.model.set("journeyIndex",journeyIndex),this.indReRender()},cancel:function(){this.$el.hide(),this.model.destroy()},showLoading:function(){this.layerLoading=Layer.load("请稍后...")},hideLoading:function(){Layer.close(this.layerLoading)},loadError:function(){tools.layer({msg:"无可更改车票，请刷新页面重试或更换产品",icon:2})}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var isPack,schId,$utils=this,list=($utils.$helpers,$data.list),individualList=$data.individualList,journeyIndex=$data.journeyIndex,filter=$data.filter,filters=$data.filters,filterKey=$data.filterKey,isPack=$data.isPack,schId=$data.schId,indSelected=$data.indSelected,_=$data._,cityList=$data.cityList,$escape=($data.item,$data.index,$utils.$escape),helperGetJourney=$data.helperGetJourney,filterString=($data.items,$data.key,$data.filterString),timeSortList=($data.i,$data.timeSortList),helperTimeTransfer=($data.show,$data.helperTimeTransfer),$string=$utils.$string,helperAirplaneShowPrice=$data.helperAirplaneShowPrice,$out="",list=individualList[journeyIndex],filter=filters[journeyIndex],filterKey=filterKey[journeyIndex];return journeyIndex&&(isPack=indSelected[journeyIndex-1].isPack,schId=indSelected[journeyIndex-1].scheduleCode),$out+="\r\n\r\n",_.each(cityList,function(item,index){$out+='\r\n<div class="cf-c-subtitle\r\n                        ',index>journeyIndex&&($out+="hide"),$out+="\r\n                        ",index==journeyIndex&&($out+="selectJounery"),$out+='\r\n                        ">\r\n                <span class="first">\r\n                    ',$out+=$escape(index<journeyIndex?"已选":"选择"),$out+=$escape(helperGetJourney(index,individualList.length)),$out+="程：\r\n                </span>\r\n    <span>",$out+=$escape(item.departCityName),$out+="—",$out+=$escape(item.destCityName),$out+="</span>\r\n    ",index<journeyIndex&&($out+='\r\n    <div class="T_select">\r\n        <div class="btn select" data-index="',$out+=$escape(index),$out+='">\r\n            重新选择\r\n        </div>\r\n    </div>\r\n    '),$out+="\r\n</div>\r\n"}),$out+='\r\n\r\n<ul class="cf-c-options">\r\n    ',_.each(filter,function(items,key){$out+='\r\n    <li class="cf-c-option',$out+=$escape(items.length?"":" hide"),$out+='">\r\n        <span class="cf-c-optionheader">',$out+=$escape(filterString[key]),$out+="</span>\r\n        <ul>\r\n            ",_.each(items,function(item,i){$out+='\r\n            <li class="cf-c-checkbox',$out+=$escape(filterKey[key][i]?" T_active":""),$out+='" data-key="',$out+=$escape(i),$out+='" data-type="',$out+=$escape(key),$out+='">',$out+=$escape(item),$out+="</li>\r\n            "}),$out+='\r\n        </ul>\r\n        <div class="clearfix"></div>\r\n    </li>\r\n    '}),$out+='\r\n    <!-- <li class="cf-c-moreopt">更多选项</li> -->\r\n    <div class="clearfix"></div>\r\n</ul>\r\n\r\n<ul class="result-list">\r\n    <li class="one-list head">\r\n        <div class="bus-info sort',$out+=$escape(1===timeSortList[journeyIndex]?" sort-asc":timeSortList[journeyIndex]===-1?" sort-desc":""),$out+='">出发时间\r\n            <i class="sort-icon"></i>\r\n        </div>\r\n        <div class="bus-station">发车/到达站</div>\r\n        <div class="bus-duration">耗时</div>\r\n        <div class="bus-end-time">到达时间</div>\r\n        <div class="bus-type">车型</div>\r\n        <div class="bus-diff-price">差价</div>\r\n        <div class="bus-select"></div>\r\n    </li>\r\n</ul>\r\n\r\n<div class="cf-c-items">\r\n    ',_.each(list,function(item,i){$out+="\r\n    ";var show=item.show;journeyIndex&&(show=isPack?show&&schId==item.scheduleCode:show&&item.isPack==isPack),$out+='\r\n    <div class="T_main',$out+=$escape(show?"":" hide"),$out+='">\r\n        <div class="bus-one-journey">\r\n            <div class="bus-info-detail">',$out+=$escape(helperTimeTransfer(item.dptTime)),$out+='</div>\r\n            <div class="bus-station-detail">\r\n                <div class="bus-station-start" title="',$out+=$escape(item.dptStation),$out+='"><span>始</span>',$out+=$escape(item.dptStation),$out+='</div>\r\n                <div class="bus-station-end" title="',$out+=$escape(item.dstStation),$out+='"><span>终</span>',$out+=$escape(item.dstStation),$out+='</div>\r\n            </div>\r\n            <div class="bus-duration-detail">--</div>\r\n            <div class="bus-end-detail">',$out+=$escape(helperTimeTransfer(item.dstTime)),$out+='</div>\r\n            <div class="bus-type-detail">',$out+=$escape(item.vehicleType?item.vehicleType:"--"),$out+='</div>\r\n            <div class="bus-diff-detail">',$out+=$string(helperAirplaneShowPrice(item.diffPrice)),$out+='</div>\r\n            <div class="T_inline T_select">\r\n                <div class="btn select',$out+=$escape(item.selected?" selected":""),$out+='" data-index="',$out+=$escape(item.unique_id),$out+='">\r\n                    <span class="tn_fontface"></span>\r\n                        <span class="text">',$out+=$escape(item.selected?"已选":"选择"),$out+="</span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    "}),$out+="\r\n</div>",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,$out=($utils.$helpers,"");return $out+='<div class="float-bg"></div>\r\n<div class="float-content">\r\n    <header class="float-header">\r\n        <!--<h2 class="package hide">优惠组合</h2>-->\r\n        <h2 class="custom hide">自由组合</h2>\r\n        <span><i class="icon book-close T_cancel"></i></span>\r\n    </header>\r\n\r\n    <div class="cf-content">\r\n        <div class="package hide"></div>\r\n        <div class="custom hide"></div>\r\n    </div>\r\n    <div class="cf-winbtns">\r\n        <div class="cf-winbtns-ok disabled">确认</div>\r\n        <div class="cf-winbtns-cancel T_cancel">取消</div>\r\n    </div>\r\n</div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(93),__webpack_require__(5),__webpack_require__(17),__webpack_require__(6)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,MultiTransportTemplate,EventBus,Layer,config){var PageDataObj=config.pageDataObj;return Backbone.View.extend({el:"#m-multi-transport",events:{"mouseenter .T_city_panel":"showCity","mouseleave .T_city_panel":"hideCity","click .T_city_panel .T_change":"changeCity","click .T_departure_city .T_select":"changeDepartureCity","click .T_back_city .T_select":"changeBackCity","click .T_add":"add","click .T_delete":"deleteOne","click .input_checkbox":"isSelectOneTranport"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"error",this.showError)},render:function(){var hasUnsureTrain=Backbone.app.toJSON()&&Backbone.app.toJSON().hasUnsureTrain;if(hasUnsureTrain)return this.$el.hide(),!1;var data=this.model.toJSON(),html=MultiTransportTemplate(data);this.$el.html(html).show(),data.defaultSelected&&document.getElementsByClassName("mu_pos")[0]&&this.selectDefaultMuTranport(document.getElementsByClassName("mu_pos")[0]),this.hideSelect()},showCity:function(e){var obj=$(e.currentTarget);obj.hasClass("T_disabled")||(obj.addClass("T_active"),this.cityResponsive())},hideCity:function(e){var obj=$(e.currentTarget);obj.removeClass("T_active")},changeCity:function(e){var obj=$(e.currentTarget),index=obj.index(),parent=obj.parents(".T_city_panel");parent.find(".T_change").removeClass("T_active"),obj.addClass("T_active"),parent.find(".T_item").hide(),parent.find(".T_item").eq(index).show(),this.cityResponsive()},cityResponsive:function(){var obj=this.$el.find(".T_city_panel"),totalWidth=obj.find(".T_city_menu").width(),width=0,last=obj.find(".T_city_menu .T_change").filter(":last");last.hasClass("T_active")?last.removeClass("T_last"):last.addClass("T_last"),obj.find(".T_city_menu li").each(function(index,item){var $item=$(item);$item.hasClass("T_space")||(width+=$item.width())}),obj.find(".T_space").width(totalWidth-width-1)},changeDepartureCity:function(e){var obj=$(e.currentTarget),code=obj.data("code"),name=obj.data("name"),parent=obj.parents(".T_city_panel");parent.find(".T_hover").hide(),this.model.set({departureCityCodeM:code,departureCityNameM:name,backCityCodeM:code,backCityNameM:name}),EventBus.trigger("changeDepartureCityM",1),EventBus.trigger("getMultiTransport"),EventBus.trigger("getDefaultTransport")},changeBackCity:function(e){var obj=$(e.currentTarget),code=obj.data("code"),name=obj.data("name"),parent=obj.parents(".T_city_panel");parent.find(".T_hover").hide(),this.model.set({backCityCodeM:code,backCityNameM:name}),EventBus.trigger("changeBackCityM",1),EventBus.trigger("getMultiTransport")},add:function(){EventBus.trigger("getMultiTransport",{isShow:!0,fromList:!0,loop:!0})},deleteOne:function(e){var obj=$(e.currentTarget),index=obj.data("index");this.showError({type:"delete",index:index})},isSelectOneTranport:function(e){if(this.model.get("isPackAndIncludePrice"))return void this.isSelectMuTranport(e);var obj=$(e.currentTarget),index=obj.data("index"),list=this.model.get("list"),airType=list[index].airType,isSelected=!0,transportTypeList=[];isSelected=obj.hasClass("enabled")?!isSelected:!!isSelected,2===airType?this.$el.find(".input_checkbox").toggleClass("enabled"):obj.toggleClass("enabled"),this.model.get("isPackTour")&&!this.model.get("isOneBackJourney")&&"0"==index&&this.changeDepartCity(isSelected),2===airType?_.each(list,function(item){item&&(item.isSelected=!item.isSelected)}):list[index].isSelected=!list[index].isSelected,_.each(list,function(item){item&&item.isSelected&&transportTypeList.push(item.transportType)}),this.model.changeTouristCardType(transportTypeList),this.model.set("list",list,{silent:!0}),EventBus.trigger("newSelectMultiTransport",isSelected),EventBus.trigger("changeTouristText",isSelected),list&&list.length&&list[index].resType&&21==list[index].resType&&Backbone.app.set("isSelectTran",isSelected)},changeDepartCity:function(f){var departureCityName=this.model.get("departureCityName"),departureCityNameM=this.model.get("departureCityNameM");departureCityNameM&&(f?EventBus.trigger("changeDepartCityName",departureCityNameM+"（"+departureCityName+"成团，"+departureCityNameM+"联运）"):EventBus.trigger("changeDepartCityName",departureCityName))},showText:function(f){var departureCityName=this.model.get("departureCityName"),departureCityNameM=this.model.get("departureCityNameM");f?this.$el.find(".newConn").show().text("线路出发城市变更为您的实际出发城市"+departureCityNameM+",请留意"+departureCityNameM+"-"+departureCityName+"段联运交通时间"):this.$el.find(".newConn").show().text("线路出发城市变更为成团地点"+departureCityName+",您需要自行前往"+departureCityName+"参团。若需要"+departureCityNameM+"-"+departureCityName+"段交通，请勾选联运交通")},isSelectMuTranport:function(e){var obj=$(e.currentTarget||e),list=(obj.data("index"),this.model.get("list")),allSelected=!0,transportTypeList=[];allSelected=obj.hasClass("enabled")?!allSelected:!!allSelected,obj.toggleClass("enabled"),this.changeDepartCity(allSelected),this.showText(allSelected),_.each(list,function(item){item&&(item.isSelected=!item.isSelected,item.isSelected&&transportTypeList.push(item.transportType))}),this.model.changeTouristCardType(transportTypeList),this.model.set("list",list,{silent:!0}),EventBus.trigger("newSelectMultiTransport",allSelected),EventBus.trigger("changeTouristText",allSelected),21==list[0].resType&&Backbone.app.set("isSelectTran",allSelected)},selectDefaultMuTranport:function(e){var obj=$(e),list=(obj.data("index"),this.model.get("list")),allSelected=!0,transportTypeList=[];obj.addClass("enabled"),this.changeDepartCity(allSelected),this.showText(allSelected),_.each(list,function(item){item&&(item.isSelected=!0,item.isSelected&&transportTypeList.push(item.transportType))}),this.model.changeTouristCardType(transportTypeList),this.model.set("list",list,{silent:!0}),EventBus.trigger("calculateMultiTransport")},showError:function(data){var msg,layerIndex,type=data.type,twoBtn=!1,self=this,proMode=data.proMode,choiceText="联运交通";if("time"==type)if(data.conflict)msg=choiceText+"方案与您"+(1===proMode?"的跟团行程时间存在冲突":"选择的机票/火车票时间存在冲突")+"，建议您更换"+choiceText;else{var tempMsg="",timeDifference1=data.timeDifference1,timeDifference2=data.timeDifference2;timeDifference1&&(tempMsg+="去程"+(1===proMode?"距跟团行程开始时间不足":"联运中转时间不足")+timeDifference1+"小时，"),timeDifference2&&(tempMsg+="返程"+(1===proMode?"距跟团行程结束时间不足":"联运中转时间不足")+timeDifference2+"小时，"),tempMsg=tempMsg.substring(0,tempMsg.length-1),msg="您选择的"+tempMsg+"，"+(1===proMode?"建议预留充足备用时间~":"建议预留充足的中转换乘时间~")}else if("check"==type){var priceDifference=data.priceDifference;void 0!=priceDifference&&(priceDifference=priceDifference<0?"-￥"+-priceDifference:"+￥"+priceDifference);
var checkTip={1:"您预订的"+choiceText+"航班的舱位已经售空，请您更换其他航班后继续预订",2:"您预订的"+choiceText+"机票价格核对有误，请稍后重试，或更改机票",3:"很抱歉，航班价格变化频繁，"+choiceText+"航班价格发生变动："+priceDifference+"，请确认价格",4:"请求错误，请稍后重试"};msg=checkTip[data.code]}else"delete"==type&&(msg="您将删除此程交通？",twoBtn=!0);layerIndex=$.layer({type:1,guide:2,title:"提示",closeBtn:[0,!0],btns:twoBtn?2:1,btn:twoBtn?["确定","取消"]:["确定"],area:["430px","200px"],border:[6,1,"#c4c4c5"],page:{html:'<p class="m10" style="position: relative;margin: 30px;line-height: 32px;padding-left: 42px;">'+msg+"</p>"},yes:function(){Layer.close(layerIndex),"check"==type&&3==data.code&&EventBus.trigger("saveOrder"),"delete"==type&&self.model.deleteOne(data.index)},no:function(){Layer.close(layerIndex)}}),"time"!=type&&"check"!=type||$("html,body").animate({scrollTop:$("#m-multi-transport").offset().top},500)},hideSelect:function(){var data=this.model.toJSON();PageDataObj.hasTakeSeat&&data.isFromOrder&&(this.$el.find(".input_checkbox").each(function(index,item){var el=$(item);el.click(),el.hide()}),this.$el.find(".T_multi_text",".T_city_panel",".T_multi_text_after").each(function(index,item){var el=$(item);el.hide()}))}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,_=($utils.$helpers,$data._),list=$data.list,isPackTour=$data.isPackTour,isOneBackJourney=$data.isOneBackJourney,$escape=$utils.$escape,backCityName=$data.backCityName,backCityNameM=$data.backCityNameM,index3=$data.index3,index4=$data.index4,backCityListM=$data.backCityListM,isPackAndIncludePrice=($data.item,$data.key,$data.item2,$data.key2,$data.item3,$data.isPackAndIncludePrice),departureCityNameM=$data.departureCityNameM,departureCityName=$data.departureCityName,index1=$data.index1,index2=$data.index2,departureCityListM=$data.departureCityListM,allSelected=$data.allSelected,lastIndex=$data.lastIndex,$string=($data.index,$data.itemData,$data.itemType,$data.k,$data.isHasPurchaseNotes,$data.freeLuggageStr,$data.strictStr,$utils.$string),helperFormatSeatType=$data.helperFormatSeatType,$out="";if($out+="<h2>\r\n    ",_.isEmpty(list)||($out+='\r\n    <a class="m-more T_add">更换交通<i class="icon more-icon"></i></a>\r\n    '),$out+='\r\n    <span class="icon tran_icon"></span>\r\n    <span class="m-title">可选交通</span>\r\n    ',isPackTour&&($out+='\r\n    <div class="jtxz-detail-hover">\r\n        <i class="icon notice2-icon"></i>\r\n        <div class="jtxz-detail2 T_width2">\r\n            <p class="YD_mgb">联运交通是从您的实际出发地前往线路成团地点的交通</p>\r\n            <span class="z">◆</span>\r\n            <span class="j">◆</span>\r\n        </div>\r\n    </div>\r\n    '),$out+="\r\n    ",isOneBackJourney){$out+='\r\n    <span class="T_multi_text">',$out+=$escape(backCityName),$out+='至所在城市</span>\r\n    <span class="T_city_panel T_back_city">\r\n        <span class="T_name">',$out+=$escape(backCityNameM),$out+='</span>\r\n        <span class="T_caret"></span>\r\n\r\n        <div class="T_hover">\r\n            <div class="T_list">\r\n                ';var index3=0,index4=0;$out+='\r\n                <ul class="T_city_menu">\r\n                    ',_.each(backCityListM,function(item,key){$out+='\r\n                    <li class="T_change ',0==index3&&($out+="T_active"),$out+='">\r\n                        <a href="javascript:;">',$out+=$escape(key),$out+="</a>\r\n                    </li>\r\n                    ",index3++}),$out+='\r\n                    <li class="T_space"></li>\r\n                </ul>\r\n                ',_.each(backCityListM,function(item){$out+='\r\n                <div class="T_item ',0!=index4&&($out+="hide"),$out+='">\r\n                    ',_.each(item,function(item2,key2){$out+='\r\n                    <div class="T_sub">\r\n                        <span>',$out+=$escape(key2),$out+="</span>\r\n                        <ul>\r\n                            ",_.each(item2,function(item3){$out+='\r\n                            <li class="T_select" data-code="',$out+=$escape(item3.cityCode),$out+='" data-name="',$out+=$escape(item3.cityName),$out+='">\r\n                                <a href="javascript:;">',$out+=$escape(item3.cityName),$out+="</a>\r\n                            </li>\r\n                            "}),$out+="\r\n                        </ul>\r\n                    </div>\r\n                    "}),$out+="\r\n                </div>\r\n                ",index4++}),$out+='\r\n            </div>\r\n        </div>\r\n        <div class="T_top_border"></div>\r\n    </span>\r\n    <span class="T_multi_text_after">的可选交通</span>\r\n    '}else{if($out+="\r\n        ",isPackAndIncludePrice)$out+='\r\n        <span class="T_multi_text">从您的所在地',$out+=$escape(departureCityNameM),$out+="前往成团地点",$out+=$escape(departureCityName),$out+="</span>\r\n        ";else{$out+='\r\n        <span class="T_multi_text">所在城市</span>\r\n        <span class="T_city_panel T_departure_city">\r\n            <span class="T_name">',$out+=$escape(departureCityNameM),$out+='</span>\r\n            <span class="T_caret"></span>\r\n\r\n            <div class="T_hover">\r\n                <div class="T_list">\r\n                    ';var index1=0,index2=0;$out+='\r\n                    <ul class="T_city_menu">\r\n                        ',_.each(departureCityListM,function(item,key){$out+='\r\n                        <li class="T_change ',0==index1&&($out+="T_active"),$out+='">\r\n                            <a href="javascript:;">',$out+=$escape(key),$out+="</a>\r\n                        </li>\r\n                        ",index1++}),$out+='\r\n                        <li class="T_space"></li>\r\n                    </ul>\r\n                    ',_.each(departureCityListM,function(item){$out+='\r\n                    <div class="T_item ',0!=index2&&($out+="hide"),$out+='">\r\n                        ',_.each(item,function(item2,key2){$out+='\r\n                        <div class="T_sub">\r\n                            <span>',$out+=$escape(key2),$out+="</span>\r\n                            <ul>\r\n                                ",_.each(item2,function(item3){$out+='\r\n                                <li class="T_select" data-code="',$out+=$escape(item3.cityCode),$out+='"\r\n                                    data-name="',$out+=$escape(item3.cityName),$out+='">\r\n                                    <a href="javascript:;">',$out+=$escape(item3.cityName),$out+="</a>\r\n                                </li>\r\n                                "}),$out+="\r\n                            </ul>\r\n                        </div>\r\n                        "}),$out+="\r\n                    </div>\r\n                    ",index2++}),$out+='\r\n                </div>\r\n            </div>\r\n            <div class="T_top_border"></div>\r\n        </span>\r\n        <span class="T_multi_text_after">至',$out+=$escape(departureCityName),$out+="的可选交通</span>\r\n        "}$out+="\r\n    "}if($out+="\r\n</h2>\r\n",isPackTour&&($out+='\r\n<div class="change-city-tips newConn">\r\n    ',allSelected?($out+="\r\n        线路出发城市变更为您的实际出发城市",$out+=$escape(departureCityNameM),$out+="，请留意",$out+=$escape(departureCityName),$out+="-上海段联运交通时间。\r\n    "):($out+="\r\n        线路出发城市变更为成团地点",$out+=$escape(departureCityName),$out+="，您需要自行前往",$out+=$escape(departureCityName),$out+="参团。若需要",$out+=$escape(departureCityNameM),$out+="-",$out+=$escape(departureCityName),$out+="段交通，请勾选联运交通\r\n    "),$out+=" \r\n</div>\r\n"),$out+='\r\n<div class="modular-body">\r\n\r\n',_.isEmpty(list))$out+='\r\n<div class="no-transport">\r\n    ',$out+=isPackAndIncludePrice?'\r\n    <span class="tips">很抱歉，未查询到可用联运交通，您可更换城市重新查询~</span>\r\n    ':'\r\n    <span class="tips">很抱歉，未查询到可用联运交通，您可更换城市重新查询，或点击选择添加更换其他查询条件~</span>\r\n    <span class="add-transport">\r\n            <button class="T_add">选择添加</button>\r\n    </span>\r\n    ',$out+="\r\n</div>\r\n";else{$out+="\r\n";var lastIndex;_.each(list,function(item,index){item&&(lastIndex=index)}),$out+="\r\n",_.each(list,function(item,index){if($out+="\r\n\r\n",item){if($out+="\r\n",1==item.transportType){$out+="\r\n";var itemData,itemType;if(_.isEmpty(item.transferInfo)?(itemData=item,itemType="normal"):(itemData=item.transferInfo,itemType="transfer"),$out+='\r\n<div class="T_transport_panel">\r\n    <div class="tran_journeys">\r\n        <div class="tran_journey ',$out+=$escape(index==lastIndex?"last":""),$out+='">\r\n            ',"transfer"==itemType){$out+="\r\n            ";for(var k=0;k<itemData.length;k++){if($out+='\r\n\r\n            <table class="tran_info">\r\n                <tr>\r\n                    <td class="route">\r\n                        <div class="trip f-ol" title="',$out+=$escape(itemData[k].departureCityName),$out+="-",$out+=$escape(itemData[k].destinationCityName),$out+='">',$out+=$escape(itemData[k].departureCityName),$out+="-",$out+=$escape(itemData[k].destinationCityName),$out+='</div>\r\n                        <div class="time">',$out+=$escape(itemData[k].departDate),$out+='</div>\r\n                    </td>\r\n\r\n                    <td class="flight">\r\n                        <div class="company f-ol" title="',$out+=$escape(itemData[k].airlineName),$out+='">\r\n                            <i class="airplane-company-icon airport_',$out+=$escape(itemData[k].flightCode),$out+='"></i>\r\n                            ',$out+=$escape(itemData[k].airlineName),$out+='\r\n                        </div>\r\n                        <div class="number">\r\n                            <span class="flightNo f-ol ',itemData[k].codeshare&&($out+="short"),$out+='" title="',$out+=$escape(itemData[k].flightNo),$out+=" ",$out+=$escape(itemData[k].airplaneTypeName),$out+='">',$out+=$escape(itemData[k].flightNo),$out+=" ",$out+=$escape(itemData[k].airplaneTypeName),$out+="</span>\r\n\r\n                            ",itemData[k].codeshare&&($out+='\r\n                            <span class="flight-share tour-stop-hover">\r\n                            共享\r\n                            <div class="stop-over-info T_width2">\r\n                                <p>\r\n                                    ',$out+=$escape(itemData[k].airlineName),$out+=$escape(itemData[k].flightNo),$out+="\r\n                                    ，实际由",$out+=$escape(itemData[k].sAirComName),$out+=$escape(itemData[k].codeshare),$out+='承运\r\n                                </p>\r\n                                <span class="z">◆</span>\r\n                                <span class="j">◆</span>\r\n                            </div>\r\n                        </span>\r\n                            '),$out+='\r\n\r\n                        </div>\r\n                    </td>\r\n\r\n                    <td class="stop">\r\n                        <div class="where f-ol" title="',$out+=$escape(itemData[k].departureAirportName),$out+='">',$out+=$escape(itemData[k].departureAirportName),$out+='</div>\r\n                        <div class="when">',$out+=$escape(itemData[k].departTime),$out+="</div>\r\n                    </td>\r\n\r\n                    ",itemData[k].stopTip?($out+='\r\n                    <td class="arrow">\r\n                        <div>\r\n                        <span class="tour-stop-tips">\r\n                            <span class="tour-stop-hover">经停\r\n                                <div class="stop-over-info">\r\n                                   <table class="stop-over-table">\r\n                                       <tr class="info-title">\r\n                                           <td class="airport">经停机场</td>\r\n                                           ',itemData[k].stopTip.arriveTime&&($out+='\r\n                                           <td class="arrival-time">到达时间</td>\r\n                                           <td class="take-off-time">起飞时间</td>\r\n                                           '),$out+='\r\n                                           <td class="stop-time">停留时间</td>\r\n                                       </tr>\r\n\r\n                                       <tr class="info-content">\r\n                                           <td class="airport-detail">',$out+=$escape(itemData[k].stopTip.stopAirportName),$out+="</td>\r\n                                           ",itemData[k].stopTip.arriveTime&&($out+='\r\n                                           <td class="arrival-detail">\r\n                                              <p class="time">',$out+=$escape(itemData[k].stopTip.arriveTime),$out+="</p>\r\n                                               <p>",$out+=$escape(itemData[k].stopTip.arriveDate),$out+='</p>\r\n                                           </td>\r\n                                           <td class="take-off-detail">\r\n                                               <p class="time">',$out+=$escape(itemData[k].stopTip.departTime),$out+="</p>\r\n                                               <p>",$out+=$escape(itemData[k].stopTip.departDate),$out+="</p>\r\n                                           </td>\r\n                                           "),$out+='\r\n                                           <td class="stop-time-detail">',$out+=$escape(itemData[k].stopTip.durationTime),$out+='</td>\r\n                                       </tr>\r\n                                   </table>\r\n                                    <span class="z">◆</span>\r\n                                    <span class="j">◆</span>\r\n                                </div>\r\n                            </span>\r\n                         </span>\r\n\r\n                            <span class="tour-stop-time">',$out+=$escape(itemData[k].duration),$out+="</span>\r\n                        </div>\r\n                    </td>\r\n                    "):($out+='\r\n                    <td class="arrow">\r\n                        <div>\r\n                            <span class="tour-stop-time">',$out+=$escape(itemData[k].duration),$out+="</span>\r\n                        </div>\r\n                    </td>\r\n                    "),$out+='\r\n\r\n                    <td class="stop">\r\n                        <div class="where f-ol" title="',$out+=$escape(itemData[k].destinationAirportName),$out+='">',$out+=$escape(itemData[k].destinationAirportName),$out+='</div>\r\n                        <div class="when">\r\n                            ',$out+=$escape(itemData[k].arriveTime),$out+="\r\n\r\n                            ",1!=itemData[k].arriveDay&&itemData[k].arriveDay!=-1||($out+='\r\n                            <span class="T_arrive_day">\r\n                            ',$out+=$escape(1==itemData[k].arriveDay?"+1":"-1"),$out+="\r\n                        </span>\r\n                            "),$out+='\r\n                        </div>\r\n                    </td>\r\n\r\n                    <td class="level">\r\n                        ',$out+=$escape(itemData[k].cabinType),$out+="\r\n\r\n                        ",2==itemData[k].airType||itemData[k].freeLuggage&&itemData[k].freeLuggageUnit||itemData[k].numberLimit||itemData[k].travelerCategory){$out+='\r\n                        <div class="comments jtxz-detail-hover">\r\n                            <i class="icon notice2-icon"></i><em class="f-bb">\r\n                            ';var isHasPurchaseNotes=itemData[k].numberLimit||itemData[k].travelerCategory,freeLuggageStr="行李额";if(1!=itemData[k].airType&&(itemData[k].freeLuggage>0&&itemData[k].freeLuggage<20?freeLuggageStr="行李额低":0==itemData[k].freeLuggage&&(freeLuggageStr="无行李额")),$out+="\r\n                           ",isHasPurchaseNotes||isHasPurchaseNotes&&2==itemData[k].airType?($out+="\r\n                              限制/",$out+=$escape(freeLuggageStr),$out+="\r\n                           "):isHasPurchaseNotes||2!=itemData[k].airType?($out+="\r\n                              ",$out+=$escape(freeLuggageStr),$out+="\r\n                           "):($out+="\r\n                              ",$out+=$escape(freeLuggageStr),$out+="\r\n                           "),$out+='\r\n                            </em>\r\n\r\n                            <div class="jtxz-detail2 T_width2">\r\n                                ',2==itemData[k].airType&&($out+='\r\n                                <p class="YD_title">往返优惠</p>\r\n                                <p class="YD_mgb">此航班往返程为指定航班，您可以根据需要自行选择</p>\r\n                                '),$out+="\r\n\r\n                                ",itemData[k].numberLimit||itemData[k].travelerCategory){$out+='\r\n                                <p class="YD_title">预订限制</p>\r\n                                <p class="YD_mgb">\r\n                                    ';var strictStr=[];itemData[k].travelerCategory&&strictStr.push("限出游人类型为："+itemData[k].travelerCategory),itemData[k].numberLimit&&strictStr.push("限出游人数为："+itemData[k].numberLimit),strictStr=strictStr.join("，"),$out+="\r\n                                    该机票为特价票，",$out+=$escape(strictStr),$out+="\r\n                                </p>\r\n                                "}$out+="\r\n\r\n                                ",itemData[k].freeLuggage&&itemData[k].freeLuggageUnit&&($out+='\r\n                                <p class="YD_title">行李额说明</p>\r\n                                <p class="YD_mgb">',$out+=$escape(itemData[k].freeLuggage),$out+=$escape(itemData[k].freeLuggageUnit),$out+="以下免行李费用</p>\r\n                                "),$out+='\r\n\r\n                                <span class="z">◆</span>\r\n                                <span class="j">◆</span>\r\n                            </div>\r\n                        </div>\r\n                        '}$out+="\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n\r\n            ",itemData[k].transfer&&($out+='\r\n            <div class="transfer-info">\r\n                <div class="transfer-tips">\r\n                    <span class="transfer-city"><i class="icon city-icon"></i>中转城市：',$out+=$escape(itemData[k].transfer.city),$out+='</span>\r\n                    <span class="transfer-time"><i class="icon time-icon"></i>停留时间：',$out+=$escape(itemData[k].transfer.duration),$out+="</span>\r\n                    ",itemData[k].transferTips&&($out+='\r\n                    <span class="transfer-tip jtxz-detail-hover">\r\n                    中转提示\r\n\r\n                    <div class="jtxz-detail2">\r\n                        <p class="YD_mgb">\r\n                            ',$out+=$escape(itemData[k].transferTips),$out+='\r\n                        </p>\r\n                        <span class="z">◆</span>\r\n                        <span class="j">◆</span>\r\n                    </div>\r\n                </span>\r\n                    '),$out+="\r\n                </div>\r\n            </div>\r\n            "),$out+="\r\n\r\n            "}$out+="\r\n            "}else{if($out+='\r\n            <table class="tran_info">\r\n                <tr>\r\n                    <td class="route">\r\n                        <div class="trip f-ol" title="',$out+=$escape(itemData.departureCityName),$out+="-",$out+=$escape(itemData.destinationCityName),$out+='">',$out+=$escape(itemData.departureCityName),$out+="-",$out+=$escape(itemData.destinationCityName),$out+='</div>\r\n                        <div class="time">',$out+=$escape(itemData.departDate),$out+='</div>\r\n                    </td>\r\n\r\n                    <td class="flight">\r\n                        <div class="company f-ol" title="',$out+=$escape(itemData.airlineName),$out+='">\r\n                            <i class="airplane-company-icon airport_',$out+=$escape(itemData.flightCode),$out+='"></i>\r\n                            ',$out+=$escape(itemData.airlineName),$out+='\r\n                        </div>\r\n                        <div class="number">\r\n                            <span class="flightNo f-ol ',itemData.codeshare&&($out+="short"),$out+='" title="',$out+=$escape(itemData.flightNo),$out+=" ",$out+=$escape(itemData.airplaneTypeName),$out+='">',$out+=$escape(itemData.flightNo),$out+=" ",$out+=$escape(itemData.airplaneTypeName),$out+="</span>\r\n\r\n                            ",itemData.codeshare&&($out+='\r\n                            <span class="flight-share tour-stop-hover">\r\n                            共享\r\n                            <div class="stop-over-info T_width2">\r\n                                <p>\r\n                                    ',$out+=$escape(itemData.airlineName),$out+=$escape(itemData.flightNo),$out+="\r\n                                    ，实际由",$out+=$escape(itemData.sAirComName),$out+=$escape(itemData.codeshare),$out+='承运\r\n                                </p>\r\n                                <span class="z">◆</span>\r\n                                <span class="j">◆</span>\r\n                            </div>\r\n                        </span>\r\n                            '),$out+='\r\n\r\n                        </div>\r\n                    </td>\r\n\r\n                    <td class="stop">\r\n                        <div class="where f-ol" title="',$out+=$escape(itemData.departureAirportName),$out+='">',$out+=$escape(itemData.departureAirportName),$out+='</div>\r\n                        <div class="when">',$out+=$escape(itemData.departTime),$out+="</div>\r\n                    </td>\r\n\r\n                    ",itemData.stopTip?($out+='\r\n                    <td class="arrow">\r\n                        <div>\r\n                        <span class="tour-stop-tips">\r\n                            <span class="tour-stop-hover">经停\r\n                                <div class="stop-over-info">\r\n                                   <table class="stop-over-table">\r\n                                       <tr class="info-title">\r\n                                           <td class="airport">经停机场</td>\r\n                                           ',itemData.stopTip.arriveTime&&($out+='\r\n                                           <td class="arrival-time">到达时间</td>\r\n                                           <td class="take-off-time">起飞时间</td>\r\n                                           '),$out+='\r\n                                           <td class="stop-time">停留时间</td>\r\n                                       </tr>\r\n\r\n                                       <tr class="info-content">\r\n                                           <td class="airport-detail">',$out+=$escape(itemData.stopTip.stopAirportName),$out+="</td>\r\n                                           ",itemData.stopTip.arriveTime&&($out+='\r\n                                           <td class="arrival-detail">\r\n                                              <p class="time">',$out+=$escape(itemData.stopTip.arriveTime),$out+="</p>\r\n                                               <p>",$out+=$escape(itemData.stopTip.arriveDate),$out+='</p>\r\n                                           </td>\r\n                                           <td class="take-off-detail">\r\n                                               <p class="time">',$out+=$escape(itemData.stopTip.departTime),$out+="</p>\r\n                                               <p>",$out+=$escape(itemData.stopTip.departDate),$out+="</p>\r\n                                           </td>\r\n                                           "),$out+='\r\n                                           <td class="stop-time-detail">',$out+=$escape(itemData.stopTip.durationTime),$out+='</td>\r\n                                       </tr>\r\n                                   </table>\r\n                                    <span class="z">◆</span>\r\n                                    <span class="j">◆</span>\r\n                                </div>\r\n                            </span>\r\n                         </span>\r\n\r\n                            <span class="tour-stop-time">',$out+=$escape(itemData.duration),$out+="</span>\r\n                        </div>\r\n                    </td>\r\n                    "):($out+='\r\n                    <td class="arrow">\r\n                        <div>\r\n                            <span class="tour-stop-time">',$out+=$escape(itemData.duration),$out+="</span>\r\n                        </div>\r\n                    </td>\r\n                    "),$out+='\r\n\r\n                    <td class="stop">\r\n                        <div class="where f-ol" title="',$out+=$escape(itemData.destinationAirportName),$out+='">',$out+=$escape(itemData.destinationAirportName),$out+='</div>\r\n                        <div class="when">\r\n                            ',$out+=$escape(itemData.arriveTime),$out+="\r\n\r\n                            ",1!=itemData.arriveDay&&itemData.arriveDay!=-1||($out+='\r\n                            <span class="T_arrive_day">\r\n                            ',$out+=$escape(1==itemData.arriveDay?"+1":"-1"),$out+="\r\n                        </span>\r\n                            "),$out+='\r\n                        </div>\r\n                    </td>\r\n\r\n                    <td class="level">\r\n                        ',$out+=$escape(itemData.cabinType),$out+="\r\n\r\n                        ",2==itemData.airType||itemData.freeLuggage&&itemData.freeLuggageUnit||itemData.numberLimit||itemData.travelerCategory){$out+='\r\n                        <div class="comments jtxz-detail-hover">\r\n                            <i class="icon notice2-icon"></i><em class="f-bb">\r\n                            ';var isHasPurchaseNotes=itemData.numberLimit||itemData.travelerCategory,freeLuggageStr="行李额";if(itemData.freeLuggage>0&&itemData.freeLuggage<20?freeLuggageStr="行李额低":0==itemData.freeLuggage&&(freeLuggageStr="无行李额"),$out+="\r\n                           ",isHasPurchaseNotes||isHasPurchaseNotes&&2==itemData.airType?($out+="\r\n                              限制/",$out+=$escape(freeLuggageStr),$out+="\r\n                           "):isHasPurchaseNotes||2!=itemData.airType?($out+="\r\n                              ",$out+=$escape(freeLuggageStr),$out+="\r\n                           "):($out+="\r\n                              ",$out+=$escape(freeLuggageStr),$out+="\r\n                           "),$out+='\r\n                            </em>\r\n\r\n                            <div class="jtxz-detail2 T_width2">\r\n                                ',2==itemData.airType&&($out+='\r\n                                <p class="YD_title">往返优惠</p>\r\n                                <p class="YD_mgb">此航班往返程为指定航班，您可以根据需要自行选择</p>\r\n                                '),$out+="\r\n\r\n                                ",itemData.numberLimit||itemData.travelerCategory){$out+='\r\n                                <p class="YD_title">预订限制</p>\r\n                                <p class="YD_mgb">\r\n                                    ';var strictStr=[];itemData.travelerCategory&&strictStr.push("限出游人类型为："+itemData.travelerCategory),itemData.numberLimit&&strictStr.push("限出游人数为："+itemData.numberLimit),strictStr=strictStr.join("，"),$out+="\r\n                                    该机票为特价票，",$out+=$escape(strictStr),$out+="\r\n                                </p>\r\n                                "}$out+="\r\n\r\n                                ",itemData.freeLuggage&&itemData.freeLuggageUnit&&($out+='\r\n                                <p class="YD_title">行李额说明</p>\r\n                                <p class="YD_mgb">',$out+=$escape(itemData.freeLuggage),$out+=$escape(itemData.freeLuggageUnit),$out+="以下免行李费用</p>\r\n                                "),$out+='\r\n\r\n                                <span class="z">◆</span>\r\n                                <span class="j">◆</span>\r\n                            </div>\r\n                        </div>\r\n                        '}$out+="\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n            "}$out+="\r\n\r\n            ",isPackAndIncludePrice||($out+='\r\n            <label class="input_checkbox ',item.isSelected&&($out+="enabled"),$out+='" data-index="',$out+=$escape(index),$out+='"><span class="tn_fontface"></span></label>\r\n            '),$out+="\r\n\r\n        </div>\r\n    </div>\r\n</div>\r\n"}else 2==item.transportType&&($out+='\r\n<div class="T_transport_panel">\r\n    <div class="tran_journeys">\r\n        <div class="tran_train_journey ',$out+=$escape(index==lastIndex?"last":""),$out+='">\r\n            <table class="tran_train_info">\r\n                <tr>\r\n                    <td class="route">\r\n                        <div class="trip f-ol" title="',$out+=$escape(item.departureCityName),$out+="-",$out+=$escape(item.arrivalCityName),$out+='">',$out+=$escape(item.departureCityName),$out+="-",$out+=$escape(item.arrivalCityName),$out+='</div>\r\n                        <div class="time">',$out+=$escape(item.departDate),$out+='</div>\r\n                    </td>\r\n\r\n                    <td class="train">\r\n                        <div class="number f-ol" title="',$out+=$escape(item.trainNum),$out+='">',$out+=$escape(item.trainNum),$out+='</div>\r\n                    </td>\r\n\r\n                    <td class="stop">\r\n                        <div class="where f-ol" title="',$out+=$escape(item.departStationName),$out+='">',$out+=$escape(item.departStationName),$out+='</div>\r\n                        <div class="when">',$out+=$escape(item.departDepartTime),$out+='</div>\r\n                    </td>\r\n\r\n                    <td class="arrow">\r\n                        <div>\r\n                            ',item.duration?($out+='\r\n                                <span class="tour-stop-duration">历时</span>\r\n                                <span class="tour-stop-time">',$out+=$escape(item.duration),$out+="</span>\r\n                            "):($out+='\r\n                                <span class="tour-stop-duration">时间待定\r\n                                    <div class="childCount-tips jtxz-detail-hover">\r\n                                        <i class="icon notice2-icon"></i>\r\n                                        <div class="jtxz-detail2">\r\n                                            <p class="YD_mgb">',$out+=$escape(item.durationTextDetail),$out+='</p>\r\n                                            <span class="z">◆</span>\r\n                                            <span class="j">◆</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </span>\r\n                            '),$out+='\r\n                        </div>\r\n                    </td>\r\n\r\n                    <td class="stop">\r\n                        <div class="where f-ol" title="',$out+=$escape(item.destStationName),$out+='">',$out+=$escape(item.destStationName),$out+='</div>\r\n                        <div class="when">\r\n                            ',$out+=$escape(item.destArriveTime),$out+="\r\n                            ",item.durationDay>1&&($out+='\r\n                            <i class="T_first_train_duration">+',$out+=$escape(item.durationDay-1),$out+="</i>\r\n                            "),$out+='\r\n                        </div>\r\n                    </td>\r\n\r\n                    <td class="level">\r\n                        <div class="f-ol" title="',$out+=$string(helperFormatSeatType(item.seat)),
$out+='">',$out+=$string(helperFormatSeatType(item.seat)),$out+="</div>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n            ",isPackAndIncludePrice||($out+='\r\n            <label class="input_checkbox ',item.isSelected&&($out+="enabled"),$out+='" data-index="',$out+=$escape(index),$out+='"><span class="tn_fontface"></span></label>\r\n            '),$out+="\r\n        </div>\r\n    </div>\r\n</div>\r\n");$out+="\r\n\r\n"}$out+="\r\n\r\n"}),$out+="\r\n",isPackAndIncludePrice&&($out+='\r\n    <label class="mu_pos input_checkbox ',allSelected&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label>\r\n'),$out+="\r\n"}return $out+="\r\n\r\n</div>",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(95),__webpack_require__(96),__webpack_require__(17),__webpack_require__(11),__webpack_require__(5),__webpack_require__(7),__webpack_require__(97),__webpack_require__(16)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,multiTransportListTemplate,multiTransportListTrainTemplate,Layer,CONSTANT,EventBus,Template,container,tools){return Backbone.View.extend({el:"#m-float-multi-transport",events:{"mouseenter .T_city_panel":"showCity","mouseleave .T_city_panel":"hideCity","click .T_city_panel .T_change":"changeCity","click .T_departure_city .T_select":"changeDepartureCity","click .T_back_city .T_select":"changeBackCity","change .T_departure_date":"changeDepartureDate","change .T_back_date":"changeBackDate","click .T_transport_type":"changeTransportType","click .T_filter .T_more":"toggleFilter","click .T_filter .T_item li":"filter","click .T_sort li":"sort","click .sort":"sort","click .T_main .select":"select","click .T_confirm":"confirm","click .T_cancel":"cancel"},initialize:function(){this.renderContainer(),this.listenTo(this.model,"needRender",this.render),this.bindEvents()},bindEvents:function(){$("body").on("click",".multi-transport-list-train .T_operation",$.proxy(this.changePersonCount,this))},renderContainer:function(){var data=this.model.toJSON(),html=container(data);this.$el.html(html)},render:function(hideSomeFilter){Layer.closeAll();var data=this.model.toJSON(),html=multiTransportListTemplate(data);this.show(),this.$el.find(".T_body").html(html),this.$el.find(".T_body").scrollTop(0),this.responsive(),this.changeConfirmBtnStatus(),this.hideSomeFilter(hideSomeFilter)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},showLoading:function(){this.loadingIndex=Layer.load("请稍后...")},hideLoading:function(){Layer.close(this.loadingIndex)},loadError:function(){var choiceText="联运交通";Layer.closeAll(),this.cancel(),tools.layer({msg:"很抱歉，没有找到匹配的"+choiceText+"~",icon:2})},responsive:function(){var self=this,resize=function(){var height=$(window).height();self.$el.find(".T_body").css({height:height-172-$(".footer").innerHeight(!0)})};$(window).off("resize.multiTransport").on("resize.multiTransport",function(){resize()}),resize()},showCity:function(e){var obj=$(e.currentTarget);obj.hasClass("T_disabled")||(obj.addClass("T_active"),this.cityResponsive())},hideCity:function(e){var obj=$(e.currentTarget);obj.removeClass("T_active")},changeCity:function(e){var obj=$(e.currentTarget),index=obj.index(),parent=obj.parents(".T_city_panel");parent.find(".T_change").removeClass("T_active"),obj.addClass("T_active"),parent.find(".T_item").hide(),parent.find(".T_item").eq(index).show(),this.cityResponsive()},cityResponsive:function(){var obj=this.$el.find(".T_city_panel"),totalWidth=obj.find(".T_city_menu").width(),width=0,last=obj.find(".T_city_menu .T_change").filter(":last");last.hasClass("T_active")?last.removeClass("T_last"):last.addClass("T_last"),obj.find(".T_city_menu li").each(function(index,item){var $item=$(item);$item.hasClass("T_space")||(width+=$item.width())}),obj.find(".T_space").width(totalWidth-width-1)},changeDepartureCity:function(e){var obj=$(e.currentTarget),code=obj.data("code"),name=obj.data("name"),parent=obj.parents(".T_city_panel");parent.find(".T_hover").hide(),parent.find(".T_name").text(name),this.model.set({departureCityCodeM:code,departureCityNameM:name,backCityCodeM:code,backCityNameM:name},{silent:!0}),this.model.request(),EventBus.trigger("changeDepartureCityM",2)},changeBackCity:function(e){var obj=$(e.currentTarget),code=obj.data("code"),name=obj.data("name"),parent=obj.parents(".T_city_panel");parent.find(".T_hover").hide(),parent.find(".T_name").text(name),this.model.set({backCityCodeM:code,backCityNameM:name},{silent:!0}),this.model.request(),EventBus.trigger("changeBackCityM",2)},changeDepartureDate:function(e){var obj=$(e.currentTarget),val=obj.val();this.model.set("departureDateM",val,{silent:!0}),this.model.request()},changeBackDate:function(e){var obj=$(e.currentTarget),val=obj.val();this.model.set("backDateM",val,{silent:!0}),this.model.request()},changeTransportType:function(e){var obj=$(e.currentTarget),val=obj.data("type");obj.hasClass("T_disabled")||obj.hasClass("T_active")||(this.model.set("transportType",val,{silent:!0}),this.model.request())},hideSomeFilter:function(isShow){this.$el.find(".T_filter .T_item").each(function(index,item){index>=CONSTANT.MAX_FILTER_COUNT&&(isShow?$(item).removeClass("hide"):$(item).addClass("hide"))}),isShow?this.$el.find(".T_filter .T_more .T_text").text("收起").addClass("T_active"):this.$el.find(".T_filter .T_more .T_text").text("更多选项").removeClass("T_active")},toggleFilter:function(e){var obj=$(e.currentTarget),textObj=obj.find(".T_text");if("更多选项"==textObj.text())textObj.text("收起"),obj.addClass("T_active"),obj.prevAll().removeClass("hide");else{textObj.text("更多选项"),obj.removeClass("T_active");var parent=obj.parent();parent.find(".T_item").each(function(index,option){index>=CONSTANT.MAX_FILTER_COUNT&&$(option).addClass("hide")})}},filter:function(e){var obj=$(e.currentTarget),disabled=obj.hasClass("T_disabled");if(!disabled){var key=obj.data("key"),type=obj.parents(".T_item").data("type"),transportType=this.model.get("transportType");if(2==transportType)this.model.filter(type,key);else{var showMoreFilter=!1;this.$el.find(".T_filter .T_item").each(function(index,item){if(index>=CONSTANT.MAX_FILTER_COUNT)return $(item).hasClass("hide")||(showMoreFilter=!0),!1}),this.model.filter(type,key),this.render(showMoreFilter)}}},sort:function(e){var obj=$(e.target),type=obj.attr("sort-key")||obj.parents("li").data("code"),showMoreFilter=!1;this.$el.find(".T_filter .T_item").each(function(index,item){if(index>=CONSTANT.MAX_FILTER_COUNT)return $(item).hasClass("hide")||(showMoreFilter=!0),!1}),this.model.sort(type),this.render(showMoreFilter)},select:function(e){var journeyIndex,obj=$(e.currentTarget),airType=obj.data("airtype"),airplaneId=obj.data("airplaneid"),trainId=obj.data("trainid"),reset=obj.data("reset");obj.hasClass("T_disabled")||(reset?(journeyIndex=obj.data("index"),this.model.set("journeyIndex",journeyIndex,{silent:!0}),this.model.request({airType:airType,loop:!0})):(journeyIndex=this.model.get("journeyIndex")+1,this.model.set("journeyIndex",journeyIndex,{silent:!0}),this.model.format({airType:airType,airplaneId:airplaneId,trainId:trainId})))},changeConfirmBtnStatus:function(){if(this.model.get("isPackAndIncludePrice"))return void this.muChangeConfirmBtnStatus();var airType,model=this.model.toJSON(),isOneJourney=model.isOneJourney,journeyIndex=model.journeyIndex,selectedData=model.selectedData,len=0,btn=this.$el.find(".T_confirm");_.each(selectedData,function(item){item&&(len++,airType=item.airType)}),isOneJourney?0==len?btn.addClass("T_disabled"):btn.removeClass("T_disabled"):0==journeyIndex?btn.removeClass("T_disabled"):0==len?btn.addClass("T_disabled"):1==len?2==airType?btn.addClass("T_disabled"):btn.removeClass("T_disabled"):2==len&&btn.removeClass("T_disabled")},muChangeConfirmBtnStatus:function(){var btn=this.$el.find(".T_confirm");this.model.get("journeyIndex")>1?btn.removeClass("T_disabled"):btn.addClass("T_disabled")},changePersonCount:function(e){var val,obj=$(e.currentTarget),minus=obj.hasClass("T_minus"),countObj=minus?obj.next():obj.prev();obj.hasClass("T_disabled")||(minus?(val=+countObj.text()-1,countObj.text(val)):(val=+countObj.text()+1,countObj.text(val)),this.changeTrainBtnStatus())},changeTrainBtnStatus:function(){var parent=$(".multi-transport-list-train"),adultMinusObj=parent.find(".T_adult .T_minus"),adultPlusObj=parent.find(".T_adult .T_plus"),adultCount=+parent.find(".T_adult .T_count").text(),childMinusObj=parent.find(".T_child .T_minus"),childPlusObj=parent.find(".T_child .T_plus"),childCount=+parent.find(".T_child .T_count").text(),model=this.model.toJSON(),person=model.person,totalNum=person[1].adultNum+person[1].childNum;1==adultCount?adultMinusObj.addClass("T_disabled"):adultMinusObj.removeClass("T_disabled"),adultCount==totalNum-childCount?adultPlusObj.addClass("T_disabled"):adultPlusObj.removeClass("T_disabled"),0==childCount?childMinusObj.addClass("T_disabled"):childMinusObj.removeClass("T_disabled"),childCount==totalNum-adultCount?childPlusObj.addClass("T_disabled"):childPlusObj.removeClass("T_disabled")},verify:function(needConfirm){var layerIndex,self=this,model=this.model.toJSON(),person=(model.journeyIndex,model.person),msg="",hasCheck1=model.hasCheck1,hasCheck2=model.hasCheck2,hasCheck3=model.hasCheck3,proMode=model.proMode||0;if(!hasCheck1){var result=this.model.checkTime(),flag=result.flag,index=result.journeyIndex,conflict=result.conflict,timeDifference1=result.timeDifference1,timeDifference2=result.timeDifference2,choiceText="联运交通";if(!flag){if(self.hide(),conflict)msg=choiceText+"方案与您"+(1===proMode?"的跟团行程时间存在冲突":"选择的机票/火车票时间存在冲突")+"，建议您更换"+choiceText,layerIndex=tools.layer({msg:msg,icon:2,yes:function(){Layer.close(layerIndex),self.model.set("journeyIndex",index,{silent:!0}),self.model.request(),self.show()}});else{var tempMsg="";timeDifference1&&(tempMsg+="去程"+(1===proMode?"距跟团行程开始时间不足":"联运中转时间不足")+timeDifference1+"小时，"),timeDifference2&&(tempMsg+="返程"+(1===proMode?"距跟团行程结束时间不足":"联运中转时间不足")+timeDifference2+"小时，"),tempMsg=tempMsg.substring(0,tempMsg.length-1),msg="您选择的"+tempMsg+"，"+(1===proMode?"建议预留充足备用时间~":"建议预留充足的中转换乘时间~"),layerIndex=tools.layer({btns:2,btn:["继续预订","更换"],icon:2,msg:msg,yes:function(){Layer.close(layerIndex),self.model.set("hasCheck1",!0,{silent:!0}),needConfirm&&self.confirm()},no:function(){Layer.close(layerIndex),self.model.set("journeyIndex",index,{silent:!0}),self.model.request(),self.show()}})}return!1}}if(!hasCheck2){var result2=this.model.checkTrain(),flag2=result2.flag;if(!flag2){self.hide();var trainHtml=multiTransportListTrainTemplate(model);return layerIndex=$.layer({type:1,guide:2,title:"选择火车票张数",closeBtn:!1,btns:1,btn:["确定"],area:["430px","300px"],border:[6,1,"#c4c4c5"],page:{html:trainHtml},yes:function(){var obj=$(".multi-transport-list-train"),adultNum=+obj.find(".T_adult .T_count").text(),childNum=+obj.find(".T_child .T_count").text();person[2].adultNum=adultNum,person[2].childNum=childNum,EventBus.trigger("changeMultiTransportPersonCount",person),Layer.close(layerIndex),self.model.set("hasCheck2",!0,{silent:!0}),needConfirm&&self.confirm()}}),self.changeTrainBtnStatus(),!1}}if(!hasCheck3){var result3=this.model.checkCurrentDay(),flag3=result3.flag,departureDateDifference=result3.departureDateDifference,backDateDifference=result3.backDateDifference;if(!flag3)return self.hide(),departureDateDifference&&(msg+="您选择的去程将提前"+(1===proMode?"跟团行程开始时间":"下一程交通出发时间")+departureDateDifference+"天到达，"),backDateDifference&&(msg+="您选择的返程将晚于"+(1===proMode?"跟团行程结束时间":"前一程交通到达时间")+backDateDifference+"天出发，"),msg+="需自理住宿，建议您提前预订酒店",layerIndex=tools.layer({msg:msg,icon:2,yes:function(){Layer.close(layerIndex),self.model.set("hasCheck3",!0,{silent:!0}),needConfirm&&self.confirm()}}),!1}return!0},confirm:function(){var obj=this.$el.find(".T_confirm"),model=this.model.toJSON(),isOneJourney=model.isOneJourney,journeyIndex=model.journeyIndex,selectedData=model.selectedData;obj.hasClass("T_disabled")||(isOneJourney||journeyIndex>0)&&!this.verify(!0)||(isOneJourney?(EventBus.trigger("changeMultiTransport",selectedData),this.cancel()):0==journeyIndex?(this.model.set("journeyIndex",journeyIndex+1,{silent:!0}),this.model.request()):(EventBus.trigger("changeMultiTransport",selectedData),this.cancel()))},cancel:function(){this.hide(),this.model.destroy()}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,hasSelected=($utils.$helpers,$data.hasSelected),_=$data._,selectedData=$data.selectedData,$escape=($data.item,$data.index,$utils.$escape),helperGetJourney=$data.helperGetJourney,$string=($data.isHasPurchaseNotes,$data.freeLuggageStr,$data.strictStr,$data.item2,$utils.$string),helperFormatSeatType=$data.helperFormatSeatType,journeyIndex=$data.journeyIndex,defaultTransport=$data.defaultTransport,one=$data.one,proMode=$data.proMode,packageResourceTime=$data.packageResourceTime,isPackAndIncludePrice=$data.isPackAndIncludePrice,departureCityNameM=$data.departureCityNameM,index1=$data.index1,index2=$data.index2,departureCityListM=$data.departureCityListM,departureCityName=($data.key,$data.key2,$data.item3,$data.departureCityName),departureDateListM=$data.departureDateListM,departureDateM=$data.departureDateM,disabled=$data.disabled,transportType=$data.transportType,group=$data.group,backCityName=$data.backCityName,backCityNameM=$data.backCityNameM,index3=$data.index3,index4=$data.index4,backCityListM=$data.backCityListM,backDateListM=$data.backDateListM,backDateM=$data.backDateM,supportTrain=$data.supportTrain,supportAirplane=$data.supportAirplane,isOneJourney=$data.isOneJourney,individualFlight=$data.individualFlight,filter=$data.filter,individualData=$data.individualData,helperFormatFilterName=$data.helperFormatFilterName,departTimeSortData=$data.departTimeSortData,helperGetSortInfo=$data.helperGetSortInfo,arriveTimeSortData=$data.arriveTimeSortData,priceSortData=$data.priceSortData,isInternationalFlag=$data.isInternationalFlag,helperMultiTransportShowPrice=$data.helperMultiTransportShowPrice,train=$data.train,$out=($data.active,""),hasSelected=!1;if(_.some(selectedData,function(item){if(item)return hasSelected=!0,!0}),$out+="\r\n",hasSelected&&($out+='\r\n<div class="T_selected">\r\n    ',_.each(selectedData,function(item,index){if($out+="\r\n    ",item){if($out+="\r\n    ",1==item.transportType){if($out+='\r\n\r\n    <h4>\r\n        <span class="T_border"></span>\r\n        <span class="T_label">已选',$out+=$escape(helperGetJourney(index,2)),$out+="程：</span>\r\n        ",$out+=$escape(item.departureCityName),$out+=" —— ",$out+=$escape(item.destinationCityName),$out+='\r\n    </h4>\r\n\r\n    <div class="T_airplane_panel">\r\n        <div class="T_main">\r\n            <div class="T_item">\r\n                <table>\r\n                    <tr class="T_border">\r\n                        <td class="T_city_fuck">\r\n                            <div class="T_first">',$out+=$escape(item.departDate),$out+='</div>\r\n                            <div class="T_second">',$out+=$escape(item.departureCityName),$out+=" — ",$out+=$escape(item.destinationCityName),$out+='</div>\r\n                        </td>\r\n\r\n                        <td class="T_airplane">\r\n                            <div class="T_first">\r\n                                <i class="airplane-company-icon airport_',$out+=$escape(item.flightCode),$out+='"></i>\r\n                                ',$out+=$escape(item.airlineName),$out+='\r\n                            </div>\r\n                            <div class="T_second">\r\n                                ',$out+=$escape(item.flightNo),$out+="\r\n\r\n                                ",item.codeshare&&($out+='\r\n                                <span class="flight-share tour-stop-hover">\r\n                                    共享\r\n\r\n                                    <div class="stop-over-info T_width2">\r\n                                        <p class="notice">\r\n                                            ',$out+=$escape(item.airlineName),$out+=$escape(item.flightNo),$out+="，实际由",$out+=$escape(item.sAirComName),$out+=$escape(item.codeshare),$out+='承运\r\n                                        </p>\r\n                                        <span class="z">◆</span>\r\n                                        <span class="j">◆</span>\r\n                                    </div>\r\n                                </span>\r\n                                '),$out+='\r\n                            </div>\r\n                        </td>\r\n\r\n                        <td class="T_depart_time">\r\n                            <div class="T_first T_bold">',$out+=$escape(item.departTime),$out+='</div>\r\n                            <div class="T_second">',$out+=$escape(item.departureAirportName),$out+='</div>\r\n                        </td>\r\n\r\n                        <td class="T_pic">\r\n                            <div>\r\n                                <div>\r\n                                    ',_.isEmpty(item.stopTip)||($out+='\r\n                                    <span class="tour-stop-hover T_stop">\r\n                                        经停\r\n                                        <div class="stop-over-info">\r\n\r\n                                        <table class="stop-over-table">\r\n                                            <tr class="info-title">\r\n                                                <td class="airport">经停机场</td>\r\n                                                ',item.stopTip.arriveTime&&($out+='\r\n                                                <td class="arrival-time">到达时间</td>\r\n                                                <td class="take-off-time">起飞时间</td>\r\n                                                '),$out+='\r\n                                                <td class="stop-time">停留时间</td>\r\n                                            </tr>\r\n\r\n                                            <tr class="info-content">\r\n                                                <td class="airport-detail">',$out+=$escape(item.stopTip.stopAirportName),$out+="</td>\r\n                                                ",item.stopTip.arriveTime&&($out+='\r\n                                                <td class="arrival-detail">\r\n                                                    <p class="time">',$out+=$escape(item.stopTip.arriveTime),$out+="</p>\r\n                                                    <p>",$out+=$escape(item.stopTip.arriveDate),$out+='</p>\r\n                                                </td>\r\n                                                <td class="take-off-detail">\r\n                                                    <p class="time">',$out+=$escape(item.stopTip.departTime),$out+="</p>\r\n                                                    <p>",$out+=$escape(item.stopTip.departDate),$out+="</p>\r\n                                                </td>\r\n                                                "),$out+='\r\n                                                <td class="stop-time-detail">',$out+=$escape(item.stopTip.durationTime),$out+='</td>\r\n                                            </tr>\r\n                                        </table>\r\n\r\n                                        <span class="z">◆</span>\r\n                                        <span class="j">◆</span>\r\n                                    </div>\r\n                                    </span>\r\n                                    '),$out+="\r\n\r\n                                    ",_.isEmpty(item.transfer)||($out+='\r\n                                    <div class="stop_zj"><span>',$out+=$escape(item.transfer.city),$out+='</span></div>\r\n                                    <div class="stop_zj">中转</div>\r\n                                    '),$out+='\r\n                                </div>\r\n                            </div>\r\n                        </td>\r\n\r\n                        <td class="T_arrive_time">\r\n                            <div class="T_first T_bold">\r\n                                ',$out+=$escape(item.arriveTime),$out+="\r\n\r\n                                ",1!=item.arriveDay&&item.arriveDay!=-1||($out+='\r\n                                <span class="T_arrive_day">\r\n                                    ',$out+=$escape(1==item.arriveDay?"+1":"-1"),$out+="\r\n                                </span>\r\n                                "),$out+='\r\n                            </div>\r\n                            <div class="T_second">',$out+=$escape(item.destinationAirportName),$out+='</div>\r\n                        </td>\r\n\r\n                        <td class="T_duration">\r\n                            ',$out+=$escape(item.duration),$out+='\r\n                        </td>\r\n\r\n                        <td class="T_right">\r\n                            <div class="T_para">\r\n\r\n                                <div class="T_inline T_cabin">\r\n                                    ',$out+=$escape(item.cabinType),$out+='\r\n                                </div>\r\n\r\n                                <div class="T_inline T_rule">\r\n                                    <div>\r\n                                        ',2==item.airType||item.freeLuggage&&item.freeLuggageUnit||item.numberLimit||item.travelerCategory){$out+='\r\n                                        <div class="T_text jtxz-detail-hover">\r\n                                            <i class="icon notice2-icon"></i><em class="f-bb">\r\n                                            ';var isHasPurchaseNotes=item.numberLimit||item.travelerCategory,freeLuggageStr="行李额";if(item.freeLuggage>0&&item.freeLuggage<20?freeLuggageStr="行李额低":0==item.freeLuggage&&(freeLuggageStr="无行李额"),$out+="\r\n                                           ",isHasPurchaseNotes||isHasPurchaseNotes&&2==item.airType?($out+="\r\n                                              限制/",$out+=$escape(freeLuggageStr),$out+="\r\n                                           "):isHasPurchaseNotes||2!=item.airType?($out+="\r\n                                              ",$out+=$escape(freeLuggageStr),$out+="\r\n                                           "):($out+="\r\n                                              ",$out+=$escape(freeLuggageStr),$out+="\r\n                                           "),$out+='\r\n                                            </em>\r\n\r\n                                            <div class="jtxz-detail2 T_width2">\r\n                                                ',2==item.airType&&($out+='\r\n                                                <p class="YD_title">往返优惠</p>\r\n                                                <p class="YD_mgb">此航班往返程为指定航班，您可以根据需要自行选择</p>\r\n                                                '),$out+="\r\n\r\n                                                ",item.numberLimit||item.travelerCategory){$out+='\r\n                                                <p class="YD_title">预订限制</p>\r\n                                                <p class="YD_mgb">\r\n                                                    ';var strictStr=[];item.travelerCategory&&strictStr.push("限出游人类型为："+item.travelerCategory),item.numberLimit&&strictStr.push("限出游人数为："+item.numberLimit),strictStr=strictStr.join("，"),$out+="\r\n                                                    该机票为特价票，",$out+=$escape(strictStr),$out+="\r\n                                                </p>\r\n                                                "}$out+="\r\n\r\n                                                ",item.freeLuggage&&item.freeLuggageUnit&&($out+='\r\n                                                <p class="YD_title">行李额说明</p>\r\n                                                <p class="YD_mgb">',$out+=$escape(item.freeLuggage),$out+=$escape(item.freeLuggageUnit),$out+="以下免行李费用</p>\r\n                                                "),$out+='\r\n\r\n                                                <span class="z">◆</span>\r\n                                                <span class="j">◆</span>\r\n                                            </div>\r\n                                        </div>\r\n                                        '}$out+='\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div class="T_inline T_price"></div>\r\n\r\n                                <div class="T_inline T_select">\r\n                                    <div class="btn select" data-airtype="',$out+=$escape(item.airType),$out+='" data-reset="true" data-index="',$out+=$escape(index),$out+='">\r\n                                        <span class="tn_fontface"></span>\r\n                                        重新选择\r\n                                    </div>\r\n                                </div>\r\n\r\n                            </div>\r\n                        </td>\r\n\r\n                    </tr>\r\n                </table>\r\n\r\n                ',_.isEmpty(item.transferInfo)||($out+='\r\n                <div class="T_zj_detail">\r\n                    <span class="T_orange_triangle"></span>\r\n                    <table>\r\n                        ',_.each(item.transferInfo,function(item2){$out+='\r\n                        <tr>\r\n                            <td class="T_city_fuck">\r\n                                <div class="T_first">\r\n                                    ',$out+=$escape(item2.departDate),$out+='\r\n                                </div>\r\n                                <div class="T_second">\r\n                                    ',$out+=$escape(item2.departureCityName),$out+=" — ",$out+=$escape(item2.destinationCityName),$out+='\r\n                                </div>\r\n                            </td>\r\n                            <td class="T_airplane">\r\n                                <div class="T_first">\r\n                                    <i class="airplane-company-icon airport_',$out+=$escape(item2.flightCode),$out+='"></i>\r\n                                    ',$out+=$escape(item2.airlineName),$out+='\r\n                                </div>\r\n                                <div class="T_second">\r\n                                    ',$out+=$escape(item2.flightNo),$out+='\r\n                                </div>\r\n                            </td>\r\n                            <td class="T_depart_time">\r\n                                <div class="T_first T_bold">\r\n                                    ',$out+=$escape(item2.departTime),$out+='\r\n                                </div>\r\n                                <div class="T_second">\r\n                                    ',$out+=$escape(item2.departureAirportName),$out+='\r\n                                </div>\r\n                            </td>\r\n                            <td class="T_pic"></td>\r\n                            <td class="T_arrive_time">\r\n                                <div class="T_first T_bold">\r\n                                    ',$out+=$escape(item2.arriveTime),$out+='\r\n                                </div>\r\n                                <div class="T_second">\r\n                                    ',$out+=$escape(item2.destinationAirportName),$out+='\r\n                                </div>\r\n                            </td>\r\n                            <td class="T_duration">\r\n                                ',$out+=$escape(item2.duration),$out+='\r\n                            </td>\r\n                            <td class="T_cabin">\r\n                                ',$out+=$escape(item2.cabinType),$out+="\r\n                            </td>\r\n                        </tr>\r\n\r\n                        ",item2.transfer&&($out+='\r\n                        <tr>\r\n                            <td colspan="6">\r\n                                <div class="T_middle">\r\n                                    <span class="T_left">中转城市：',$out+=$escape(item2.transfer.city),$out+="</span>\r\n                                    <span>中转时间：",$out+=$escape(item2.transfer.duration),$out+="</span>\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n                        "),$out+="\r\n\r\n                        "}),$out+="\r\n                    </table>\r\n\r\n                    ",(item.transferTips||item.visaTips)&&($out+='\r\n                    <div class="T_note">\r\n                        ',item.transferTips&&($out+="\r\n                        <div>不同机场：中转机场不在同一机场，请注意。</div>\r\n                        "),$out+="\r\n                        ",item.visaTips&&($out+="\r\n                        <div>过境签：此行程需要过境转机，中国大陆公民过境韩国，可能需要申请该过境签证，请确认签证无误。</div>\r\n                        "),$out+="\r\n                    </div>\r\n                    "),$out+="\r\n\r\n                </div>\r\n                "),$out+="\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    "}else 2==item.transportType&&($out+='\r\n\r\n    <h4>\r\n        <span class="T_border"></span>\r\n        <span class="T_label">已选',$out+=$escape(helperGetJourney(index,2)),$out+="程：</span>\r\n        ",$out+=$escape(item.departureCityName),$out+=" —— ",$out+=$escape(item.arrivalCityName),$out+='\r\n    </h4>\r\n\r\n    <div class="T_train_panel">\r\n        <div class="T_main">\r\n            <div class="T_item">\r\n                <table>\r\n                    <tr class="T_border">\r\n                        <td class="T_city_fuck">\r\n                            <div class="T_first">',$out+=$escape(item.departDate),$out+='</div>\r\n                            <div class="T_second">',$out+=$escape(item.departureCityName),$out+=" — ",$out+=$escape(item.arrivalCityName),$out+='\r\n                            </div>\r\n                        </td>\r\n\r\n                        <td class="T_airplane">\r\n                            <div class="T_first">\r\n                                ',$out+=$escape(item.trainNum),$out+='\r\n                            </div>\r\n                        </td>\r\n\r\n                        <td class="T_depart_time">\r\n                            <div class="T_first T_bold">',$out+=$escape(item.departDepartTime),$out+='</div>\r\n                            <div class="T_second">',$out+=$escape(item.departStationName),$out+='</div>\r\n                        </td>\r\n\r\n                        <td class="T_pic">\r\n                            <div></div>\r\n                        </td>\r\n\r\n                        <td class="T_arrive_time">\r\n                            <div class="T_first T_bold">\r\n                                ',
$out+=$escape(item.destArriveTime),$out+='\r\n                            </div>\r\n                            <div class="T_second">',$out+=$escape(item.destStationName),$out+='</div>\r\n                        </td>\r\n\r\n                        <td class="T_duration">\r\n                            ',$out+=$escape(item.duration),$out+='\r\n                        </td>\r\n\r\n                        <td class="T_right">\r\n                            <div class="T_para">\r\n\r\n                                <div class="T_inline T_cabin">\r\n                                    <div>',$out+=$string(helperFormatSeatType(item.seat)),$out+='</div>\r\n                                </div>\r\n\r\n                                <div class="T_inline T_rule"></div>\r\n\r\n                                <div class="T_inline T_price"></div>\r\n\r\n                                <div class="T_inline T_select">\r\n                                    <div class="btn select" data-reset="true" data-index="',$out+=$escape(index),$out+='">\r\n                                        <span class="tn_fontface"></span>\r\n                                        重新选择\r\n                                    </div>\r\n                                </div>\r\n\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    ');$out+="\r\n    "}$out+="\r\n    "}),$out+="\r\n</div>\r\n"),$out+="\r\n\r\n",journeyIndex<2){if($out+="\r\n\r\n",!_.isEmpty(defaultTransport)){$out+="\r\n";var one=defaultTransport[journeyIndex];$out+="\r\n",one&&($out+='\r\n<div class="T_default">\r\n    ',1==one.transportType?($out+="\r\n\r\n    <span>已选</span><em>",$out+=$escape(one.departureCityName),$out+="——",$out+=$escape(one.destinationCityName),$out+="</em><span>航班</span>\r\n    ",0==journeyIndex?($out+="\r\n    <span>起飞时间为</span><em>",$out+=$escape(one.departDate),$out+=" ",$out+=$escape(one.departTime),$out+="</em><span>，请注意此程交通的到达时间</span>\r\n    "):1==journeyIndex&&($out+="\r\n    <span>到达时间为</span><em>",$out+=$escape(one.arrivalDate),$out+=" ",$out+=$escape(one.arriveTime),$out+="</em><span>，请注意此程交通的出发时间</span>\r\n    "),$out+="\r\n\r\n    "):2==one.transportType&&($out+="\r\n\r\n    <span>已选</span><em>",$out+=$escape(one.departCityName),$out+="——",$out+=$escape(one.destCityName),$out+="</em><span>车次</span>\r\n    ",0==journeyIndex?($out+="\r\n    <span>出发时间为</span><em>",$out+=$escape(one.departDate),$out+=" ",$out+=$escape(one.departDepartTime),$out+="</em><span>，请注意此程交通的到达时间</span>\r\n    "):1==journeyIndex&&($out+="\r\n    <span>到达时间为</span><em>",$out+=$escape(one.arrivalDate),$out+=" ",$out+=$escape(one.destArriveTime),$out+="</em><span>，请注意此程交通的出发时间</span>\r\n    "),$out+="\r\n\r\n    "),$out+="\r\n</div>\r\n"),$out+="\r\n"}if($out+="\r\n\r\n",1===proMode&&packageResourceTime&&($out+='\r\n<div class="T_default">\r\n    ',0==journeyIndex?($out+="\r\n    <span>跟团行程开始时间为</span><em>",$out+=$escape(packageResourceTime.normalDepartDate),$out+=" ",$out+=$escape(packageResourceTime.normalDepartTime),$out+="</em><span>，请注意此程交通的到达时间</span>\r\n    "):1==journeyIndex&&($out+="\r\n    <span>跟团行程结束时间为</span><em>",$out+=$escape(packageResourceTime.normalArriveDate),$out+=" ",$out+=$escape(packageResourceTime.normalArriveTime),$out+="</em><span>，请注意此程交通的出发时间</span>\r\n    "),$out+="\r\n</div>\r\n"),$out+='\r\n\r\n<div class="T_menu">\r\n    <div class="T_wrapper">\r\n        <label for="">选择',$out+=$escape(helperGetJourney(journeyIndex,2)),$out+="程：</label>\r\n\r\n\r\n        ",0==journeyIndex){if($out+="\r\n        ",isPackAndIncludePrice)$out+="\r\n            ",$out+=$escape(departureCityNameM),$out+="\r\n        ";else{$out+='\r\n        <span class="T_city_panel T_departure_city">\r\n            <span class="T_name">',$out+=$escape(departureCityNameM),$out+='</span>\r\n            <span class="T_caret"></span>\r\n\r\n            <div class="T_hover">\r\n                <div class="T_list">\r\n                    ';var index1=0,index2=0;$out+='\r\n                    <ul class="T_city_menu">\r\n                        ',_.each(departureCityListM,function(item,key){$out+='\r\n                        <li class="T_change ',0==index1&&($out+="T_active"),$out+='">\r\n                            <a href="javascript:;">',$out+=$escape(key),$out+="</a>\r\n                        </li>\r\n                        ",index1++}),$out+='\r\n                        <li class="T_space"></li>\r\n                    </ul>\r\n                    ',_.each(departureCityListM,function(item){$out+='\r\n                    <div class="T_item ',0!=index2&&($out+="hide"),$out+='">\r\n                        ',_.each(item,function(item2,key2){$out+='\r\n                        <div class="T_sub">\r\n                            <span>',$out+=$escape(key2),$out+="</span>\r\n                            <ul>\r\n                                ",_.each(item2,function(item3){$out+='\r\n                                <li class="T_select" data-code="',$out+=$escape(item3.cityCode),$out+='" data-name="',$out+=$escape(item3.cityName),$out+='">\r\n                                    <a href="javascript:;">',$out+=$escape(item3.cityName),$out+="</a>\r\n                                </li>\r\n                                "}),$out+="\r\n                            </ul>\r\n                        </div>\r\n                        "}),$out+="\r\n                    </div>\r\n                    ",index2++}),$out+='\r\n                </div>\r\n            </div>\r\n            <div class="T_top_border"></div>\r\n        </span>\r\n        '}$out+="\r\n        到",$out+=$escape(departureCityName),$out+='\r\n\r\n        <label for="" class="T_m">出发日期：</label>\r\n        <select name="" id="" class="T_departure_date">\r\n            ',_.each(departureDateListM,function(item){$out+='\r\n            <option value="',$out+=$escape(item),$out+='" ',item==departureDateM&&($out+="selected"),$out+=">",$out+=$escape(item),$out+="</option>\r\n            "}),$out+="\r\n        </select>\r\n\r\n        "}else{$out+="\r\n\r\n        ";var disabled=!1;if(1==transportType&&group&&(disabled=!0),$out+="\r\n\r\n        ",$out+=$escape(backCityName),$out+="到\r\n        ",isPackAndIncludePrice)$out+="\r\n            ",$out+=$escape(departureCityName),$out+="\r\n        ";else{$out+='\r\n        <span class="T_city_panel T_back_city ',disabled&&($out+="T_disabled"),$out+='">\r\n            <span class="T_name">',$out+=$escape(backCityNameM),$out+='</span>\r\n            <span class="T_caret"></span>\r\n\r\n            <div class="T_hover">\r\n                <div class="T_list">\r\n                    ';var index3=0,index4=0;$out+='\r\n                    <ul class="T_city_menu">\r\n                        ',_.each(backCityListM,function(item,key){$out+='\r\n                        <li class="T_change ',0==index3&&($out+="T_active"),$out+='">\r\n                            <a href="javascript:;">',$out+=$escape(key),$out+="</a>\r\n                        </li>\r\n                        ",index3++}),$out+='\r\n                        <li class="T_space"></li>\r\n                    </ul>\r\n                    ',_.each(backCityListM,function(item){$out+='\r\n                    <div class="T_item ',0!=index4&&($out+="hide"),$out+='">\r\n                        ',_.each(item,function(item2,key2){$out+='\r\n                        <div class="T_sub">\r\n                            <span>',$out+=$escape(key2),$out+="</span>\r\n                            <ul>\r\n                                ",_.each(item2,function(item3){$out+='\r\n                                <li class="T_select" data-code="',$out+=$escape(item3.cityCode),$out+='" data-name="',$out+=$escape(item3.cityName),$out+='">\r\n                                    <a href="javascript:;">',$out+=$escape(item3.cityName),$out+="</a>\r\n                                </li>\r\n                                "}),$out+="\r\n                            </ul>\r\n                        </div>\r\n                        "}),$out+="\r\n                    </div>\r\n                    ",index4++}),$out+='\r\n                </div>\r\n            </div>\r\n            <div class="T_top_border"></div>\r\n        </span>\r\n        '}$out+='\r\n\r\n        <label for="" class="T_m">返回日期：</label>\r\n        <select name="" id="" class="T_back_date" ',disabled&&($out+="disabled"),$out+=">\r\n            ",_.each(backDateListM,function(item){$out+='\r\n            <option value="',$out+=$escape(item),$out+='" ',item==backDateM&&($out+="selected"),$out+=">",$out+=$escape(item),$out+="</option>\r\n            "}),$out+="\r\n        </select>\r\n\r\n        "}if($out+='\r\n    </div>\r\n\r\n    <div class="T_wrapper">\r\n        <div class="T_area">\r\n            <label for="">交通方式：</label>\r\n            ',supportTrain&&($out+='\r\n            <a href="javascript:;" class="T_transport_type T_m2 ',2==transportType&&($out+="T_active"),$out+=" ",disabled&&($out+="T_disabled"),$out+='" data-type="2">\r\n                <span class="tn_fontface">&#xe618;</span>火车票\r\n            </a>\r\n            '),$out+="\r\n            ",supportAirplane&&($out+='\r\n            <a href="javascript:;" class="T_transport_type ',1==transportType&&($out+="T_active"),$out+='" data-type="1">\r\n                <span class="tn_fontface">&#xe618;</span>机票\r\n            </a>\r\n            '),$out+="\r\n        </div>\r\n\r\n        ",0!=journeyIndex||1!=transportType||isOneJourney||($out+='\r\n        <label for="" class="T_m3">返回日期：</label>\r\n        <select name="" id="" class="T_back_date">\r\n            ',_.each(backDateListM,function(item){$out+='\r\n            <option value="',$out+=$escape(item),$out+='" ',item==backDateM&&($out+="selected"),$out+=">",$out+=$escape(item),$out+="</option>\r\n            "}),$out+="\r\n        </select>\r\n        "),$out+="\r\n    </div>\r\n</div>\r\n\r\n",1==transportType){if($out+="\r\n",individualFlight||group){$out+='\r\n<div class="T_airplane_panel not-selected">\r\n    ';var filter=[];0==journeyIndex?filter=individualData.filter[0]:1==journeyIndex&&(group?filter=individualData.filter[1]:individualFlight&&(filter=individualData.filter[0])),$out+="\r\n    ",_.isEmpty(filter)||($out+='\r\n    <div class="T_filter">\r\n        ',_.each(filter,function(item,key){$out+="\r\n        ",_.isEmpty(item)||($out+='\r\n        <div class="T_item" data-type="',$out+=$escape(key),$out+='">\r\n            <span class="T_type">',$out+=$escape(helperFormatFilterName(key)),$out+="</span>\r\n            <ul>\r\n                ",_.each(item,function(item2){$out+='\r\n                <li class="',item2.selected&&($out+="T_active"),$out+='" data-key="',$out+=$escape(item2.key),$out+='">\r\n                    <a href="javascript:;">\r\n                        <span class="tn_fontface">&#xe618;</span>\r\n                        ',$out+=$escape(item2.viewName),$out+="\r\n                    </a>\r\n                </li>\r\n                "}),$out+="\r\n            </ul>\r\n        </div>\r\n        "),$out+="\r\n        "}),$out+="\r\n\r\n        ",_.keys(filter).length>3&&($out+='\r\n        <button class="T_more">\r\n            <span class="T_text">更多选项</span>\r\n            <span class="T_caret"></span>\r\n        </button>\r\n        '),$out+="\r\n    </div>\r\n    "),$out+='\r\n\r\n    <ul class="result-list">\r\n        <li class="one-list head">\r\n            ';var departTimeSortData=helperGetSortInfo(individualData.sort,"departTime"),arriveTimeSortData=helperGetSortInfo(individualData.sort,"arriveTime"),priceSortData=helperGetSortInfo(individualData.sort,"price");$out+='\r\n            <div class="flight-info ">航班信息</div>\r\n            <div class="flight-start-time sort ',departTimeSortData&&departTimeSortData.selected&&departTimeSortData.val==-1?$out+="sort-desc":departTimeSortData&&departTimeSortData.selected&&1==departTimeSortData.val&&($out+="sort-asc"),$out+='" sort-key="departTime"> ',$out+=$escape(isInternationalFlag?"当地起飞时间":"起飞时间"),$out+='\r\n                <i class="sort-icon"></i>\r\n            </div>\r\n            <div class="flight-during">&nbsp;</div>\r\n            <div class="flight-end-time  sort ',arriveTimeSortData&&arriveTimeSortData.selected&&arriveTimeSortData.val==-1?$out+="sort-desc":arriveTimeSortData&&arriveTimeSortData.selected&&1==arriveTimeSortData.val&&($out+="sort-asc"),$out+='" sort-key="arriveTime"> ',$out+=$escape(isInternationalFlag?"当地到达时间":"到达时间"),$out+='<i class="sort-icon"></i> </div>\r\n            <div class="seat-ctn">\r\n                <div class="flight-cabin">舱位</div>\r\n                <div class="flight-describe ">&nbsp;</div>\r\n                <div class="flight-diff-price sort ',priceSortData&&priceSortData.selected&&priceSortData.val==-1?$out+="sort-desc":priceSortData&&priceSortData.selected&&1==priceSortData.val&&($out+="sort-asc"),$out+='" sort-key="price">差价 <i class="sort-icon"></i> </div>\r\n                <div class="flight-select"></div>\r\n            </div>\r\n        </li>\r\n\r\n    </ul>\r\n\r\n    <div class="T_main">\r\n        ',_.each(individualData.list,function(item){$out+='\r\n        <div class="T_item">\r\n            <table>\r\n                <tr class="T_border">\r\n\r\n                    <td class="T_airplane">\r\n                        <div class="T_first">\r\n                            <i class="airplane-company-icon airport_',$out+=$escape(item.flightCode),$out+='"></i>\r\n                            ',$out+=$escape(item.airlineName),$out+='\r\n                        </div>\r\n                        <div class="T_second">\r\n                            ',$out+=$escape(item.flightNo),$out+="\r\n\r\n                            ",item.codeshare&&($out+='\r\n                            <span class="flight-share tour-stop-hover">\r\n                            共享\r\n\r\n                                <div class="stop-over-info T_width2">\r\n                                    <p class="notice">\r\n                                        ',$out+=$escape(item.airlineName),$out+=$escape(item.flightNo),$out+="，实际由",$out+=$escape(item.sAirComName),$out+=$escape(item.codeshare),$out+='承运\r\n                                    </p>\r\n                                    <span class="z">◆</span>\r\n                                    <span class="j">◆</span>\r\n                                </div>\r\n                            </span>\r\n                            '),$out+='\r\n                        </div>\r\n                    </td>\r\n\r\n                    <td class="T_depart_time">\r\n                        <div class="T_first T_bold">',$out+=$escape(item.departTime),$out+='</div>\r\n                        <div class="T_second">',$out+=$escape(item.departureAirportName),$out+='</div>\r\n                    </td>\r\n\r\n                    <td class="T_pic">\r\n                        <div>\r\n                            <div class="jtxz-detail-hover">\r\n                                ',_.isEmpty(item.stopTip)||($out+='\r\n                                <span class="tour-stop-hover T_stop">\r\n                                        经停\r\n                                        <div class="stop-over-info">\r\n\r\n                                        <table class="stop-over-table">\r\n                                            <tr class="info-title">\r\n                                                <td class="airport">经停机场</td>\r\n                                                ',item.stopTip.arriveTime&&($out+='\r\n                                                <td class="arrival-time">到达时间</td>\r\n                                                <td class="take-off-time">起飞时间</td>\r\n                                                '),$out+='\r\n                                                <td class="stop-time">停留时间</td>\r\n                                            </tr>\r\n\r\n                                            <tr class="info-content">\r\n                                                <td class="airport-detail">',$out+=$escape(item.stopTip.stopAirportName),$out+="</td>\r\n                                                ",item.stopTip.arriveTime&&($out+='\r\n                                                <td class="arrival-detail">\r\n                                                    <p class="time">',$out+=$escape(item.stopTip.arriveTime),$out+="</p>\r\n                                                    <p>",$out+=$escape(item.stopTip.arriveDate),$out+='</p>\r\n                                                </td>\r\n                                                <td class="take-off-detail">\r\n                                                    <p class="time">',$out+=$escape(item.stopTip.departTime),$out+="</p>\r\n                                                    <p>",$out+=$escape(item.stopTip.departDate),$out+="</p>\r\n                                                </td>\r\n                                                "),$out+='\r\n                                                <td class="stop-time-detail">',$out+=$escape(item.stopTip.durationTime),$out+='</td>\r\n                                            </tr>\r\n                                        </table>\r\n\r\n                                        <span class="z">◆</span>\r\n                                        <span class="j">◆</span>\r\n                                    </div>\r\n                                    </span>\r\n                                '),$out+="\r\n\r\n                                ",_.isEmpty(item.transfer)||($out+='\r\n                                <div class="T_stop_zj"><span>',$out+=$escape(item.transfer.city),$out+='</span></div>\r\n                                <div class="T_stop_zj">中转</div>\r\n                                '),$out+='\r\n                            </div>\r\n                        </div>\r\n                        <div class="T_duration">',$out+=$escape(item.duration),$out+='</div>\r\n                    </td>\r\n\r\n                    <td class="T_arrive_time">\r\n                        <div class="T_first T_bold">\r\n                            ',$out+=$escape(item.arriveTime),$out+="\r\n\r\n                            ",1!=item.arriveDay&&item.arriveDay!=-1||($out+='\r\n                            <span class="T_arrive_day">\r\n                            ',$out+=$escape(1==item.arriveDay?"+1":"-1"),$out+="\r\n                        </span>\r\n                            "),$out+='\r\n                        </div>\r\n                        <div class="T_second">',$out+=$escape(item.destinationAirportName),$out+='</div>\r\n                    </td>\r\n\r\n                    <td class="T_right">\r\n                        ',_.each(item.cabinTypeRes,function(item2){if($out+='\r\n                        <div class="T_para">\r\n\r\n                            <div class="T_inline T_cabin">\r\n                                <div>',$out+=$escape(item2.cabinType),$out+='</div>\r\n                            </div>\r\n\r\n                            <div class="T_inline T_rule">\r\n                                <div>\r\n                                    ',2==item.airType||item2.freeLuggage&&item2.freeLuggageUnit||item2.numberLimit||item2.travelerCategory){$out+='\r\n                                    <div class="T_text jtxz-detail-hover">\r\n                                        <i class="icon notice2-icon"></i><em class="f-bb">\r\n                                        ';var isHasPurchaseNotes=item2.numberLimit||item2.travelerCategory,freeLuggageStr="行李额";if(item2.freeLuggage>0&&item2.freeLuggage<20?freeLuggageStr="行李额低":0==item2.freeLuggage&&(freeLuggageStr="无行李额"),$out+="\r\n                                       ",isHasPurchaseNotes||isHasPurchaseNotes&&2==item.airType?($out+="\r\n                                          限制/",$out+=$escape(freeLuggageStr),$out+="\r\n                                       "):isHasPurchaseNotes||2!=item.airType?($out+="\r\n                                          ",$out+=$escape(freeLuggageStr),$out+="\r\n                                       "):($out+="\r\n                                          ",$out+=$escape(freeLuggageStr),$out+="\r\n                                       "),$out+='\r\n                                        </em>\r\n\r\n                                        <div class="jtxz-detail2 T_width2">\r\n                                            ',2==item.airType&&($out+='\r\n                                            <p class="YD_title">往返优惠</p>\r\n                                            <p class="YD_mgb">此航班往返程为指定航班，您可以根据需要自行选择</p>\r\n                                            '),$out+="\r\n\r\n                                            ",item2.numberLimit||item2.travelerCategory){$out+='\r\n                                            <p class="YD_title">预订限制</p>\r\n                                            <p class="YD_mgb">\r\n                                                ';var strictStr=[];item2.travelerCategory&&strictStr.push("限出游人类型为："+item2.travelerCategory),item2.numberLimit&&strictStr.push("限出游人数为："+item2.numberLimit),strictStr=strictStr.join("，"),$out+="\r\n                                                该机票为特价票，",$out+=$escape(strictStr),$out+="\r\n                                            </p>\r\n                                            "}$out+="\r\n\r\n                                            ",item2.freeLuggage&&item2.freeLuggageUnit&&($out+='\r\n                                            <p class="YD_title">行李额说明</p>\r\n                                            <p class="YD_mgb">',$out+=$escape(item2.freeLuggage),$out+=$escape(item2.freeLuggageUnit),$out+="以下免行李费用</p>\r\n                                            "),$out+='\r\n\r\n                                            <span class="z">◆</span>\r\n                                            <span class="j">◆</span>\r\n                                        </div>\r\n                                    </div>\r\n                                    '}$out+='\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div class="T_inline T_price">',$out+=$string(helperMultiTransportShowPrice(item2.price)),$out+='</div>\r\n\r\n                            <div class="T_inline T_select">\r\n                                ',item2.selected?($out+='\r\n                                <div class="btn select selected" data-airtype="',$out+=$escape(item.airType),$out+='" data-airplaneid="',$out+=$escape(item2.resId),$out+='">\r\n                                    <span class="tn_fontface"></span>\r\n                                    已选\r\n                                </div>\r\n                                '):($out+='\r\n                                <div class="btn select ',item2.disabled&&($out+="T_disabled"),$out+='" data-airtype="',$out+=$escape(item.airType),$out+='" data-airplaneid="',$out+=$escape(item2.resId),$out+='">\r\n                                    <span class="tn_fontface"></span>\r\n                                    选择\r\n                                </div>\r\n                                '),$out+="\r\n\r\n                                ",item2.totalLeft<10&&($out+='\r\n                                <div class="T_rest">余位',$out+=$escape(item2.totalLeft),$out+="</div>\r\n                                "),$out+="\r\n                            </div>\r\n\r\n                        </div>\r\n                        "}),$out+="\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n\r\n            ",_.isEmpty(item.transferInfo)||($out+='\r\n            <div class="T_zj_detail">\r\n                <span class="T_orange_triangle"></span>\r\n                <table>\r\n                    ',_.each(item.transferInfo,function(item2){$out+='\r\n                    <tr>\r\n                        <td class="T_city_fuck">\r\n                            <div class="T_first">\r\n                                ',$out+=$escape(item2.departDate),$out+='\r\n                            </div>\r\n                            <div class="T_second">\r\n                                ',$out+=$escape(item2.departureCityName),$out+=" — ",$out+=$escape(item2.destinationCityName),$out+='\r\n                            </div>\r\n                        </td>\r\n                        <td class="T_airplane">\r\n                            <div class="T_first">\r\n                                <i class="airplane-company-icon airport_',$out+=$escape(item2.flightCode),$out+='"></i>\r\n                                ',$out+=$escape(item2.airlineName),$out+='\r\n                            </div>\r\n                            <div class="T_second">\r\n                                ',$out+=$escape(item2.flightNo),$out+='\r\n                            </div>\r\n                        </td>\r\n                        <td class="T_depart_time">\r\n                            <div class="T_first T_bold">\r\n                                ',$out+=$escape(item2.departTime),$out+='\r\n                            </div>\r\n                            <div class="T_second">\r\n                                ',$out+=$escape(item2.departureAirportName),$out+='\r\n                            </div>\r\n                        </td>\r\n                        <td class="T_pic"></td>\r\n                        <td class="T_arrive_time">\r\n                            <div class="T_first T_bold">\r\n                                ',$out+=$escape(item2.arriveTime),$out+='\r\n                            </div>\r\n                            <div class="T_second">\r\n                                ',$out+=$escape(item2.destinationAirportName),$out+='\r\n                            </div>\r\n                        </td>\r\n                        <td class="T_duration">\r\n                            ',$out+=$escape(item2.duration),$out+='\r\n                        </td>\r\n                        <td class="T_cabin">\r\n                            ',$out+=$escape(item2.cabinType),$out+="\r\n                        </td>\r\n                    </tr>\r\n\r\n                    ",item2.transfer&&($out+='\r\n                    <tr>\r\n                        <td colspan="6">\r\n                            <div class="T_middle">\r\n                                <span class="T_left">中转城市：',$out+=$escape(item2.transfer.city),$out+="</span>\r\n                                <span>中转时间：",$out+=$escape(item2.transfer.duration),$out+="</span>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                    "),$out+="\r\n\r\n                    "}),$out+="\r\n                </table>\r\n\r\n                ",(item.transferTips||item.visaTips)&&($out+='\r\n                <div class="T_note">\r\n                    ',item.transferTips&&($out+="\r\n                    <div>不同机场：中转机场不在同一机场，请注意。</div>\r\n                    "),$out+="\r\n                    ",item.visaTips&&($out+="\r\n                    <div>过境签：此行程需要过境转机，中国大陆公民过境韩国，可能需要申请该过境签证，请确认签证无误。</div>\r\n                    "),$out+="\r\n                </div>\r\n                "),$out+="\r\n\r\n            </div>\r\n            "),$out+="\r\n\r\n        </div>\r\n        "}),$out+="\r\n\r\n        ",individualData.list.length||($out+='\r\n        <h4 class="T_no_data">没有找到符合条件的航班，换个条件再试试吧~</h4>\r\n        '),$out+="\r\n    </div>\r\n</div>\r\n"}else $out+='\r\n<h4 class="T_main_no_data">\r\n    <img src="http://img.tuniucdn.com/img/201505140148/boss3_driver/niu_fail_2.jpg" alt=""/>\r\n    <p>很抱歉，没有找到匹配的联运交通，您可更换日期或城市后重新查询</p>\r\n</h4>\r\n';$out+="\r\n"}if($out+="\r\n\r\n",2==transportType){if($out+="\r\n",train){$out+='\r\n<div class="T_train_panel">\r\n\r\n    ';var filter=train.filter;$out+="\r\n    ",_.isEmpty(filter)||($out+='\r\n    <div class="T_filter">\r\n        ',_.each(filter,function(item,index){if($out+="\r\n        ",!_.isEmpty(item.sub)){$out+='\r\n        <div class="T_item" data-type="',$out+=$escape(item.id),$out+='">\r\n            <span class="T_type">',$out+=$escape(item.name),$out+="</span>\r\n            <ul>\r\n                ";var active=!0;_.some(item.sub,function(item2){if(item2.selected)return active=!1,!0}),$out+='\r\n                <li data-key="99" class="T_all ',active&&($out+="T_active"),$out+='">\r\n                    <a href="javascript:;">全部</a>\r\n                </li>\r\n                ',_.each(item.sub,function(item2){$out+='\r\n                <li class="',item2.selected&&($out+="T_active"),$out+='" data-key="',$out+=$escape(item2.id),$out+='">\r\n                    <a href="javascript:;">\r\n                        <span class="tn_fontface">&#xe618;</span>\r\n                        ',$out+=$escape(item2.name),$out+="\r\n                    </a>\r\n                </li>\r\n                "}),$out+="\r\n            </ul>\r\n        </div>\r\n        "}$out+="\r\n        "}),$out+="\r\n\r\n        ",filter.length>3&&($out+='\r\n        <button class="T_more">\r\n            <span class="T_text">更多选项</span>\r\n            <span class="T_caret"></span>\r\n        </button>\r\n        '),$out+="\r\n    </div>\r\n    "),$out+='\r\n\r\n    <ul class="T_sort">\r\n        ',_.each(train.sort,function(item){$out+='\r\n        <li data-code="',$out+=$escape(item.code),$out+='">\r\n            <a href="javascript:;">\r\n                ',$out+=$escape(item.name),$out+='\r\n                <span class="T_caret T_top ',item.selected&&1==item.val&&($out+="T_active"),$out+='"></span>\r\n                <span class="T_caret T_bottom ',item.selected&&item.val==-1&&($out+="T_active"),$out+='"></span>\r\n            </a>\r\n        </li>\r\n        '}),$out+='\r\n    </ul>\r\n\r\n    <ul class="T_title">\r\n        <li class="T_city_fuck">时间/出发城市/到达城市</li>\r\n        <li class="T_airplane">车次</li>\r\n        <li class="T_depart_time">出发车站/出发时间</li>\r\n        <li class="T_pic"></li>\r\n        <li class="T_arrive_time">到达车站/到达时间</li>\r\n        <li class="T_duration">历时</li>\r\n        <li class="T_right">\r\n            <div class="T_para">\r\n                <div class="T_inline T_cabin">坐席</div>\r\n                <div class="T_inline T_rule"></div>\r\n                <div class="T_inline T_price">价格</div>\r\n                <div class="T_inline T_select">选择</div>\r\n            </div>\r\n        </li>\r\n    </ul>\r\n\r\n    <div class="T_main">\r\n        ',_.each(train.list,function(item){$out+='\r\n        <div class="T_item">\r\n            <table>\r\n                <tr class="T_border">\r\n                    <td class="T_city_fuck">\r\n                        <div class="T_first">',$out+=$escape(item.departDate),$out+='</div>\r\n                        <div class="T_second">',$out+=$escape(item.departureCityName),$out+=" — ",$out+=$escape(item.arrivalCityName),$out+='\r\n                        </div>\r\n                    </td>\r\n\r\n                    <td class="T_airplane">\r\n                        <div class="T_first ',item.isUnsureTicket&&($out+="unsureTicket"),$out+='">\r\n                            ',$out+=$escape(item.trainNum),$out+='\r\n                        </div>\r\n                    </td>\r\n\r\n                    <td class="T_depart_time">\r\n                        <div class="T_first T_bold ',$out+=$escape(item.isUnsureTicket?"unSureTicketTime":""),$out+='">',$out+=$escape(item.departDepartTime),$out+='</div>\r\n                        <div class="T_second">',$out+=$escape(item.departStationName),$out+='</div>\r\n                    </td>\r\n\r\n                    <td class="T_pic">\r\n                        <div></div>\r\n                    </td>\r\n\r\n                    <td class="T_arrive_time">\r\n                        <div class="T_first T_bold ',
$out+=$escape(item.isUnsureTicket?"unSureTicketTime":""),$out+='">\r\n                            ',$out+=$escape(item.destArriveTime),$out+="\r\n                            ",item.durationDay>1&&($out+='\r\n                            <i class="T_first_train_duration">+',$out+=$escape(item.durationDay-1),$out+="</i>\r\n                            "),$out+='\r\n                        </div>\r\n                        <div class="T_second">',$out+=$escape(item.destStationName),$out+='</div>\r\n                    </td>\r\n\r\n                    <td class="T_duration">\r\n                        ',$out+=$escape(item.duration?item.duration:item.durationText),$out+="\r\n                        ",item.durationText&&"时间待定"==item.durationText&&($out+='\r\n                            <div class="childCount-tips jtxz-detail-hover">\r\n                                <i class="icon notice2-icon"></i>\r\n                                <div class="jtxz-detail2 timeInfo">\r\n                                    <div class="out-div">\r\n                                        <div class="train-arrow">\r\n                                        </div> \r\n                                        <span style="line-height: 15px; color: #666">',$out+=$escape(item.durationTextDetail),$out+="</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        "),$out+='\r\n                    </td>\r\n\r\n                    <td class="T_right">\r\n                        ',_.each(item.prices,function(item2){$out+='\r\n                        <div class="T_para">\r\n\r\n                            <div class="T_inline T_cabin">\r\n                                <div>',$out+=$string(helperFormatSeatType(item2.seat)),$out+='</div>\r\n                            </div>\r\n\r\n                            <div class="T_inline T_rule"></div>\r\n\r\n                            <div class="T_inline T_price">',$out+=$string(helperMultiTransportShowPrice(item2.adultPrice)),$out+='</div>\r\n\r\n                            <div class="T_inline T_select">\r\n                                ',item2.selected?($out+='\r\n                                <div class="btn select selected" data-trainid="',$out+=$escape(item2.resId),$out+='">\r\n                                    <span class="tn_fontface"></span>\r\n                                    已选\r\n                                </div>\r\n                                '):($out+='\r\n                                <div class="btn select ',item2.disabled&&($out+="T_disabled"),$out+='" data-trainid="',$out+=$escape(item2.resId),$out+='">\r\n                                    <span class="tn_fontface"></span>\r\n                                    选择\r\n                                </div>\r\n                                '),$out+="\r\n                            </div>\r\n\r\n                        </div>\r\n                        "}),$out+="\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n        </div>\r\n        "}),$out+="\r\n\r\n        ",train.list.length||($out+='\r\n        <h4 class="T_no_data">没有找到符合条件的火车，换个条件再试试吧~</h4>\r\n        '),$out+="\r\n    </div>\r\n</div>\r\n"}else $out+='\r\n<h4 class="T_main_no_data">\r\n    <img src="http://img.tuniucdn.com/img/201505140148/boss3_driver/niu_fail_2.jpg" alt=""/>\r\n    <p>很抱歉，没有找到匹配的联运交通，您可更换日期或城市后重新查询</p>\r\n</h4>\r\n';$out+="\r\n"}$out+="\r\n\r\n"}return new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,person=($utils.$helpers,$data.person),$escape=$utils.$escape,$out="";return $out+='<div class="multi-transport-list-train">\r\n    <div class="T_select T_adult">\r\n        成人票\r\n        <span class="T_operation T_minus ',1==person[1].adultNum&&($out+="T_disabled"),$out+='">-\r\n        </span><span class="T_count">',$out+=$escape(person[1].adultNum),$out+='\r\n        </span><span class="T_operation T_plus">+</span>\r\n        张<span class="T_note">（高于1.5米）</span>\r\n    </div>\r\n    <div class="T_select T_child">\r\n        儿童票\r\n        <span class="T_operation T_minus">-\r\n        </span><span class="T_count">',$out+=$escape(person[1].childNum),$out+='\r\n        </span><span class="T_operation T_plus ',1==person[1].adultNum&&($out+="T_disabled"),$out+='">+</span>\r\n        张<span class="T_note">（1.2米-1.5米）</span>\r\n    </div>\r\n    <p>1、一名成年人旅客可以免费携带一名身高不足1.2米的儿童，如果身高不足1.2米的儿童超过一名时，一名儿童免费，其他儿童须购买儿童票。儿童身高为1.2～1.5米的，须购买儿童票；超过1.5米的，须购买全价座票。</p>\r\n    <p>2、请根据儿童实际身高购票，途牛不承担因儿童身高与所购车票不符而无法进站的责任。</p>\r\n</div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,$out=($utils.$helpers,"");return $out+='<div class="float-bg"></div>\r\n<div class="float-content">\r\n    <header class="float-header">\r\n        <h2 class="active">选择联运交通</h2>\r\n        <span><i class="icon book-close T_cancel"></i></span>\r\n    </header>\r\n\r\n    <div class="T_body">\r\n\r\n    </div>\r\n    <div class="T_foot">\r\n        <button class="T_confirm T_disabled">确定</button>\r\n        <button class="T_cancel">取消</button>\r\n    </div>\r\n</div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(14),__webpack_require__(18),__webpack_require__(99),__webpack_require__(6),__webpack_require__(5)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,$,Layer,transport,config,eventBus){var pageDataObj=config.pageDataObj;return Backbone.View.extend({el:"#m-transport",initialize:function(){var self=this;self.bindEvents(),self.model.on("needRender",function(){self.render()})},bindEvents:function(){var self=this;this.$el.on("click",".input_checkbox",function(e){var DOM=$(e.target).parents(".tab_list_header"),resId=$(DOM).data("resid");self.model.selectOne(resId),self.showText(resId)})},render:function(){var hasUnsureTrain=Backbone.app.toJSON()&&Backbone.app.toJSON().hasUnsureTrain;if(hasUnsureTrain)return this.$el.hide(),!1;var data=this.model.toJSON(),html=transport(data);this.$el.html(html).show(),this.isShowText()},isShowText:function(){var self=this,renderData=self.model.get("baseData");_.each(renderData,function(item){item.select&&self.showText(item.resId)})},showText:function(resId){if(1==pageDataObj.proMode&&1==pageDataObj.proType){var self=this,data=self.model.get("baseData");_.each(data,function(oneTransport){oneTransport.resId==resId&&(oneTransport.select?eventBus.trigger("changeDepartCityName",oneTransport.conCityName+"（"+oneTransport.arriveCityName+"成团，"+oneTransport.conCityName+"联运）"):eventBus.trigger("changeDepartCityName",oneTransport.arriveCityName))})}}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,proMode=($utils.$helpers,$data.proMode),proType=$data.proType,$escape=$utils.$escape,combinedCityName=$data.combinedCityName,departCityName=$data.departCityName,oneData=$data.oneData,_=$data._,baseData=$data.baseData,hasSelect=$data.hasSelect,k=($data.item,$data.k),$out="";if($out+='<h2>\r\n\t<span class="icon tran_icon',1==proMode&&1==proType&&($out+=" icon_new"),$out+='"></span>\r\n\t<span class="m-title">\r\n\t\t',$out+=1==proMode&&1==proType?"\r\n\t\t联运交通\r\n\t\t":"\r\n\t\t联运方案\r\n\t\t",$out+='\r\n\t</span>\r\n\t<div class="jtxz-detail-hover">\r\n\t\t<i class="icon notice2-icon"></i>\r\n\t\t<div class="jtxz-detail2">\r\n\t\t\t',1==proMode&&1==proType?($out+='\r\n\t\t\t<p class="YD_mgb">联运交通是从您的实际出发地前往线路成团地点的交通，联运交通出发城市默认为您当前所在城市',$out+=$escape(combinedCityName),$out+="，若需要更换其他城市，可联系客服咨询。若您选择的联运交通在成团日期之前到达成团城市，您需自理酒店住宿。若您无需联运，请自行安排行程前往成团地点",$out+=$escape(departCityName),$out+="。</p>\r\n\t\t\t"):$out+='\r\n\t\t\t<p class="YD_title">什么是联运城市?</p>\r\n\t\t\t<p class="YD_mgb">联运城市是游客到旅游团实际发团城市的出发城市;根据您选择的城市站点,我们提供不同的联运城市</p>\r\n\t\t\t',$out+='\r\n\t\t\t<span class="z">◆</span>\r\n\t\t\t<span class="j">◆</span>\r\n\t\t</div>\r\n\t</div>\r\n\t',1==proMode&&1==proType&&($out+='\r\n\t<span class="m-title-desc">从您的出发地',$out+=$escape(combinedCityName),$out+="前往成团地点",$out+=$escape(departCityName),$out+="</span>\r\n\t"),$out+='\r\n</h2>\r\n\r\n<div class="modular-body">\r\n\t',1==proMode&&1==proType){$out+='\r\n\t<div class="info_box">\r\n\t\t';var oneData=!_.isEmpty(baseData)&&baseData[0],hasSelect=_.some(baseData,function(item){return item.select});$out+="\r\n\t\t",hasSelect?($out+="\r\n\t\t当前出发城市为",$out+=$escape(oneData.conCityName),$out+="，请留意",$out+=$escape(oneData.conCityName),$out+="-",$out+=$escape(oneData.arriveCityName),$out+="段联运交通时间\r\n\t\t"):($out+="\r\n\t\t当前出发城市为成团地点",$out+=$escape(oneData.arriveCityName),$out+="，您需要自行前往",$out+=$escape(oneData.arriveCityName),$out+="参团。若需要",$out+=$escape(oneData.conCityName),$out+="-",$out+=$escape(oneData.arriveCityName),$out+="段交通，请勾选联运交通\r\n\t\t"),$out+="\r\n\t</div>\r\n\t"}$out+='\r\n\r\n\t<ul class="tab_list" id="tab_list-tips">\r\n\t\t',1==proMode&&1==proType||($out+='\r\n\t\t<li class="tab_list_header tab-header">\r\n\t\t\t<span class="col_1">联运出发城市</span>\r\n\t\t\t<span class="col_2">方案名</span>\r\n\t\t\t<span class="col_3">单价</span>\r\n\t\t\t<span class="col_4">选择</span>\r\n\t\t</li>\r\n\t\t'),$out+="\r\n\t\t";for(var k in baseData)$out+='\r\n\t\t<li class="tab_list_header tab-body" data-resid="',$out+=$escape(baseData[k].resId),$out+='">\r\n\t\t\t<span class="col_1">',$out+=$escape(baseData[k].conCityName),1==proMode&&1==proType&&($out+=" - ",$out+=$escape(baseData[k].arriveCityName)),$out+='</span>\r\n\t\t\t<span class="col_2 f-ol" id="col_2" title="',$out+=$escape(baseData[k].resName),$out+='">\r\n\t\t\t\t<em class="detail-wrapper f-active-color">\r\n\t\t\t\t\t',$out+=$escape(baseData[k].resName),$out+='\r\n\t\t\t\t\t<div class="resources-detail">\r\n\t\t\t\t\t<div class="close-detail"><i class="icon close-icon"></i></div>\r\n\t\t\t\t\t<div class="resources">\r\n\t\t\t\t\t\t<div class="resources-panel">\r\n\t\t\t\t\t\t\t<span class="resources-panel-title"><i class="icon title-icon"></i>联运城市</span>\r\n\t\t\t\t\t\t\t<div class="c9">\r\n\t\t\t\t\t\t\t\t<ul class="city-list">\r\n\t\t\t\t\t\t\t\t\t',_.each(baseData[k].areas,function(item){$out+="\r\n\t\t\t\t\t\t\t\t\t<li>",$out+=$escape(item),$out+="</li>\r\n\t\t\t\t\t\t\t\t\t"}),$out+="\r\n\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t",1==proMode&&1==proType&&($out+='\r\n\t\t\t\t\t\t\t<div class="c9">\r\n\t\t\t\t\t\t\t\t<div class="add-tips">\r\n                              \t联运出发城市默认为您当前所在城市，若需要更换其他可选联运城市，您可返回修改您的出发城市，也可下单后联系客服咨询。\r\n                         \t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t'),$out+='\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class="resources-panel">\r\n\t\t\t\t\t\t\t<span class="resources-panel-title"><i class="icon title-icon"></i>预订须知</span>\r\n\t\t\t\t\t\t\t<p class="c9 book-notice">',$out+=$escape(baseData[k].bookNotice),$out+='</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<span class="icon white-triangle"></span>\r\n\t\t\t\t\t<div class="clear-float"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t</em>\r\n\t\t\t</span>\r\n\t\t\t<span class="col_3">',0==baseData[k].price?$out+="免费赠送\r\n\t\t\t\t":($out+="￥",$out+=$escape(baseData[k].price)),$out+='</span>\r\n\t\t\t<span class="col_4">\r\n\t\t\t\t',baseData[k].needHide||($out+='\r\n\t\t\t\t<label class="input_checkbox ',baseData[k].select&&($out+="enabled"),$out+='">\r\n\t                  <span class="tn_fontface"></span>\r\n\t           </label>\r\n\t\t\t\t'),$out+="\r\n\t\t\t</span>\r\n\t\t</li>\r\n\t\t";return $out+="\r\n\t</ul>\r\n</div>",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(5),__webpack_require__(101),__webpack_require__(17),__webpack_require__(18),__webpack_require__(16)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,EventBus,HotelView,Layer,layer_2_1,tools){return Backbone.View.extend({el:"#m-hotel",initialize:function(){this.listenTo(this.model,"needRender",this.render),this.listenTo(this.model,"jiBaoTip",this.jiBaoTip),this.responsive(),$(window).on("closeHotelDetail",this.closeHotelDetail)},render:function(){var self=this,models=this.model.models;_.each(models,function(hotel){var hotelView=new HotelView({model:hotel}),html=hotelView.toHtml();self.$el.append(html)}),EventBus.trigger("hotelPriceChange"),this.$el.show()},responsive:function(){},showCheckLoading:function(){Layer.load("正在验证，请稍后...")},hideCheckLoading:function(){Layer.closeAll()},closeHotelDetail:function(){layer_2_1.close(window.hotelDetailLayerIndex)},jiBaoTip:function(diffPrice){if(0==diffPrice)var index=tools.layer({msg:'注："即保房酒店"付款后才能确认有无房间，确认成功后，房间不退不改！',closeBtn:0,icon:2,yes:function(){Layer.close(index),EventBus.trigger("saveOrder")}});else{diffPrice=diffPrice<0?"-￥"+-diffPrice:"+￥"+diffPrice;var index=tools.layer({msg:"“即保房酒店”价格发生变动："+diffPrice+'，注："即保房酒店"付款后才能确认有无房间，确认成功后，房间不退不改！',closeBtn:0,icon:2,yes:function(){Layer.close(index),EventBus.trigger("saveOrder")}})}}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(5),__webpack_require__(102),__webpack_require__(7),__webpack_require__(18),__webpack_require__(6),__webpack_require__(103)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,EventBus,HotelTemplate,Template,Layer,config,gallery2){var PageDataObj=window.pageDataObj,tksHost=config.tksHost||"";return Backbone.View.extend({className:"modular",initialize:function(){var self=this;this.listenTo(this.model,"change",this.render),this.$el.on("click",".hotel-name",$.proxy(this.showHotelDetail,this)),this.$el.on("click",".hotel-img img",$.proxy(this.showHotelDetail,this)),this.$el.on("click",".view_map",function(e){self.showHotelDetail(e,1)}),this.$el.on("change",".input_number > select",$.proxy(this.roomCountChange,this)),this.$el.on("click",".m-more",$.proxy(this.toChangeHotel,this)),this.bindHover(".T_bao_icon","即保房需要您先付款才能发起酒店占位哦~"),this.prevCount=this.nextCount=0},render:function(){var data=this.model.toJSON(),html=HotelTemplate(data);this.$el.html(html)},toHtml:function(){var data=this.model.toJSON(),html=HotelTemplate(data);return this.$el.html(html),this.$el},bindHover:function(obj,msg){$("body").on("mouseenter",obj,function(){var _left=$(this).offset().left,_top=$(this).offset().top,_width=$(this).outerWidth(),_height=$(this).outerHeight(),div=$('<div class="T_hover"/>'),left=_left+_width/2,top=_top+_height;div.text(msg),div.css({left:left,top:top}).appendTo("body");var width=div.outerWidth(),marginLeft=(div.outerHeight(),-width/2);div.css({"margin-left":marginLeft})}).on("mouseleave",obj,function(){$(".T_hover").remove()})},showHotelDetail:function(e,showMap){var ratePlan,hotel=this.model.get("hotel"),room=hotel.room,location=window.location,protocol=location.protocol?location.protocol+"//"+location.host:"http://"+location.host;hotel.hotelType&&(ratePlan=room.ratePlan);var postData={hotelId:hotel.hotelId,hotelType:hotel.hotelType,productId:PageDataObj.productId,roomId:hotel.hotelType?ratePlan.ratePlanId:room.roomId,departCity:PageDataObj.departCity,departDate:PageDataObj.departDate,journeyId:PageDataObj.journeyId,isInter:hotel.isInter,version:2,hswHost:protocol};0==hotel.hotelType&&(postData.isPkgHotel=1);var iframeUrl=tksHost+"/Hotel/viewHotelDetail"+this.stringfy(postData);PageDataObj.needIframeRedirect&&(iframeUrl+="&needIframeRedirect=true"),1==showMap&&(iframeUrl+="&activeTab=map"),window.hotelDetailLayerIndex=Layer.open({type:2,title:!1,closeBtn:0,area:["930px","498px"],content:iframeUrl})},roomCountChange:function(e){var obj=$(e.currentTarget),roomCount=+obj.val(),ratePlanId=obj.data("rateplanid");this.model.roomCountChange(roomCount,ratePlanId)},stringfy:function(obj){var url="";url+="?";for(var key in obj)url+="postData["+key+"]="+obj[key]+"&";return encodeURI(url.substring(0,url.length-1))},toChangeHotel:function(){var url=this.model.getAllHotelPath(),iframe_src=tksHost+"/Hotel/HotelListPage?";PageDataObj.needIframeRedirect&&(iframe_src+="needIframeRedirect=true&"),iframe_src+=url;var html='<iframe style="width: 100%;height: 100%;"  src="'+iframe_src+'" scrolling="auto" allowtransparency="true" frameborder="0"></iframe>';$("#allHotelPath").show().find("#iframeContainer").html(html),$(".all_hotel_path_bg").show()}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var room,ratePlan,$utils=this,room=($utils.$helpers,$data.room),ratePlan=$data.ratePlan,hotel=$data.hotel,canChange=$data.canChange,$escape=$utils.$escape,isFromOrder=$data.isFromOrder,pageType=$data.pageType,firstPicture=$data.firstPicture,_=$data._,typeTitle=$data.typeTitle,str2=$data.str2,str=$data.str,i=$data.i,helperIsEmpty=$data.helperIsEmpty,helperFormatFacility=($data.item,$data.helperFormatFacility),constant=($data.picture,$data.index,$data.constant),hasChange=$data.hasChange,helperIsExist=$data.helperIsExist,helperFormatRoomTypeDesc=$data.helperFormatRoomTypeDesc,$string=$utils.$string,$out="";room=hotel.room,hotel.hotelType&&(ratePlan=room.ratePlan),$out+='\r\n<h2>\r\n    <a class="m-more ',canChange||($out+="hide"),$out+='">更改酒店<i class="icon more-icon"></i></a>\r\n    <span class="icon hotel-icon"></span>\r\n    <span class="m-title">酒店信息',hotel.destinationName&&($out+="（",$out+=$escape(hotel.destinationName),$out+="）"),$out+='</span>\r\n    <span class="m-title-desc">\r\n        ',isFromOrder||"cruise2"!=pageType||($out+="\r\n        此酒店为默认推荐，请确认酒店\r\n        "),$out+='\r\n    </span>\r\n</h2>\r\n\r\n<div class="modular-body">\r\n    <div class="hotel-info-center">\r\n        <div class="hotel-info">\r\n            <div class="hotel-img">\r\n                ';var firstPicture="http://img.tuniucdn.com/img/201705310921/bookOnline/nohotel.jpg";_.isEmpty(hotel.pictures)||(firstPicture=hotel.pictures[0].small),$out+='\r\n                <img src="',$out+=$escape(firstPicture),$out+='" alt="">\r\n\r\n                ';var typeTitle="";if(hotel.hotelType){var str2=hotel.star+"";typeTitle=str2.length>1?hotel.star:hotel.star+"星级"}else typeTitle=hotel.star;if($out+='\r\n                <span class="hotel-type">\r\n                    ',hotel.hotelType){$out+="\r\n\r\n                    ";var str=hotel.star+"";if(str.length>1)$out+="\r\n                    <span>",$out+=$escape(hotel.star),$out+="</span>\r\n                    ";else{for(var i=0;i<5;i++)$out+=i<hotel.star?'\r\n                    <i class="tn_fontface T_star on">&#xe60b;</i>\r\n                    ':'\r\n                    <i class="tn_fontface T_star off">&#xe609;</i>\r\n                    ',$out+="\r\n                    ";$out+="\r\n                    "}$out+="\r\n\r\n                    "}else $out+="\r\n                    <span>",$out+=$escape(hotel.star),$out+="</span>\r\n                    ";if($out+='\r\n                </span>\r\n            </div>\r\n            <div class="hotel-detail-info">\r\n                <p class="hotel-name-p">\r\n                    <span class="hotel-name f-active-color two-line" title="',$out+=$escape(hotel.chineseName),hotel.englishName&&($out+="(",$out+=$escape(hotel.englishName),$out+=")"),$out+='">\r\n                        ',$out+=$escape(hotel.chineseName),hotel.englishName&&($out+="(",$out+=$escape(hotel.englishName),$out+=")"),$out+='\r\n                    </span>\r\n                    <div class="clear-float"></div>\r\n                </p>\r\n                <p class="hotel-date-p">\r\n                    ',$out+=$escape(hotel.departDate),$out+="入住，",$out+=$escape(hotel.backDate),$out+="退房的酒店（",$out+=$escape(hotel.duration),$out+="晚）\r\n                </p>\r\n                ",helperIsEmpty(hotel.facilities)||($out+='\r\n                <p class="hotel-img-p">\r\n                    ',_.each(hotel.facilities,function(item){$out+="\r\n                    ",helperFormatFacility(item)&&($out+='\r\n                    <span class="T_icon ',$out+=$escape(helperFormatFacility(item)),$out+='" title="',$out+=$escape(hotel.facilityName&&hotel.facilityName[item]),$out+='"></span>\r\n                    '),$out+="\r\n                    "}),$out+="\r\n                </p>\r\n                "),$out+='\r\n                <p class="hotel-address-p">\r\n                    <span class="f-ol address" title="',$out+=$escape(hotel.address),$out+='">',$out+=$escape(hotel.address),$out+='</span>\r\n                    <a href="javascript:;" class="view_map J_view_map"><i class="icon map-icon"></i>地图</a>\r\n                </p>\r\n            </div>\r\n            <div class="clear-float"></div>\r\n        </div>\r\n        ',room){$out+='\r\n        <div class="book-hotel-info">\r\n                <span class="room-type detail-wrapper f-ol" title="',$out+=$escape(room.name),$out+='">\r\n                    <em class="f-active-color">',$out+=$escape(room.name),$out+='</em>\r\n                    <div class="resources-detail hotel-detail">\r\n                       <div class="hotel-detail-title">\r\n                           <header class="float-header">\r\n                               <h2 class="active">房型详情</h2>\r\n                               <span><i class="icon close-icon"></i></span>\r\n                           </header>\r\n\r\n                           <div class="resources detail-main gallery2">\r\n                               <div class="detail-img-list">\r\n                                   <div class="big-img">\r\n                                       ',_.each(room.pictures,function(picture,index){$out+='\r\n                                       <img src="',$out+=$escape(picture.big),$out+='" class="',0!=index&&($out+="hide"),$out+='">\r\n                                       '}),$out+="\r\n\r\n                                       ",_.isEmpty(room.pictures)&&($out+='\r\n                                       <img src="//img3.tuniucdn.com/img/201510131901/bookOnline/default.png">\r\n                                       '),$out+='\r\n                                   </div>\r\n                                   <div class="small-img" data-count="',$out+=$escape(constant.ROOM_PICTURES_COUNT),$out+='">\r\n                                       ';var hasChange=!_.isEmpty(room.pictures)&&room.pictures.length>constant.ROOM_PICTURES_COUNT;if($out+="\r\n                                       ",hasChange&&($out+='\r\n                                       <a class="left">\r\n                                           <img class="tn_logo" src="//img3.tuniucdn.com/img/201510131901/bookOnline/left.png" alt="">\r\n                                           <img class="tn_logo hide" src="//img3.tuniucdn.com/img/201510131901/bookOnline/left-active.png" alt="前一张">\r\n                                       </a>\r\n                                       '),$out+='\r\n                                       <div class="middle">\r\n                                           <ul>\r\n                                               ',_.each(room.pictures,function(picture,index){$out+='\r\n                                               <li class="',0==index&&($out+="active"),$out+='"><a href="javascript:;"><img src="',$out+=$escape(picture.small),$out+='" alt=""></a></li>\r\n                                               '}),$out+="\r\n\r\n                                               ",_.isEmpty(room.pictures)&&($out+='\r\n                                               <li class="active"><a href="javascript:;"><img src="//img3.tuniucdn.com/img/201510131901/bookOnline/default_small2.jpg" alt=""></a></li>\r\n                                               '),$out+="\r\n                                           </ul>\r\n                                       </div>\r\n                                       ",hasChange&&($out+='\r\n                                       <a class="right">\r\n                                           <img class="tn_logo hide" src="//img3.tuniucdn.com/img/201510131901/bookOnline/right.png" alt="">\r\n                                           <img class="tn_logo" src="//img3.tuniucdn.com/img/201510131901/bookOnline/right-active.png" alt="后一张">\r\n                                       </a>\r\n                                       '),$out+='\r\n                                   </div>\r\n                               </div>\r\n                               <div class="detail-explain">\r\n                                   <p class="detail-explain-name">',$out+=$escape(room.name),$out+="</p>\r\n                                   ",helperIsExist(room.area)&&($out+='\r\n                                   <div class="area">\r\n                                       <p class="area-title">建筑面积：</p>\r\n                                       <p class="area-content">',$out+=$escape(room.area),$out+='m<span class="T-supper">2</span></p>\r\n                                   </div>\r\n                                   '),$out+='\r\n                            <div>\r\n                                <p class="area-title">床型：</p>\r\n                                <p class="area-content">',$out+=$escape(room.bedType),$out+='</p>\r\n                            </div>\r\n                            <div>\r\n                                <p class="area-title">是否可加床：</p>\r\n                                <p class="area-content">',$out+=$escape(room.isExtraBed?"是":"否"),$out+='</p>\r\n                            </div>\r\n                            <div>\r\n                                <p class="area-title">可入住人数：</p>\r\n                                <p class="area-content">\r\n                                    ',$out+=$escape(room.maxAdultNum),$out+="成人",room.maxChildNum&&($out+=$escape(room.maxChildNum),$out+="儿童"),$out+='\r\n                                </p>\r\n                            </div>\r\n                            <div>\r\n                                <p class="area-title">宽带：</p>\r\n                                <p class="area-content">',$out+=$escape(room.network),$out+="</p>\r\n                            </div>\r\n                            ",helperIsExist(room.bedInfo)&&($out+='\r\n                            <div>\r\n                                <p class="area-title">床型描述：</p>\r\n                                <p class="area-content">',$out+=$escape(room.bedInfo),$out+="</p>\r\n                            </div>\r\n                              "),$out+="\r\n                             ",helperIsExist(room.roomTypeDesc)&&($out+='\r\n                                 <div>\r\n                                    <p class="area-title">无烟房：</p>\r\n                                    <p class="area-content">',$out+=$escape(helperFormatRoomTypeDesc(room.bedInfo)),$out+="</p>\r\n                                </div>\r\n                               "),$out+="\r\n                                   ",helperIsExist(room.bookNotice)&&($out+='\r\n                                   <div class="notice">\r\n                                       <p class="area-title">预订须知：</p>\r\n                                       <p class="area-content">',$out+=$string(room.bookNotice),$out+="</p>\r\n                                   </div>\r\n                                   "),$out+='\r\n                               </div>\r\n                               <div class="clear-float"></div>\r\n                           </div>\r\n                           <span class="icon white-triangle"></span>\r\n                       </div>\r\n                   </div>\r\n                </span>\r\n            ',
hotel.hotelType){if($out+="\r\n            ",ratePlan){$out+='\r\n            <span class="bed-type">\r\n                    <span class="bed-info f-ol" title="',$out+=$escape(ratePlan.bedType||"--"),$out+='"><em class="c9">床型：</em>',$out+=$escape(ratePlan.bedType||"--"),$out+='</span>\r\n                    <span class="meals-info"><em  class="c9">早餐：</em>',$out+=$escape(ratePlan.breakfast||"--"),$out+='</span>\r\n                    <div class="clear-float"></div>\r\n                </span>\r\n            <span class="net-info f-ol" title="',$out+=$escape(ratePlan.network||"--"),$out+='"><em  class="c9">宽带：</em>',$out+=$escape(ratePlan.network||"--"),$out+='</span>\r\n            <span class="input_number"><em  class="c9">间数：</em>\r\n                    <select class="field-select">\r\n                        ';for(var i=ratePlan.minRoomCount;i<=ratePlan.maxRoomCount;i++)$out+="\r\n                        <option\r\n                                ",i==ratePlan.roomCount&&($out+="selected"),$out+=">",$out+=$escape(i),$out+="</option>\r\n                        ";$out+="\r\n                    </select>\r\n                    <label> 间</label>\r\n                </span>\r\n            "}$out+="\r\n            "}else{$out+='\r\n            <span class="bed-type">\r\n                    <span class="bed-info f-ol" title="',$out+=$escape(room.bedType||"--"),$out+='"><em class="c9">床型：</em>',$out+=$escape(room.bedType||"--"),$out+='</span>\r\n                    <span class="meals-info"><em  class="c9">早餐：</em>',$out+=$escape(room.breakfast||"--"),$out+='</span>\r\n                    <div class="clear-float"></div>\r\n                </span>\r\n            <span class="net-info f-ol" title="',$out+=$escape(room.network||"--"),$out+='"><em  class="c9">宽带：</em>',$out+=$escape(room.network||"--"),$out+='</span>\r\n            <span class="input_number"><em  class="c9">间数：</em>\r\n                    <select class="field-select">\r\n                        ';for(var i=room.minRoomCount;i<=room.maxRoomCount;i++)$out+="\r\n                        <option\r\n                                ",i==room.roomCount&&($out+="selected"),$out+=">",$out+=$escape(i),$out+="</option>\r\n                        ";$out+="\r\n                    </select>\r\n                    <label> 间</label>\r\n                </span>\r\n            "}$out+='\r\n        </div>\r\n        <div class="clear-float"></div>\r\n        '}return $out+="\r\n    </div>\r\n</div>\r\n",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var $=__webpack_require__(14),gallery2=(__webpack_require__(11),{init:function(){$(document).on("click",".hotel-detail .small-img .left",this.prevPicture),$(document).on("click",".hotel-detail .small-img .right",this.nextPicture),$(document).on("click",".hotel-detail .small-img li",this.showPicture)},prevPicture:function(e){var obj=$(e.currentTarget);if(!obj.hasClass("T_disabled")){var parent=obj.parent(".small-img"),container=parent.find(".middle"),delta=container.width(),ul=parent.find(".middle ul");delta+=parseInt(ul.children("li").eq(0).css("marginRight"));var left=parseInt(ul.css("left"))||0,next=parent.find(".right");gallery2.canPrev(obj)&&(gallery2.disabled(obj),ul.animate({left:left+delta},"linear",function(){gallery2.canPrev(obj)&&gallery2.enabled(obj),gallery2.enabled(next)}))}},nextPicture:function(e){var obj=$(e.currentTarget);if(!obj.hasClass("T_disabled")){var parent=obj.parent(".small-img"),container=parent.find(".middle"),delta=container.width(),ul=parent.find(".middle ul");delta+=parseInt(ul.children("li").eq(0).css("marginRight"));var left=parseInt(ul.css("left"))||0,prev=parent.find(".left");gallery2.canNext(obj)&&(gallery2.disabled(obj),ul.animate({left:left-delta},"linear",function(){gallery2.canNext(obj)&&gallery2.enabled(obj),gallery2.enabled(prev)}))}},showPicture:function(e){var obj=$(e.currentTarget),index=obj.index(),parent=obj.parents(".small-img");parent.find("li").removeClass("active"),obj.addClass("active"),parent.prev(".big-img").find("img").hide(),parent.prev(".big-img").find("img").eq(index).show()},canPrev:function(obj){var parent=obj.parent(".small-img"),ul=parent.find(".middle ul"),left=parseInt(ul.css("left"))||0;return left<0},canNext:function(obj){var parent=obj.parent(".small-img"),container=parent.find(".middle"),delta=container.width(),ul=parent.find(".middle ul"),left=parseInt(ul.css("left"))||0,len=ul.children("li").length,count=parent.data("count");return left>-(Math.ceil(len/count)-1)*delta},disabled:function(obj){var imgs=obj.find("img");imgs.eq(1).hide(),imgs.eq(0).show(),obj.addClass("T_disabled")},enabled:function(obj){var imgs=obj.find("img");imgs.eq(0).hide(),imgs.eq(1).show(),obj.removeClass("T_disabled")}});gallery2.init()},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),tpl=__webpack_require__(105),eventBus=__webpack_require__(5);module.exports=backbone.View.extend({el:"#m-schedule-info",events:{"click .location .input_checkbox":"selectOneRow"},initialize:function(){this.listenTo(this.model,"render",this.render),this.render(),this.initSelect()},render:function(){this.model.danShenGou();var renderData=this.model.toJSON();if(this.model.getCanRender()){var html=tpl(renderData);this.$el.html(html).show()}else this.$el.hide()},selectOneRow:function(e){var ele=$(e.currentTarget),selectIndex=ele.parents(".location-info").index(),isCheck=ele.hasClass("enabled")?0:1;this.model.trigger("selectOneRow",selectIndex,isCheck)},initSelect:function(){var self=this,index=void 0,isCheck=void 0;this.$el.on("click",".sigle-room .input_checkbox",function(){var target=$(this);1!==target.parents(".T_one_resource").length&&(index=target.parents(".room-info").prevAll(".room-info").length,isCheck=target.hasClass("enabled")?0:1,self.model.trigger("oneRowSelect",index,isCheck),eventBus.trigger("refreshInsurance"))})}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,busPlaceInfo=($utils.$helpers,$data.busPlaceInfo),i=$data.i,oneBusPlaceInfo=$data.oneBusPlaceInfo,$escape=$utils.$escape,_=$data._,danshengouBudget=$data.danshengouBudget,roomAddBudget=$data.roomAddBudget,hasRoomAddBudgetFalg=$data.hasRoomAddBudgetFalg,oneRoomAddBudget=$data.oneRoomAddBudget,str=$data.str,helperShowPrice=$data.helperShowPrice,$out="";if($out+='<h2>\r\n    <span class="icon schedule-icon"></span>\r\n    <span class="m-title">行程通告</span>\r\n</h2>\r\n<div class="modular-body">\r\n    ',busPlaceInfo&&busPlaceInfo.length){$out+='\r\n    <div class="panel location">\r\n        <span class="panel-title"><i class="icon loca-icon"></i>上车地点</span>\r\n        <div>\r\n            ';for(var i=0;i<busPlaceInfo.length;i++){$out+="\r\n            ";var oneBusPlaceInfo=busPlaceInfo[i];$out+='\r\n            <div class="location-info">\r\n                <div class="start-and-end">\r\n                    <p class="left f-ol" title="发车：',$out+=$escape(oneBusPlaceInfo.departTime),$out+=" ",$out+=$escape(oneBusPlaceInfo.departPlace),$out+='"><em class="c3">发车：</em>',$out+=$escape(oneBusPlaceInfo.departTime),$out+=" ",$out+=$escape(oneBusPlaceInfo.departPlace),$out+='</p>\r\n                    <p class="right f-ol" title="返回：',$out+=$escape(oneBusPlaceInfo.backPlace),$out+='"><em class="c3">返回：</em>',$out+=$escape(oneBusPlaceInfo.backPlace),$out+='</p>\r\n                    <p class="clear-float"></p>\r\n                </div>\r\n                <div class="remarks">\r\n                    ',oneBusPlaceInfo.departRemark&&($out+='\r\n                    <p class="left f-ol" title="备注：',$out+=$escape(oneBusPlaceInfo.departRemark),$out+='"><em class="c3">备注：</em>',$out+=$escape(oneBusPlaceInfo.departRemark),$out+="</p>\r\n                    "),$out+='\r\n                    <p class="right text-right f-ol" title=""><label class="input_checkbox ',1===oneBusPlaceInfo.isSelect&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label></p>\r\n                    <p class="clear-float"></p>\r\n                </div>\r\n            </div>\r\n            '}$out+="\r\n        </div>\r\n    </div>\r\n    "}if($out+="\r\n\r\n    ",_.isEmpty(danshengouBudget)||(roomAddBudget=danshengouBudget),$out+="\r\n    ",roomAddBudget&&roomAddBudget.length&&hasRoomAddBudgetFalg){$out+='\r\n    <div class="panel sigle-room">\r\n        <span class="panel-title"><i class="icon loca-icon"></i>全程单房差\r\n              <span class="jtxz-detail-hover">\r\n                  <i class="icon loca-tips-icon"></i>\r\n                        <div class="jtxz-detail2 T_width2">\r\n                            <p class="YD_title">单房差是什么？</p>\r\n                            <p class="YD_mgb">因旅游过程中的住宿一般是两个床位的标准间，而团费是根据1名成人占1张床计算的，所以当您的出游人数（成人）为奇数时，需要补足另外一个床位的费用。</p>\r\n                            <span class="z">◆</span>\r\n                            <span class="j">◆</span>\r\n                        </div>\r\n              </span>\r\n        </span>\r\n        ';for(var i=0;i<roomAddBudget.length;i++){$out+="\r\n        ";var oneRoomAddBudget=roomAddBudget[i];$out+="\r\n        ";var str="room-info";1==i&&(str+=" hide"),1==roomAddBudget.length&&(str+=" T_one_resource"),i==roomAddBudget.length-1&&(str+=" last"),$out+='\r\n        <div class="',$out+=$escape(str),$out+='">\r\n            <span class="info-type">',$out+=$escape(oneRoomAddBudget.name),$out+='</span>\r\n            <span class="info-price"><em class="f60">',$out+=i<2?$escape(helperShowPrice(oneRoomAddBudget.price)):"￥0",$out+='</em></span>\r\n            <span class="info-select"><label class="input_checkbox ',1===oneRoomAddBudget.isSelect&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label></span>\r\n        </div>\r\n        '}$out+="\r\n    </div>\r\n    "}return $out+="\r\n</div>",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),eventBus=__webpack_require__(5),tpl=__webpack_require__(107),layer2=(__webpack_require__(17),__webpack_require__(18));module.exports=backbone.View.extend({el:"#m-must-selected",events:{},initialize:function(){this.listenTo(this.model,"needRender",this.render),this.listenTo(this.model,"showError",this.showError),this.$el.on("click",".addition-panel .more-or-less-pro",$.proxy(this.showAll,this)),this.$el.on("change",".addition-panel .must-date select",$.proxy(this.dateChange,this)),this.$el.on("change",".addition-panel .select-count select",$.proxy(this.countChange,this)),this.$el.on("click",".addition-panel .must-btn label",$.proxy(this.selectOne,this))},render:function(){var data=this.model.toJSON();if(this.model.getCanRender()){var html=tpl(data);this.$el.html(html).show()}_.isEmpty(data.additionList)||(eventBus.trigger("additionRequiredCalculate"),eventBus.trigger("changeTicketResource"))},showError:function(options){var msg={1:"请选择一项资源"},type=options.type,position=(options.index,this.$el.offset().top);$("body").animate({scrollTop:position}),layer2.msg(msg[type])},showAll:function(e){var obj=$(e.currentTarget),parent=obj.parents(".panel"),index=parent.data("index");this.model.showAll(index)},dateChange:function(e){var self=this,obj=$(e.currentTarget).children("option:selected"),index=obj.index(),resId=obj.parents(".panel-list").data("resid"),parent=obj.parents(".panel"),panelIndex=parent.data("index"),data=self.model.toJSON();_.some(data.additionList,function(unit,tmpIndex){return panelIndex==tmpIndex&&_.some(unit.resList,function(item){if(item.resId==resId)return item.selectDate=index,item.adultPrice=item.resourceDatePrices[index].price,item.childPrice=item.resourceDatePrices[index].childPrice,item.departDate=item.resourceDatePrices[index].departDate,!0})}),self.model.trigger("needRender"),eventBus.trigger("additionRequiredCalculate")},countChange:function(e){var self=this,obj=$(e.currentTarget),count=+obj.val(),isAdult=obj.parent().hasClass("T_adult"),resId=obj.parents(".panel-list").data("resid"),parent=obj.parents(".panel"),panelIndex=parent.data("index"),data=self.model.toJSON();_.some(data.additionList,function(unit,tmpIndex){var selectType=unit.selectType;return panelIndex==tmpIndex&&_.some(unit.resList,function(item){if(item.resId==resId)return isAdult?item.adultResourceCount=count:(item.childResourceCount=count,0==selectType&&(0==count?item.childSelect=!1:item.childSelect=!0)),!0})}),self.model.trigger("needRender"),eventBus.trigger("additionRequiredCalculate")},selectOne:function(e){var self=this,obj=$(e.currentTarget),isSelect=obj.hasClass("enabled"),resId=obj.parents(".panel-list").data("resid"),parent=obj.parents(".panel"),panelIndex=parent.data("index"),data=self.model.toJSON(),changeFlag=!1;_.some(data.additionList,function(unit,tmpIndex){if(panelIndex==tmpIndex){var selectType=unit.selectType;if(2==selectType)if(isSelect){var flag=!1;_.some(unit.resList,function(item){if(item.resId!=resId&&item.adultSelect)return flag=!0,!0}),flag?_.some(unit.resList,function(item){if(item.resId==resId)return item.adultSelect=!1,item.childSelect=!1,changeFlag=!0,!0}):layer2.msg("至少选一项")}else _.some(unit.resList,function(item){if(item.resId==resId){var resInfo=item.resInfo,priceComputerType=resInfo.priceComputerType,selectDate=item.selectDate;item.resourceDatePrices[selectDate].excludeChildFlag;return item.adultSelect=!0,"人"==priceComputerType&&data.childNum&&(item.childSelect=!0),changeFlag=!0,!0}});else 3==selectType&&(isSelect?layer2.msg("至少选一项"):(_.each(unit.resList,function(item){if(item.resId==resId){var resInfo=item.resInfo,priceComputerType=resInfo.priceComputerType,selectDate=item.selectDate;item.resourceDatePrices[selectDate].excludeChildFlag;item.adultSelect=!0,"人"==priceComputerType&&data.childNum&&(item.childSelect=!0)}else item.adultSelect=!1,item.childSelect=!1}),changeFlag=!0))}}),changeFlag&&(self.model.trigger("needRender"),eventBus.trigger("additionRequiredCalculate"))}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,$escape=($utils.$helpers,$utils.$escape),title=$data.title,supportChangeCount=$data.supportChangeCount,_=$data._,additionList=$data.additionList,helperFormatText=($data.unit,$data.index,$data.helperFormatText),helperGetTypeByCode=($data.showAddition,$data.item,$data.moreCount,$data.hasFindFlag,$data.firstShowFlag,$data.hasSelected,$data.resInfo,$data.listClass,$data.selectDate,$data.excludeChildFlag,$data.helperGetTypeByCode),helperIsExist=($data.visaInfo,$data.helperIsExist),helperFormatBooleanTip=$data.helperFormatBooleanTip,helperFormatDrawType=$data.helperFormatDrawType,helperFormatEnterWay=$data.helperFormatEnterWay,$string=$utils.$string,childNum=($data.dsInfo,$data.date,$data.adultPrice,$data.childPrice,$data.titleStr,$data.childNum),pageType=$data.pageType,$out=($data.onlyshow,$data.i,"");return $out+='<h2>\r\n    <span class="icon must-icon"></span>\r\n    <span class="m-title">',$out+=$escape(title),$out+='</span>\r\n</h2>\r\n<div class="modular-body ',supportChangeCount&&($out+="support-change-count"),$out+='">\r\n    ',_.each(additionList,function(unit,index){$out+='\r\n    <div class="panel addition-panel ',unit.show||($out+="hide"),$out+='" data-index="',$out+=$escape(index),$out+='">\r\n        <aside>\r\n            <span class="must-product">\r\n                <em class="f-ol">',$out+=$escape(helperFormatText(unit.subType)),$out+="(",$out+=$escape(unit.destinationName),$out+='使用)</em>\r\n                <p class="select-type">\r\n                    ',3==unit.selectType?$out+="\r\n                    <span>任选一项</span>\r\n                    ":2==unit.selectType?$out+="\r\n                    <span>一项起选</span>\r\n                    ":0==unit.selectType&&($out+="\r\n                    <span>必选</span>\r\n                    "),$out+="\r\n                </p>\r\n             </span>\r\n        </aside>\r\n        <main>\r\n            ";var showAddition=unit.resList.filter(function(item){return 1==item.show})||[],moreCount=showAddition.length,hasFindFlag=!1,firstShowFlag=!1,hasSelected=_.some(unit.resList,function(item){return item.adultSelect||item.childSelect});$out+="\r\n            ",_.each(unit.resList,function(item,index){$out+="\r\n            ";var listClass,resInfo=item.resInfo;if(item.show)if(unit.showAll)listClass="";else switch(unit.selectType){case 0:case 4:listClass="";break;case 2:case 3:item.adultSelect||item.childSelect?(listClass="",hasFindFlag=!0):hasSelected||hasFindFlag?listClass="hide":(listClass="",hasFindFlag=!0)}else listClass="hide";firstShowFlag||""!=listClass||(firstShowFlag=!0,listClass+=" first");var selectDate=item.selectDate,excludeChildFlag=item.resourceDatePrices[selectDate].excludeChildFlag;if($out+='\r\n            <div class="panel-list ',$out+=$escape(listClass),$out+='" data-resid="',$out+=$escape(item.resId),$out+='">\r\n                 <span class="must-content res-name">\r\n                     <em class="two-line f-active-color detail-wrapper" title="',$out+=$escape(item.resName),$out+='">\r\n                         ',$out+=$escape(item.resName),$out+='\r\n                         <div class="resources-detail">\r\n                            <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                             ',unit.subType==helperGetTypeByCode("qz")){$out+='\r\n                             <div class="resources">\r\n                                <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>资源名称</span>\r\n                                    <p class="c9">',$out+=$escape(item.resName),$out+='</p>\r\n                                </div>\r\n                                <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>产品介绍</span>\r\n                                    ';var visaInfo=resInfo.visaInfo;$out+="\r\n                                    ",helperIsExist(visaInfo.visaCityName)&&($out+='\r\n                                    <p class="c9">\r\n                                        领区：',$out+=$escape(visaInfo.visaCityName),$out+="\r\n                                    </p>\r\n                                    "),$out+="\r\n                                    ",helperIsExist(visaInfo.enterCountryTimes)&&($out+='\r\n                                    <p class="c9">\r\n                                        入境次数：',$out+=$escape(visaInfo.enterCountryTimes),$out+="\r\n                                    </p>\r\n                                    "),$out+="\r\n\r\n\r\n                                    ",visaInfo.visaAvailableRange&&($out+='\r\n                                       <p class="c9">\r\n                                             有效期：',$out+=$escape(visaInfo.visaAvailableRange),$out+="\r\n                                       </p>\r\n                                    "),$out+='\r\n\r\n                                    <p class="c9">\r\n                                           是否面试：',$out+=$escape(helperFormatBooleanTip(visaInfo.isNeedInterview)),$out+='\r\n                                    </p>\r\n\r\n                                    <p class="c9">\r\n                                          是否需录指纹：',$out+=$escape(helperFormatBooleanTip(visaInfo.isNeedFingerprint)),$out+='\r\n                                    </p>\r\n\r\n                                    <p class="c9">\r\n                                         是否销签：',$out+=$escape(helperFormatBooleanTip(visaInfo.isNeedCancelVisa)),$out+='\r\n                                    </p>\r\n\r\n                                    <p class="c9">\r\n                                         是否需担保金：',$out+=$escape(helperFormatBooleanTip(visaInfo.isNeedDeposit)),$out+="\r\n                                    </p>\r\n\r\n                                    ",visaInfo.visaMajorTypeName&&($out+='\r\n                                         <p class="c9">\r\n                                            签证类型：',$out+=$escape(visaInfo.visaMajorTypeName),$out+="\r\n                                         </p>\r\n                                    "),$out+="\r\n\r\n                                    ",helperIsExist(visaInfo.longestResidenceTime)&&($out+='\r\n                                    <p class="c9">\r\n                                        停留天数：',$out+=$escape(visaInfo.longestResidenceTime),$out+="\r\n                                    </p>\r\n                                    "),$out+="\r\n                                    ",helperIsExist(visaInfo.handleTimeDuration)&&($out+='\r\n                                    <p class="c9">\r\n                                        ',visaInfo.isOld?($out+="\r\n                                        受理时长：",$out+=$escape(visaInfo.handleTimeDuration),$out+="\r\n                                        "):($out+="\r\n                                        受理时长：",$out+=$escape(visaInfo.handleTimeDuration),$out+="个工作日\r\n                                        "),$out+="\r\n                                    </p>\r\n                                    "),$out+="\r\n                                    ",helperIsExist(visaInfo.acceptanceScope)&&($out+='\r\n                                    <p class="c9">\r\n                                        受理范围：',$out+=$escape(visaInfo.acceptanceScope),$out+="\r\n                                    </p>\r\n                                    "),$out+="\r\n                                </div>\r\n                                 ",helperIsExist(visaInfo.bookNotice)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>预订须知</span>\r\n                                    <p class="c9">',$out+=$escape(visaInfo.bookNotice),$out+="</p>\r\n                                </div>\r\n                                 "),$out+="\r\n                                ",visaInfo.importantNote&&($out+='\r\n                                    <div class="resources-panel">\r\n                                        <span class="resources-panel-title"><i class="icon title-icon"></i>重要提示</span>\r\n                                        <p class="c9">',$out+=$escape(visaInfo.importantNote),$out+="</p>\r\n                                    </div>\r\n                                "),$out+="\r\n                             </div>\r\n                             "}else if(unit.subType==helperGetTypeByCode("mp"))$out+='\r\n                             <div class="resources">\r\n                                 ',helperIsExist(resInfo.saleTime)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>取票时间</span>\r\n                                    <p class="c9">',$out+=$escape(resInfo.saleTime),$out+="</p>\r\n                                 </div>\r\n                                 "),$out+="\r\n                                 ",helperIsExist(resInfo.drawType)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>出票方式</span>\r\n                                    <p class="c9">',$out+=$escape(helperFormatDrawType(resInfo.drawType)),$out+="</p>\r\n                                 </div>\r\n                                 "),$out+="\r\n                                 ",helperIsExist(resInfo.drawAddress)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>取票地址：</span>\r\n                                    <p class="c9">',$out+=$escape(resInfo.drawAddress),$out+="</p>\r\n                                 </div>\r\n                                 "),$out+="\r\n                                 ",helperIsExist(resInfo.availableRange)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>门票有效期</span>\r\n                                    <p class="c9">',$out+=$escape(resInfo.availableRange),$out+="</p>\r\n                                 </div>\r\n                                 "),$out+="\r\n                                 ",helperIsExist(resInfo.enterCertificate)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>入园方式</span>\r\n                                    <p class="c9">',$out+=$escape(helperFormatEnterWay(resInfo.enterCertificate)),$out+="</p>\r\n                                 </div>\r\n                                 "),$out+="\r\n                                 ",helperIsExist(resInfo.bookNotice)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>预订须知</span>\r\n                                    <pre class="c9">',$out+=$string(resInfo.bookNotice),$out+="</pre>\r\n                                 </div>\r\n                                 "),$out+="\r\n                                 ",helperIsExist(resInfo.info)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>其他说明</span>\r\n                                    <p class="c9">',$out+=$escape(resInfo.info),$out+="</p>\r\n                                 </div>\r\n                                 "),$out+="\r\n                             </div>\r\n                             ";else if(unit.subType==helperGetTypeByCode("ddwl")){$out+='\r\n                             <div class="resources">\r\n                                 ';var dsInfo=resInfo.baseInfo;$out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>资源名称</span>\r\n                                    <p class="c9">',$out+=$escape(item.resName),$out+="</p>\r\n                                </div>\r\n\r\n                                 ",helperIsExist(dsInfo.useNotice)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>使用说明</span>\r\n                                    <p class="c9">',$out+=$string(dsInfo.useNotice),$out+="</p>\r\n                                </div>\r\n                                "),$out+="\r\n                                ",dsInfo.resDescribe&&dsInfo.resDescribe.sch_days&&dsInfo.resDescribe.sch_days[0]&&dsInfo.resDescribe.sch_days[0].sch_items&&dsInfo.resDescribe.sch_days[0].sch_items[0]&&helperIsExist(dsInfo.resDescribe.sch_days[0].sch_items[0].content)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>产品介绍</span>\r\n                                    <p class="c9">',$out+=$string(dsInfo.resDescribe.sch_days[0].sch_items[0].content),$out+="</p>\r\n                                </div>\r\n                                "),$out+="\r\n                                ",helperIsExist(dsInfo.budgetInclude)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>费用包含</span>\r\n                                    <p class="c9">',$out+=$string(dsInfo.budgetInclude),$out+="</p>\r\n                                </div>\r\n                                "),$out+="\r\n                                ",helperIsExist(dsInfo.budgetExclude)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>费用不包含</span>\r\n                                    <p class="c9">',$out+=$string(dsInfo.budgetExclude),$out+="</p>\r\n                                </div>\r\n                                "),$out+="\r\n                                ",helperIsExist(dsInfo.bookNotice)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>预订须知</span>\r\n                                    <p class="c9">',$out+=$string(dsInfo.bookNotice),$out+="</p>\r\n                                </div>\r\n                                "),$out+="\r\n                                ",helperIsExist(dsInfo.warmNotice)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>特殊说明</span>\r\n                                    <p class="c9">',$out+=$string(dsInfo.warmNotice),$out+="</p>\r\n                                </div>\r\n                                "),$out+="\r\n                             </div>\r\n                             "}else $out+='\r\n                             <div class="resources">\r\n                                <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>资源名称</span>\r\n                                    <p class="c9">',$out+=$escape(item.resName),$out+="</p>\r\n                                </div>\r\n                                 ",helperIsExist(resInfo.info)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>产品介绍</span>\r\n                                    <p class="c9">',
$out+=$escape(resInfo.info),$out+="</p>\r\n                                </div>\r\n                                 "),$out+="\r\n                                 ",helperIsExist(resInfo.bookNotice)&&($out+='\r\n                                 <div class="resources-panel">\r\n                                    <span class="resources-panel-title"><i class="icon title-icon"></i>预订须知</span>\r\n                                    <p class="c9">',$out+=$escape(resInfo.bookNotice),$out+="</p>\r\n                                </div>\r\n                                 "),$out+="\r\n                             </div>\r\n                             ";$out+='\r\n                             <span class="icon white-triangle"></span>\r\n                            <div class="clear-float"></div>\r\n                        </div>\r\n                     </em>\r\n                 </span>\r\n                <span class="must-date">\r\n                    ',item.isWifiByDay?($out+="\r\n                    ",$out+=$escape(resInfo.durationDays),$out+="天\r\n                    "):($out+='\r\n                    <select class="field-select ',item.unValid&&($out+="T_valid"),$out+='">\r\n                        ',_.each(item.resourceDatePrices,function(date,index){$out+='\r\n                        <option value=""\r\n                                ',index==item.selectDate&&($out+="selected"),$out+=">",$out+=$escape(date.departDate),$out+="</option>\r\n                        "}),$out+="\r\n                    </select>\r\n                    使用\r\n                    "),$out+="\r\n                </span>\r\n                ";var adultPrice=item.resourceDatePrices[selectDate].price,childPrice=item.resourceDatePrices[selectDate].childPrice,titleStr="";if("人"==resInfo.priceComputerType?(titleStr+=0==adultPrice?"限时赠送":adultPrice+"/成人",childNum&&(titleStr+=0==childPrice?"限时赠送":childPrice+"/儿童")):titleStr+=0==adultPrice?"限时赠送":item.isWifiByDay?adultPrice+"/单日/"+resInfo.priceComputerType:adultPrice+"/"+resInfo.priceComputerType,$out+='\r\n                <span class="must-price" title="',$out+=$escape(titleStr),$out+='">\r\n                   ',"self_tour2"==pageType&&item.mealInclude?$out+='\r\n                        <div class="T_adult f-ol">\r\n                            套餐包含\r\n                        </div>    \r\n                   ':($out+="\r\n                        ","人"==resInfo.priceComputerType?($out+='\r\n                        <div class="T_adult f-ol">\r\n                            ',0==adultPrice?$out+="\r\n                            限时赠送\r\n                            ":($out+="\r\n                            <em>￥",$out+=$escape(adultPrice),$out+="</em>/成人\r\n                            "),$out+='\r\n                        </div>\r\n                        <div class="T_child f-ol ',childNum||($out+="hide"),$out+='">\r\n                            ',0==childPrice?$out+="\r\n                            限时赠送\r\n                            ":($out+="\r\n                            <em>￥",$out+=$escape(childPrice),$out+="</em>/儿童\r\n                            "),$out+="\r\n                        </div>\r\n                        "):($out+='\r\n                        <div class="T_adult f-ol">\r\n                            ',0==adultPrice?$out+="\r\n                            限时赠送\r\n                            ":($out+="\r\n                            ",item.isWifiByDay?($out+="\r\n                            <em>￥",$out+=$escape(adultPrice),$out+="</em>/单日/",$out+=$escape(resInfo.priceComputerType),$out+="\r\n                            "):($out+="\r\n                            <em>￥",$out+=$escape(adultPrice),$out+="</em>/",$out+=$escape(resInfo.priceComputerType),$out+="\r\n                            "),$out+="\r\n                            "),$out+="\r\n                        </div>\r\n                        "),$out+="\r\n                   "),$out+='\r\n                </span>\r\n                <span class="must-btn select-count">\r\n                    ',supportChangeCount){var onlyshow=!1;switch("self_tour2"!=pageType&&"drive_routine2"!=pageType||(onlyshow=!0),$out+=" \r\n                    ",resInfo.priceComputerType){case"份":case"张":case"台":case"辆":case"成人":case"儿童":if($out+='\r\n                    <div class="T_adult">\r\n                        <select class="field-select">\r\n                            ',onlyshow&&0==item.adultPrice)$out+='\r\n                                <option value="',$out+=$escape(item.adultResourceCount),$out+='" selected >',$out+=$escape(item.adultResourceCount),$out+="</option>\r\n                            ";else{$out+="\r\n                                ";for(var i=item.minValue;i<=item.maxValue;i++)$out+='\r\n                                <option value="',$out+=$escape(i),$out+='" ',i==item.adultResourceCount&&($out+="selected"),$out+=" >",$out+=$escape(i),$out+="</option>\r\n                                ";$out+="\r\n                            "}$out+="\r\n                        </select>\r\n                        ",$out+=$escape(resInfo.priceComputerType),$out+="\r\n                    </div>\r\n                    ";break;case"人":if($out+="\r\n                    ",item.adultSelect){if($out+='\r\n                    <div class="T_adult">\r\n                        <select class="field-select">\r\n                            ',onlyshow&&0==item.adultPrice)$out+='\r\n                                <option value="',$out+=$escape(item.adultResourceCount),$out+='" selected >',$out+=$escape(item.adultResourceCount),$out+="</option>\r\n                            ";else{$out+="\r\n                                ";for(var i=item.minAdultValue;i<=item.maxAdultValue;i++)$out+='\r\n                                <option value="',$out+=$escape(i),$out+='" ',i==item.adultResourceCount&&($out+="selected"),$out+=" >",$out+=$escape(i),$out+="</option>\r\n                                ";$out+="\r\n                            "}$out+="\r\n                        </select>\r\n                        成人\r\n                    </div>\r\n                    "}if($out+="\r\n                    ",item.childSelect){if($out+='\r\n                    <div class="T_child ',childNum||($out+="T_hide"),$out+='">\r\n                        <select class="field-select">\r\n                            ',onlyshow&&0==item.childPrice)$out+='\r\n                                <option value="',$out+=$escape(item.childResourceCount),$out+='" selected >',$out+=$escape(item.childResourceCount),$out+="</option>\r\n                            ";else{$out+="\r\n                                ";for(var i=item.minChildValue;i<=item.maxChildValue;i++)$out+='\r\n                                <option value="',$out+=$escape(i),$out+='" ',i==item.childResourceCount&&($out+="selected"),$out+=" >",$out+=$escape(i),$out+="</option>\r\n                                ";$out+="\r\n                            "}$out+="                            \r\n                        </select>\r\n                        儿童\r\n                    </div>\r\n                    "}$out+="\r\n                    "}$out+="\r\n                    "}else{switch($out+="\r\n                    ",resInfo.priceComputerType){case"份":case"张":case"台":case"辆":case"成人":case"儿童":$out+='\r\n                    <div class="T_adult">\r\n                        <label class="input_checkbox ',item.adultSelect&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label>\r\n                    </div>\r\n                    ';break;case"人":$out+='\r\n                    <div class="T_adult">\r\n                        <label class="input_checkbox ',item.adultSelect&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label>\r\n                    </div>\r\n                    <!--<div class="T_child ',childNum&&0==excludeChildFlag||($out+="hide"),$out+='">-->\r\n                    <!--<label class="input_checkbox ',item.childSelect&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label>-->\r\n                    <!--</div>-->\r\n                    '}$out+="\r\n                    "}$out+="\r\n                </span>\r\n            </div>\r\n            "}),$out+="\r\n            ",!unit.showAll&&moreCount>1&&0!=unit.selectType&&($out+='\r\n            <div class="panel-list more-or-less-pro">\r\n                <em class="more">更多',$out+=$escape(helperFormatText(unit.subType)),$out+='<i class="icon more-select-icon"></i></em>\r\n            </div>\r\n            '),$out+="\r\n            ",unit.showAll&&0!=unit.selectType&&($out+='\r\n            <div class="panel-list more-or-less-pro">\r\n                <em class="less">收起<i class="icon less-select-icon"></i></em>\r\n            </div>\r\n            '),$out+='\r\n        </main>\r\n        <div class="clear-float"></div>\r\n    </div>\r\n    '}),$out+="\r\n</div>",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),eventBus=__webpack_require__(5),tpl=__webpack_require__(109),_=__webpack_require__(8),tools=__webpack_require__(16),optionalSelectedCommon=__webpack_require__(110);module.exports=backbone.View.extend({el:"#m-optional-selected",events:{"click .transfer .common-addr":"showCommonAddress","click .transfer .address":"useAddress","click .transfer .receipt_con":"useCommonAddress","change .transfer .date":"changeRecommendDate","change .transfer .hour":"changeRecommendHour","change .transfer .minute":"changeRecommendMinute","click .transfer .transfer-footer .input_checkbox":"selectRecommend","click .addition .more-or-less":"showAll","change .addition .date-select select":"dateChange","change .addition .select-count select":"countChange","click .addition .select-box label":"selectOne","click .update .input_checkbox":"updateSelect","click .update .stop-or-open":"updateShowMore","click .m-more ":"showMore"},initialize:function(){this.listenTo(this.model,"render",this.render),this.listenTo(this.model,"showError",this.showError),this.listenTo(this.model,"triggerChange",this.triggerChange),this.$el.on("input onpropertychange",".transfer .input-off-place",_.debounce($.proxy(this.getRecommendAddress,this),300)),this.render()},render:function(obj){obj=obj||{};var keepCursor=obj.keepCursor,type=obj.type;if(this.model.getCanRender()){this.model.set("renderTime",this.model.get("renderTime")+1),1==this.model.get("renderTime")&&(this.model.changeResourceShow(),this.model.initSelectDefaultCount()),this.model.setCanChange();var data=this.model.toJSON(),html=tpl(data);this.$el.html(html).show(),this.keepCursor(keepCursor,type)}else this.$el.hide()},triggerChange:function(){this.$el.find(".addition .select-count select").trigger("change")},showAll:function(e){var obj=$(e.currentTarget),currentIndex=obj.parents(".panel").data("index"),data=this.model.toJSON(),list=data.list;_.some(list,function(item,index){if(currentIndex==index)return item.showAll=!item.showAll,!0}),this.model.trigger("render")},dateChange:function(e){var self=this,obj=$(e.currentTarget).children("option:selected"),currentIndex=obj.parents(".panel").data("index"),selectDateIndex=obj.index(),resId=obj.parents(".right-panel").data("resid"),data=self.model.toJSON(),list=data.list;_.some(list,function(item,index){if(currentIndex==index)return _.some(item.resList,function(sub){if(sub.resId==resId)return sub.selectDate=selectDateIndex,sub.adultPrice=sub.resourceDatePrices[selectDateIndex].price,sub.childPrice=sub.resourceDatePrices[selectDateIndex].childPrice,sub.departDate=sub.resourceDatePrices[selectDateIndex].departDate,!0})}),this.model.trigger("render"),eventBus.trigger("additionOptionalCalculate")},countChange:function(e){var self=this,obj=$(e.currentTarget),currentIndex=obj.parents(".panel").data("index"),count=+obj.val(),isAdult=obj.parent().hasClass("T_adult"),resId=obj.parents(".right-panel").data("resid"),data=this.model.toJSON(),list=data.list;+this.model.get("adultNum")+ +this.model.get("childNum");if(_.some(list,function(item,index){if(currentIndex==index)return _.some(item.resList,function(sub){if(sub.resId==resId)return isAdult?(sub.adultResourceCount=count,sub.adultResourceCount+sub.childResourceCount!=0&&sub.adultResourceCount+sub.childResourceCount<sub.resInfo.limitMin&&(sub.childResourceCount=sub.resInfo.limitMin-sub.adultResourceCount,self.model.getIsInRange(sub,sub.childResourceCount,"child")||(sub.childResourceCount=0,sub.childSelect=!1))):(sub.childResourceCount=count,sub.adultResourceCount+sub.childResourceCount!=0&&sub.adultResourceCount+sub.childResourceCount<sub.resInfo.limitMin&&(sub.adultResourceCount=sub.resInfo.limitMin-sub.childResourceCount,self.model.getIsInRange(sub,sub.adultResourceCount,"adult")||(sub.adultResourceCount=0,sub.adultSelect=!1))),count>0?isAdult?(sub.adultSelect=!0,sub.childResourceCount&&(sub.childSelect=!0)):(sub.childSelect=!0,sub.adultResourceCount&&(sub.adultSelect=!0)):isAdult?sub.adultSelect=!1:sub.childSelect=!1,!0})}),this.model.trigger("render"),eventBus.trigger("additionOptionalCalculate"),"tour_order2"==pageDataObj.pageType){var resNames=[];_.each(data.list,function(item){var resList=item.resList;_.each(resList,function(list){if(14==list.resType){var o={resName:list.resName,resId:list.resId};o.adultResourceCount=list.adultResourceCount,o.adultNum=self.model.get("adultNum"),o.isSelectAdult=0,o.childResourceCount=list.childResourceCount,o.childNum=self.model.get("childNum"),o.isSelectChild=0,resNames.push(o)}})}),eventBus.trigger("showVisaUserInTourist",resNames)}},selectOne:function(e){var obj=$(e.currentTarget),currentIndex=obj.parents(".panel").data("index"),resId=(obj.parent().hasClass("T_adult"),obj.parents(".right-panel").data("resid")),data=this.model.toJSON(),list=data.list;_.some(list,function(item,index){if(currentIndex==index)return _.some(item.resList,function(sub){if(sub.resId==resId){var resInfo=sub.resInfo,priceComputerType=resInfo.priceComputerType,selectDate=sub.selectDate;sub.resourceDatePrices[selectDate].excludeChildFlag;return sub.adultSelect=!sub.adultSelect,"人"==priceComputerType&&data.childNum&&(sub.childSelect=!sub.childSelect),!0}})}),this.model.trigger("render"),eventBus.trigger("additionOptionalCalculate")},getRecommendAddress:function(e){if(tools.alreadyInput()){var obj=$(e.currentTarget),val=obj.val(),parent=obj.parents(".panel"),type=+parent.data("type");this.model.getRecommendAddress(val,type)}},showCommonAddress:function(e){var obj=$(e.currentTarget),parent=obj.parents(".panel"),type=+parent.data("type");this.model.showCommonAddress(type)},useAddress:function(e){var obj=$(e.currentTarget),parent=obj.parents(".panel"),type=+parent.data("type"),index=+obj.data("index");this.model.useAddress(type,index)},useCommonAddress:function(e){var obj=$(e.currentTarget),parent=obj.parents(".panel"),type=+parent.data("type"),val=obj.data("addr");this.model.getRecommendAddress(val,type)},changeRecommendDate:function(e){var obj=$(e.currentTarget),val=obj.val(),type=obj.parents(".transfer").data("type");this.model.changeRecommendDate(val),this.model.getNewestPrice(type)},changeRecommendHour:function(e){var obj=$(e.currentTarget),val=obj.val(),type=obj.parents(".transfer").data("type");this.model.changeRecommendHour(val),this.model.getNewestPrice(type)},changeRecommendMinute:function(e){var obj=$(e.currentTarget),val=obj.val(),type=obj.parents(".transfer").data("type");this.model.changeRecommendMinute(val),this.model.getNewestPrice(type)},selectRecommend:function(e){var obj=$(e.currentTarget),parent=obj.parents(".panel"),type=+parent.data("type");this.model.selectRecommend(type)},updateSelect:function(e){var isSelect,currentIndex,currentContent=$(e.currentTarget);isSelect=currentContent.hasClass("enabled")?0:1,currentIndex=currentContent.parents(".update-list").prevAll(".update-list").length,this.model.trigger("oneRowSelect",currentIndex,isSelect)},updateShowMore:function(){this.model.updateShowMore()},showError:function(obj){var type=obj.type,code=obj.code,map={recommend:{1:"请填写下车地点",2:"暂无可用车辆",3:"请填写下车地点",4:"请填写上车地点",5:"暂无可用车辆",6:"请填写上车地点"}};tools.layer({msg:map[type][code]})},showMore:function(){var data=this.model.toJSON();eventBus.trigger("showMoreOptionalSelected",data)},keepCursor:optionalSelectedCommon.keepCursor})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,canChange=($utils.$helpers,$data.canChange),$escape=$utils.$escape,changeText=$data.changeText,supportChangeCount=$data.supportChangeCount,recommendData=$data.recommendData,resourceShow=$data.resourceShow,deliverySelected=$data.deliverySelected,_=$data._,commonReceiptInfo=$data.commonReceiptInfo,deliveryAddress=$data.deliveryAddress,addressError=$data.addressError,addressShow=$data.addressShow,addressType=$data.addressType,places=$data.places,dateList=($data.item,$data.index,$data.dateList),deliveryDate=$data.deliveryDate,hourList=$data.hourList,deliveryHour=$data.deliveryHour,minuteList=$data.minuteList,deliveryMinute=$data.deliveryMinute,deliveryPriceLoading=$data.deliveryPriceLoading,deliveryInfo=$data.deliveryInfo,deliveryType=$data.deliveryType,helperFormatRecommendNote=$data.helperFormatRecommendNote,$string=$utils.$string,pickupSelected=$data.pickupSelected,pickupAddress=$data.pickupAddress,airplaneData=$data.airplaneData,pickupPriceLoading=$data.pickupPriceLoading,pickupInfo=$data.pickupInfo,pickupType=$data.pickupType,updateSchemeInfo=$data.updateSchemeInfo,i=$data.i,oneUpdateScheme=$data.oneUpdateScheme,uClass=$data.uClass,updateSchemeShowAll=$data.updateSchemeShowAll,helperShowPrice=$data.helperShowPrice,list=$data.list,helperFormatText=($data._index,$data.helperFormatText),helperGetTypeByCode=($data.moreCount,$data.hasFindFlag,$data.firstShowFlag,$data.sub,$data.resInfo,$data.listClass,$data.selectDate,$data.excludeChildFlag,$data.helperGetTypeByCode),helperFormatBooleanTip=($data.visaInfo,$data.helperFormatBooleanTip),childNum=($data.date,$data.adultPrice,$data.childPrice,$data.titleStr,$data.childNum),$out="";if($out+='<h2>\r\n    <a class="m-more ',canChange||($out+="hide"),$out+='">',$out+=$escape(changeText),$out+='<i class="icon more-icon"></i></a>\r\n    <span class="icon optional-icon"></span>\r\n    <span class="m-title">推荐项目</span>\r\n</h2>\r\n<div class="modular-body ',supportChangeCount&&($out+="support-change-count"),$out+='">\r\n\r\n    ',recommendData&&($out+="\r\n    ",resourceShow.delivery&&($out+='\r\n    <div class="panel transfer ',deliverySelected&&($out+="selected"),$out+='" data-type="2">\r\n        <div class="transfer-header">\r\n            ',$out+=$escape(recommendData.deliveryCityName),$out+='送机\r\n        </div>\r\n        <div class="transfer-body">\r\n            <p class="transfer-title f-ol" title="自选上车地点-',$out+=$escape(recommendData.deliveryServer.serviceName),$out+=$escape(recommendData.deliveryServer.airportTerminal),$out+='">自选上车地点-',$out+=$escape(recommendData.deliveryServer.serviceName),$out+=$escape(recommendData.deliveryServer.airportTerminal),$out+='</p>\r\n            <div class="T-place">上车地点：\r\n                <input type="text" class="field-input input-small input-off-place ',_.isEmpty(commonReceiptInfo)||($out+="hasCommon"),$out+='" placeholder="填写或选择上车地点" value="',$out+=$escape(deliveryAddress&&deliveryAddress.name),$out+='">\r\n                ',_.isEmpty(commonReceiptInfo)||($out+='\r\n                <span class="common-addr">常用地址<i></i></span>\r\n                '),$out+="\r\n                ",2==addressError&&($out+='\r\n                <div class="error"><i class="icon error-icon"></i>未找到相关地点，请您修改</div>\r\n            '),$out+="\r\n            </div>\r\n            ",2==addressShow&&($out+="\r\n            ",1==addressType?($out+='\r\n            <div class="common_send_place">\r\n                ',_.each(places,function(item,index){$out+='\r\n                <div class="address" data-index="',$out+=$escape(index),$out+='">\r\n                    <span class="address_icon"></span>\r\n                    <div class="address_text">\r\n                        <div class="nobr name" title="',$out+=$escape(item.name),$out+='">',$out+=$escape(item.name),$out+='</div>\r\n                        <div class="nobr address-detail" title="',$out+=$escape(item.address),$out+='">',$out+=$escape(item.address),$out+="</div>\r\n                    </div>\r\n                </div>\r\n                "}),$out+="\r\n            </div>\r\n            "):2==addressType&&($out+='\r\n            <div class="common_send_place">\r\n                ',_.each(commonReceiptInfo,function(item){$out+='\r\n                <p class="receipt_con" data-addr="',$out+=$escape(item.leftAddress),$out+='"><span class="nobr">',$out+=$escape(item.leftAddress),$out+="</span> </p>\r\n                "}),$out+="\r\n            </div>\r\n            "),$out+="\r\n            "),$out+='\r\n            <p class="T-time">\r\n                <span class="label-text">上车时间：</span>\r\n                <select class="date field-select">\r\n                    ',_.each(dateList,function(item){$out+='\r\n                    <option value="',$out+=$escape(item),$out+='"\r\n                            ',item==deliveryDate&&($out+="selected"),$out+=">\r\n                        ",$out+=$escape(item.split("-")[1]+"月"+item.split("-")[2]+"日"),$out+="\r\n                    </option>\r\n                    "}),$out+='\r\n                </select>\r\n                <select class="hour field-select">\r\n                    ',_.each(hourList,function(item){$out+='\r\n                    <option value="',$out+=$escape(item),$out+='"\r\n                            ',item==deliveryHour&&($out+="selected"),$out+=">\r\n                        ",$out+=$escape(item+"时"),$out+="\r\n                    </option>\r\n                    "}),$out+='\r\n                </select>\r\n                <select class="minute field-select">\r\n                    ',_.each(minuteList,function(item){$out+='\r\n                    <option value="',$out+=$escape(item),$out+='"\r\n                            ',item==deliveryMinute&&($out+="selected"),$out+=">\r\n                        ",$out+=$escape(item+"分"),$out+="\r\n                    </option>\r\n                    "}),$out+='\r\n                </select>\r\n            </p>\r\n        </div>\r\n        <div class="transfer-leg">\r\n            <span class="start-price">\r\n                ',1==deliveryPriceLoading?($out+="\r\n                <em>￥",$out+=$escape(deliveryInfo&&deliveryInfo.totalPrice?deliveryInfo.totalPrice:recommendData.deliveryStartPrice+"起"),$out+="</em>\r\n                "):2==deliveryPriceLoading?$out+="\r\n                <em>价格计算中...</em>\r\n                ":3==deliveryPriceLoading&&($out+="\r\n                <em>暂无可用车辆</em>\r\n                "),$out+='\r\n            </span>\r\n            <span class="type jtxz-detail-hover">\r\n                ',$out+=$escape(deliveryType?deliveryType:recommendData.deliveryServer.vehicleGroupInfos.name),$out+='\r\n                <div class="jtxz-detail2">\r\n                    <p class="YD_mgb">',$out+=$escape(helperFormatRecommendNote(recommendData.deliveryServer.vehicleGroupInfos)),$out+='</p>\r\n                    <span class="z">◆</span>\r\n                    <span class="j">◆</span>\r\n                </div>\r\n            </span>\r\n            <span class="tips jtxz-detail-hover"><i class="icon notice2-icon"></i>须知\r\n                            <div class="jtxz-detail2">\r\n                                <p class="YD_title">服务说明</p>\r\n                                <p class="YD_mgb">1. 接送机产品是点到点中途不停留的服务，不能临时改变路线。司机会根据路况合理安排行驶路，不接受中途经停或绕路。</p>\r\n                                <p class="YD_mgb">2. 婴儿、儿童即使不占用座位也需计入乘车人数。</p>\r\n                                <p class="YD_mgb">3. 各车型的承载人数及行李都有所限制，请您仔细核对，由于您自身选择车型不符而影响您的用车，该损失由您自行承担。</p>\r\n                                <p class="YD_mgb">4. 若您选择的地址因交通因素无法送达，比如送达山脉、森林、岛屿、海上、沙漠、无人区等，途牛会视情况送您到就近的地点。如鼓浪屿，司机会送您至轮渡码头，请您自行乘船前往目的地。</p>\r\n                                <p class="YD_mgb">5. 送机服务司机将会在指定地点等您上车。</p>\r\n                                <p class="YD_title">车型和容量</p>\r\n                                <p class="YD_mgb">',$out+=$escape(helperFormatRecommendNote(recommendData.deliveryServer.vehicleGroupInfos)),$out+="</p>\r\n                                ",deliveryInfo&&($out+='\r\n                                <p class="YD_title">免费等待时长</p>\r\n                                <p class="YD_mgb">',$out+=$string(deliveryInfo.attentions.content),$out+="</p>\r\n                                "),$out+='\r\n                                <span class="z">◆</span>\r\n                                <span class="j">◆</span>\r\n                            </div>\r\n                        </span>\r\n        </div>\r\n        <div class="transfer-footer">\r\n            <label class="input_checkbox ',deliverySelected&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label>\r\n        </div>\r\n    </div>\r\n    '),$out+="\r\n\r\n    ",resourceShow.pickup&&($out+='\r\n    <div class="panel transfer ',pickupSelected&&($out+="selected"),$out+='" data-type="1">\r\n        <div class="transfer-header">\r\n            ',$out+=$escape(recommendData.pickupCityName),$out+='接机\r\n        </div>\r\n        <div class="transfer-body">\r\n            <p class="transfer-title f-ol" title="',$out+=$escape(recommendData.pickupServer.serviceName),$out+=$escape(recommendData.pickupServer.airportTerminal),$out+='-自选下车地点">',$out+=$escape(recommendData.pickupServer.serviceName),$out+=$escape(recommendData.pickupServer.airportTerminal),$out+='-自选下车地点</p>\r\n            <div class="T-place">下车地点：\r\n                <input type="text" class="field-input input-small input-off-place ',_.isEmpty(commonReceiptInfo)||($out+="hasCommon"),$out+='" placeholder="填写或选择下车地点" value="',$out+=$escape(pickupAddress&&pickupAddress.name),$out+='">\r\n                ',_.isEmpty(commonReceiptInfo)||($out+='\r\n                <span class="common-addr">常用地址<i></i></span>\r\n                '),$out+="\r\n                ",1==addressError&&($out+='\r\n                <div class="error"><i class="icon error-icon"></i>未找到相关地点，请您修改</div>\r\n            '),$out+="\r\n            </div>\r\n            ",1==addressShow&&($out+="\r\n            ",1==addressType?($out+='\r\n            <div class="common_send_place">\r\n                ',_.each(places,function(item,index){$out+='\r\n                <div class="address" data-index="',$out+=$escape(index),$out+='">\r\n                    <span class="address_icon"></span>\r\n                    <div class="address_text">\r\n                        <div class="nobr name" title="',$out+=$escape(item.name),$out+='">',$out+=$escape(item.name),$out+='</div>\r\n                        <div class="nobr address-detail" title="',$out+=$escape(item.address),$out+='">',$out+=$escape(item.address),$out+="</div>\r\n                    </div>\r\n                </div>\r\n                "}),$out+="\r\n            </div>\r\n            "):2==addressType&&($out+='\r\n            <div class="common_send_place">\r\n                ',_.each(commonReceiptInfo,function(item){$out+='\r\n                <p class="receipt_con" data-addr="',$out+=$escape(item.leftAddress),$out+='"><span class="nobr">',$out+=$escape(item.leftAddress),$out+="</span> </p>\r\n                "}),$out+="\r\n            </div>\r\n            "),$out+="\r\n            "),$out+='\r\n            <p class="T-time">\r\n                <span class="label-text">上车时间：</span>\r\n                <span class="date">\r\n                    ',$out+=$escape(airplaneData.arrivalDate.split("-")[1]),$out+="月",$out+=$escape(airplaneData.arrivalDate.split("-")[2]),$out+='日\r\n                </span>\r\n                <span class="hour">',$out+=$escape(airplaneData.arriveTime.split(":")[0]),$out+='时</span>\r\n                <span class="minute">',$out+=$escape(airplaneData.arriveTime.split(":")[1]),$out+='分</span>\r\n            </p>\r\n        </div>\r\n        <div class="transfer-leg">\r\n            <span class="start-price">\r\n                ',1==pickupPriceLoading?($out+="\r\n                <em>￥",$out+=$escape(pickupInfo&&pickupInfo.totalPrice?pickupInfo.totalPrice:recommendData.pickupStartPrice+"起"),$out+="</em>\r\n                "):2==pickupPriceLoading?$out+="\r\n                <em>价格计算中...</em>\r\n                ":3==pickupPriceLoading&&($out+="\r\n                <em>暂无可用车辆</em>\r\n                "),$out+='\r\n            </span>\r\n            <span class="type jtxz-detail-hover">\r\n                ',$out+=$escape(pickupType?pickupType:recommendData.pickupServer.vehicleGroupInfos.name),$out+='\r\n                <div class="jtxz-detail2">\r\n                    <p class="YD_mgb">',$out+=$escape(helperFormatRecommendNote(recommendData.pickupServer.vehicleGroupInfos)),$out+='</p>\r\n                    <span class="z">◆</span>\r\n                    <span class="j">◆</span>\r\n                </div>\r\n            </span>\r\n            <span class="tips jtxz-detail-hover"><i class="icon notice2-icon"></i>须知\r\n                            <div class="jtxz-detail2">\r\n                                <p class="YD_title">服务说明</p>\r\n                                <p class="YD_mgb">1. 接送机产品是点到点中途不停留的服务，不能临时改变路线。司机会根据路况合理安排行驶路，不接受中途经停或绕路。</p>\r\n                                <p class="YD_mgb">2. 婴儿、儿童即使不占用座位也需计入乘车人数。</p>\r\n                                <p class="YD_mgb">3. 各车型的承载人数及行李都有所限制，请您仔细核对，由于您自身选择车型不符而影响您的用车，该损失由您自行承担。</p>\r\n                                <p class="YD_mgb">4. 若您选择的地址因交通因素无法送达，比如送达山脉、森林、岛屿、海上、沙漠、无人区等，途牛会视情况送您到就近的地点。如鼓浪屿，司机会送您至轮渡码头，请您自行乘船前往目的地。</p>\r\n                                <p class="YD_mgb">5. 送机服务司机将会在指定地点等您上车。</p>\r\n                                <p class="YD_title">车型和容量</p>\r\n                                <p class="YD_mgb">',$out+=$escape(helperFormatRecommendNote(recommendData.pickupServer.vehicleGroupInfos)),$out+="</p>\r\n                                ",pickupInfo&&($out+='\r\n                                <p class="YD_title">免费等待时长</p>\r\n                                <p class="YD_mgb">',$out+=$string(pickupInfo.attentions.content),$out+="</p>\r\n                                "),$out+='\r\n                                <span class="z">◆</span>\r\n                                <span class="j">◆</span>\r\n                            </div>\r\n                        </span>\r\n        </div>\r\n        <div class="transfer-footer">\r\n            <label class="input_checkbox ',pickupSelected&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label>\r\n        </div>\r\n    </div>\r\n    '),$out+="\r\n    "),$out+="\r\n\r\n    ",!_.isEmpty(updateSchemeInfo)){if($out+="\r\n    ",resourceShow.updateScheme){$out+='\r\n    <div class="panel update">\r\n        <div class="panel-body">\r\n            <div class="left">\r\n                <span class="type f-ol" title="升级方案（活动）">\r\n                    升级方案\r\n                </span>\r\n            </div>\r\n            <div class="right">\r\n                ';
for(var i=0;i<updateSchemeInfo.length;i++){$out+="\r\n                ";var oneUpdateScheme=updateSchemeInfo[i];$out+="\r\n                ";var uClass="hide";updateSchemeShowAll?uClass="":oneUpdateScheme.show&&(uClass=""),$out+='\r\n                <div class="update-list ',$out+=$escape(uClass),$out+='">\r\n                    <span class="update-name">\r\n                        <em class="two-line" title="',$out+=$escape(oneUpdateScheme.resName),$out+='">',$out+=$escape(oneUpdateScheme.resName),$out+='</em>\r\n                    </span>\r\n                    <span class="update-days-num">',$out+=$escape(oneUpdateScheme.journey),$out+='</span>\r\n                    <span class="update-price f-ol">\r\n                        <div class="T_adult">\r\n                            <em>',$out+=$escape(helperShowPrice(oneUpdateScheme.adultPrice)),$out+='</em>/成人\r\n                        </div>\r\n                        <div class="T_child">\r\n                            ',oneUpdateScheme.supportChild?($out+="\r\n                            <em>",$out+=$escape(helperShowPrice(oneUpdateScheme.childPrice)),$out+="</em>/儿童\r\n                            "):$out+="\r\n                            不支持儿童\r\n                            ",$out+='\r\n                        </div>\r\n                    </span>\r\n                    <span class="box">\r\n                        <label class="input_checkbox ',1==oneUpdateScheme.isSelect&&($out+="enabled"),$out+='">\r\n                            <span class="tn_fontface">&#xe618;</span>\r\n                        </label>\r\n                    </span>\r\n                </div>\r\n                '}$out+="\r\n                <!--",updateSchemeShowAll&&($out+='-->\r\n                <!--<div class="stop-or-open">-->\r\n                    <!--收起<i class="icon less-select-icon"></i>-->\r\n                <!--</div>-->\r\n                <!--'),$out+="-->\r\n                <!--",updateSchemeInfo.length>1&&!updateSchemeShowAll&&($out+='-->\r\n                <!--<div class="stop-or-open">-->\r\n                    <!--更多升级方案<i class="icon more-select-icon"></i>-->\r\n                <!--</div>-->\r\n                <!--'),$out+='-->\r\n            </div>\r\n            <div class="clear-float"></div>\r\n        </div>\r\n    </div>\r\n    '}$out+="\r\n    "}return $out+="\r\n\r\n    ",_.each(list,function(item,_index){if($out+="\r\n    ",item.resourceShow){$out+='\r\n    <div class="panel addition ',item.show||($out+="hide"),$out+='" data-index="',$out+=$escape(_index),$out+='">\r\n        <div class="panel-body">\r\n            <div class="left">\r\n                <span class="type f-ol" title="',$out+=$escape(helperFormatText(item.subType)),$out+='">\r\n                    ',$out+=$escape(helperFormatText(item.subType)),$out+="(",$out+=$escape(item.destinationName),$out+='使用)\r\n                </span>\r\n            </div>\r\n            <div class="right">\r\n                ';var moreCount=item.resList.length,firstShowFlag=!1;$out+="\r\n                ",_.each(item.resList,function(sub,index){$out+="\r\n                ";var listClass,resInfo=sub.resInfo;sub.show?(listClass="",moreCount--):listClass="hide",firstShowFlag||""!=listClass||(firstShowFlag=!0,listClass+=" first");var selectDate=sub.selectDate,excludeChildFlag=sub.resourceDatePrices[selectDate].excludeChildFlag;if($out+='\r\n                <div class="right-panel ',$out+=$escape(listClass),$out+='" data-resid="',$out+=$escape(sub.resId),$out+='" data-restype="',$out+=$escape(sub.resType),$out+='">\r\n                    <span class="name">\r\n                        <em class="two-line f-active-color detail-wrapper" title="',$out+=$escape(sub.resName),$out+='">\r\n                            ',$out+=$escape(sub.resName),$out+='\r\n                            <div class="resources-detail">\r\n                                  <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                                        ',item.subType==helperGetTypeByCode("qz")){$out+='\r\n                                        <div class="resources">\r\n                                      <div class="resources-panel">\r\n                                          <span class="resources-panel-title"><i class="icon title-icon"></i>资源名称</span>\r\n                                          <p class="c9">',$out+=$escape(sub.resName),$out+='</p>\r\n                                      </div>\r\n                                      <div class="resources-panel">\r\n                                          <span class="resources-panel-title"><i class="icon title-icon"></i>产品介绍</span>\r\n                                          ';var visaInfo=resInfo.visaInfo;$out+="\r\n                                          ",visaInfo.visaCityName&&($out+='\r\n                                          <p class="c9">\r\n                                              领区：',$out+=$escape(visaInfo.visaCityName),$out+="\r\n                                          </p>\r\n                                          "),$out+="\r\n                                          ",visaInfo.enterCountryTimes&&($out+='\r\n                                          <p class="c9">\r\n                                              入境次数：',$out+=$escape(visaInfo.enterCountryTimes),$out+="\r\n                                          </p>\r\n                                          "),$out+="\r\n\r\n                                           ",visaInfo.visaAvailableRange&&($out+='\r\n                                               <p class="c9">\r\n                                                   有效期：',$out+=$escape(visaInfo.visaAvailableRange),$out+="\r\n                                                </p>\r\n                                           "),$out+='\r\n\r\n                                            <p class="c9">\r\n                                               是否面试：',$out+=$escape(helperFormatBooleanTip(visaInfo.isNeedInterview)),$out+='\r\n                                            </p>\r\n\r\n                                            <p class="c9">\r\n                                               是否需录指纹：',$out+=$escape(helperFormatBooleanTip(visaInfo.isNeedFingerprint)),$out+='\r\n                                            </p>\r\n\r\n                                            <p class="c9">\r\n                                               是否销签：',$out+=$escape(helperFormatBooleanTip(visaInfo.isNeedCancelVisa)),$out+='\r\n                                            </p>\r\n\r\n                                            <p class="c9">\r\n                                               是否需担保金：',$out+=$escape(helperFormatBooleanTip(visaInfo.isNeedDeposit)),$out+="\r\n                                            </p>\r\n\r\n                                            ",visaInfo.visaMajorTypeName&&($out+='\r\n                                                <p class="c9">\r\n                                                    签证类型：',$out+=$escape(visaInfo.visaMajorTypeName),$out+="\r\n                                                 </p>\r\n                                            "),$out+="\r\n\r\n                                          ",visaInfo.longestResidenceTime&&($out+='\r\n                                          <p class="c9">\r\n                                              停留天数：',$out+=$escape(visaInfo.longestResidenceTime),$out+="\r\n                                          </p>\r\n                                          "),$out+="\r\n                                          ",visaInfo.handleTimeDuration&&($out+='\r\n                                          <p class="c9">\r\n                                              ',visaInfo.isOld?($out+="\r\n                                              受理时长：",$out+=$escape(visaInfo.handleTimeDuration),$out+="\r\n                                              "):($out+="\r\n                                              受理时长：",$out+=$escape(visaInfo.handleTimeDuration),$out+="个工作日\r\n                                              "),$out+="\r\n                                          </p>\r\n                                          "),$out+="\r\n                                          ",visaInfo.acceptanceScope&&($out+='\r\n                                          <p class="c9">\r\n                                              受理范围：',$out+=$escape(visaInfo.acceptanceScope),$out+="\r\n                                          </p>\r\n                                          "),$out+="\r\n                                      </div>\r\n                                            ",visaInfo.bookNotice&&($out+='\r\n                                            <div class="resources-panel">\r\n                                          <span class="resources-panel-title"><i class="icon title-icon"></i>预订须知</span>\r\n                                          <p class="c9">',$out+=$escape(visaInfo.bookNotice),$out+="</p>\r\n                                      </div>\r\n                                            "),$out+="\r\n                                            ",visaInfo.importantNote&&($out+='\r\n                                            <div class="resources-panel">\r\n                                          <span class="resources-panel-title"><i class="icon title-icon"></i>重要提示</span>\r\n                                          <p class="c9">',$out+=$escape(visaInfo.importantNote),$out+="</p>\r\n                                      </div>\r\n                                            "),$out+="\r\n                                        </div>\r\n                                        "}else $out+='\r\n                                        <div class="resources">\r\n                                      <div class="resources-panel">\r\n                                          <span class="resources-panel-title"><i class="icon title-icon"></i>资源名称</span>\r\n                                          <p class="c9">',$out+=$escape(sub.resName),$out+="</p>\r\n                                      </div>\r\n                                            ",resInfo.info&&($out+='\r\n                                            <div class="resources-panel">\r\n                                          <span class="resources-panel-title"><i class="icon title-icon"></i>产品介绍</span>\r\n                                          <p class="c9">',$out+=$escape(resInfo.info),$out+="</p>\r\n                                      </div>\r\n                                            "),$out+="\r\n                                            ",resInfo.bookNotice&&($out+='\r\n                                            <div class="resources-panel">\r\n                                          <span class="resources-panel-title"><i class="icon title-icon"></i>预订须知</span>\r\n                                          <p class="c9">',$out+=$escape(resInfo.bookNotice),$out+="</p>\r\n                                      </div>\r\n                                            "),$out+="\r\n                                        </div>\r\n                                        ";$out+='\r\n                                <span class="icon white-triangle"></span>\r\n                                  <div class="clear-float"></div>\r\n                            </div>\r\n                        </em>\r\n                    </span>\r\n                    <span class="date-select">\r\n                        ',sub.isWifiByDay?($out+="\r\n                        ",$out+=$escape(resInfo.durationDays),$out+="天\r\n                        "):($out+='\r\n                        <select class="field-select ',sub.unValid&&($out+="T_valid"),$out+='">\r\n                            ',_.each(sub.resourceDatePrices,function(date,index){$out+='\r\n                            <option value=""\r\n                                    ',index==sub.selectDate&&($out+="selected"),$out+=">",$out+=$escape(date.departDate),$out+="</option>\r\n                            "}),$out+="\r\n                        </select>\r\n                        使用\r\n                        "),$out+="\r\n                    </span>\r\n                    ";var adultPrice=sub.resourceDatePrices[selectDate].price,childPrice=sub.resourceDatePrices[selectDate].childPrice,titleStr="";if("人"==resInfo.priceComputerType?(titleStr+=0==adultPrice?"限时赠送":adultPrice+"/成人",childNum&&(titleStr+=0==childPrice?"限时赠送":childPrice+"/儿童")):titleStr+=0==adultPrice?"限时赠送":sub.isWifiByDay?adultPrice+"/单日/"+resInfo.priceComputerType:adultPrice+"/"+resInfo.priceComputerType,$out+='\r\n                    <span class="price" title="',$out+=$escape(titleStr),$out+='">\r\n                        ',"人"==resInfo.priceComputerType?($out+='\r\n                        <div class="T_adult">\r\n                            ',0==adultPrice?$out+="\r\n                            限时赠送\r\n                            ":($out+="\r\n                            <em>￥",$out+=$escape(adultPrice),$out+="</em>/成人\r\n                            "),$out+='\r\n                        </div>\r\n\r\n                        <div class="T_child ',childNum||($out+="hide"),$out+='">\r\n                            ',0==childPrice?$out+="\r\n                            限时赠送\r\n                            ":($out+="\r\n                            <em>￥",$out+=$escape(childPrice),$out+="</em>/儿童\r\n                            "),$out+="\r\n                        </div>\r\n                        "):($out+='\r\n                        <div class="T_adult">\r\n                            ',0==adultPrice?$out+="\r\n                            限时赠送\r\n                            ":($out+="\r\n                            ",sub.isWifiByDay?($out+="\r\n                            <em>￥",$out+=$escape(adultPrice),$out+="</em>/单日/",$out+=$escape(resInfo.priceComputerType),$out+="\r\n                            "):($out+="\r\n                            <em>￥",$out+=$escape(adultPrice),$out+="</em>/",$out+=$escape(resInfo.priceComputerType),$out+="\r\n                            "),$out+="\r\n                            "),$out+="\r\n                        </div>\r\n                        "),$out+='\r\n                    </span>\r\n                    <span class="select-box select-count">\r\n                        ',supportChangeCount){switch($out+="\r\n                        ",resInfo.priceComputerType){case"份":case"张":case"台":case"辆":case"成人":case"儿童":if($out+='\r\n                        <div class="T_adult">\r\n                            <select class="field-select">\r\n                                ',0==sub.adultPrice)$out+='\r\n                                    <option value="',$out+=$escape(sub.adultResourceCount),$out+='" selected >',$out+=$escape(sub.adultResourceCount),$out+="</option>\r\n                                ";else{$out+="\r\n                                    ",0!=sub.minValue&&($out+='\r\n                                    <option value="0" ',0==sub.adultResourceCount&&($out+="selected"),$out+=" >0</option>\r\n                                    "),$out+="\r\n                                    ";for(var i=sub.minValue;i<=sub.maxValue;i++)$out+='\r\n                                    <option value="',$out+=$escape(i),$out+='" ',i==sub.adultResourceCount&&($out+="selected"),$out+=" >",$out+=$escape(i),$out+="</option>\r\n                                    ";$out+="\r\n                                "}$out+="\r\n                            </select>\r\n                            ",$out+=$escape(resInfo.priceComputerType),$out+="\r\n                        </div>\r\n                        ";break;case"人":if($out+='\r\n                        <div class="T_adult">\r\n                            <select class="field-select">\r\n                                ',0==sub.adultPrice)$out+='\r\n                                <option value="',$out+=$escape(sub.adultResourceCount),$out+='" selected >',$out+=$escape(sub.adultResourceCount),$out+="</option>\r\n                                ";else{$out+="\r\n                                    ",0!=sub.minAdultValue&&($out+='\r\n                                    <option value="0" ',0==sub.adultResourceCount&&($out+="selected"),$out+=" >0</option>\r\n                                    "),$out+="                             \r\n                                    ";for(var i=sub.minAdultValue;i<=sub.maxAdultValue;i++)$out+='\r\n                                    <option value="',$out+=$escape(i),$out+='" ',i==sub.adultResourceCount&&($out+="selected"),$out+=" >",$out+=$escape(i),$out+="</option>\r\n                                    ";$out+="\r\n                                "}if($out+='                            \r\n                            </select>\r\n                            成人\r\n                        </div>\r\n                        <div class="T_child ',childNum||($out+="T_hide"),$out+='">\r\n                            <select class="field-select">\r\n                                ',0==sub.childPrice)$out+='\r\n                                    <option value="',$out+=$escape(sub.childResourceCount),$out+='" selected >',$out+=$escape(sub.childResourceCount),$out+="</option>\r\n                                ";else{$out+="\r\n                                    ",0!=sub.minChildValue&&($out+='\r\n                                    <option value="0" ',0==sub.childResourceCount&&($out+="selected"),$out+=" >0</option>\r\n                                    "),$out+="  \r\n                                    ";for(var i=sub.minChildValue;i<=sub.maxChildValue;i++)$out+='\r\n                                    <option value="',$out+=$escape(i),$out+='" ',i==sub.childResourceCount&&($out+="selected"),$out+=" >",$out+=$escape(i),$out+="</option>\r\n                                    ";$out+="\r\n                                "}$out+="                            \r\n                            </select>\r\n                            儿童\r\n                        </div>\r\n                        "}$out+="\r\n                        "}else{switch($out+="\r\n                        ",resInfo.priceComputerType){case"份":case"张":case"台":case"辆":case"成人":case"儿童":$out+='\r\n                        <div class="T_adult">\r\n                            <label class="input_checkbox ',sub.adultSelect&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label>\r\n                        </div>\r\n                        ';break;case"人":$out+='\r\n                        <div class="T_adult">\r\n                            <label class="input_checkbox ',sub.adultSelect&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label>\r\n                        </div>\r\n                        <!--<div class="T_child ',childNum&&0==excludeChildFlag||($out+="hide"),$out+='">-->\r\n                        <!--<label class="input_checkbox ',sub.childSelect&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label>-->\r\n                        <!--</div>-->\r\n                        '}$out+="\r\n                        "}$out+="\r\n                    </span>\r\n                </div>\r\n                "}),$out+="\r\n                <!--",!item.showAll&&moreCount>1&&($out+='-->\r\n                <!--<div class="right-panel more-or-less">-->\r\n                    <!--<em class="more">更多',$out+=$escape(helperFormatText(item.subType)),$out+='<i class="icon more-select-icon"></i></em>-->\r\n                <!--</div>-->\r\n                <!--'),$out+="-->\r\n                <!--",item.showAll&&($out+='-->\r\n                <!--<div class="right-panel more-or-less">-->\r\n                    <!--<em class="less">收起<i class="icon less-select-icon"></i></em>-->\r\n                <!--</div>-->\r\n                <!--'),$out+="-->\r\n            </div>\r\n        </div>\r\n    </div>\r\n    "}$out+="\r\n    "}),$out+="\r\n</div>",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var tools=__webpack_require__(16);exports.keepCursor=function(keepCursor,type){if(keepCursor){var index=1==type?1:0,input=this.$el.find(".transfer").eq(index).find(".input-off-place"),val=input.val();tools.moveCursor(input[0],val.length,val.length)}}},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),eventBus=__webpack_require__(5),tpl=__webpack_require__(112),_=__webpack_require__(8),tools=__webpack_require__(16),constant=__webpack_require__(11),layer2=(__webpack_require__(17),__webpack_require__(18)),optionalSelectedCommon=(__webpack_require__(24),__webpack_require__(110));module.exports=backbone.View.extend({el:"#m-float-optional",events:{"click .transfer .common-addr":"showCommonAddress","click .transfer .address":"useAddress","click .transfer .receipt_con":"useCommonAddress","change .transfer .date":"changeRecommendDate","change .transfer .hour":"changeRecommendHour","change .transfer .minute":"changeRecommendMinute","click .transfer .transfer-footer .input_checkbox":"selectRecommend","click .addition .more-or-less":"showAll","change .addition .date-select select":"dateChange","click .addition .select-box label":"selectOne","change .addition .select-count select":"countChange","click .update .input_checkbox":"updateSelect","click .update .stop-or-open":"updateShowMore","click .float-header .book-close":"close","click .float-footer .btn-confirm":"confirm","click .float-footer .btn-cancel":"cancel"},initialize:function(){this.listenTo(this.model,"render",this.render),this.listenTo(this.model,"showError",this.showError),this.$el.on("input onpropertychange",".transfer .input-off-place",_.debounce($.proxy(this.getRecommendAddress,this),300))},render:function(obj){obj=obj||{};var keepCursor=obj.keepCursor,type=obj.type,data=this.model.toJSON(),html=tpl(data);this.$el.html(html).show(),tools.responsive(this.$el.find(".float-content"),constant.MAX_FLOAT_PANEL_HEIGHT),this.responsive(),this.keepCursor(keepCursor,type)},showAll:function(e){var obj=$(e.currentTarget),currentIndex=obj.parents(".panel").data("index"),data=this.model.toJSON(),list=data.list;_.some(list,function(item,index){if(currentIndex==index)return item.showAll=!item.showAll,!0}),this.model.trigger("render")},dateChange:function(e){var self=this,obj=$(e.currentTarget).children("option:selected"),currentIndex=obj.parents(".panel").data("index"),selectDateIndex=obj.index(),resId=obj.parents(".right-panel").data("resid"),data=self.model.toJSON(),list=data.list;_.some(list,function(item,index){if(currentIndex==index)return _.some(item.resList,function(sub){if(sub.resId==resId)return sub.selectDate=selectDateIndex,sub.adultPrice=sub.resourceDatePrices[selectDateIndex].price,sub.childPrice=sub.resourceDatePrices[selectDateIndex].childPrice,sub.departDate=sub.resourceDatePrices[selectDateIndex].departDate,!0})}),this.model.trigger("render")},countChange:function(e){var self=this,obj=$(e.currentTarget),currentIndex=obj.parents(".panel").data("index"),count=+obj.val(),isAdult=obj.parent().hasClass("T_adult"),resId=obj.parents(".right-panel").data("resid"),data=this.model.toJSON(),list=data.list;_.some(list,function(item,index){if(currentIndex==index)return _.some(item.resList,function(sub){if(sub.resId==resId)return isAdult?(sub.adultResourceCount=count,sub.adultResourceCount+sub.childResourceCount!=0&&sub.adultResourceCount+sub.childResourceCount<sub.resInfo.limitMin&&(sub.childResourceCount=sub.resInfo.limitMin-sub.adultResourceCount,self.model.getIsInRange(sub,sub.childResourceCount,"child")||(sub.childResourceCount=0,sub.childSelect=!1))):(sub.childResourceCount=count,sub.adultResourceCount+sub.childResourceCount!=0&&sub.adultResourceCount+sub.childResourceCount<sub.resInfo.limitMin&&(sub.adultResourceCount=sub.resInfo.limitMin-sub.childResourceCount,self.model.getIsInRange(sub,sub.adultResourceCount,"adult")||(sub.adultResourceCount=0,sub.adultSelect=!1))),count>0?isAdult?(sub.adultSelect=!0,sub.childResourceCount&&(sub.childSelect=!0)):(sub.childSelect=!0,sub.adultResourceCount&&(sub.adultSelect=!0)):isAdult?sub.adultSelect=!1:sub.childSelect=!1,!0})}),this.model.trigger("render")},selectOne:function(e){var obj=$(e.currentTarget),currentIndex=obj.parents(".panel").data("index"),resId=(obj.parent().hasClass("T_adult"),obj.parents(".right-panel").data("resid")),data=this.model.toJSON(),list=data.list;_.some(list,function(item,index){if(currentIndex==index)return _.some(item.resList,function(sub){if(sub.resId==resId){var resInfo=sub.resInfo,priceComputerType=resInfo.priceComputerType,selectDate=sub.selectDate;sub.resourceDatePrices[selectDate].excludeChildFlag;return sub.adultSelect=!sub.adultSelect,"人"==priceComputerType&&data.childNum&&(sub.childSelect=!sub.childSelect),!0}})}),this.model.trigger("render")},getRecommendAddress:function(e){if(tools.alreadyInput()){var obj=$(e.currentTarget),val=obj.val(),parent=obj.parents(".panel"),type=+parent.data("type");this.model.getRecommendAddress(val,type)}},showCommonAddress:function(e){var obj=$(e.currentTarget),parent=obj.parents(".panel"),type=+parent.data("type");this.model.showCommonAddress(type)},useAddress:function(e){var obj=$(e.currentTarget),parent=obj.parents(".panel"),type=+parent.data("type"),index=+obj.data("index");this.model.useAddress(type,index)},useCommonAddress:function(e){var obj=$(e.currentTarget),parent=obj.parents(".panel"),type=+parent.data("type"),val=obj.data("addr");this.model.getRecommendAddress(val,type)},changeRecommendDate:function(e){var obj=$(e.currentTarget),val=obj.val();this.model.changeRecommendDate(val)},changeRecommendHour:function(e){var obj=$(e.currentTarget),val=obj.val();this.model.changeRecommendHour(val)},changeRecommendMinute:function(e){var obj=$(e.currentTarget),val=obj.val();this.model.changeRecommendMinute(val)},selectRecommend:function(e){var obj=$(e.currentTarget),parent=obj.parents(".panel"),type=+parent.data("type");this.model.selectRecommend(type)},updateSelect:function(e){var isSelect,currentIndex,currentContent=$(e.currentTarget);isSelect=currentContent.hasClass("enabled")?0:1,currentIndex=currentContent.parents(".update-list").prevAll(".update-list").length,this.model.trigger("oneRowSelect",currentIndex,isSelect)},updateShowMore:function(){this.model.updateShowMore()},showError:function(obj){var type=obj.type,code=obj.code,map={recommend:{1:"请填写下车地点",2:"暂无可用车辆",3:"请填写下车地点",4:"请填写上车地点",5:"暂无可用车辆",6:"请填写上车地点"}};layer2.msg(map[type][code])},responsive:function(){var height=this.$el.find(".float-content").height();this.$el.find(".float-main").height(height-122)},confirm:function(){var data=this.model.toJSON();this.model.checkRecommend()&&(eventBus.trigger("changeOptionalSelected",data),this.cancel())},cancel:function(){this.$el.hide()},close:function(){this.cancel()},keepCursor:optionalSelectedCommon.keepCursor})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,supportChangeCount=($utils.$helpers,$data.supportChangeCount),recommendData=$data.recommendData,deliverySelected=$data.deliverySelected,$escape=$utils.$escape,_=$data._,commonReceiptInfo=$data.commonReceiptInfo,deliveryAddress=$data.deliveryAddress,addressError=$data.addressError,addressShow=$data.addressShow,addressType=$data.addressType,places=$data.places,dateList=($data.item,$data.index,$data.dateList),deliveryDate=$data.deliveryDate,hourList=$data.hourList,deliveryHour=$data.deliveryHour,minuteList=$data.minuteList,deliveryMinute=$data.deliveryMinute,deliveryPriceLoading=$data.deliveryPriceLoading,deliveryInfo=$data.deliveryInfo,deliveryType=$data.deliveryType,helperFormatRecommendNote=$data.helperFormatRecommendNote,$string=$utils.$string,pickupSelected=$data.pickupSelected,pickupAddress=$data.pickupAddress,airplaneData=$data.airplaneData,pickupPriceLoading=$data.pickupPriceLoading,pickupInfo=$data.pickupInfo,pickupType=$data.pickupType,updateSchemeInfo=$data.updateSchemeInfo,i=$data.i,oneUpdateScheme=$data.oneUpdateScheme,uClass=$data.uClass,updateSchemeShowAll=$data.updateSchemeShowAll,helperShowPrice=$data.helperShowPrice,list=$data.list,helperFormatText=($data._index,$data.helperFormatText),helperGetTypeByCode=($data.moreCount,$data.hasFindFlag,$data.firstShowFlag,$data.hasSelected,$data.sub,$data.resInfo,$data.listClass,$data.selectDate,$data.excludeChildFlag,$data.helperGetTypeByCode),helperFormatBooleanTip=($data.visaInfo,$data.helperFormatBooleanTip),childNum=($data.date,$data.adultPrice,$data.childPrice,$data.titleStr,$data.childNum),$out="";if($out+='<div class="float-bg"></div>\r\n<div class="float-content">\r\n    <header class="float-header">\r\n        <h2 class="active">推荐项目</h2>\r\n        <span><i class="icon book-close"></i></span>\r\n    </header>\r\n\r\n    <main class="float-main ',supportChangeCount&&($out+="support-change-count"),$out+='">\r\n\r\n        ',recommendData&&($out+='\r\n        <div class="panel transfer ',deliverySelected&&($out+="selected"),$out+='" data-type="2">\r\n            <div class="transfer-header">\r\n                ',$out+=$escape(recommendData.deliveryCityName),$out+='送机\r\n            </div>\r\n            <div class="transfer-body">\r\n                <p class="transfer-title f-ol" title="自选上车地点-',$out+=$escape(recommendData.deliveryServer.serviceName),$out+=$escape(recommendData.deliveryServer.airportTerminal),$out+='">自选上车地点-',$out+=$escape(recommendData.deliveryServer.serviceName),$out+=$escape(recommendData.deliveryServer.airportTerminal),$out+='</p>\r\n                <div class="T-place">上车地点：\r\n                    <input type="text" class="field-input input-small input-off-place ',_.isEmpty(commonReceiptInfo)||($out+="hasCommon"),$out+='" placeholder="填写或选择上车地点" value="',$out+=$escape(deliveryAddress&&deliveryAddress.name),$out+='">\r\n                    ',_.isEmpty(commonReceiptInfo)||($out+='\r\n                    <span class="common-addr">常用地址<i></i></span>\r\n                    '),$out+="\r\n                    ",2==addressError&&($out+='\r\n                    <div class="error"><i class="icon error-icon"></i>未找到相关地点，请您修改</div>\r\n                '),$out+="\r\n                </div>\r\n                ",2==addressShow&&($out+="\r\n                ",1==addressType?($out+='\r\n                <div class="common_send_place">\r\n                    ',_.each(places,function(item,index){$out+='\r\n                    <div class="address" data-index="',$out+=$escape(index),$out+='">\r\n                        <span class="address_icon"></span>\r\n                        <div class="address_text">\r\n                            <div class="nobr name" title="',$out+=$escape(item.name),$out+='">',$out+=$escape(item.name),$out+='</div>\r\n                            <div class="nobr address-detail" title="',$out+=$escape(item.address),$out+='">',$out+=$escape(item.address),$out+="</div>\r\n                        </div>\r\n                    </div>\r\n                    ";
}),$out+="\r\n                </div>\r\n                "):2==addressType&&($out+='\r\n                <div class="common_send_place">\r\n                    ',_.each(commonReceiptInfo,function(item){$out+='\r\n                    <p class="receipt_con" data-addr="',$out+=$escape(item.leftAddress),$out+='"><span class="nobr">',$out+=$escape(item.leftAddress),$out+="</span> </p>\r\n                    "}),$out+="\r\n                </div>\r\n                "),$out+="\r\n                "),$out+='\r\n                <p class="T-time">\r\n                    <span class="label-text">上车时间：</span>\r\n                    <select class="date field-select">\r\n                        ',_.each(dateList,function(item){$out+='\r\n                        <option value="',$out+=$escape(item),$out+='"\r\n                                ',item==deliveryDate&&($out+="selected"),$out+=">\r\n                            ",$out+=$escape(item.split("-")[1]+"月"+item.split("-")[2]+"日"),$out+="\r\n                        </option>\r\n                        "}),$out+='\r\n                    </select>\r\n                    <select class="hour field-select">\r\n                        ',_.each(hourList,function(item){$out+='\r\n                        <option value="',$out+=$escape(item),$out+='"\r\n                                ',item==deliveryHour&&($out+="selected"),$out+=">\r\n                            ",$out+=$escape(item+"时"),$out+="\r\n                        </option>\r\n                        "}),$out+='\r\n                    </select>\r\n                    <select class="minute field-select">\r\n                        ',_.each(minuteList,function(item){$out+='\r\n                        <option value="',$out+=$escape(item),$out+='"\r\n                                ',item==deliveryMinute&&($out+="selected"),$out+=">\r\n                            ",$out+=$escape(item+"分"),$out+="\r\n                        </option>\r\n                        "}),$out+='\r\n                    </select>\r\n                </p>\r\n            </div>\r\n            <div class="transfer-leg">\r\n            <span class="start-price">\r\n                ',1==deliveryPriceLoading?($out+="\r\n                <em>￥",$out+=$escape(deliveryInfo&&deliveryInfo.totalPrice?deliveryInfo.totalPrice:recommendData.deliveryStartPrice+"起"),$out+="</em>\r\n                "):2==deliveryPriceLoading?$out+="\r\n                <em>价格计算中...</em>\r\n                ":3==deliveryPriceLoading&&($out+="\r\n                <em>暂无可用车辆</em>\r\n                "),$out+='\r\n            </span>\r\n                <span class="type jtxz-detail-hover">\r\n                ',$out+=$escape(deliveryType?deliveryType:recommendData.deliveryServer.vehicleGroupInfos.name),$out+='\r\n                    <div class="jtxz-detail2">\r\n                    <p class="YD_mgb">',$out+=$escape(helperFormatRecommendNote(recommendData.deliveryServer.vehicleGroupInfos)),$out+='</p>\r\n                    <span class="z">◆</span>\r\n                    <span class="j">◆</span>\r\n                </div>\r\n            </span>\r\n                <span class="tips jtxz-detail-hover"><i class="icon notice2-icon"></i>须知\r\n                            <div class="jtxz-detail2">\r\n                                <p class="YD_title">服务说明</p>\r\n                                <p class="YD_mgb">1. 接送机产品是点到点中途不停留的服务，不能临时改变路线。司机会根据路况合理安排行驶路，不接受中途经停或绕路。</p>\r\n                                <p class="YD_mgb">2. 婴儿、儿童即使不占用座位也需计入乘车人数。</p>\r\n                                <p class="YD_mgb">3. 各车型的承载人数及行李都有所限制，请您仔细核对，由于您自身选择车型不符而影响您的用车，该损失由您自行承担。</p>\r\n                                <p class="YD_mgb">4. 若您选择的地址因交通因素无法送达，比如送达山脉、森林、岛屿、海上、沙漠、无人区等，途牛会视情况送您到就近的地点。如鼓浪屿，司机会送您至轮渡码头，请您自行乘船前往目的地。</p>\r\n                                <p class="YD_mgb">5. 送机服务司机将会在指定地点等您上车。</p>\r\n                                <p class="YD_title">车型和容量</p>\r\n                                <p class="YD_mgb">',$out+=$escape(helperFormatRecommendNote(recommendData.deliveryServer.vehicleGroupInfos)),$out+="</p>\r\n                                ",deliveryInfo&&($out+='\r\n                                <p class="YD_title">免费等待时长</p>\r\n                                <p class="YD_mgb">',$out+=$string(deliveryInfo.attentions.content),$out+="</p>\r\n                                "),$out+='\r\n                                <span class="z">◆</span>\r\n                                <span class="j">◆</span>\r\n                            </div>\r\n                        </span>\r\n            </div>\r\n            <div class="transfer-footer">\r\n                <label class="input_checkbox ',deliverySelected&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="panel transfer ',pickupSelected&&($out+="selected"),$out+='" data-type="1">\r\n            <div class="transfer-header">\r\n                ',$out+=$escape(recommendData.pickupCityName),$out+='接机\r\n            </div>\r\n            <div class="transfer-body">\r\n                <p class="transfer-title f-ol" title="',$out+=$escape(recommendData.pickupServer.serviceName),$out+=$escape(recommendData.pickupServer.airportTerminal),$out+='-自选下车地点">',$out+=$escape(recommendData.pickupServer.serviceName),$out+=$escape(recommendData.pickupServer.airportTerminal),$out+='-自选下车地点</p>\r\n                <div class="T-place">下车地点：\r\n                    <input type="text" class="field-input input-small input-off-place ',_.isEmpty(commonReceiptInfo)||($out+="hasCommon"),$out+='" placeholder="填写或选择下车地点" value="',$out+=$escape(pickupAddress&&pickupAddress.name),$out+='">\r\n                    ',_.isEmpty(commonReceiptInfo)||($out+='\r\n                    <span class="common-addr">常用地址<i></i></span>\r\n                    '),$out+="\r\n                    ",1==addressError&&($out+='\r\n                    <div class="error"><i class="icon error-icon"></i>未找到相关地点，请您修改</div>\r\n                '),$out+="\r\n                </div>\r\n                ",1==addressShow&&($out+="\r\n                ",1==addressType?($out+='\r\n                <div class="common_send_place">\r\n                    ',_.each(places,function(item,index){$out+='\r\n                    <div class="address" data-index="',$out+=$escape(index),$out+='">\r\n                        <span class="address_icon"></span>\r\n                        <div class="address_text">\r\n                            <div class="nobr name" title="',$out+=$escape(item.name),$out+='">',$out+=$escape(item.name),$out+='</div>\r\n                            <div class="nobr address-detail" title="',$out+=$escape(item.address),$out+='">',$out+=$escape(item.address),$out+="</div>\r\n                        </div>\r\n                    </div>\r\n                    "}),$out+="\r\n                </div>\r\n                "):2==addressType&&($out+='\r\n                <div class="common_send_place">\r\n                    ',_.each(commonReceiptInfo,function(item){$out+='\r\n                    <p class="receipt_con" data-addr="',$out+=$escape(item.leftAddress),$out+='"><span class="nobr">',$out+=$escape(item.leftAddress),$out+="</span> </p>\r\n                    "}),$out+="\r\n                </div>\r\n                "),$out+="\r\n                "),$out+='\r\n                <p class="T-time">\r\n                    <span class="label-text">上车时间：</span>\r\n                    <span class="date">\r\n                    ',$out+=$escape(airplaneData.arrivalDate.split("-")[1]),$out+="月",$out+=$escape(airplaneData.arrivalDate.split("-")[2]),$out+='日\r\n                    </span>\r\n                    <span class="hour">',$out+=$escape(airplaneData.arriveTime.split(":")[0]),$out+='时</span>\r\n                    <span class="minute">',$out+=$escape(airplaneData.arriveTime.split(":")[1]),$out+='分</span>\r\n                </p>\r\n            </div>\r\n            <div class="transfer-leg">\r\n            <span class="start-price">\r\n                ',1==pickupPriceLoading?($out+="\r\n                <em>￥",$out+=$escape(pickupInfo&&pickupInfo.totalPrice?pickupInfo.totalPrice:recommendData.pickupStartPrice+"起"),$out+="</em>\r\n                "):2==pickupPriceLoading?$out+="\r\n                <em>价格计算中...</em>\r\n                ":3==pickupPriceLoading&&($out+="\r\n                <em>暂无可用车辆</em>\r\n                "),$out+='\r\n            </span>\r\n                <span class="type jtxz-detail-hover">\r\n                ',$out+=$escape(pickupType?pickupType:recommendData.pickupServer.vehicleGroupInfos.name),$out+='\r\n                    <div class="jtxz-detail2">\r\n                    <p class="YD_mgb">',$out+=$escape(helperFormatRecommendNote(recommendData.pickupServer.vehicleGroupInfos)),$out+='</p>\r\n                    <span class="z">◆</span>\r\n                    <span class="j">◆</span>\r\n                </div>\r\n            </span>\r\n                <span class="tips jtxz-detail-hover"><i class="icon notice2-icon"></i>须知\r\n                            <div class="jtxz-detail2">\r\n                                <p class="YD_title">服务说明</p>\r\n                                <p class="YD_mgb">1. 接送机产品是点到点中途不停留的服务，不能临时改变路线。司机会根据路况合理安排行驶路，不接受中途经停或绕路。</p>\r\n                                <p class="YD_mgb">2. 婴儿、儿童即使不占用座位也需计入乘车人数。</p>\r\n                                <p class="YD_mgb">3. 各车型的承载人数及行李都有所限制，请您仔细核对，由于您自身选择车型不符而影响您的用车，该损失由您自行承担。</p>\r\n                                <p class="YD_mgb">4. 若您选择的地址因交通因素无法送达，比如送达山脉、森林、岛屿、海上、沙漠、无人区等，途牛会视情况送您到就近的地点。如鼓浪屿，司机会送您至轮渡码头，请您自行乘船前往目的地。</p>\r\n                                <p class="YD_mgb">5. 送机服务司机将会在指定地点等您上车。</p>\r\n                                <p class="YD_title">车型和容量</p>\r\n                                <p class="YD_mgb">',$out+=$escape(helperFormatRecommendNote(recommendData.pickupServer.vehicleGroupInfos)),$out+="</p>\r\n                                ",pickupInfo&&($out+='\r\n                                <p class="YD_title">免费等待时长</p>\r\n                                <p class="YD_mgb">',$out+=$string(pickupInfo.attentions.content),$out+="</p>\r\n                                "),$out+='\r\n                                <span class="z">◆</span>\r\n                                <span class="j">◆</span>\r\n                            </div>\r\n                        </span>\r\n            </div>\r\n            <div class="transfer-footer">\r\n                <label class="input_checkbox ',pickupSelected&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label>\r\n            </div>\r\n        </div>\r\n        '),$out+="\r\n\r\n        ",!_.isEmpty(updateSchemeInfo)){$out+='\r\n        <div class="panel update">\r\n            <div class="panel-body">\r\n                <div class="left">\r\n                <span class="type f-ol" title="升级方案（活动）">\r\n                    升级方案\r\n                </span>\r\n                </div>\r\n                <div class="right">\r\n                    ';for(var i=0;i<updateSchemeInfo.length;i++){$out+="\r\n                    ";var oneUpdateScheme=updateSchemeInfo[i];$out+="\r\n                    ";var uClass="hide";updateSchemeShowAll?uClass="":i<1&&(uClass=""),$out+='\r\n                    <div class="update-list ',$out+=$escape(uClass),$out+='">\r\n                        <span class="update-name">\r\n                            <em class="two-line" title="',$out+=$escape(oneUpdateScheme.resName),$out+='">',$out+=$escape(oneUpdateScheme.resName),$out+='</em>\r\n                        </span>\r\n                        <span class="update-days-num">',$out+=$escape(oneUpdateScheme.journey),$out+='</span>\r\n                        <span class="update-price f-ol">\r\n                            <div class="T_adult">\r\n                                ',0==oneUpdateScheme.adultPrice?$out+="\r\n                                    限时赠送\r\n                                ":($out+="\r\n                                    <em>",$out+=$escape(helperShowPrice(oneUpdateScheme.adultPrice)),$out+="</em>/成人\r\n                                "),$out+='\r\n                            </div>\r\n                            <div class="T_child">\r\n                                ',oneUpdateScheme.supportChild?($out+="\r\n                                <em>",$out+=$escape(helperShowPrice(oneUpdateScheme.childPrice)),$out+="</em>/儿童\r\n                                "):$out+="\r\n                                不支持儿童\r\n                                ",$out+='\r\n                            </div>\r\n                        </span>\r\n                        <span class="box">\r\n                        <label class="input_checkbox ',1==oneUpdateScheme.isSelect&&($out+="enabled"),$out+='">\r\n                            <span class="tn_fontface">&#xe618;</span>\r\n                        </label>\r\n                    </span>\r\n                    </div>\r\n                    '}$out+="\r\n                    ",updateSchemeShowAll&&($out+='\r\n                    <div class="stop-or-open">\r\n                        收起<i class="icon less-select-icon"></i>\r\n                    </div>\r\n                    '),$out+="\r\n                    ",updateSchemeInfo.length>1&&!updateSchemeShowAll&&($out+='\r\n                    <div class="stop-or-open">\r\n                        更多升级方案<i class="icon more-select-icon"></i>\r\n                    </div>\r\n                    '),$out+='\r\n                </div>\r\n                <div class="clear-float"></div>\r\n            </div>\r\n        </div>\r\n        '}return $out+="\r\n\r\n        ",_.each(list,function(item,_index){$out+='\r\n        <div class="panel addition ',item.show||($out+="hide"),$out+='" data-index="',$out+=$escape(_index),$out+='">\r\n            <div class="panel-body">\r\n                <div class="left">\r\n                <span class="type f-ol" title="',$out+=$escape(helperFormatText(item.subType)),$out+='">\r\n                    ',$out+=$escape(helperFormatText(item.subType)),$out+="(",$out+=$escape(item.destinationName),$out+='使用)\r\n                </span>\r\n                </div>\r\n                <div class="right">\r\n                    ';var moreCount=item.resList.length,hasFindFlag=!1,firstShowFlag=!1,hasSelected=_.some(item.resList,function(sub){return sub.adultSelect||sub.childSelect});$out+="\r\n                    ",_.each(item.resList,function(sub,index){$out+="\r\n                    ";var listClass,resInfo=sub.resInfo;sub.show?item.showAll?listClass="":sub.adultSelect||sub.childSelect?(listClass="",moreCount--,hasFindFlag=!0):hasSelected||hasFindFlag?listClass="hide":(listClass="",moreCount--,hasFindFlag=!0):(listClass="hide",moreCount--),firstShowFlag||""!=listClass||(firstShowFlag=!0,listClass+=" first");var selectDate=sub.selectDate,excludeChildFlag=sub.resourceDatePrices[selectDate].excludeChildFlag;if($out+='\r\n                    <div class="right-panel ',$out+=$escape(listClass),$out+='" data-resid="',$out+=$escape(sub.resId),$out+='">\r\n                    <span class="name">\r\n                        <em class="two-line f-active-color detail-wrapper" title="',$out+=$escape(sub.resName),$out+='">\r\n                            ',$out+=$escape(sub.resName),$out+='\r\n                            <div class="resources-detail">\r\n                                  <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                                        ',item.subType==helperGetTypeByCode("qz")){$out+='\r\n                                        <div class="resources">\r\n                                      <div class="resources-panel">\r\n                                          <span class="resources-panel-title"><i class="icon title-icon"></i>资源名称</span>\r\n                                          <p class="c9">',$out+=$escape(sub.resName),$out+='</p>\r\n                                      </div>\r\n                                      <div class="resources-panel">\r\n                                          <span class="resources-panel-title"><i class="icon title-icon"></i>产品介绍</span>\r\n                                          ';var visaInfo=resInfo.visaInfo;$out+="\r\n                                          ",visaInfo.visaCityName&&($out+='\r\n                                          <p class="c9">\r\n                                              领区：',$out+=$escape(visaInfo.visaCityName),$out+="\r\n                                          </p>\r\n                                          "),$out+="\r\n                                          ",visaInfo.enterCountryTimes&&($out+='\r\n                                          <p class="c9">\r\n                                              入境次数：',$out+=$escape(visaInfo.enterCountryTimes),$out+="\r\n                                          </p>\r\n                                          "),$out+="\r\n                                          ",visaInfo.visaAvailableRange&&($out+='\r\n                                                                                         <p class="c9">\r\n                                                                                             有效期：',$out+=$escape(visaInfo.visaAvailableRange),$out+="\r\n                                                                                          </p>\r\n                                                                                     "),$out+='\r\n\r\n                                                                                      <p class="c9">\r\n                                                                                         是否面试：',$out+=$escape(helperFormatBooleanTip(visaInfo.isNeedInterview)),$out+='\r\n                                                                                      </p>\r\n\r\n                                                                                      <p class="c9">\r\n                                                                                         是否需录指纹：',$out+=$escape(helperFormatBooleanTip(visaInfo.isNeedFingerprint)),$out+='\r\n                                                                                      </p>\r\n\r\n                                                                                      <p class="c9">\r\n                                                                                         是否销签：',$out+=$escape(helperFormatBooleanTip(visaInfo.isNeedCancelVisa)),$out+='\r\n                                                                                      </p>\r\n\r\n                                                                                      <p class="c9">\r\n                                                                                         是否需担保金：',$out+=$escape(helperFormatBooleanTip(visaInfo.isNeedDeposit)),$out+="\r\n                                                                                      </p>\r\n\r\n                                                                                      ",visaInfo.visaMajorTypeName&&($out+='\r\n                                                                                          <p class="c9">\r\n                                                                                              签证类型：',$out+=$escape(visaInfo.visaMajorTypeName),$out+="\r\n                                                                                           </p>\r\n                                                                                      "),$out+="\r\n\r\n\r\n\r\n\r\n                                          ",visaInfo.longestResidenceTime&&($out+='\r\n                                          <p class="c9">\r\n                                              停留天数：',$out+=$escape(visaInfo.longestResidenceTime),$out+="\r\n                                          </p>\r\n                                          "),$out+="\r\n                                          ",visaInfo.handleTimeDuration&&($out+='\r\n                                          <p class="c9">\r\n                                              ',visaInfo.isOld?($out+="\r\n                                              受理时长：",$out+=$escape(visaInfo.handleTimeDuration),$out+="\r\n                                              "):($out+="\r\n                                              受理时长：",$out+=$escape(visaInfo.handleTimeDuration),$out+="个工作日\r\n                                              "),$out+="\r\n                                          </p>\r\n                                          "),$out+="\r\n                                          ",visaInfo.acceptanceScope&&($out+='\r\n                                          <p class="c9">\r\n                                              受理范围：',$out+=$escape(visaInfo.acceptanceScope),$out+="\r\n                                          </p>\r\n                                          "),$out+="\r\n                                      </div>\r\n                                            ",visaInfo.bookNotice&&($out+='\r\n                                            <div class="resources-panel">\r\n                                          <span class="resources-panel-title"><i class="icon title-icon"></i>预订须知</span>\r\n                                          <p class="c9">',$out+=$escape(visaInfo.bookNotice),$out+="</p>\r\n                                      </div>\r\n                                            "),$out+="\r\n                                            ",visaInfo.importantNote&&($out+='\r\n                                            <div class="resources-panel">\r\n                                          <span class="resources-panel-title"><i class="icon title-icon"></i>重要提示</span>\r\n                                          <p class="c9">',$out+=$escape(visaInfo.importantNote),$out+="</p>\r\n                                      </div>\r\n                                            "),$out+="\r\n                                        </div>\r\n                                        "}else $out+='\r\n                                        <div class="resources">\r\n                                      <div class="resources-panel">\r\n                                          <span class="resources-panel-title"><i class="icon title-icon"></i>资源名称</span>\r\n                                          <p class="c9">',$out+=$escape(sub.resName),$out+="</p>\r\n                                      </div>\r\n                                            ",resInfo.info&&($out+='\r\n                                            <div class="resources-panel">\r\n                                          <span class="resources-panel-title"><i class="icon title-icon"></i>产品介绍</span>\r\n                                          <p class="c9">',$out+=$escape(resInfo.info),$out+="</p>\r\n                                      </div>\r\n                                            "),$out+="\r\n                                            ",resInfo.bookNotice&&($out+='\r\n                                            <div class="resources-panel">\r\n                                          <span class="resources-panel-title"><i class="icon title-icon"></i>预订须知</span>\r\n                                          <p class="c9">',$out+=$escape(resInfo.bookNotice),$out+="</p>\r\n                                      </div>\r\n                                            "),$out+="\r\n                                        </div>\r\n                                        ";$out+='\r\n                                        <span class="icon white-triangle"></span>\r\n                                  <div class="clear-float"></div>\r\n                            </div>\r\n                        </em>\r\n                    </span>\r\n                        <span class="date-select">\r\n                            ',sub.isWifiByDay?($out+="\r\n                            ",$out+=$escape(resInfo.durationDays),$out+="天\r\n                            "):($out+='\r\n                            <select class="field-select ',sub.unValid&&($out+="T_valid"),$out+='">\r\n                                ',_.each(sub.resourceDatePrices,function(date,index){$out+='\r\n                                <option value=""\r\n                                        ',index==sub.selectDate&&($out+="selected"),$out+=">",$out+=$escape(date.departDate),$out+="</option>\r\n                                "}),$out+="\r\n                            </select>\r\n                            使用\r\n                            "),$out+="\r\n                        </span>\r\n                        ";var adultPrice=sub.resourceDatePrices[selectDate].price,childPrice=sub.resourceDatePrices[selectDate].childPrice,titleStr="";if("人"==resInfo.priceComputerType?(titleStr+=0==adultPrice?"限时赠送":adultPrice+"/成人",childNum&&(titleStr+=0==childPrice?"限时赠送":childPrice+"/儿童")):titleStr+=0==adultPrice?"限时赠送":sub.isWifiByDay?adultPrice+"/单日/"+resInfo.priceComputerType:adultPrice+"/"+resInfo.priceComputerType,$out+='\r\n                        <span class="price" title="',$out+=$escape(titleStr),$out+='">\r\n                            ',"人"==resInfo.priceComputerType?($out+='\r\n                            <div class="T_adult">\r\n                                ',0==adultPrice?$out+="\r\n                                限时赠送\r\n                                ":($out+="\r\n                                <em>￥",$out+=$escape(adultPrice),$out+="</em>/成人\r\n                                "),$out+='\r\n                            </div>\r\n\r\n                            <div class="T_child ',childNum||($out+="hide"),$out+='">\r\n                                ',0==childPrice?$out+="\r\n                                限时赠送\r\n                                ":($out+="\r\n                                <em>￥",$out+=$escape(childPrice),$out+="</em>/儿童\r\n                                "),$out+="\r\n                            </div>\r\n                            "):($out+='\r\n                            <div class="T_adult">\r\n                                ',0==adultPrice?$out+="\r\n                                限时赠送\r\n                                ":($out+="\r\n                                ",sub.isWifiByDay?($out+="\r\n                                <em>￥",$out+=$escape(adultPrice),$out+="</em>/单日/",$out+=$escape(resInfo.priceComputerType),$out+="\r\n                                "):($out+="\r\n                                <em>￥",$out+=$escape(adultPrice),$out+="</em>/",$out+=$escape(resInfo.priceComputerType),$out+="\r\n                                "),$out+="\r\n                                "),$out+="\r\n                            </div>\r\n                            "),$out+='\r\n                        </span>\r\n                        <span class="select-box select-count">\r\n                            ',supportChangeCount){switch($out+="\r\n                            ",resInfo.priceComputerType){case"份":case"张":case"台":case"辆":case"成人":case"儿童":if($out+='\r\n                            <div class="T_adult">\r\n                                <select class="field-select">\r\n                                    ',0==sub.adultPrice)$out+='\r\n                                        <option value="',$out+=$escape(sub.adultResourceCount),$out+='" selected >',$out+=$escape(sub.adultResourceCount),$out+="</option>\r\n                                    ";else{$out+="\r\n                                        ",0!=sub.minValue&&($out+='\r\n                                        <option value="0" ',0==sub.adultResourceCount&&($out+="selected"),$out+=" >0</option>\r\n                                        "),$out+="\r\n                                        ";for(var i=sub.minValue;i<=sub.maxValue;i++)$out+='\r\n                                        <option value="',$out+=$escape(i),$out+='" ',i==sub.adultResourceCount&&($out+="selected"),$out+=" >",$out+=$escape(i),$out+="</option>\r\n                                        ";$out+="\r\n                                    "}$out+="\r\n                                </select>\r\n                                    ",$out+=$escape(resInfo.priceComputerType),$out+="\r\n                            </div>\r\n                            ";break;case"人":if($out+='\r\n                            <div class="T_adult">\r\n                                <select class="field-select">\r\n                                    ',0==sub.adultPrice)$out+='\r\n                                    <option value="',$out+=$escape(sub.adultResourceCount),$out+='" selected >',$out+=$escape(sub.adultResourceCount),$out+="</option>\r\n                                    ";else{$out+="\r\n                                        ",0!=sub.minAdultValue&&($out+='\r\n                                        <option value="0" ',0==sub.adultResourceCount&&($out+="selected"),$out+=" >0</option>\r\n                                        "),$out+="                             \r\n                                        ";for(var i=sub.minAdultValue;i<=sub.maxAdultValue;i++)$out+='\r\n                                        <option value="',$out+=$escape(i),$out+='" ',i==sub.adultResourceCount&&($out+="selected"),$out+=" >",$out+=$escape(i),$out+="</option>\r\n                                        ";$out+="\r\n                                    "}if($out+='  \r\n                                </select>\r\n                                成人\r\n                            </div>\r\n                            <div class="T_child ',childNum||($out+="T_hide"),$out+='">\r\n                                <select class="field-select">\r\n                                    ',0==sub.childPrice)$out+='\r\n                                        <option value="',$out+=$escape(sub.childResourceCount),$out+='" selected >',$out+=$escape(sub.childResourceCount),$out+="</option>\r\n                                    ";else{$out+="\r\n                                        ",0!=sub.minChildValue&&($out+='\r\n                                        <option value="0" ',0==sub.childResourceCount&&($out+="selected"),$out+=" >0</option>\r\n                                        "),$out+="  \r\n                                        ";for(var i=sub.minChildValue;i<=sub.maxChildValue;i++)$out+='\r\n                                        <option value="',$out+=$escape(i),$out+='" ',i==sub.childResourceCount&&($out+="selected"),$out+=" >",$out+=$escape(i),$out+="</option>\r\n                                        ";$out+="\r\n                                    "}$out+=" \r\n                                </select>\r\n                                儿童\r\n                            </div>\r\n                            "}$out+="\r\n                            "}else{switch($out+="\r\n                            ",resInfo.priceComputerType){case"份":case"张":case"台":case"辆":case"成人":case"儿童":$out+='\r\n                            <div class="T_adult">\r\n                                <label class="input_checkbox ',sub.adultSelect&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label>\r\n                            </div>\r\n                            ';break;case"人":$out+='\r\n                            <div class="T_adult">\r\n                                <label class="input_checkbox ',sub.adultSelect&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label>\r\n                            </div>\r\n                            <!--<div class="T_child ',childNum&&0==excludeChildFlag||($out+="hide"),$out+='">-->\r\n                            <!--<label class="input_checkbox ',sub.childSelect&&($out+="enabled"),$out+='"><span class="tn_fontface"></span></label>-->\r\n                            <!--</div>-->\r\n                            ';
}$out+="\r\n                            "}$out+="\r\n                        </span>\r\n                    </div>\r\n                    "}),$out+="\r\n                    ",!item.showAll&&moreCount>0&&($out+='\r\n                    <div class="right-panel more-or-less">\r\n                        <em class="more">更多',$out+=$escape(helperFormatText(item.subType)),$out+='<i class="icon more-select-icon"></i></em>\r\n                    </div>\r\n                    '),$out+="\r\n                    ",item.showAll&&moreCount>1&&($out+='\r\n                    <div class="right-panel more-or-less">\r\n                        <em class="less">收起<i class="icon less-select-icon"></i></em>\r\n                    </div>\r\n                    '),$out+="\r\n                </div>\r\n            </div>\r\n        </div>\r\n        "}),$out+='\r\n    </main>\r\n\r\n    <footer class="float-footer">\r\n        <button class="btn btn-confirm">确认</button>\r\n        <button class="btn btn-cancel">取消</button>\r\n    </footer>\r\n</div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(14),__webpack_require__(7),__webpack_require__(114),__webpack_require__(115)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,$,Template,Loading,renderInsurance){return Backbone.View.extend({el:"#m-insurance",events:{},initialize:function(){this.render(),this.listenTo(this.model,"render",this.render),this.initSelect(),this.moreBtnClick(),this.loadingHtml=new Loading,this.model.isNewInsuranceFlag&&this.beforeLoad()},initSelect:function(){var self=this,content=this.$el,index=void 0,isCheck=void 0;content.on("click",".select-box .input_checkbox",function(){var target=$(this);index=target.parents(".panel").prevAll(".panel").length,isCheck=target.hasClass("enabled")?0:1,self.model.trigger("oneRowSelect",index,isCheck)})},moreBtnClick:function(){var self=this,isShowMore=0,content=this.$el;content.on("click",".more-insurance",function(){var target=$(this);isShowMore="更多"==target.text().trim()||"更多保险"==target.text().trim()?1:0,self.model.trigger("clickMoreBtu",isShowMore)})},beforeLoad:function(){var html=this.loadingHtml.renderHtml();this.$el.find(".modular-body").html(html)},loadError:function(){this.$el.find(".modular-body").html("网络异常！")},render:function(){var insuranceInfo=this.model.toJSON(),html=renderInsurance(insuranceInfo);if(_.isEmpty(insuranceInfo.insuranceInfo))this.$el.hide();else{this.$el.html(html).show();var isSelectInsuranceInfo=this.model.getIsSelectRow();if(0===isSelectInsuranceInfo.length)this.$el.find(".m-title-desc").show().text("购买保险可以为您的旅途提供意外风险保障，建议您至少购买一项旅游保险");else{var showTip=this.model.geTipSug();showTip?this.$el.find(".m-title-desc").show().text("保险无法当日生效，意外险投保次日开始生效"):this.$el.find(".m-title-desc").hide()}insuranceInfo.insuranceNotice&&this.$el.find(".m-title-desc").show().text(insuranceInfo.insuranceNotice)}this.model.setGlobalData()}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(14),__webpack_require__(9)],__WEBPACK_AMD_DEFINE_RESULT__=function($,Backbone){var loadingRender=function(msg){return'<div class="load-panel"> <p class="load-img"></p> <p class="load-tip">'+msg+"</p> </div>"};return Backbone.View.extend({renderHtml:function(msg){return loadingRender(msg||"")}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,insuranceInfo=($utils.$helpers,$data.insuranceInfo),i=$data.i,oneInsurance=$data.oneInsurance,$escape=$utils.$escape,helperIsInsuranceHide=$data.helperIsInsuranceHide,triggerFlag=$data.triggerFlag,$string=$utils.$string,helperShowPrice=$data.helperShowPrice,helperCanShowMoreBut=$data.helperCanShowMoreBut,isShowMore=$data.isShowMore,$out="";if(insuranceInfo&&insuranceInfo.length){$out+='\r\n<h2>\r\n    <span class="icon insurance-icon"></span>\r\n    <span class="m-title">保险方案</span>\r\n    <span class="m-title-desc"></span>\r\n</h2>\r\n<div class="modular-body">\r\n    ';for(var i=0;i<insuranceInfo.length;i++){$out+="\r\n    ";var oneInsurance=insuranceInfo[i];$out+='\r\n    <div class="panel ',$out+=$escape(helperIsInsuranceHide(triggerFlag,insuranceInfo,i)),$out+=" ",oneInsurance.showBorder&&($out+="has-border"),$out+='">\r\n        <span class="type" style="',oneInsurance.showTitle||($out+="visibility: hidden;"),$out+='">',$out+=$escape(oneInsurance.type),$out+='</span>\r\n        <span class="name f-ol">\r\n            <em class="f-active-color detail-wrapper" title="',$out+=$escape(oneInsurance.resName),$out+='" >\r\n                ',$out+=$escape(oneInsurance.resName),$out+='\r\n                <div class="resources-detail">\r\n                 <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                 <div class="resources">\r\n                     <div class="resources-panel">\r\n                         <span class="resources-panel-title"><i class="icon title-icon"></i>保险类型</span>\r\n                         <p class="c9">',oneInsurance.realType&&($out+=$escape(oneInsurance.realType)),$out+='</p>\r\n                     </div>\r\n                     <div class="resources-panel">\r\n                         <span class="resources-panel-title"><i class="icon title-icon"></i>保险描述</span>\r\n                         <div class="c9 explain">',$out+=oneInsurance.productDesc?$string(oneInsurance.productDesc):"暂无保险描述",$out+='</div>\r\n                     </div>\r\n                     <div class="resources-panel">\r\n                         <span class="resources-panel-title"><i class="icon title-icon"></i>投保须知</span>\r\n                         <div class="c9 explain">',$out+=oneInsurance.notice?$string(oneInsurance.notice):"暂无投保须知",$out+="</div>\r\n                     </div>\r\n                     ",oneInsurance.url&&($out+='\r\n                     <div class="resources-panel">\r\n                         <span class="resources-panel-title"><i class="icon title-icon"></i>详细信息请阅读</span>\r\n                         <p class="c9"><a href="',$out+=$escape(oneInsurance.url),$out+='" target="_blank" class="f-active-color">保险条款</a></p>\r\n                     </div>\r\n                     '),$out+='\r\n                 </div>\r\n                <span class="icon white-triangle"></span>\r\n                <div class="clear-float"></div>\r\n             </div>\r\n            </em>\r\n        </span>\r\n        <span class="price"><em>',$out+=$escape(helperShowPrice(oneInsurance.price*oneInsurance.airRange)),$out+='</em>/人</span>\r\n        <span class="select-box"><label class="input_checkbox ',1==oneInsurance.isSelect&&($out+=$escape("enabled")),$out+='"><span class="tn_fontface">&#xe618;</span></label></span>\r\n    </div>\r\n    '}$out+="\r\n    ",helperCanShowMoreBut(insuranceInfo)&&($out+='\r\n    <div class="more-insurance">\r\n        <span>',$out+=1===isShowMore?"收起":"更多保险",$out+='<i class="icon ',$out+=isShowMore?"less-select-icon":"more-select-icon",$out+='"></i></span>\r\n    </div>\r\n    '),$out+="\r\n</div>\r\n"}return $out+="\r\n",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(7),__webpack_require__(118),__webpack_require__(114),__webpack_require__(6),__webpack_require__(17),__webpack_require__(117),__webpack_require__(5),__webpack_require__(119),__webpack_require__(120),__webpack_require__(121),__webpack_require__(16)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,Template,favourableRender,Loading,config,layer,DialogRender,eventBus,TravelCouponCheckTpl,placeHolder,favourableBindCardsTpl,tools){var Login=config.isLogin,ErrMsgMap={1:"旅游券号不能为空",2:"旅游券密码不能为空",3:"优惠券券号不能为空"},FavourableView=Backbone.View.extend({el:"#m-favourable",events:{"click .J_list .list_row .input_checkbox":"onRowSelect","blur .J_travel_coupon":"useTravelCoupon","click .J_addPromotionCode":"addPromotionCode","click .J_tavelPromotionCharge":"openCharge","click .J_LoginBtn":"needLogin","click #J_bind_cards":"bindCards","click #J_change_address":"openAddressList"},initialize:function(){var self=this;this.loadingHtml=new Loading,this.listenTo(this.model,"render",this.render),this.listenTo(this.model,"travelCouponLimitError",function(userCanUsed){this.$el.find(".J_travel_coupon").val(userCanUsed),layer.tips("旅游券大于账户余额",".J_travel_coupon",{time:3})}),this.listenTo(this.model,"checkMsgSuccess",function(){this.checkFailShowMsg(""),layer.close(self.dialog)}),this.listenTo(this.model,"checkMsgFail",function(){this.checkFailShowMsg("验证码错误，请重新输入"),self.msgCode.val(""),self.msgCode.focus()}),this.listenTo(this.model,"chargeError",this.chargeError),this.listenTo(this.model,"chargeTooOffen",this.chargeTooOffen),this.listenTo(this.model,"validateError",this.validateError),this.listenTo(this.model,"changeAddress",this.changeAddress),this.listenTo(this.model,"hideAddress",this.hideAddress),self.timeCount=60},render:function(){var renderData=this.model.get("favourableInfo");renderData.isLogin=Login.status,renderData.defaultAddress=this.model.get("defaultAddress");var renderHtml=favourableRender(renderData);this.$el.html(renderHtml).show();var renderSubTitle=this.$el.find(".m-title-desc").empty();renderData&&renderData.proPromotion&&renderData.proPromotion.data&&renderData.proPromotion.data.length&&renderData.resPromotion&&renderData.resPromotion.data&&renderData.resPromotion.data.length&&renderSubTitle.text("套餐优惠与酒店、机票等单品优惠不能同时选择。"),renderData.promotionNotice&&renderSubTitle.append(renderData.promotionNotice),this.hideLastBorder()},beforeLoading:function(){var html=this.loadingHtml.renderHtml();this.$el.find(".modular-body").html(html)},onRowSelect:function(e){var currentParent=$(e.currentTarget).parents(".list_row"),checkIndex=currentParent.prevAll(".list_row:not(.noIndex)").length,type=currentParent.find(".input_checkbox").data("type");if("companyPrivilege"==type){var checkId=currentParent.find(".input_checkbox").data("id");this.model.selectCheckCompanyPrivilege(checkId)}else{if(currentParent.hasClass("disable"))return;this.model.selectCheckChangeData(checkIndex),this.model.getCompanyPrivilege()}},useTravelCoupon:function(e){var target=$(e.currentTarget),travelCoupon=target.val();this.model.useTravelCoupon(travelCoupon)},sendTravelMsg:function(data){var self=this,flag=data.data&&data.data.flag,tel=data.tel||data.data&&data.data.tel,needReCheck=this.model.get("needReCheck");if(data&&data.tel||1==flag){var content=TravelCouponCheckTpl({type:needReCheck?1:""});self.dialog=$.layer({type:1,guide:2,title:"验证会员信息",closeBtn:[0,!0],btns:0,area:["500px","auto"],border:[6,1,"#c4c4c5"],page:{html:content},success:function(wrap){wrap=$(wrap),self.userTel=wrap.find(".J_user_tel"),self.msgCode=wrap.find(".J_msg_code"),self.sendAgainBtn=wrap.find(".J_send_again"),self.showErrorMsg=wrap.find(".J_LoginError"),self.submit=wrap.find(".J_submit"),self.userTel.text(tel),self.timeCaculate(),self.sendAgainBtn.click(function(){self.model.sendMsgAgain()}),self.submit.click(function(){self.checkMsgCode(self.msgCode.val())}),$(window).trigger("resize")},cancel:function(){},close:function(){self.$el.find(".J_travel_coupon").val(0).trigger("blur"),needReCheck&&self.model.clearCheckInfo()}})}else if(2==flag)var tip="为了您的账户和旅游券安全，使用旅游券需通过所属会员手机号码校验。您已达到今日验证码发送次数上限，如有疑问请拨打4007-999-999联系客服咨询",layerIndex=tools.layer({msg:tip,icon:2,yes:function(){self.$el.find(".J_travel_coupon").val(0),layer.close(layerIndex)},close:function(){self.$el.find(".J_travel_coupon").val(0),layer.close(layerIndex)}})},timeCaculate:function(){var self=this;self.sendAgainBtn.attr("disabled",!0),self.sendAgainBtn.addClass("disabled"),clearInterval(self.timeCountId),self.timeCountId=setInterval(function(){self.sendAgainBtn.attr("value",self.timeCount+"秒后重新发送"),self.timeCount--,self.timeCount<1&&(clearInterval(self.timeCountId),self.timeCount=60,self.sendAgainBtn.attr("value","重新发送验证码"),self.sendAgainBtn.attr("disabled",!1),self.sendAgainBtn.removeClass("disabled"))},1e3)},checkMsgCode:function(codeValue){return codeValue?void this.model.checkMsgCode(codeValue):void this.checkFailShowMsg("验证码不能为空")},checkFailShowMsg:function(msg){this.showErrorMsg.text(msg)},addPromotionCode:function(){var ele=this.$el.find(".coupon_add_inp");this.model.addPromotionCode(ele.val())},openCharge:function(){var dialogWrap,self=this;this.dialog=$.layer({title:"旅游券充值",type:1,page:{html:DialogRender({})},btns:2,btn:["确定","取消"],area:["420px","285px"],success:function(ele){dialogWrap=ele,dialogWrap.addClass("travel_charge_dialog").find(".ord_form_input").placeholder({placeholderSelector:".ord_form_placeholder"}),$(window).trigger("resize")},yes:function(index){self.model.charge(dialogWrap.find(".J_TravelID").val(),dialogWrap.find(".J_TravelPwd").val())},end:function(){dialogWrap=null}}),$(window).trigger("resize")},closeDialog:function(){layer.close(this.dialog),this.dialog=null},chargeError:function(){this.showError("旅游券充值失败, 请重试")},chargeTooOffen:function(){this.showError("输入错误超过3次，请10分钟后重试")},chargePromotionCodeError:function(data){var msg="旅游券充值失败, 请重试";data.msg&&(msg=data.msg),this.showError(msg)},validateError:function(errType){this.showError(ErrMsgMap[errType])},showError:function(msg){tools.layer({msg:msg})},needLogin:function(){eventBus.trigger("openLogin")},chargePromotionCodeSuccess:function(){var msg="添加成功";tools.layer({msg:msg,icon:0,time:2})},bindCards:function(){var isLogin=Login.status;isLogin?this.model.getCardsData():this.model.needLogin()},openAddressList:function(){var isLogin=Login.status;isLogin?eventBus.trigger("openListAddress"):this.model.needLogin()},renderBindsCards:function(data){var self=this,html=favourableBindCardsTpl(data);$(".xubox_setwin").off("click");var bindCardsLayer=$.layer({type:1,title:!1,fix:!1,border:[10,.3,"#000"],shadeClose:!0,closeBtn:[0,!0],area:["700px","316px"],page:{html:html}});this.model.set("bindCardsLayer",bindCardsLayer),$("#J_select_type").off("change"),$("#J_select_type").on("change",function(){var membcard_type_pic_cur=$("#J_select_type").find("option:selected").attr("membcard_type_pic");$("img#membcard_type_pic").attr("src",membcard_type_pic_cur),self.checkAndSetBindBtn()}),$("#J_card_num").off("input"),$("#J_card_num").on("input",function(){$("#j_err_card").text(""),self.checkAndSetBindBtn()}),$("#J_bind_cards_btn").off("click"),$("#J_bind_cards_btn").on("click",function(){self.submitBindCards()}),$(".xubox_setwin").click(function(){layer.close(bindCardsLayer)})},checkAndSetBindBtn:function(){$("#J_select_type").find("option:selected").val()>0&&""!=$("#J_card_num").val()?$("a.yes").eq(0).addClass("yes_done"):$("a.yes").eq(0).removeClass("yes_done")},showBindErrorMsg:function(data){$("#j_err_card").text(data)},submitBindCards:function(){var selectd_type=$("#J_select_type").val(),selectd_name=$("#J_select_type").find("option:selected").text(),card_num=$("#J_card_num").val(),reg=/^[0-9]*$/;if(selectd_type<=0)return this.showBindErrorMsg("请选择所要绑定的合作卡类型"),!1;if(!card_num)return this.showBindErrorMsg("请输入合作卡卡号"),!1;if(!reg.test(card_num))return this.showBindErrorMsg("请输入正确格式的合作卡卡号"),!1;var sendData={};sendData.membertype=selectd_type,sendData.membertext=selectd_name,sendData.membercode=card_num,this.model.postBindCardsData(sendData)},showBindCardsSuccess:function(){var index=this.model.get("bindCardsLayer");layer.close(index)},showBindCardsErr:function(data){var index=this.model.get("bindCardsLayer");layer.close(index);var errMsg="绑定失败，请稍候重试";switch(data){case 1:errMsg="绑定成功";break;case 2:errMsg="没有选择合作卡类型";break;case 3:errMsg="没有填写合作卡号";break;case 4:errMsg="您的卡类型非法，请刷新后重新选择";break;case 5:errMsg="您的卡号不存在";break;case 6:errMsg="您输入的卡号和类型不匹配，请重新选择";break;case 7:errMsg="您输入的卡号已经激活，无需再次激活";break;case 8:errMsg="绑定失败";break;default:errMsg="出现异常，请稍后重试"}$(".xubox_setwin").off("click");var err_layer=layer.alert(errMsg,3,!1);$(".xubox_setwin").on("click",function(){layer.close(err_layer)})},changeAddress:function(){var addObj=this.model.get("defaultAddress"),addressTemp=this.$el.find(".dev-address"),changeAddressBtn=this.$el.find("#J_change_address");addressTemp.text(addObj.user_name+" "+addObj.tel+" "+addObj.provinceName+addObj.cityName+addObj.address),addressTemp.parents(".list_row").hasClass("hide")&&(addressTemp.parents(".list_row").removeClass("hide"),changeAddressBtn.text("更改地址"),this.$el.find(".dev-address-notice").hide())},hideAddress:function(){var addressTemp=this.$el.find(".dev-address"),changeAddressBtn=this.$el.find("#J_change_address");changeAddressBtn.text("赠送配送地址"),addressTemp.text(""),this.$el.find(".dev-address-notice").show()},hideLastBorder:function(){var el=this.$el;el.find(".bottom_row").length||el.find(".list li").filter(":visible").filter(":last").addClass("no-border")}});return FavourableView}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,$out=($utils.$helpers,"");return $out+='<div class="charge_dialog charge_dialog_travel">\r\n    <div class="charge_dialog_box">\r\n        <div class="ord_form">\r\n            <table>\r\n                <tr class="ord_form_row">\r\n                    <td class="ord_form_col_label"><strong>*</strong>请输入旅游券号：</td>\r\n                    <td class="ord_form_col_input">\r\n                        <div class="ord_form_input">\r\n                            <div class="ord_form_placeholder">旅游券号</div>\r\n                            <input class="J_TravelID ord_form_ctrl_input" type="text" name="voucherID"/></div>\r\n                    </td>\r\n                    <td class="ord_form_error"></td>\r\n                </tr>\r\n                <tr class="ord_form_row">\r\n                    <td class="ord_form_col_label"><strong>*</strong>旅游券密码：</td>\r\n                    <td class="ord_form_col_input">\r\n                        <div class="ord_form_input">\r\n                            <div class="ord_form_placeholder">旅游券密码</div>\r\n                            <input class="J_TravelPwd ord_form_ctrl_input" type="text" name="voucherPwd"/></div>\r\n                    </td>\r\n                    <td class="ord_form_error"></td>\r\n                </tr>\r\n                <tr class="ord_form_row ord_form_row_tip">\r\n                    <td colspan="3">\r\n                        <div class="charge_dialog_tip">旅游券一经充值,将只能在该会员帐户消费途牛旅游网产品时使用，无法进行转移、赠送、退还等其他操作</div>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n        </div>\r\n    </div>\r\n</div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,blackCardPromotion=($utils.$helpers,$data.blackCardPromotion),_=$data._,hasResourcesDetail=($data.item,$data.index,$data.len,$data.hasResourcesDetail),$escape=$utils.$escape,$string=$utils.$string,helperProductCalendarPrice=$data.helperProductCalendarPrice,globalPromotion=$data.globalPromotion,promotionCode=$data.promotionCode,promotionCodeData=$data.promotionCodeData,helperPromotionCodeInfo=$data.helperPromotionCodeInfo,proPromotion=$data.proPromotion,showPromotionCodeTitle=$data.showPromotionCodeTitle,i=$data.i,onePromotionCode=$data.onePromotionCode,promotionTitleFlag=$data.promotionTitleFlag,oneProPromotion=$data.oneProPromotion,last=$data.last,isLogin=$data.isLogin,returnCash=$data.returnCash,promotionReturnMoneyTitleFlag=$data.promotionReturnMoneyTitleFlag,onePromotionReturnMoney=$data.onePromotionReturnMoney,resPromotion=$data.resPromotion,oneType=$data.oneType,oneResTypePromotion=$data.oneResTypePromotion,oneResPromotionInfo=$data.oneResPromotionInfo,helperResourceCalendarPrice=$data.helperResourceCalendarPrice,couponPromotion=$data.couponPromotion,oneCouponTypePromotion=$data.oneCouponTypePromotion,titleHide=$data.titleHide,couponDetailInfo=$data.couponDetailInfo,cannotIndex=$data.cannotIndex,usedListInfo=$data.usedListInfo,cardsPromotion=$data.cardsPromotion,k=$data.k,returnCoupon=$data.returnCoupon,returnCouponTitleFlag=$data.returnCouponTitleFlag,rk=$data.rk,oneReturnCoupon=$data.oneReturnCoupon,companyPrivilege=$data.companyPrivilege,companyPrivilegeFlag=$data.companyPrivilegeFlag,ck=$data.ck,oneCompanyPrivilege=$data.oneCompanyPrivilege,promotionFreeGifts=$data.promotionFreeGifts,defaultAddress=$data.defaultAddress,tourListInfo=$data.tourListInfo,showTourListInfo=$data.showTourListInfo,oneTourInfo=$data.oneTourInfo,$out="";if($out+='<h2>\r\n    <span class="icon favourable-icon"></span>\r\n    <span class="m-title">优惠方案</span>\r\n    <span class="m-title-desc"></span>\r\n</h2>\r\n<div class="modular-body">\r\n    <ul class="list J_list">\r\n        ',$out+="\r\n        ",blackCardPromotion&&!_.isEmpty(blackCardPromotion.data)&&($out+="\r\n            ",_.each(blackCardPromotion.data,function(item,index){var len=blackCardPromotion.data.length,hasResourcesDetail=item.web_html;$out+='\r\n            <li class="list_row ',index!=len-1&&($out+=" no-border "),$out+=" ",0==item.enable&&($out+=$escape("disable")),$out+='">\r\n                <span class="col1">',0==index&&($out+=$escape(blackCardPromotion.name)),$out+='</span>\r\n                <span class="col2">\r\n                    <span class="detail-wrapper f-active-color ',hasResourcesDetail||($out+="no-cursor"),$out+='">\r\n                        ',$out+=$escape(item.name),$out+="\r\n                        ",hasResourcesDetail&&($out+='\r\n                        <div class="resources-detail">\r\n                             <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                             <div class="resources">\r\n                                 <div class="resources-panel">\r\n                                     <div class="c9">',$out+=$string(item.web_html),$out+='</div>\r\n                                 </div>\r\n                             </div>\r\n                            <span class="icon white-triangle"></span>\r\n                            <div class="clear-float"></div>\r\n                        </div>\r\n                        '),$out+='\r\n                    </span>\r\n                </span>\r\n                <span class="col3">',$out+=$escape(helperProductCalendarPrice(item.reductions)),$out+='</span>\r\n                <span class="col4">\r\n                    <label class="input_checkbox ',1==item.selected&&($out+=$escape("enabled")),$out+=" ",0==item.enable&&($out+="forbidden"),$out+=' ">\r\n                        <span class="tn_fontface">&#xe618;</span>\r\n                    </label>\r\n                </span>\r\n            </li>\r\n           '}),$out+="\r\n        "),$out+="\r\n\r\n\r\n        ",$out+="\r\n\r\n        ",_.isEmpty(globalPromotion.data)||($out+="\r\n\r\n           ",_.each(globalPromotion.data,function(item,index){var len=globalPromotion.data.length,hasResourcesDetail=item.web_html;$out+='\r\n\r\n            <li class="list_row global-buy ',index!=len-1&&($out+=" no-border "),$out+=" ",0==item.enable&&($out+=$escape("disable")),$out+='">\r\n                <span class="col1">',0==index&&($out+=$escape(globalPromotion.name)),$out+='</span>\r\n                <span class="col2">\r\n                    <span class="detail-wrapper f-active-color ',hasResourcesDetail||($out+="no-cursor"),$out+='">\r\n                        ',$out+=$escape(item.name),$out+="\r\n                        ",hasResourcesDetail&&($out+='\r\n                        <div class="resources-detail">\r\n                             <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                             <div class="resources">\r\n                                 <div class="resources-panel">\r\n                                     <div class="c9">',$out+=$string(item.web_html),$out+='</div>\r\n                                 </div>\r\n                             </div>\r\n                            <span class="icon white-triangle"></span>\r\n                            <div class="clear-float"></div>\r\n                        </div>\r\n                        '),$out+='\r\n                    </span>\r\n                </span>\r\n                <span class="col3">',$out+=$escape(item.price),$out+='</span>\r\n                <span class="col4">\r\n                    <label class="input_checkbox ',1==item.selected&&($out+=$escape("enabled")),$out+=" ",0==item.enable&&($out+="forbidden"),$out+=' ">\r\n                        <span class="tn_fontface">&#xe618;</span>\r\n                    </label>\r\n                </span>\r\n            </li>\r\n\r\n           '}),$out+="\r\n        "),$out+="\r\n\r\n        ",$out+="\r\n        ",promotionCode){var promotionCodeData=helperPromotionCodeInfo(proPromotion),showPromotionCodeTitle=0;if($out+="\r\n        ",promotionCode.isLogin){if($out+="\r\n        ",promotionCodeData&&promotionCodeData.length){showPromotionCodeTitle=1;for(var i=0;i<promotionCodeData.length;i++){var onePromotionCode=promotionCodeData[i],hasResourcesDetail=!!onePromotionCode.web_html;$out+='\r\n        <li class="list_row no-border ',0==onePromotionCode.enable&&($out+=$escape("disable")),$out+='">\r\n            <span class="col1">',0==i&&($out+=$escape(promotionCode.name)),$out+='</span>\r\n            <span class="col2">\r\n                <span class="detail-wrapper f-active-color ',hasResourcesDetail||($out+="no-cursor"),$out+='">\r\n                    ',$out+=$escape(onePromotionCode.name),$out+="\r\n                    ",hasResourcesDetail&&($out+='\r\n                    <div class="resources-detail">\r\n                         <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                         <div class="resources">\r\n                             <div class="resources-panel">\r\n                                 <div class="c9">',$out+=$string(onePromotionCode.web_html),$out+='</div>\r\n                             </div>\r\n                         </div>\r\n                        <span class="icon white-triangle"></span>\r\n                        <div class="clear-float"></div>\r\n                    </div>\r\n                    '),$out+='\r\n                </span>\r\n            </span>\r\n            <span class="col3">',$out+=$escape(helperProductCalendarPrice(onePromotionCode.reductions)),$out+='</span>\r\n            <span class="col4">\r\n                <label class="input_checkbox ',1==onePromotionCode.selected&&($out+=$escape("enabled")),$out+=" ",0==onePromotionCode.enable&&($out+="forbidden"),$out+=' ">\r\n                    <span class="tn_fontface">&#xe618;</span>\r\n                </label>\r\n            </span>\r\n        </li>\r\n        '}}$out+="\r\n        ",$out+='\r\n        <li class="list_coupon_form">\r\n            <span class="col1">',0==showPromotionCodeTitle&&($out+=$escape(promotionCode.name)),$out+='</span>\r\n            <span class="col2 coupon_add_form">\r\n                    <input class="coupon_add_inp" type="text" placeholder="请输入优惠券券号" />\r\n                    <a class="coupon_add_btn J_addPromotionCode" href="javascript:;">添加</a>\r\n                </span>\r\n        </li>\r\n\r\n        '}else showPromotionCodeTitle=1,$out+='\r\n        <li class="list_coupon_form">\r\n            <span class="col1">',$out+=$escape(promotionCode.name),$out+='</span>\r\n            <span class="col2 coupon_unlogin_tip">如果您有优惠券号或者账户中已绑定了优惠券，请<a class="coupon_login_btn J_LoginBtn" href="javascript:;">登录</a>后使用</span>\r\n        </li>\r\n        ';$out+="\r\n        </li>\r\n        "}if($out+="\r\n\r\n        ",$out+="\r\n        ",proPromotion){for(var promotionTitleFlag=0,i=0;i<proPromotion.data.length;i++){var oneProPromotion=proPromotion.data[i],hasResourcesDetail=!!oneProPromotion.web_html,last=i==proPromotion.data.length-1;21!=oneProPromotion.type&&($out+='\r\n        <li class="list_row ',0==oneProPromotion.enable&&($out+=$escape("disable")),$out+=" ",last||($out+="no-border"),$out+='">\r\n            <span class="col1">',0==promotionTitleFlag&&(promotionTitleFlag=1,$out+=$escape(proPromotion.name)),$out+='</span>\r\n            <span class="col2">\r\n                <span class="detail-wrapper f-active-color ',hasResourcesDetail||($out+="no-cursor"),$out+='">\r\n                    ',$out+=$escape(oneProPromotion.name),$out+="\r\n                    ",hasResourcesDetail&&($out+='\r\n                    <div class="resources-detail">\r\n                         <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                         <div class="resources">\r\n                             <div class="resources-panel">\r\n                                 <div class="c9">',
$out+=$string(oneProPromotion.web_html),$out+='</div>\r\n                             </div>\r\n                         </div>\r\n                        <span class="icon white-triangle"></span>\r\n                        <div class="clear-float"></div>\r\n                    </div>\r\n                    '),$out+='\r\n                </span>\r\n            </span>\r\n            <span class="col3">',$out+=$escape(helperProductCalendarPrice(oneProPromotion.reductions)),$out+='</span>\r\n            <span class="col4">\r\n                <label class="input_checkbox ',1==oneProPromotion.selected&&($out+=$escape("enabled")),$out+=" ",0==oneProPromotion.enable&&($out+="forbidden"),$out+=' ">\r\n                    <span class="tn_fontface">&#xe618;</span>\r\n                </label>\r\n            </span>\r\n            ',1!==oneProPromotion.selected||1!==oneProPromotion.need_user||isLogin||($out+='\r\n            <div class="list_detail current_list_detail">\r\n                <span class="j">◆</span>\r\n                <span class="k">◆</span>\r\n                <p>登录用户才能参加活动，<a href="javascript:;" class="J_LoginBtn">登录</a>或<a href="http://www.tuniu.com/u/register">注册</a></p>\r\n            </div>\r\n            '),$out+="\r\n        </li>\r\n\r\n        ")}$out+="\r\n        "}if($out+="\r\n\r\n        ",$out+="\r\n        ",returnCash){for(var promotionReturnMoneyTitleFlag=0,i=0;i<returnCash.data.length;i++){var onePromotionReturnMoney=returnCash.data[i],hasResourcesDetail=!!onePromotionReturnMoney.web_html,last=i==returnCash.data.length-1;$out+='\r\n        <li class="list_row ',0==onePromotionReturnMoney.enable&&($out+=$escape("disable")),$out+=" ",last||($out+="no-border"),$out+='">\r\n            <span class="col1">',0==promotionReturnMoneyTitleFlag&&(promotionReturnMoneyTitleFlag=1,$out+=$escape(returnCash.name)),$out+='</span>\r\n            <span class="col2">\r\n                <span class="detail-wrapper f-active-color ',hasResourcesDetail||($out+="no-cursor"),$out+='">\r\n                    ',$out+=$escape(onePromotionReturnMoney.name),$out+="\r\n                    ",hasResourcesDetail&&($out+='\r\n                    <div class="resources-detail">\r\n                         <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                         <div class="resources">\r\n                             <div class="resources-panel">\r\n                                <div class="c9">',$out+=$string(onePromotionReturnMoney.web_html),$out+='</div>\r\n                             </div>\r\n                         </div>\r\n                        <span class="icon white-triangle"></span>\r\n                        <div class="clear-float"></div>\r\n                    </div>\r\n                    '),$out+='\r\n                </span>\r\n            </span>\r\n            <span class="col3 jtxz-detail-hover returnCash">\r\n                返￥',$out+=$escape(onePromotionReturnMoney.promotionReturnMoney.returnAmount),$out+='\r\n                <i class="icon notice2-icon"></i>\r\n                <div class="jtxz-detail2 T_width2" style="width: 318px">                    \r\n                    <p class="YD_mgb">   \r\n                       ',$out+=$escape(onePromotionReturnMoney.promotionReturnMoney.returnTravelBackDaysDesc),$out+='\r\n                    </p>\r\n                    <p class="YD_mgb cashAccountUrl" style="color: #999">\r\n                        查看方式:会员首页>我的资产><a href="',$out+=$escape(onePromotionReturnMoney.promotionReturnMoney.cashAccountUrl),$out+='" style="color:#22c233">现金账户</a>\r\n                    </p>                                                  \r\n                    <span class="z">◆</span>\r\n                    <span class="j">◆</span>\r\n                </div>\r\n            </span>\r\n            <span class="col4">\r\n                <label class="input_checkbox ',1==onePromotionReturnMoney.selected&&($out+=$escape("enabled")),$out+=" ",0==onePromotionReturnMoney.enable&&($out+="forbidden"),$out+=' ">\r\n                    <span class="tn_fontface">&#xe618;</span>\r\n                </label>\r\n            </span>\r\n            ',1!==onePromotionReturnMoney.selected||1!==onePromotionReturnMoney.need_user||isLogin||($out+='\r\n            <div class="list_detail current_list_detail">\r\n                <span class="j">◆</span>\r\n                <span class="k">◆</span>\r\n                <p>登录用户才能参加活动，<a href="javascript:;" class="J_LoginBtn">登录</a>或<a href="http://www.tuniu.com/u/register">注册</a></p>\r\n            </div>\r\n            '),$out+="\r\n        </li>\r\n\r\n        "}$out+="\r\n        "}if($out+="\r\n\r\n        ",$out+="\r\n        ",resPromotion){$out+="\r\n        ";for(var oneType=0;oneType<resPromotion.length;oneType++){$out+="\r\n        ";var oneResTypePromotion=resPromotion[oneType];$out+="\r\n        ";for(var i=0;i<oneResTypePromotion.data.length;i++){$out+="\r\n        ";var oneResPromotionInfo=oneResTypePromotion.data[i],hasResourcesDetail=!!oneResPromotionInfo.webShow,last=i==oneResTypePromotion.data.length-1;$out+='\r\n        <li class="list_row ',0==oneResPromotionInfo.enable&&($out+=$escape("disable")),$out+=" ",last||($out+="no-border"),$out+='">\r\n            <span class="col1">',0==i&&($out+=$escape(oneResTypePromotion.name)),$out+='</span>\r\n            <span class="col2">\r\n                <span class="detail-wrapper f-active-color ',hasResourcesDetail||($out+="no-cursor"),$out+='">\r\n                    ',$out+=$escape(oneResPromotionInfo.psName),$out+="\r\n                    ",hasResourcesDetail&&($out+='\r\n                    <div class="resources-detail">\r\n                         <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                         <div class="resources">\r\n                             <div class="resources-panel">\r\n                                 <div class="c9">',$out+=$escape(oneResPromotionInfo.webShow),$out+='</div>\r\n                             </div>\r\n                         </div>\r\n                        <span class="icon white-triangle"></span>\r\n                        <div class="clear-float"></div>\r\n                    </div>\r\n                    '),$out+='\r\n                </span>\r\n            </span>\r\n            <span class="col3">\r\n                ',$out+=$escape(helperResourceCalendarPrice(oneResPromotionInfo.pfResults)),$out+='\r\n            </span>\r\n            <span class="col4">\r\n            <label class="input_checkbox ',1==oneResPromotionInfo.selected&&($out+=$escape("enabled")),$out+=" ",0==oneResPromotionInfo.enable&&($out+="forbidden"),$out+='">\r\n                <span class="tn_fontface">&#xe618;</span>\r\n            </label>\r\n        </span>\r\n        </li>\r\n        '}$out+="\r\n        "}$out+="\r\n        "}if($out+="\r\n        ",$out+="\r\n        ",couponPromotion){$out+="\r\n        ";for(var oneType=0;oneType<couponPromotion.length;oneType++){$out+="\r\n        ";var oneCouponTypePromotion=couponPromotion[oneType],last=oneType==couponPromotion.length-1;if($out+="\r\n        ",$out+="\r\n        ",0==oneType){if($out+='\r\n        <li class="list_row ',0==oneCouponTypePromotion.data.enable&&($out+=$escape("disable")),$out+=" ",1==oneCouponTypePromotion.data.hide){var titleHide=1;$out+=$escape("hide")}$out+=" ",last||($out+="no-border"),$out+='">\r\n            <span class="col1">通用优惠</span>\r\n            <span class="col2">\r\n                <span class="detail-wrapper f-active-color">\r\n                    ',$out+=$escape(oneCouponTypePromotion.name),$out+='\r\n                    <div class="resources-detail">\r\n                         <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                         <div class="resources">\r\n                             <div class="resources-panel">\r\n                                 <div class="c9">途牛五星会员享受任意时间预订产品时抵用券双倍使用特权。<a href="http://www.tuniu.com/static/yh/" target="_blank">什么是抵用劵?</a></div>\r\n                             </div>\r\n                         </div>\r\n                        <span class="icon white-triangle"></span>\r\n                        <div class="clear-float"></div>\r\n                    </div>\r\n                </span>\r\n            </span>\r\n            <span class="col3">￥',$out+=$escape(oneCouponTypePromotion.data.data),$out+='</span>\r\n            <span class="col4">\r\n                <label class="input_checkbox ',1==oneCouponTypePromotion.data.selected&&($out+=$escape("enabled")),$out+=" ",0==oneCouponTypePromotion.data.enable&&($out+="forbidden"),$out+='">\r\n                    <span class="tn_fontface">&#xe618;</span>\r\n                </label>\r\n            </span>\r\n            ',1!==oneCouponTypePromotion.data.selected||isLogin||($out+='\r\n            <div class="list_detail">\r\n                <span class="j"></span>\r\n                <span class="k"></span>\r\n                <p>登录用户才能参加活动，<a href="javascript:;" class="J_LoginBtn">登录</a>或<a href="http://www.tuniu.com/u/register">注册</a></p>\r\n            </div>\r\n            '),$out+="\r\n        </li>\r\n        "}else{$out+="\r\n        ",$out+="\r\n        ";var couponDetailInfo=oneCouponTypePromotion.data,hasResourcesDetail=!!couponDetailInfo.orderCannotUsedList;if($out+='\r\n        <li class="list_row coupon_row T_tour_coupon ',last||($out+="no-border"),$out+='">\r\n            <span class="col1">',1==titleHide&&($out+="券类优惠"),$out+='</span>\r\n            <span class="col2">\r\n                <span class="detail-wrapper f-active-color ',hasResourcesDetail||($out+="no-cursor"),$out+='">\r\n                    ',$out+=$escape(oneCouponTypePromotion.name),$out+=" 账户总余额：￥",$out+=$escape(couponDetailInfo.accountBalance||0),$out+="，",$out+=$escape(couponDetailInfo.orderUsedValue?"已使用：¥"+couponDetailInfo.orderUsedValue:"本次可用：¥"+(couponDetailInfo.orderCanUsedValue||0)),$out+="\r\n                    ",hasResourcesDetail){if($out+='\r\n                    <div class="resources-detail">\r\n                         <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                         <div class="resources">\r\n                             <div class="resources-panel">\r\n                                 <div class="c9">\r\n                                    <div class="coupon_detail">\r\n                                 <p>',couponDetailInfo.orderCannotUsedList.length&&($out+="当前订单限制使用的旅游券明细 "),$out+='<a href="javascript:void(0)" class="fr J_tavelPromotionCharge">充值</a></p>\r\n                                     ',couponDetailInfo.orderCannotUsedList.length){$out+='\r\n                                     <table class="mt10">\r\n                                    <thead>\r\n                                    <tr>\r\n                                        <td>旅游券编号</td>\r\n                                        <td>面额</td>\r\n                                        <td>有效日期</td>\r\n                                        <td>余额</td>\r\n                                        <td>限制使用原因</td>\r\n                                    </tr>\r\n                                    </thead>\r\n                                    <tbody>\r\n                                    ';for(var cannotIndex=0;cannotIndex<couponDetailInfo.orderCannotUsedList.length;cannotIndex++){$out+="\r\n                                    ";var usedListInfo=couponDetailInfo.orderCannotUsedList[cannotIndex];$out+="\r\n                                    <tr>\r\n                                        <td>",$out+=$escape(usedListInfo.travelCouponId),$out+="</td>\r\n                                        <td>￥",$out+=$escape(usedListInfo.price),$out+="</td>\r\n                                        <td>",$out+=$escape(usedListInfo.overTime.substr(0,10)),$out+="</td>\r\n                                        <td>￥",$out+=$escape(usedListInfo.leftPrice),$out+="</td>\r\n                                        <td>",$out+=$escape(usedListInfo.cannotUsedReason),$out+="</td>\r\n                                    </tr>\r\n                                    "}$out+="\r\n                                    </tbody>\r\n                                </table>\r\n                                     "}$out+='\r\n                                     <p class="mt10 note">旅游券等同于现金使用，可直接抵扣订单金额。<a href="http://www.tuniu.com/static/yh/" target="_blank">更多详情&gt;</a></p>\r\n                             </div>\r\n                                </div>\r\n                             </div>\r\n                         </div>\r\n                        <span class="icon white-triangle"></span>\r\n                        <div class="clear-float"></div>\r\n                    </div>\r\n                    '}$out+='\r\n                </span>\r\n            </span>\r\n            <span class="col3"><label>本次使用：<input type="text" class="J_travel_coupon" value="',$out+=$escape(couponDetailInfo.useUsed),$out+='" placeholder="输入金额"></label></span>\r\n            <span class="col4"></span>\r\n        </li>\r\n        '}$out+="\r\n        "}$out+="\r\n        "}if($out+="\r\n        ",cardsPromotion&&cardsPromotion.data&&cardsPromotion.data.length){$out+="\r\n        ";for(var k in cardsPromotion.data)$out+='\r\n        <li class="list_row no-border ',0==cardsPromotion.data[k].enable&&($out+=$escape("disable")),$out+='">\r\n            <span class="col1">',0==k&&($out+="合作卡"),$out+='</span>\r\n            <span class="col2">\r\n                <span class="detail-wrapper f-active-color">\r\n                    ',$out+=$escape(cardsPromotion.data[k].name),$out+='\r\n                    <div class="resources-detail">\r\n                         <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                         <div class="resources">\r\n                             <div class="resources-panel">\r\n                                 <div class="c9">',$out+=$string(cardsPromotion.data[k].web_html),$out+='</div>\r\n                             </div>\r\n                         </div>\r\n                        <span class="icon white-triangle"></span>\r\n                        <div class="clear-float"></div>\r\n                    </div>\r\n                </span>\r\n            </span>\r\n            <span class="col3">',$out+=$escape(helperProductCalendarPrice(cardsPromotion.data[k].reductions)),$out+='</span>\r\n            <span class="col4">\r\n                <label class="input_checkbox ',1==cardsPromotion.data[k].selected&&($out+=$escape("enabled")),$out+=" ",0==cardsPromotion.data[k].enable&&($out+="forbidden"),$out+='">\r\n                    <span class="tn_fontface">&#xe618;</span>\r\n                </label>\r\n            </span>\r\n        </li>\r\n        ';$out+='\r\n        <li class="list_row ">\r\n            <span class="col1"></span>\r\n            <span class="col2"><a class="bind-cards" id="J_bind_cards">绑定</a></span>\r\n            <span class="col3"></span>\r\n            <span class="col4"></span>\r\n        </li>\r\n        '}else $out+='\r\n        <li class="list_row coupon_row">\r\n            <span class="col1">合作卡</span>\r\n            <span class="col2"><a class="bind-cards" id="J_bind_cards">绑定</a></span>\r\n            <span class="col3"></span>\r\n            <span class="col4"></span>\r\n        </li>\r\n        ';if($out+="\r\n\r\n\r\n        ",$out+="\r\n        ",returnCoupon){$out+="\r\n        ";var returnCouponTitleFlag=0;$out+="\r\n        ";for(var rk in returnCoupon.data){$out+="\r\n        ";var oneReturnCoupon=returnCoupon.data[rk],hasResourcesDetail=!!oneReturnCoupon.web_html,last=rk==returnCoupon.data.length-1;$out+='\r\n\r\n        <li class="list_row ',oneReturnCoupon.needCheckFlag||($out+="noIndex"),$out+=" ",0==oneReturnCoupon.enable&&($out+=$escape("disable")),$out+=" ",last||($out+="no-border"),$out+='">\r\n            <span class="col1">',0==returnCouponTitleFlag&&(returnCouponTitleFlag=1,$out+="返券优惠"),$out+='</span>\r\n            <span class="col2">\r\n                <span class="detail-wrapper f-active-color ',hasResourcesDetail||($out+="no-cursor"),$out+='">\r\n                    ',$out+=$escape(oneReturnCoupon.name),$out+="\r\n                    ",hasResourcesDetail&&($out+='\r\n                    <div class="resources-detail">\r\n                         <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                         <div class="resources">\r\n                             <div class="resources-panel">\r\n                                 <div class="c9">',$out+=$string(oneReturnCoupon.web_html),$out+='</div>\r\n                             </div>\r\n                         </div>\r\n                        <span class="icon white-triangle"></span>\r\n                        <div class="clear-float"></div>\r\n                    </div>\r\n                    '),$out+='\r\n                </span>\r\n            </span>\r\n            <span class="col3">\r\n                ',oneReturnCoupon.needCheckFlag||($out+="\r\n                ",$out+=$escape(helperProductCalendarPrice(oneReturnCoupon.reductions)),$out+="\r\n                "),$out+='\r\n            </span>\r\n            <span class="col4">\r\n                ',oneReturnCoupon.needCheckFlag&&($out+='\r\n                <label class="input_checkbox ',1==oneReturnCoupon.selected&&($out+=$escape("enabled")),$out+=" ",0==oneReturnCoupon.enable&&($out+="forbidden"),$out+='">\r\n                    <span class="tn_fontface">&#xe618;</span>\r\n                </label>\r\n                '),$out+="\r\n            </span>\r\n        </li>\r\n        "}$out+="\r\n        "}if($out+="\r\n\r\n        ",$out+="\r\n        ",companyPrivilege){$out+="\r\n        ";var companyPrivilegeFlag=0;$out+="\r\n        ";for(var ck in companyPrivilege.data){$out+="\r\n        ";var oneCompanyPrivilege=companyPrivilege.data[ck],hasResourcesDetail=!!oneCompanyPrivilege.web_html,last=ck==companyPrivilege.data.length-1;$out+='\r\n\r\n        <li class="list_row coupon_row noIndex ',last||($out+="no-border"),$out+='">\r\n            <span class="col1">',0==companyPrivilegeFlag&&(companyPrivilegeFlag=1,$out+=$escape(companyPrivilege.name)),$out+='</span>\r\n            <span class="col2">\r\n                <span class="detail-wrapper f-active-color ',hasResourcesDetail||($out+="no-cursor"),$out+='">\r\n                    ',$out+=$escape(oneCompanyPrivilege.name),$out+="\r\n                    ",hasResourcesDetail&&($out+='\r\n                    <div class="resources-detail">\r\n                         <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                         <div class="resources">\r\n                             <div class="resources-panel">\r\n                                 <div class="c9">',$out+=$string(oneCompanyPrivilege.web_html),$out+='</div>\r\n                             </div>\r\n                         </div>\r\n                        <span class="icon white-triangle"></span>\r\n                        <div class="clear-float"></div>\r\n                    </div>\r\n                    '),$out+='\r\n                </span>\r\n            </span>\r\n            <span class="col3">',$out+=$escape(helperProductCalendarPrice(oneCompanyPrivilege.reductions)),$out+='</span>\r\n            <span class="col4">\r\n                <label class="input_checkbox ',1==oneCompanyPrivilege.selected&&($out+=$escape("enabled")),$out+=" ",0==oneCompanyPrivilege.enable&&($out+="forbidden"),$out+='" data-type="companyPrivilege" data-id="',$out+=$escape(oneCompanyPrivilege.campaign_id),$out+='">\r\n                    <span class="tn_fontface">&#xe618;</span>\r\n                </label>\r\n            </span>\r\n        </li>\r\n        '}$out+="\r\n        "}if($out+="\r\n\r\n        ",$out+="\r\n        ",promotionFreeGifts&&promotionFreeGifts.data&&promotionFreeGifts.data.length&&($out+="\r\n        ",_.each(promotionFreeGifts.data,function(item,index){$out+='\r\n        <li class="list_row no-border ',0==item.enable&&($out+="disable"),$out+='">\r\n            <span class="col1">',0==index&&($out+=$escape(promotionFreeGifts.name)),$out+='</span>\r\n            <span class="col2">\r\n                <span class="detail-wrapper f-active-color">\r\n                    ',$out+=$escape(item.name),$out+='\r\n                    <div class="resources-detail">\r\n                         <div class="close-detail"><i class="icon close-icon"></i></div>\r\n                         <div class="resources">\r\n                             <div class="resources-panel">\r\n                                 <div class="c9">',$out+=$string(item.web_html),$out+='</div>\r\n                             </div>\r\n                         </div>\r\n                        <span class="icon white-triangle"></span>\r\n                        <div class="clear-float"></div>\r\n                    </div>\r\n                </span>\r\n            </span>\r\n            <span class="col3"></span>\r\n            <span class="col4">\r\n                <label class="input_checkbox',1==item.selected&&($out+=" enabled"),$out+=" ",0==item.enable&&($out+=" forbidden"),$out+='">\r\n                    <span class="tn_fontface">&#xe618;</span>\r\n                </label>\r\n            </span>\r\n        </li>\r\n        '}),$out+='\r\n        <li class="list_row',defaultAddress||($out+=" hide"),$out+='">\r\n            <span class="col1"></span>\r\n            <span class="dev-address">',defaultAddress&&($out+=$escape(defaultAddress.user_name+" "+defaultAddress.tel+" "+defaultAddress.provinceName+defaultAddress.cityName+defaultAddress.address)),$out+='</span>\r\n        </li>\r\n        <li class="list_row last-fan-zen">\r\n            <span class="col1"></span>\r\n            <span class="col2">\r\n                ',$out+=defaultAddress?'\r\n                <a class="bind-cards" id="J_change_address">更改地址</a>\r\n                ':'\r\n                <a class="bind-cards" id="J_change_address">赠送配送地址</a>\r\n                    <span class="dev-address-notice jtxz-detail-hover">\r\n                        <i class="icon notice2-icon"></i>\r\n                        <div class="jtxz-detail2 auto-width">\r\n                            <p class="YD_mgb">下单后您可以前往会员中心我的订单中添加寄送地址</p>\r\n                            <span class="z">◆</span>\r\n                            <span class="j">◆</span>\r\n                        </div>\r\n                    </span>\r\n                ',$out+="\r\n            </span>\r\n        </li>\r\n        "),$out+="\r\n\r\n        ",tourListInfo&&tourListInfo.length){$out+="\r\n        ";for(var showTourListInfo=0,i=0;i<tourListInfo.length;i++){var oneTourInfo=tourListInfo[i];if(2==oneTourInfo.type){showTourListInfo=1;break}}if(1==showTourListInfo){if($out+='\r\n        <li class="bottom_row ie">\r\n            <dl>\r\n                ',tourListInfo.length>0){$out+="\r\n                <dt>· <em>特殊人群优惠</em></dt>\r\n                ";for(var i=0;i<tourListInfo.length;i++){var oneTourInfo=tourListInfo[i];2==oneTourInfo.type&&($out+="\r\n                <dd>· <span>",$out+=$escape(oneTourInfo.name),$out+=" </span>",$out+=$escape(oneTourInfo.remark),$out+="<em> 优惠￥",$out+=$escape(oneTourInfo.price),$out+="/人</em></dd>\r\n                ")}}$out+="\r\n            </dl>\r\n        </li>\r\n        "}$out+="\r\n        "}return $out+="\r\n    </ul>\r\n</div>",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,type=($utils.$helpers,$data.type),$out="";return $out+='<div class="login_dialog coupon_dialog">\r\n    <div class="rc_common_trave_box nologin">\r\n        <div class="J_LoginLoading rcLoadingImg rcLoadingImg-1"></div>\r\n        <img src="http://img3.tuniucdn.com/img/20140922/bookOnline/loading-72x72.gif"\r\n             class="J_LoginLoading rcLoadingImg rcLoadingImg-2">\r\n        ',1==type&&($out+='\r\n        <p class="T-note">抱歉，页面操作时间过长，需重新进行验证</p>\r\n        '),$out+='\r\n        <p class="J_LoginError show_error"></p>\r\n        <dl class="rc_double_col rc_w_s clearfix">\r\n            <dt>会员手机号：</dt>\r\n            <dd class="J_user_tel"></dd>\r\n        </dl>\r\n        <dl class="rc_double_col rc_w_s clearfix">\r\n            <dt>短信验证码：</dt>\r\n            <dd>\r\n                <input type="text" tabindex="3" class="J_msg_code rc_common_input rc_small rcVerCode"><!-- 去除间隙\r\n                    --><input class="J_send_again rc_ableBtn" value="重新发送验证码" type="button">\r\n            </dd>\r\n        </dl>\r\n        <div class="login_submit">\r\n            <input class="J_submit rc_ableBtn" value="确定" type="button">\r\n        </div>\r\n        <dl class="rc_double_col rc_reg clearfix">\r\n            <dd>\r\n                为了您的账户和旅游券安全，请输入旅游券所属会员手机号码。\r\n                &nbsp;\r\n                如果原手机号码已变更，请先至\r\n                &nbsp;&nbsp;\r\n                <a href="http://www.tuniu.com/main.php?do=user_info_confirm" target="_blank" class="rc_g_color">会员资料页</a>\r\n                &nbsp;&nbsp;\r\n                更新手机号。\r\n            </dd>\r\n        </dl>\r\n    </div>\r\n</div>\r\n',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(14)],__WEBPACK_AMD_DEFINE_RESULT__=function($){function Placeholder(target,option){var options=$.extend({},DefaultOption,option),ctrlEle=$(target),inputEle=ctrlEle.find(options.inputSelector),placeholderEle=ctrlEle.find(options.placeholderSelector);this.options=options,this.ctrlEle=ctrlEle,this.inputEle=inputEle,this.placeholderEle=placeholderEle,this.init()}var DefaultOption={placeholderSelector:".form_placeholder",inputSelector:"input",hideOnFocus:!1};$.extend(Placeholder.prototype,{init:function(){var self=this,options=this.options,placeholderEle=this.placeholderEle,inputEle=this.inputEle;options.hideOnFocus&&(inputEle.on("focus",function(){placeholderEle.hide()}),inputEle.on("blur",$.proxy(self.checkState,self))),inputEle.on("change input",$.proxy(self.checkState,self)).on("propertychange",function(e){"value"===e.originalEvent.propertyName&&self.checkState()}),this.checkState()},checkState:function(){this.inputEle.val()?this.placeholderEle.hide():this.placeholderEle.show()},update:function(){this.checkState()},destroy:function(){this.options=null,this.ctrlEle=null,this.inputEle=null,this.placeholderEle=null}}),$.fn.placeholder=function(option){var arg=Array.prototype.slice.apply(arguments);return this.each(function(){var pluginObj=this.__placeholder;"string"==typeof option?pluginObj&&$.isFunction(pluginObj[option])&&pluginObj[option].apply(pluginObj,arg.slice(1)):pluginObj||(this.__placeholder=new Placeholder(this,option))})}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,k=($utils.$helpers,$data.k),data=$data.data,$escape=$utils.$escape,$out="";$out+='<div class="bind-cards-bar">\r\n    <p class="title_bg">添加合作卡</p>\r\n    <div class="content">\r\n        <aside>\r\n            <img class="imghezuokalogo" id="membcard_type_pic" src="http://img4.tuniucdn.com/img/20140606/user_login/card.jpg">\r\n        </aside>\r\n        <main>\r\n            <div class="type">\r\n                <span>类 型：</span>\r\n                <select id="J_select_type" class="select_type">\r\n                    <option class="card_num" value="0" membcard_type_pic="http://img4.tuniucdn.com/img/20140606/user_login/card.jpg">请选择合作卡类型</option>\r\n                    ';for(var k in data)$out+='\r\n                    <option class="card_num" value="',$out+=$escape(data[k].membcard_type_id),$out+='" membcard_type_pic="',$out+=$escape(data[k].membcard_type_pic),$out+='">',$out+=$escape(data[k].membcard_type_name),$out+="</option>\r\n                    ";return $out+='\r\n                </select>\r\n            </div>\r\n            <div class="num">\r\n                <span>会 籍 卡 号：</span>\r\n                <input class="card_num" class="textin" id="J_card_num">\r\n            </div>\r\n            <p id="j_err_card" style="color: red;"></p>\r\n            <a class="yes yellow_btn" href="javascript:void(0)" id="J_bind_cards_btn">完成</a>\r\n        </main>\r\n    </div>\r\n</div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(5),__webpack_require__(17),__webpack_require__(123),__webpack_require__(7),__webpack_require__(124),__webpack_require__(24)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,EventBus,Layer,deliveryAddressTemplate,Template,citys,Scroll){return Backbone.View.extend({el:"#m-float-delivery",events:{"mouseenter .delivery-address-item":"showHoverInfo","mouseleave .delivery-address-item":"hideHoverInfo","click .delivery-address-item":"selectDefaultAddress","click .cancel":"closePanel","click .book-close":"closePanel","click .confirm":"closePanel","click #J_resume_address":"resumeAddress","click #J_delete_address":"deleteAddress","click .delivery-address-add":"showAddPanel","click #canShowMore":"reSetMainHeight","blur #J_new_address_name":"valiName","blur #J_new_address_phone":"valiTel","blur #J_new_address_address":"valiAddress","focus #J_new_address_address":"addressFocus",
"change #J_new_address_province":"renderCity","click .address_add":"valiAll","click .address_cancel":"closeNewAddressPanel","click .no-default":"resetDefaultAddress"},initialize:function(){var self=this;this.listenTo(self.model,"render",this.render),$(window).resize(function(){self.resPosition()})},render:function(){var renderHtml=deliveryAddressTemplate(this.model.toJSON());this.$el.html(renderHtml),this.model.get("canShouMore")?this.$el.find(".delivery-main").css("max-height","none"):this.$el.find(".delivery-main").css("max-height","310px"),this.$el.show(),this.resPosition(),this.scrollObj=this.$el.find(".delivery-con").TScroll()},resPosition:function(){var $content=this.$el.find(".float-content"),mgTop=($(window).height()-$content.height())/2,mgLeft=($(window).width()-$content.width())/2;$content.css("top",mgTop+"px"),$content.css("left",mgLeft+"px")},showHoverInfo:function(e){var target=$(e.currentTarget);target.addClass("active")},hideHoverInfo:function(e){var target=$(e.currentTarget),index=target.data("index"),isSelected=this.model.isSelected(index);isSelected||target.removeClass("active")},selectDefaultAddress:function(e){var target=$(e.currentTarget),index=target.data("index");this.$el.find(".delivery-address-item").removeClass("active"),target.addClass("active"),this.model.resetSelectObj(index)},resetDefaultAddress:function(e){var target=$(e.currentTarget),index=target.data("index");this.$el.find(".is-default").removeClass("is-default").addClass("no-default").text("设为默认地址"),target.removeClass("no-default").addClass("is-default").text("默认地址"),this.model.resetDefaultAddress(index),e.stopPropagation()},deleteAddress:function(e){var target=$(e.currentTarget).parents(".delivery-address-item"),index=target.data("index"),item=this.model.get("list")[index];EventBus.trigger("deleteDevAddress",item.address_id,index),e.stopPropagation()},reSetMainHeight:function(e){var target=$(e.currentTarget);"更多地址"==target.text()?(target.find("span").text("收起"),this.model.set("canShouMore",!0),this.$el.find(".delivery-main").css("max-height","none")):(target.find("span").text("更多地址"),this.model.set("canShouMore",!1),this.$el.find(".delivery-main").css("max-height","310px")),this.resPosition()},showAddPanel:function(){this.model.set({isShowInput:!0}),this.$el.find(".receipt-new-address-form").show(),this.scrollObj.scrollY(this.$el.find(".receipt-new-address-form")),this.clearAddressInput(),this.resPosition()},valiName:function(e){var text=e?$(e.currentTarget).val().trim():this.$el.find("#J_new_address_name").val().trim();return text?(this.$el.find(".err_name").hide(),!0):(this.showErr("name"),!1)},valiTel:function(e){var tel=e?$(e.currentTarget).val().trim():this.$el.find("#J_new_address_phone").val().trim(),partten=/^1[3,5,7,8]\d{9}$/;return partten.test(tel)?(this.$el.find(".err_tel").hide(),!0):(this.showErr("tel"),!1)},valiAddress:function(e){var address=e?$(e.currentTarget).val().trim():this.$el.find("#J_new_address_address").val().trim();return address&&this.model.get("hasFocus")?(this.$el.find(".err_address").hide(),!0):(this.showErr("address"),!1)},valiProvince:function(){return this.$el.find("#J_new_address_province").val()&&this.$el.find("#J_new_address_city").val()?(this.$el.find(".err_province").hide(),!0):(this.showErr("province"),!1)},valiAll:function(e){var ver1=this.valiName(),ver2=this.valiTel(),ver3=this.valiAddress(),ver4=this.valiProvince(),needSaveOrUpadte=ver1&&ver2&&ver3&&ver4;if(needSaveOrUpadte){var baseObj={receiver_name:this.$el.find("#J_new_address_name").val().trim(),province:this.$el.find("#J_new_address_province option:selected").val().split("_")[1],provinceName:this.$el.find("#J_new_address_province option:selected").text(),city:this.$el.find("#J_new_address_city option:selected").val().split("_")[1],cityName:this.$el.find("#J_new_address_city option:selected").text(),address:this.$el.find("#J_new_address_address").val().trim(),tel_num:this.$el.find("#J_new_address_phone").val().trim()};this.model.get("updaterAddress")?(baseObj.addressId=this.model.get("updaterAddress").address_id,baseObj.isDefault=this.model.get("updaterAddress").isDefault,EventBus.trigger("updateDeliveryAddress",baseObj)):EventBus.trigger("saveDeliveryAddress",baseObj)}},addressFocus:function(e){var address=$(e.currentTarget).val().trim();this.model.set("hasFocus",!0),address.indexOf("不需要重复填写")!=-1?($(e.currentTarget).val(""),$(e.currentTarget).css("color","#000000")):$(e.currentTarget).css("color","#000000")},renderCity:function(e){var province=$(e.currentTarget).val();this.renderCitys(province)},renderCitys:function(p){var collCityObj=citys[p],html='<option selected="selected" value="">--市--</option>';for(var k in collCityObj)html+='<option value="'+collCityObj[k]+'">'+k+"</option>";this.$el.find("#J_new_address_city").html(html)},showErr:function(key){var err={name:"收件人必填",province:"请选择省市",city:"请选择省市",address:"详细地址必填",postCode:"收件人邮编不能为空",areaCode:"区号不能为空",tel:"请输入正确的手机号码"};this.$el.find(".err_"+key).html("<img src='http://ssl3.tuniucdn.com/img/201604072050/bookOnline/error.png'>"+err[key])},closeNewAddressPanel:function(){this.$el.find(".receipt-new-address-form").hide(),this.clearAddressInput(),this.model.reset(),this.resPosition()},resumeAddress:function(e){var i=$(e.currentTarget).data("index"),list=this.model.toJSON().list,updaterAddress=list[i],provinces=this.$el.find("#J_new_address_province option");this.$el.find(".receipt-new-address-form").show(),this.scrollObj.scrollY(this.$el.find(".receipt-new-address-form")),this.model.set({isShowInput:!0,updaterAddress:updaterAddress}),this.$el.find("#J_new_address_name").val(updaterAddress.user_name),this.$el.find("#J_new_address_phone").val(updaterAddress.tel),this.$el.find("#J_new_address_address").val(updaterAddress.address).css("color","#666666"),this.model.set("hasFocus",!0),_.each(provinces,function(item,index){$(item).text()==updaterAddress.provinceName&&$(item).attr("selected","selected").css("color","#666666")}),this.renderCitys(this.$el.find("#J_new_address_province").val());var renderCity=this.$el.find("#J_new_address_city option");_.each(renderCity,function(item,index){$(item).text()==updaterAddress.cityName&&$(item).attr("selected","selected").css("color","#666666")}),this.resPosition(),e.stopPropagation()},clearAddressInput:function(){this.$el.find(".receipt-new-address-form").find("input").val(""),this.$el.find(".receipt-new-address-form").find("textarea").val("不需要重复填写省市区，不小于5个字符，不超过120个字符。").css("color","#999"),this.$el.find("#J_new_address_province").find("option").eq(0).attr("selected",!0),this.$el.find("#J_new_address_city").find("option").eq(0).attr("selected",!0),this.$el.find(".err_tips").html()},openPanel:function(){},closePanel:function(e){var target=$(e.target),flag=target.hasClass("confirm");flag&&"order_detail"==pageDataObj.pageType&&this.setDefaultAddress(target),this.$el.hide(),this.model.reset()},setDefaultAddress:function(target){var receiveInfo,panelBox=target.parents(".float-content").find(".panel-box"),index=panelBox.children(".active").index(),promotionId=0;if("-1"==index)return!1;receiveInfo=this.model.selectedData(index),_.each(pageDataObj.giftOrderInfo.list,function(item){25==item.promotionTypeId&&(promotionId=item.promotionId)});var postData={orderId:pageDataObj.baseInfo.orderId,promotionIds:[promotionId],receiveProvinceCode:receiveInfo.provinceCode,receiveProvinceName:receiveInfo.provinceName,receiveCityCode:receiveInfo.cityCode,receiveCityName:receiveInfo.cityName,receiveDistrictCode:"",receiveDistrictName:"",receiveDetailAddress:receiveInfo.address,receiveTel:receiveInfo.tel,receiveName:receiveInfo.user_name,receivePostCode:""};EventBus.trigger("restOrderAddress",postData,receiveInfo)}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,_=($utils.$helpers,$data._),list=$data.list,$escape=($data.item,$data.index,$utils.$escape),canShouMore=$data.canShouMore,isShowInput=$data.isShowInput,$out="";return $out+='<div class="float-bg"></div>\r\n<div class="float-content">\r\n\t<header class="float-header">\r\n\t\t<h2 class="active">配送地址</h2>\r\n\t\t<span><i class="icon book-close"></i></span>\r\n\t</header>\r\n\r\n\t<div class="delivery-con">\r\n\t\t<div class="delivery-main">\r\n\t\t\t<div class="panel-box">\r\n\t\t\t\t',_.each(list,function(item,index){$out+='\r\n\t\t\t\t<div class="panel delivery-address-item ',item.selected&&($out+="active"),$out+='" data-index="',$out+=$escape(index),$out+='">\r\n\t\t\t\t\t<div class="panel-body">\r\n\t\t\t\t\t\t<p class="panel-title">',$out+=$escape(item.provinceName),$out+=" ",$out+=$escape(item.cityName),$out+="(",$out+=$escape(item.user_name),$out+=' 收)</p>\r\n\t\t\t\t\t\t<div class="panel-main">\r\n\t\t\t\t\t\t\t<p>',$out+=$escape(item.tel),$out+='</p>\r\n\t\t\t\t\t\t\t<p class="detail-add f-ol">',$out+=$escape(item.address),$out+='</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class="panel-footer">\r\n\t\t\t\t\t\t\t<div class="footer-left">\r\n\t\t\t\t\t\t\t\t<span class="edit" id="J_resume_address" data-index="',$out+=$escape(index),$out+='">修改</span>\r\n\t\t\t\t\t\t\t\t<span class="line"></span>\r\n\t\t\t\t\t\t\t\t<span id="J_delete_address" class="delete">删除</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class="footer-right">\r\n\t\t\t\t\t\t\t\t',item.isDefault?$out+='\r\n\t\t\t\t\t\t\t\t<span class="defaults-address is-default">默认地址</span>\r\n\t\t\t\t\t\t\t\t':($out+='\r\n\t\t\t\t\t\t\t\t<span class="defaults-address no-default" data-index="',$out+=$escape(index),$out+='">设为默认地址</span>\r\n\t\t\t\t\t\t\t\t'),$out+="\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t",item.selected&&($out+='\r\n\t\t\t\t\t\t<div class="user-selected"><img class="" src="//img3.tuniucdn.com/img/201510131901/bookOnline/user-selected.png" alt=""></div>\r\n\t\t\t\t\t\t'),$out+="\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t"}),$out+='\r\n\t\t\t\t<div class="panel delivery-address-add">\r\n\t\t\t\t\t<div class="panel-main"><img class="add-address" src="http://img3.tuniucdn.com/img/201510131901/bookOnline/add.png" alt=""></div>\r\n\t\t\t\t\t<div class="add-text">添加收货人信息</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="clear-float"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t',list&&list.length>=6&&($out+='\r\n\t\t<div class="click-to-more-address">\r\n\t\t\t',$out+=canShouMore?'\r\n\t\t\t<span id="canShowMore" class="moreAddress"><span>收起</span><i class="icon less-tourist-icon"></i></span>\r\n\t\t\t':'\r\n\t\t\t<span id="canShowMore" class="moreAddress"><span>更多地址</span><i class="icon more-tourist-icon"></i></span>\r\n\t\t\t',$out+="\r\n\t\t</div>\r\n\t\t"),$out+='\r\n\r\n\t\t<div class="receipt-new-address-form',isShowInput||($out+=" hide"),$out+='">\r\n\r\n\t\t\t<div>\r\n\t\t\t\t<span class="add-consignee-info">添加收货人信息</span>\r\n\t\t\t</div>\r\n\r\n\t\t\t<table>\r\n\t\t\t\t<tbody>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td class="receipt_info_title">收件人</td>\r\n\t\t\t\t\t<td>\r\n\t\t\t\t\t\t<input type="text" id="J_new_address_name" class="new_address_input" maxlength="10" placeholder="请输入收件人姓名" onfocus="this.placeholder=\'\'" onblur="this.placeholder=\'请输入收件人姓名\'">\r\n\t\t\t\t\t\t<span class="err_tips err_name"></span>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td class="receipt_info_title">手机号</td>\r\n\t\t\t\t\t<td>\r\n\t\t\t\t\t\t<input type="text" id="J_new_address_phone" class="new_address_input" placeholder="请输入收件人手机号码" onfocus="this.placeholder=\'\'" onblur="this.placeholder=\'请输入收件人手机号码\'">\r\n\t\t\t\t\t\t<span class="err_tips err_tel"></span>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td class="receipt_info_title">所在地区</td>\r\n\t\t\t\t\t<td>\r\n\t\t\t\t\t\t<select name="" id="J_new_address_province">\r\n\t\t\t\t\t\t\t<option selected="selected" value="">省</option>\r\n\t\t\t\t\t\t\t<option value="安徽_100">安徽</option>\r\n\t\t\t\t\t\t\t<option value="北京_200">北京</option>\r\n\t\t\t\t\t\t\t<option value="重庆_300">重庆</option>\r\n\t\t\t\t\t\t\t<option value="福建_400">福建</option>\r\n\t\t\t\t\t\t\t<option value="甘肃_500">甘肃</option>\r\n\t\t\t\t\t\t\t<option value="广东_600">广东</option>\r\n\t\t\t\t\t\t\t<option value="广西_700">广西</option>\r\n\t\t\t\t\t\t\t<option value="贵州_800">贵州</option>\r\n\t\t\t\t\t\t\t<option value="海南_900">海南</option>\r\n\t\t\t\t\t\t\t<option value="河北_1000">河北</option>\r\n\t\t\t\t\t\t\t<option value="黑龙江_1100">黑龙江</option>\r\n\t\t\t\t\t\t\t<option value="河南_1200">河南</option>\r\n\t\t\t\t\t\t\t<option value="香港_1300">香港</option>\r\n\t\t\t\t\t\t\t<option value="湖北_1400">湖北</option>\r\n\t\t\t\t\t\t\t<option value="湖南_1500">湖南</option>\r\n\t\t\t\t\t\t\t<option value="江苏_1600">江苏</option>\r\n\t\t\t\t\t\t\t<option value="江西_1700">江西</option>\r\n\t\t\t\t\t\t\t<option value="吉林_1800">吉林</option>\r\n\t\t\t\t\t\t\t<option value="辽宁_1900">辽宁</option>\r\n\t\t\t\t\t\t\t<option value="澳门_2000">澳门</option>\r\n\t\t\t\t\t\t\t<option value="内蒙古_2100">内蒙古</option>\r\n\t\t\t\t\t\t\t<option value="宁夏_2200">宁夏</option>\r\n\t\t\t\t\t\t\t<option value="青海_2300">青海</option>\r\n\t\t\t\t\t\t\t<option value="山东_2400">山东</option>\r\n\t\t\t\t\t\t\t<option value="上海_2500">上海</option>\r\n\t\t\t\t\t\t\t<option value="山西_2600">山西</option>\r\n\t\t\t\t\t\t\t<option value="陕西_2700">陕西</option>\r\n\t\t\t\t\t\t\t<option value="四川_2800">四川</option>\r\n\t\t\t\t\t\t\t<option value="台湾_2900">台湾</option>\r\n\t\t\t\t\t\t\t<option value="天津_3000">天津</option>\r\n\t\t\t\t\t\t\t<option value="新疆_3100">新疆</option>\r\n\t\t\t\t\t\t\t<option value="西藏_3200">西藏</option>\r\n\t\t\t\t\t\t\t<option value="云南_3300">云南</option>\r\n\t\t\t\t\t\t\t<option value="浙江_3400">浙江</option>\r\n\t\t\t\t\t\t\t<option value="欧洲_3600">欧洲</option>\r\n\t\t\t\t\t\t\t<option value="北美洲_3700">北美洲</option>\r\n\t\t\t\t\t\t\t<option value="南美洲_3800">南美洲</option>\r\n\t\t\t\t\t\t\t<option value="亚洲_3900">亚洲</option>\r\n\t\t\t\t\t\t\t<option value="非洲_4000">非洲</option>\r\n\t\t\t\t\t\t\t<option value="大洋洲_4100">大洋洲</option>\r\n\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t<select name="" id="J_new_address_city">\r\n\t\t\t\t\t\t\t<option selected="selected" value="">市</option>\r\n\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t<span class="err_tips err_city err_province"></span>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td class="receipt_info_title new_detailed_address">详细地址</td>\r\n\t\t\t\t\t<td>\r\n\t\t\t\t\t\t<textarea id="J_new_address_address" class="new_address_input detailed_address">不需要重复填写省市区，不小于5个字符，不超过120个字符</textarea>\r\n\t\t\t\t\t\t<span class="err_tips err_address control"></span>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td class="new_address_sub_title"></td>\r\n\t\t\t\t\t<td>\r\n\t\t\t\t\t\t<button class="btn address_add">保存</button>\r\n\t\t\t\t\t\t<button class="btn address_cancel">取消</button>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t</tbody>\r\n\t\t\t</table>\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<div class="add-btn">\r\n\t\t<button class="confirm">确认</button>\r\n\t\t<button class="cancel">取消</button>\r\n\t</div>\r\n</div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports){module.exports={"安徽_100":{"合肥":"合肥_102","芜湖":"芜湖_120","蚌埠":"蚌埠_104","淮南":"淮南_112","马鞍山":"马鞍山_116","淮北":"淮北_110","铜陵":"铜陵_118","安庆":"安庆_103","黄山":"黄山_113","滁州":"滁州_107","阜阳":"阜阳_108","宿州":"宿州_117","巢湖":"巢湖_106","六安":"六安_115","亳州":"亳州_105","池州":"池州_109","宣城":"宣城_121","屯溪":"屯溪_119","九华山":"九华山_114","其它":"其它_101"},"北京_200":{"东城":"东城_202","西城":"西城_203","崇文":"崇文_204","宣武":"宣武_205","朝阳":"朝阳_206","丰台":"丰台_207","石景山":"石景山_208","海淀":"海淀_209","门头沟":"门头沟_210","房山":"房山_211","通州":"通州_212","顺义":"顺义_213","昌平":"昌平_214","大兴":"大兴_215","平谷":"平谷_216","怀柔":"怀柔_217","密云":"密云_218","延庆":"延庆_219","其它":"其它_201"},"重庆_300":{"渝中":"渝中_304","大渡口":"大渡口_305","江北":"江北_306","沙坪坝":"沙坪坝_307","九龙坡":"九龙坡_308","南岸":"南岸_309","北碚":"北碚_310","万盛":"万盛_311","双挢":"双挢_312","渝北":"渝北_313","巴南":"巴南_314","万州":"万州_302","涪陵":"涪陵_303","黔江":"黔江_315","长寿":"长寿_316","綦江":"綦江_317","潼南":"潼南_318","铜梁":"铜梁_319","大足":"大足_320","荣昌":"荣昌_321","壁山":"壁山_322","垫江":"垫江_326","武隆":"武隆_327","丰都":"丰都_325","城口":"城口_324","梁平":"梁平_323","开县":"开县_329","云阳":"云阳_330","奉节":"奉节_331","巫山":"巫山_332","巫溪":"巫溪_333","忠县":"忠县_328","石柱":"石柱_334","秀山":"秀山_335","酉阳":"酉阳_336","彭水":"彭水_337","江津":"江津_338","合川":"合川_339","永川":"永川_340","南川":"南川_341","其它":"其它_301"},"福建_400":{"福州":"福州_402","厦门":"厦门_414","莆田":"莆田_407","三明":"三明_409","泉州":"泉州_408","漳州":"漳州_415","南平":"南平_405","龙岩":"龙岩_404","宁德":"宁德_406","武夷山":"武夷山_413","其它":"其它_401"},"甘肃_500":{"兰州":"兰州_502","金昌":"金昌_507","白银":"白银_503","天水":"天水_511","嘉峪关市":"嘉峪关市_516","武威":"武威_513","张掖":"张掖_515","平凉":"平凉_510","酒泉":"酒泉_508","庆阳":"庆阳_514","定西":"定西_504","陇南":"陇南_512","临夏":"临夏_509","甘南":"甘南_506","敦煌":"敦煌_505","其它":"其它_501"},"广东_600":{"广州":"广州_602","深圳":"深圳_619","珠海":"珠海_628","汕头":"汕头_616","韶关":"韶关_618","佛山":"佛山_607","江门":"江门_610","湛江":"湛江_625","茂名":"茂名_613","肇庆":"肇庆_626","惠州":"惠州_609","梅州":"梅州_614","汕尾":"汕尾_617","河源":"河源_608","阳江":"阳江_621","清远":"清远_615","东莞":"东莞_606","中山":"中山_627","潮州":"潮州_604","揭阳":"揭阳_611","云浮":"云浮_623","其它":"其它_601"},"广西_700":{"南宁":"南宁_702","柳州":"柳州_709","桂林":"桂林_705","梧州":"梧州_711","北海":"北海_704","防城港":"防城港_706","钦州":"钦州_710","贵港":"贵港_713","玉林":"玉林_712","百色":"百色_703","贺州":"贺州_708","河池":"河池_707","来宾":"来宾_714","崇左":"崇左_715","其它":"其它_701"},"贵州_800":{"贵阳":"贵阳_802","六盘水":"六盘水_807","遵义":"遵义_811","安顺":"安顺_803","铜仁":"铜仁_808","毕节":"毕节_804","黔南布依族苗族自治州":"黔南布依族苗族自治州_805","黔东南苗族侗族自治州":"黔东南苗族侗族自治州_806","黔西南布依族苗族自治州":"黔西南布依族苗族自治州_809","其它":"其它_801"},"海南_900":{"海口":"海口_902","三亚":"三亚_906","文昌":"文昌_909","琼海":"琼海_905","万宁":"万宁_908","五指山":"五指山_910","东方":"东方_911","儋州":"儋州_903","临高":"临高_912","澄迈":"澄迈_913","定安":"定安_914","屯昌":"屯昌_915","昌江":"昌江_916","白沙":"白沙_917","琼中":"琼中_918","陵水":"陵水_904","保亭":"保亭_919","乐东:":"乐东_907","西南中沙群岛":"西南中沙群岛_920","其它":"其它_901"},"河北_1000":{"石家庄":"石家庄_1002","唐山":"唐山_1013","秦皇岛":"秦皇岛_1012","邯郸":"邯郸_1008","邢台":"邢台_1015","保定":"保定_1003","张家口":"张家口_1016","承德":"承德_1006","沧州":"沧州_1005","廊坊":"廊坊_1010","衡水":"衡水_1009","其它":"其它_1001"},"黑龙江_1100":{"哈尔滨":"哈尔滨_1102","齐齐哈尔":"齐齐哈尔_1111","鸡西":"鸡西_1109","鹤岗":"鹤岗_1106","双鸭山":"双鸭山_1113","大庆":"大庆_1104","伊春":"伊春_1115","佳木斯":"佳木斯_1108","七台河":"七台河_1112","牡丹江":"牡丹江_1110","黑河":"黑河_1107","绥化":"绥化_1114","大兴安岭":"大兴安岭_1105","其它":"其它_1101"},"河南_1200":{"郑州":"郑州_1202","开封":"开封_1208","洛阳":"洛阳_1210","平顶山":"平顶山_1212","焦作":"焦作_1206","鹤壁":"鹤壁_1204","新乡":"新乡_1216","安阳":"安阳_1203","濮阳":"濮阳_1213","许昌":"许昌_1218","漯河":"漯河_1209","三门峡":"三门峡_1214","南阳":"南阳_1211","商丘":"商丘_1215","信阳":"信阳_1217","周口":"周口_1219","驻马店":"驻马店_1220","济源":"济源_1207","其它":"其它_1201"},"香港_1300":{"香港":"香港_1302","九龙":"九龙_1303","新界":"新界_1304","其它":"其它_1301"},"湖北_1400":{"武汉":"武汉_1402","黄石":"黄石_1406","襄樊":"襄樊_1416","十堰":"十堰_1410","荆州":"荆州_1408","宜昌":"宜昌_1418","鄂州":"鄂州_1404","孝感":"孝感_1417","黄冈":"黄冈_1405","咸宁":"咸宁_1414","随州":"随州_1411","恩施":"恩施_1403","仙桃":"仙桃_1413","潜江":"潜江_1409","天门":"天门_1407","神农架":"神农架_1412","荆门":"荆门_1419","其它":"其它_1401"},"湖南_1500":{"长沙":"长沙_1502","株洲":"株洲_1515","湘潭":"湘潭_1510","衡阳":"衡阳_1505","邵阳":"邵阳_1509","岳阳":"岳阳_1512","常德":"常德_1503","张家界":"张家界_1514","益阳":"益阳_1511","郴州":"郴州_1504","永州":"永州_1513","怀化":"怀化_1506","娄底":"娄底_1508","湘西":"湘西_1507","其它":"其它_1501"},"江苏_1600":{"南京":"南京_1602","常州":"常州_1604","淮安":"淮安_1606","连云港":"连云港_1610","南通":"南通_1611","宿迁":"宿迁_1614","苏州":"苏州_1615","泰州":"泰州_1617","同里":"同里_1618","无锡":"无锡_1619","徐州":"徐州_1620","盐城":"盐城_1621","扬州":"扬州_1622","镇江":"镇江_1626","周庄":"周庄_1627","其它":"其它_1601"},"江西_1700":{"南昌":"南昌_1702","景德镇":"景德镇_1706","萍乡":"萍乡_1710","九江":"九江_1708","新余":"新余_1712","鹰潭":"鹰潭_1714","赣州":"赣州_1704","吉安":"吉安_1705","宜春":"宜春_1713","抚州":"抚州_1703","上饶":"上饶_1711","井冈山":"井冈山_1707","庐山":"庐山_1709","其它":"其它_1701"},"吉林_1800":{"长春":"长春_1802","吉林":"吉林_1808","四平":"四平_1809","辽源":"辽源_1806","通化":"通化_1811","白山":"白山_1804","松原":"松原_1810","白城":"白城_1803","延边":"延边_1812","其它":"其它_1801"},"辽宁_1900":{"沈阳":"沈阳_1902","大连":"大连_1906","鞍山":"鞍山_1903","抚顺":"抚顺_1908","本溪":"本溪_1904","丹东":"丹东_1907","锦州":"锦州_1911","营口":"营口_1915","阜新":"阜新_1909","辽阳":"辽阳_1912","盘锦":"盘锦_1913","铁岭":"铁岭_1914","朝阳":"朝阳_1905","葫芦岛":"葫芦岛_1910","其它":"其它_1901"},"澳门_2000":{"澳门":"澳门_2002","其它":"其它_2001"},"内蒙古_2100":{"呼和浩特":"呼和浩特_2102","包头":"包头_2104","乌海":"乌海_2111","赤峰":"赤峰_2105","通辽":"通辽_2110","鄂尔多斯":"鄂尔多斯_2106","呼伦贝尔":"呼伦贝尔_2107","巴彦淖尔":"巴彦淖尔_2109","乌兰察布":"乌兰察布_2108","锡林郭勒":"锡林郭勒_2113","兴安":"兴安_2112","阿拉善盟":"阿拉善盟_2103","其它":"其它_2101"},"宁夏_2200":{"银川":"银川_2202","固源":"固源_2203","石嘴山":"石嘴山_2204","吴忠":"吴忠_2205","中卫 ":"中卫_2206","其它":"其它_2201"},"青海_2300":{"西宁":"西宁_2302","海东":"海东_2306","海西":"海西_2303","海南":"海南_2305","海北":"海北_2307","果洛":"果洛_2308","黄南":"黄南_2309","玉树":"玉树_2310","其它":"其它_2301"},"山东_2400":{"济南":"济南_2402","青岛":"青岛_2413","淄博":"淄博_2421","枣庄":"枣庄_2420","东营":"东营_2406","烟台":"烟台_2419","潍坊":"潍坊_2417","威海":"威海_2418","济宁":"济宁_2408","泰安":"泰安_2416","日照":"日照_2415","莱芜":"莱芜_2409","临沂":"临沂_2411","德州":"德州_2405","聊城":"聊城_2410","滨州":"滨州_2403","菏泽":"菏泽_2407","其它":"其它_2401"},"上海_2500":{"崇明":"崇明_2502","黄浦":"黄浦_2503","卢湾":"卢湾_2504","徐汇":"徐汇_2505","长宁":"长宁_2506","静安":"静安_2507","普陀":"普陀_2508","闸北":"闸北_2509","虹口":"虹口_2510","杨浦":"杨浦_2511","闵行":"闵行_2512","宝山":"宝山_2513","嘉定":"嘉定_2514","浦东":"浦东_2515","金山":"金山_2516","松江":"松江_2517","青浦":"青浦_2518","南汇":"南汇_2519","奉贤":"奉贤_2520","其它":"其它_2501"},"山西_2600":{"太原":"太原_2602","大同":"大同_2604","阳泉":"阳泉_2611","长治":"长治_2603","晋城":"晋城_2606","朔州":"朔州_2605","晋中":"晋中_2612","运城":"运城_2613","忻州":"忻州_2610","临汾":"临汾_2608","吕梁":"吕梁_2607","其它":"其它_2601"},"陕西_2700":{"西安":"西安_2702","铜川":"铜川_2709","宝鸡":"宝鸡_2704","咸阳":"咸阳_2710","渭南":"渭南_2706","延安":"延安_2711","汉中":"汉中_2705","榆林":"榆林_2712","安康":"安康_2703","商洛":"商洛_2707","其它":"其它_2701"},"四川_2800":{"成都":"成都_2802","自贡":"自贡_2826","攀枝花":"攀枝花_2820","泸州":"泸州_2814","德阳":"德阳_2805","绵阳":"绵阳_2816","广元":"广元_2810","遂宁":"遂宁_2821","内江":"内江_2819","乐山":"乐山_2813","南充":"南充_2818","眉山":"眉山_2817","宜宾":"宜宾_2825","广安":"广安_2809","达州":"达州_2804","雅安":"雅安_2824","巴中":"巴中_2803","资阳":"资阳_2827","阿坝":"阿坝_2815","甘孜":"甘孜_2812","凉山":"凉山_2823","峨眉山":"峨眉山_2807","九寨沟":"九寨沟_2811","其它":"其它_2801"},"台湾_2900":{"台北":"台北_2902","高雄":"高雄_2906","基隆":"基隆_2903","台南":"台南_2904","台中":"台中_2905","新竹":"新竹_2910","嘉义":"嘉义_2913","宜兰":"宜兰_2916","桃园":"桃园_2915","苗栗":"苗栗_2912","彰化":"彰化_2911","南投":"南投_2908","云林":"云林_2909","屏东":"屏东_2907","台东":"台东_2917","花莲":"花莲_2914","澎湖":"澎湖_2920","金门":"金门_2918","马祖":"马祖_2919","其它":"其它_2901"},"天津_3000":{"和平":"和平_3003","东丽":"东丽_3004","河东":"河东_3005","西青":"西青_3006","河西":"河西_3007","津南":"津南_3008","南开":"南开_3009","北辰":"北辰_3010","河北":"河北_3011","武清":"武清_3012","红桥":"红桥_3013","塘沽":"塘沽_3014","汉沽":"汉沽_3015","大港":"大港_3016","宁河":"宁河_3017","静海":"静海_3018","宝坻":"宝坻_3019","蓟县":"蓟县_3020","其它":"其它_3001"},"新疆_3100":{"乌鲁木齐":"乌鲁木齐_3102","克拉玛依":"克拉玛依_3112","吐鲁番":"吐鲁番_3118","哈密":"哈密_3109","和田":"和田_3110","阿克苏":"阿克苏_3103","喀什":"喀什_3111","克孜勒苏柯尔克孜":"克孜勒苏柯尔克孜_3105","巴音郭楞蒙古":"巴音郭楞蒙古_3114","昌吉":"昌吉_3107","博尔塔拉蒙古":"博尔塔拉蒙古_3106","伊犁哈萨克":"伊犁哈萨克_3119","塔城":"塔城_3117","阿勒泰":"阿勒泰_3104","石河子":"石河子_3116","阿拉尔":"阿拉尔_3108","图木舒克":"图木舒克_3113","五家渠":"五家渠_3115","其它":"其它_3101"},"西藏_3200":{"拉萨":"拉萨_3202","阿里":"阿里_3203","昌都":"昌都_3204","林芝":"林芝_3205","那曲":"那曲_3206","日喀则":"日喀则_3207","山南":"山南_3208","其它":"其它_3201"},"云南_3300":{"昆明":"昆明_3302","曲靖":"曲靖_3315","玉溪":"玉溪_3319","保山":"保山_3304","昭通":"昭通_3321","丽江":"丽江_3312","思茅":"思茅_3316","临沧":"临沧_3311","文山":"文山_3317","红河":"红河_3308","西双版纳":"西双版纳_3318","楚雄":"楚雄_3305","大理":"大理_3306","德宏":"德宏_3314","怒江":"怒江_3313","迪庆":"迪庆_3320","其它":"其它_3301"},"浙江_3400":{"杭州":"杭州_3402","宁波":"宁波_3415","温州":"温州_3426","嘉兴":"嘉兴_3410","湖州":"湖州_3409","绍兴":"绍兴_3422","金华":"金华_3411","衢州":"衢州_3419","舟山":"舟山_3427","台州":"台州_3424","丽水":"丽水_3414","安吉":"安吉_3403","千岛湖":"千岛湖_3418","其它":"其它_3401"},"欧洲_3600":{"爱尔兰":"爱尔兰_3602","比利时":"比利时_3603","法国":"法国_3604","荷兰":"荷兰_3605","卢森堡":"卢森堡_3606","摩纳哥":"摩纳哥_3607","英国":"英国_3608","冰岛":"冰岛_3609","丹麦":"丹麦_3610","芬兰":"芬兰_3611","挪威":"挪威_3612","瑞典":"瑞典_3613","奥地利":"奥地利_3614","波兰":"波兰_3615","德国":"德国_3616","捷克共和国":"捷克共和国_3617","列支敦士登":"列支敦士登_3618","瑞士":"瑞士_3619","斯洛伐克":"斯洛伐克_3620","匈牙利":"匈牙利_3621","爱沙尼亚":"爱沙尼亚_3622","白俄罗斯":"白俄罗斯_3623","俄罗斯":"俄罗斯_3624","拉脱维亚":"拉脱维亚_3625","立陶宛":"立陶宛_3626","摩尔多瓦":"摩尔多瓦_3627","乌克兰":"乌克兰_3628","阿尔巴尼亚":"阿尔巴尼亚_3629","波斯尼亚和黑塞哥维那":"波斯尼亚和黑塞哥维那_3630","保加利亚":"保加利亚_3631","梵蒂冈":"梵蒂冈_3632","克罗地亚":"克罗地亚_3633","罗马尼亚":"罗马尼亚_3634","马其顿":"马其顿_3635","马耳他":"马耳他_3636","黑山":"黑山_3637","葡萄牙":"葡萄牙_3638","斯洛文尼亚":"斯洛文尼亚_3639","塞浦路斯":"塞浦路斯_3640","塞尔维亚":"塞尔维亚_3641","圣马力诺":"圣马力诺_3642","希腊":"希腊_3643","西班牙":"西班牙_3644","意大利":"意大利_3645","安道尔":"安道尔_3646","其它":"其它_3601"},"北美洲_3700":{"安圭拉":"安圭拉_3702","安提瓜和巴布达":"安提瓜和巴布达_3703","阿鲁巴":"阿鲁巴_3704","巴哈马":"巴哈马_3705","巴巴多斯":"巴巴多斯_3706","伯利兹":"伯利兹_3707","百慕大群岛":"百慕大群岛_3708","英属维京群岛":"英属维京群岛_3709","加拿大":"加拿大_3710","开曼群岛":"开曼群岛_3711","哥斯达黎加":"哥斯达黎加_3712","古巴":"古巴_3713","多米尼克":"多米尼克_3714","多米尼加共和国":"多米尼加共和国_3715","萨尔瓦多":"萨尔瓦多_3716","格陵兰":"格陵兰_3717","格林纳达":"格林纳达_3718","瓜德洛普":"瓜德洛普_3719","危地马拉":"危地马拉_3720","海地":"海地_3721","洪都拉斯":"洪都拉斯_3722","牙买加":"牙买加_3723","马提尼克":"马提尼克_3724","墨西哥":"墨西哥_3725","蒙特塞拉特 ":"蒙特塞拉特 _3726","纳弗沙岛":"纳弗沙岛_3727","荷属安的列斯":"荷属安的列斯_3728","尼加拉瓜":"尼加拉瓜_3729","巴拿马":"巴拿马_3730","波多黎各":"波多黎各_3731","圣克里斯多福与尼维斯":"圣克里斯多福与尼维斯_3732","圣卢西亚":"圣卢西亚_3733","圣皮耶与密克隆群岛":"圣皮耶与密克隆群岛_3734","圣文森特和格林纳丁斯":"圣文森特和格林纳丁斯_3735","特立尼达及多巴哥":"特立尼达及多巴哥_3736","特克斯与凯科斯群岛":"特克斯与凯科斯群岛_3737","美国":"美国_3738","美属维京群岛 ":"美属维京群岛 _3739","其它":"其它_3701"},"南美洲_3800":{"厄瓜多尔":"厄瓜多尔_3802","哥伦比亚":"哥伦比亚_3803","委内瑞拉":"委内瑞拉_3804","秘鲁":"秘鲁_3805","巴西":"巴西_3806","智利":"智利_3807","乌拉圭":"乌拉圭_3808","巴拉圭":"巴拉圭_3809","阿根廷":"阿根廷_3810","玻利维亚":"玻利维亚_3811","圭亚那":"圭亚那_3812","苏里南":"苏里南_3813","法属圭亚那":"法属圭亚那_3814","其它":"其它_3801"},"亚洲_3900":{"蒙古":"蒙古_3902","朝鲜":"朝鲜_3903","韩国":"韩国_3904","日本":"日本_3905","越南":"越南_3906","老挝":"老挝_3907","柬埔寨":"柬埔寨_3908","缅甸":"缅甸_3909","泰国":"泰国_3910","马来西亚":"马来西亚_3911","新加坡":"新加坡_3912","文莱":"文莱_3913","菲律宾":"菲律宾_3914","印度尼西亚":"印度尼西亚_3915","锡金":"锡金_3916","不丹":"不丹_3917","孟加拉国":"孟加拉国_3918","印度":"印度_3919","斯里兰卡":"斯里兰卡_3920","哈萨克斯坦":"哈萨克斯坦_3921","马尔代夫":"马尔代夫_3922","吉尔吉斯斯坦":"吉尔吉斯斯坦_3923","塔吉克斯坦":"塔吉克斯坦_3924","乌兹别可斯坦":"乌兹别可斯坦_3915","土库曼斯坦":"土库曼斯坦_3926","格鲁吉亚":"格鲁吉亚_3927","阿塞拜疆":"阿塞拜疆_3928","巴基斯坦":"巴基斯坦_3929","阿富汗":"阿富汗_3930","伊朗":"伊朗_3931","科威特":"科威特_3932","沙特阿拉伯":"沙特阿拉伯_3933","巴林":"巴林_3934","卡塔尔":"卡塔尔_3935","阿拉伯联合酋长国":"阿拉伯联合酋长国_3936","阿曼":"阿曼_3937","也门":"也门_3938","伊拉克":"伊拉克_3939","叙利亚":"叙利亚_3940","黎巴嫩":"黎巴嫩_3941","约旦":"约旦_3942","巴勒斯坦国":"巴勒斯坦国_3943","以色列":"以色列_3944","塞浦路斯":"塞浦路斯_3945","土耳其":"土耳其_3946","东帝汶":"东帝汶_3947","尼泊尔":"尼泊尔_3948","亚美尼亚":"亚美尼亚_3949","其它":"其它_3901"},"非洲_4000":{"埃及":"埃及_4002","利比亚":"利比亚_4003","突尼斯":"突尼斯_4004","阿尔及利亚":"阿尔及利亚_4005","摩洛哥":"摩洛哥_4006","西撒哈拉":"西撒哈拉_4007","毛里塔尼亚":"毛里塔尼亚_4008","塞内加尔":"塞内加尔_4009","冈比亚":"冈比亚_4010","马里":"马里_4011","布基纳法索":"布基纳法索_4012","佛得角":"佛得角_4013","几内亚比绍":"几内亚比绍_4014","苏丹":"苏丹_4015","埃塞俄比亚":"埃塞俄比亚_4016","厄立特里亚":"厄立特里亚_4017","吉布提":"吉布提_4018","索马里":"索马里_4019","肯尼亚":"肯尼亚_4020","乌干达":"乌干达_4021","坦桑尼亚":"坦桑尼亚_4022","卢旺达":"卢旺达_4023","布隆迪":"布隆迪_4024","刚果民主共和国":"刚果民主共和国_4025","刚果":"刚果_4026","加蓬":"加蓬_4027","圣多美和普林西比":"圣多美和普林西比_4028","安哥拉":"安哥拉_4029","几内亚":"几内亚_4030","塞拉利昂":"塞拉利昂_4031","利比里亚":"利比里亚_4032","科特迪瓦":"科特迪瓦_4033","加纳":"加纳_4034","多哥":"多哥_4035","贝宁":"贝宁_4036","尼日尔":"尼日尔_4037","尼日利亚":"尼日利亚_4038","喀麦隆":"喀麦隆_4039","赤道几内亚":"赤道几内亚_4040","乍得":"乍得_4041","中非":"中非_4042","赞比亚":"赞比亚_4043","马拉维":"马拉维_4044","莫桑比克":"莫桑比克_4045","科摩罗":"科摩罗_4046","马达加斯加":"马达加斯加_4047","塞舌尔":"塞舌尔_4048","毛里求斯":"毛里求斯_4049","留尼汪（法）":"留尼汪（法）_4050","津巴布韦":"津巴布韦_4051","博茨瓦纳":"博茨瓦纳_4052","纳米比亚":"纳米比亚_4053","南非":"南非_4054","斯威士兰":"斯威士兰_4055","莱索托":"莱索托_4056","圣赫勒拿（英）":"圣赫勒拿（英）_4057","其它":"其它_4001"},"大洋洲_4100":{"澳大利亚":"澳大利亚_4102","新西兰":"新西兰_4103","巴布亚新几内亚":"巴布亚新几内亚_4104","所罗门群岛":"所罗门群岛_4105","瓦努阿图":"瓦努阿图_4106","新喀里多尼亚（法）":"新喀里多尼亚（法）_4107","斐济群岛":"斐济群岛_4108","基里巴斯":"基里巴斯_4109","瑙鲁":"瑙鲁_4110","密克罗尼西亚联邦":"密克罗尼西亚联邦_4111","马绍尔群岛":"马绍尔群岛_4112","帕劳":"帕劳_4113","北马里亚那群岛":"北马里亚那群岛_4114","关岛（英）":"关岛（英）_4115","图瓦卢":"图瓦卢_4116","瓦利斯和富图那（法）":"瓦利斯和富图那（法）_4117","萨摩亚":"萨摩亚_4118","美属萨摩亚":"美属萨摩亚_4119","纽埃（新）":"纽埃（新）_4120","托克劳（新）":"托克劳（新）_4121","库克群岛（新）":"库克群岛（新）_4122","汤加":"汤加_4123","法属波利尼西亚":"法属波利尼西亚_4124","皮特凯恩（美）":"皮特凯恩（美）_4125","诺福克岛":"诺福克岛_4126","中途岛":"中途岛_4127","其它":"其它_4101"}}},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(50),__webpack_require__(6),__webpack_require__(126),__webpack_require__(5),__webpack_require__(128),__webpack_require__(16)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,Validator,config,icBox,eventBus,tpl,tools){var pageDataObj=config.pageDataObj,Login=config.isLogin;return Backbone.View.extend({el:"#m-contact",initialize:function(){"step1"==pageDataObj.bookStep?this.render():2==pageDataObj.operationFlag&&this.render();var self=this;this.name=this.$el.find(".name"),this.mobile=this.$el.find(".mobile"),this.phone=this.$el.find(".phone"),this.email=this.$el.find(".email"),this.companyName=this.$el.find(".companyName"),this.bindEvents(),this.listenTo(this.model,"validatorAll",this.validatorAll),this.listenTo(this.model,"registed",this.showLogin),this.listenTo(this.model,"unregisted",function(){self.clearError(self.mobile)}),this.listenTo(this.model,"reset",function(){self.name.find("input").val(self.model.get("name")).trigger("blur"),self.mobile.find(".input-tel").val(self.model.get("mobile")).trigger("blur"),self.email.find("input").val(self.model.get("email")).trigger("blur"),self.mobile.find(".area-code").data("telcountryid",self.model.get("telCountryId")),self.mobile.find(".area-code").val(self.model.get("intlCode"))}),this.listenTo(this.model,"crmSet",function(){self.name.find("input").val(self.model.get("name")),self.mobile.find(".input-tel").val(self.model.get("mobile")),self.email.find("input").val(self.model.get("email")),self.mobile.find(".area-code").data("telcountryid",self.model.get("telCountryId")),self.mobile.find(".area-code").val(self.model.get("intlCode"))}),this.listenTo(this.model,"teamTourTypeChanged",function(){this.render()})},bindEvents:function(){this.name.on("blur",".field-input",$.proxy(this.onNameBlur,this)),this.mobile.find(".input-tel").on("blur",$.proxy(this.onMobileBlur,this)),this.mobile.find(".input-tel").on("propertychange input",$.proxy(this.onMobileInput,this)),this.phone.on("blur",".field-input.area-code",$.proxy(this.onAreaCodeBlur,this)),this.phone.on("blur",".field-input.input-tel",$.proxy(this.onPhoneCodeBlur,this)),this.email.on("blur",".field-input",$.proxy(this.onEmailBlur,this)),this.mobile.on("click",".area-code",$.proxy(this.onInternationCodeBlur,this)),this.mobile.on("setInternationCode",".area-code",$.proxy(this.onInternationCodeSet,this)),this.$el.on("click",".J_login_btn",$.proxy(this.openLogin,this)),this.companyName.on("blur",".field-input.input-companyName",$.proxy(this.onCompanyNameBlur,this))},showLogin:function(){var htmlContent='您已经是途牛会员，请<a href="javascript:;" class="J_login_btn">登录</a>';this.showError(this.mobile,htmlContent)},validatorAll:function(){this.name.find(".field-input").trigger("blur"),this.mobile.find(".field-input").trigger("blur");var phoneCode=(this.model.get("phoneAreaCode"),this.model.get("phoneCode"));phoneCode&&this.phone.find(".field_input .phone_code").trigger("blur"),this.email.find(".field-input").trigger("blur")},clearMobile:function(){
this.clearError(this.mobile)},onInternationCodeBlur:function(e){icBox.init({dom:$(e.target)}),e.stopPropagation()},onInternationCodeSet:function(e){var telCountryId=$(e.target).data("telCountryId"),intlCode=$(e.target).data("intlCode");this.model.set({intlCode:intlCode,telCountryId:telCountryId},{silent:!0}),this.$el.find(".mobile_box").trigger("blur"),this.model.judgeIsMember()},onNameBlur:function(e){var value=$(e.target).val(),error=Validator.validateName(value);this.showError(this.name,error),this.model.set("name",value)},onMobileInput:function(e){var value=$(e.target).val(),regx=/^\d{0,10}$/;regx.test(value)||this.onMobileBlur(e)},onMobileBlur:function(e){var value=$(e.target).val();if(this.model.get("telCountryId")&&40!=this.model.get("telCountryId")&&"40"!=this.model.get("telCountryId"))var error=Validator.validateInternationTel(value);else var error=Validator.validateTel(value);if(this.clearMobile(),pageDataObj.telNum)if(error)this.showError(this.mobile,error);else{var data={user_tel:value};this.model.getJudgeCrm(data)}else error||!this.model.isRegister()||Login.status?this.showError(this.mobile,error):this.showLogin(),error||this.model.set("mobile",value)},onAreaCodeBlur:function(e){var value=$(e.target).val(),error=Validator.validateAreaCode(value);this.showError(this.phone,error),error||this.model.set("phoneAreaCode",value)},onPhoneCodeBlur:function(e){var value=$(e.target).val(),error=Validator.validateTelPhone(value);this.showError(this.phone,error),error||this.model.set("phoneCode",value)},onEmailBlur:function(e){var value=$(e.target).val(),error=Validator.validateEmail(value);""==value.replace(/\s/g,"")?this.model.get("isTeamTour")||this.showError(this.email,"邮箱不得为空！"):this.showError(this.email,error),error||this.model.set("email",value)},showError:function(field,error){var flag=this.model.get("flag");if(!flag){if(this.clearError(field),!error)return;var errorSpan=$("<div class='error-tips'></div>").append("<i class='icon error-icon'></i>").append(error);$(field).append(errorSpan)}},clearError:function(field){$(field).find("div.error-tips").remove()},openLogin:function(){eventBus.trigger("openLogin")},render:function(){var html,data=this.model.toJSON();2==pageDataObj.operationFlag?data.operationFlag=!0:data.operationFlag=!1,html=tpl(data),this.$el.html(html).show()},contactCustomerServiceModifyTip:function(data){var str="";data&&(str="（"+data+"）"),tools.layer({msg:"您的下单信息有误，为了您的正常出游，请咨询 4007-999-999 进一步核实，给您带来的不便敬请谅解。"+str})},thisOrderNotNeedPerfect:function(){var self=this;tools.layer({msg:"该订单无需完善出游信息！",yes:function(){self.closeWp()},close:function(){self.closeWp()}})},closeWp:function(){window.location.href="about:blank",window.close()},onCompanyNameBlur:function(e){var value=$(e.target).val();this.model.set("companyName",value)}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(14),__webpack_require__(127),__webpack_require__(6)],__WEBPACK_AMD_DEFINE_RESULT__=function($,icBox,config){var Ic=config.pageDataObj.countryAreaCode,ICB={init:function(options){ICB.Dom=options.dom,ICB.defaultCode=options.defaultCode||86,ICB.showBox(),ICB.bindEvents()},showBox:function(){var html=icBox({icList:Ic});$("body").append(html),$(".international_code_box").css({position:"absolute",left:$(ICB.Dom).offset().left,top:$(ICB.Dom).offset().top+$(ICB.Dom).height()}).show()},bindEvents:function(){$(".international_code_box").off("click"),$(".international_code_box").on("mouseenter",".code_title_list li",function(e){ICB.changeTab($(e.target))}),$(".international_code_box").on("click",".code_detail_list li",function(e){$(e.target).hasClass("code_detail_cell")?ICB.selectCode($(e.target)):ICB.selectCode($(e.target).parent())}),$(window).one("click",function(e){return!$(e.target).hasClass("internation_code_box")&&(!$(e.target).parents(".international_code_box").length&&void $(".international_code_box").hide())}),$(".international_code_box").on("click",".T_close",function(){$(".international_code_box").hide()})},changeTab:function(dom){if(!$(dom).hasClass("activity")){$(".international_code_box").find(".code_title_list li").removeClass("activity"),$(dom).addClass("activity");var parentCode=$(dom).data("parentcode"),tabData=ICB.getTabData(parentCode),html=ICB.getTabHtml(tabData);$(".code_detail_list").html(html)}},selectCode:function(dom){var code=$(dom).attr("data-code"),telCountryId=($(dom).attr("data-name"),$(dom).attr("data-telCountryId"));$(dom).data("parentcode");$(ICB.Dom).val(code),$(ICB.Dom).data("intlCode",code),$(ICB.Dom).data("telCountryId",telCountryId),$(ICB.Dom).trigger("setInternationCode"),$(".international_code_box").remove()},getTabData:function(parentCode){for(var k in Ic)if(Ic[k].name==parentCode)return Ic[k]},getTabHtml:function(data){var $out="";if(!data)return $out;for(var j in data.list)$out+='\r\n\t\t\t\t\t\t<li class="code_detail_cell" data-code=\'',$out+=data.list[j].intl_code,$out+="' data-parentcode='",$out+=data.name,$out+="' data-telCountryId='",$out+=data.list[j].id,$out+='\'><span class="name"> ',$out+=data.list[j].country_name,$out+='</span><span class="code"> ',$out+=data.list[j].intl_code,$out+="</span></li>\r\n\t\t\t\t\t";return $out}};return ICB}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,k=($utils.$helpers,$data.k),icList=$data.icList,$escape=$utils.$escape,j=$data.j,$out="";$out+='<div class="international_code_box">\r\n\t\t\t<div class="code_title">\r\n\t\t\t\t<ul class="code_title_list">\r\n\t\t\t\t\t';for(var k in icList)$out+='\r\n\t\t\t\t\t\t<li class="',0==k&&($out+="activity"),$out+=" ","hot"==icList[k].name&&($out+="icBox_hot"),$out+='" data-parentCode = "',$out+=$escape(icList[k].name),$out+='">',$out+=$escape("hot"==icList[k].name?"热门":icList[k].name),$out+="</li>\r\n\t\t\t\t\t";$out+='\r\n\t\t\t\t\t\r\n\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t\t<div class="code_detail">\r\n\t\t\t\t<ul class="code_detail_list">\r\n\t\t\t\t\t';for(var j in icList[0].list)$out+='\r\n\t\t\t\t\t\t<li class="code_detail_cell" data-code=\'',$out+=$escape(icList[0].list[j].intl_code),$out+="' data-parentcode='",$out+=$escape(icList[0].name),$out+="' data-telCountryId='",$out+=$escape(icList[0].list[j].id),$out+='\'><span class="name"> ',$out+=$escape(icList[0].list[j].country_name),$out+='</span><span class="code"> ',$out+=$escape(icList[0].list[j].intl_code),$out+="</span></li>\r\n\t\t\t\t\t";return $out+='\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t\t<div class="T_close"></div>\r\n\t\t</div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,$escape=($utils.$helpers,$utils.$escape),name=$data.name,operationFlag=$data.operationFlag,isCompanyTour=$data.isCompanyTour,companyName=$data.companyName,telCountryId=$data.telCountryId,intlCode=$data.intlCode,mobile=$data.mobile,isTeamTour=$data.isTeamTour,email=$data.email,$out="";return $out+='<h2>\r\n    <span class="icon contact-icon"></span>\r\n    <span class="m-title">联系人信息</span>\r\n</h2>\r\n<div class="modular-body">  \r\n    <div class="panel">\r\n        <div class="panel-group name">\r\n            <div class="panel-title"><em class="stars">* </em>姓名：</div>\r\n            <div class="panel-body">\r\n                <input type="text" class="field-input input-name" placeholder="如：张三" value="',$out+=$escape(name),$out+='" ',operationFlag&&name&&($out+=" readonly "),$out+=" >\r\n            </div>\r\n        </div>\r\n\r\n        ",isCompanyTour&&($out+='\r\n        <div class="panel-group companyName">\r\n                    <div class="panel-title">公司名称：</div>\r\n                    <div class="panel-body">\r\n                        <input type="text" class="field-input input-companyName" value="',$out+=$escape(companyName),$out+='" ',operationFlag&&companyName&&($out+=" readonly "),$out+=" >\r\n                    </div>\r\n        </div>\r\n        "),$out+='\r\n        <div class="panel-group tel mobile">\r\n            <div class="panel-title"><em class="stars">* </em>联系电话：</div>\r\n            <div class="panel-body">\r\n                <input type="text" class="field-input area-code" readonly data-telcountryid="',$out+=$escape(telCountryId),$out+='" value="',$out+=$escape(intlCode),$out+='" ',operationFlag&&intlCode&&($out+=' disabled="disabled" '),$out+=' ><input type="text" class="field-input input-tel" value="',$out+=$escape(mobile),$out+='" ',operationFlag&&mobile&&($out+=" readonly "),$out+=" >\r\n            </div>\r\n        </div>\r\n        ",(operationFlag||isTeamTour)&&($out+='\r\n            <div class="panel-group email">\r\n                <div class="panel-title">\r\n                ',isTeamTour||($out+='\r\n                <em class="stars">* </em>\r\n                '),$out+='\r\n                电子邮箱：</div>\r\n                <div class="panel-body">\r\n                    <input type="text" class="field-input input-email" value="',$out+=$escape(email),$out+='">\r\n<!--                     <span class="error-tip"><i class="icon error-icon"></i>电子邮件不得为空</span> -->\r\n                    <span class="tips jtxz-detail-hover">\r\n                        <i class="icon notice2-icon"></i>\r\n                        <div class="jtxz-detail2 T_width2">\r\n                            <p class="YD_mgb">付款完成后,您的邮箱将收到加盖公章的合同,您也可以在个人中心查看和下载您的合同。</p>\r\n                            <span class="z">◆</span>\r\n                            <span class="j">◆</span>\r\n                        </div>\r\n                    </span>\r\n                </div>\r\n            </div>\r\n        '),$out+="\r\n    </div>\r\n</div>",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(130),__webpack_require__(14),__webpack_require__(6),__webpack_require__(17),__webpack_require__(5),__webpack_require__(8),__webpack_require__(132),__webpack_require__(16),__webpack_require__(18)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,PassengerView,$,config,Layer,eventBus,_,touristsTpl,tools,layer2){var pageDataObj=config.pageDataObj,ERR={noPass:"出游人已满！",touristErr:"出游人不满足条件",noPhone:"请至少填写一个手机号码",ageErr:"您选择的游客$name年龄不符合要求，请您更换游客",ageErrAir:"儿童标准2周岁(含)-12周岁(不含)，您选择的游客$name年龄不符合要求；请您更换游客，如需定婴儿票请联系客服",notBindAllResource:"您还有门票未勾选出游人，请勾选。",noAdult:"未成年人需要大人陪同出游",hasInternationTel:"门票暂不支持国际手机号预定，请填写中国大陆11位手机号码！",noTicketInfo:"取票人信息不全",needDeleteTourist:"您更改了出游人数，请删除对应成人！",needDeleteChildTourist:"您更改了出游人数，请删除对应儿童！",notEmpty:"请填写出游人手机号",noRepeat:"手机号码重复，请正确填写",cruiseNoAdult:"您好，邮轮上每间房间至少要有一位"+pageDataObj.childAgeStandard+"岁以上成人入住，请修改",modifyErr:"您的下单信息有误，为了您的正常出游，请咨询 4007-999-999 进一步核实，给您带来的不便敬请谅解。",specialNameErr:"出游人姓名中包含称谓$title，请确保出游人姓名与证件一致。您是否确定$name是与证件一致的真实姓名？",trainNumErr:"火车票限制一名成人最多携带四名儿童和一名免票儿童（根据用户身高进行成人儿童标准判断），您的选择不符合该限制。"};return Backbone.View.extend({el:$("#m-tourist"),events:{"click .is-has-foreign .input_checkbox":"hasForeign","click .is-has-older .input_checkbox":"hasOdler","click .is-has-younger .input_checkbox":"hasYounger"},views:[],initialize:function(){this.render();var self=this,notDefineTicketer=pageDataObj.hasCustomerLimit;this.listenTo(this.model,"add",function(model){notDefineTicketer&&(notDefineTicketer=!1,model.set("isTicketer",1),model.set("cardType",pageDataObj.defaultTickerCardType)),self.add(model)}),$(".no-write-btn").on("click",function(){var html,line="";pageDataObj.telNum?"cruise2"==pageDataObj.pageType?html="订单价格可能发生变化，建议您下单前帮助客人填写游客信息。":(html="订单价格可能发生变化，建议您下单前帮助客人填写游客信息；若暂不填写，为避免价格变化，请提醒客人在订单提交后30分钟内前往我的订单添加。",line=3):"cruise2"==pageDataObj.pageType?html="订单价格可能发生变化，建议您下单前填写游客信息。":(html="订单价格可能发生变化，建议您下单前填写游客信息；若暂不填写，为避免价格增加，请在订单提交后30分钟内前往我的订单添加。",line=3),tools.layer({btns:2,btn:["马上填写","暂不填写"],msg:html,line:line,icon:2,yes:function(){layer.closeAll()},no:function(){$("#J_tourist_detail").slideUp(function(){$("html,body").animate({scrollTop:$("#m-tourist").offset().top},500)}),$("#J_no_write_tips").show(),$("#J_tourist_detail_switch").show(),self.$el.children("h2").addClass("no-border"),pageDataObj.hasPassengers=0}})}),$("#J_tourist_detail_switch").on("click",function(){$("#J_tourist_detail").slideDown(),$("#J_no_write_tips").hide(),$("#J_tourist_detail_switch").hide(),self.$el.children("h2").removeClass("no-border"),pageDataObj.hasPassengers=1}),$('.lradio-content input[name="lradio"]').on("click",function(){$('.lradio-content input[name="lradio"]').attr("checked",""),$(this).attr("checked","checked"),$(this).parent(".field_radio.has").length?Backbone.app.set("isL",1):Backbone.app.set("isL",0)}),this.listenTo(this.model,"changeTips",this.changeTips)},render:function(){var html=touristsTpl(_.extend({showAgeCheckBox:this.model.showAgeCheckBox},_.pick(pageDataObj,"ticketFlag","hotelFlag","hideBtn","operationFlag","foreignLimit","maxAgeLimit","minAgeLimit")));this.$el.html(html).show(),this.changeTips()},reRender:function(){var self=this;_.each(this.views,function(view){view.remove()}),this.view=[],this.model.each(function(passModel,index){var passView=new PassengerView({model:passModel});self.views.push(passView),self.$el.find("#J_Passes").append(passView.renderPage())})},add:function(model){this.reRender(),"cruise2"==!pageDataObj.pageType&&this.model.changeSerial()},hideTouristForCrm:function(){$("#J_tourist_detail").slideUp(function(){$("html,body").animate({scrollTop:$("#m-tourist").offset().top},500)}),$("#J_no_write_tips").show(),$("#J_tourist_detail_switch").show(),this.$el.children("h2").addClass("no-border"),pageDataObj.hasPassengers=0,pageDataObj.hideBtn=!1,this.$el.find(".tourist-no-write").show()},showErr:function(key,options){var self=this,tips=ERR[key],name=options&&options.passData&&options.passData.name;if(name=name?name:"","ageErr"===key&&(tips=pageDataObj.hasAirResource?ERR.ageErrAir.replace("$name",name):ERR.ageErr.replace("$name",name)),"specialNameErr"==key){var result=this.model.getSpecialNameError(),title=result.title,name=result.name,index=result.index;tips=tips.replace("$title",title).replace("$name",name);var layerIndex=tools.layer({msg:tips,btns:2,btn:["确定","返回修改"],yes:function(){Layer.close(layerIndex),self.model.notNeedCheckSpecialName(),eventBus.trigger("saveOrder")},no:function(){Layer.close(layerIndex),tools.scrollTo(self.$el.find(".tourist_info").eq(index))}})}else tools.layer({msg:tips})},showEmptyErr:function(data,index){this.model.some(function(model,_index){_index==index&&model.trigger("needShowErr","Mobile",7)})},showSelDialog:function(name){tools.layer({msg:"机票年龄标准成人12周岁及以上、儿童2周岁(含)-12周岁(不含)，您选择的游客"+name+"不符合要求，请您更换游客。",line:3,end:function(){layer.closeAll(),pageDataObj.isNetOrderFlag=2}})},showAgrDialog:function(name){var self=this;tools.layer({btns:2,btn:["继续预订","提交订单"],msg:"机票年龄标准成人12周岁及以上、儿童2周岁(含)-12周岁(不含)，您选择的游客"+name+"为儿童，继续预订则将按照机票年龄标准出票。如您希望按照成人类型预订机票，可以选择提交订单等待客服联系。",yes:function(){layer.closeAll(),pageDataObj.isNetOrderFlag=2,pageDataObj.hasCheckTourist=1,self.model.goToOrder()},no:function(){layer.closeAll(),pageDataObj.isNetOrderFlag=1,pageDataObj.hasCheckTourist=1,self.model.goToOrder()},cancel:function(){layer.closeAll(),pageDataObj.hasCheckTourist=0}})},hasForeign:function(e){var obj=$(e.currentTarget),val=obj.data("value");obj.addClass("enabled"),obj.parent().siblings().find("label").removeClass("enabled"),this.model.hasForeign=Number(val),this.model.hasForeignOrOld=this.model.hasOdler||this.model.hasYounger||this.model.hasForeign},hasOdler:function(e){var obj=$(e.currentTarget),val=obj.data("value");obj.addClass("enabled"),obj.parent().siblings().find("label").removeClass("enabled"),this.model.hasOdler=Number(val),this.model.hasForeignOrOld=this.model.hasOdler||this.model.hasYounger||this.model.hasForeign},hasYounger:function(e){var obj=$(e.currentTarget),val=obj.data("value");obj.addClass("enabled"),obj.parent().siblings().find("label").removeClass("enabled"),this.model.hasYounger=Number(val),this.model.hasForeignOrOld=this.model.hasOdler||this.model.hasYounger||this.model.hasForeign},hideTouristTab:function(){this.$el.hide()},showNeedPerfectTouristTip:function(){tools.layer({msg:"您有部分出游人信息未完善，为了您能安心出游，请尽快完善剩下的出游人信息"})},changeTips:function(){var isGangAoAndInSideAirplane=this.model.getIsGangAoAndInSideAirplane();isGangAoAndInSideAirplane?this.$el.find(".gang-ao-in-side-airplane-tip").show():this.$el.find(".gang-ao-in-side-airplane-tip").hide()},showAgrPassengerDialog:function(passengerNum){var self=this,displayMsg="机票儿童票标准：2~12岁（不含）。您选择的联运机票将根据出游人年龄购买"+passengerNum.adultNum+"成人票";0!==passengerNum.childNum&&(displayMsg=displayMsg+"、"+passengerNum.childNum+"儿童票"),0!==passengerNum.babyNum&&(displayMsg=displayMsg+"、"+passengerNum.babyNum+"婴儿票"),tools.layer({btns:1,btn:["确定"],msg:displayMsg,icon:2,yes:function(){layer.closeAll(),pageDataObj.isSurePassengerInfo=!0,self.model.goToOrder()}})},showVisaError:function(count){var tips="已选择"+count+"位签证使用人";layer2.msg(tips)}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(14),__webpack_require__(6),__webpack_require__(131),__webpack_require__(126),__webpack_require__(5),__webpack_require__(18)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,$,config,touristInfoTemplate,icBox,eventBus,Layer){function getTwoBitsString(num){return 1==num.length?"0"+num:num}var pageDataObj=config.pageDataObj,initValidateError=function(){return{Name:{2:"姓名为空",3:"中文名长度2-11个汉字",4:"姓名只能包含中文、英文",5:"游客姓名重复，请核实 （如果确实存在重名的情况，请直接提交页面）"},EnglishFirstName:{2:"请填写名的拼音或英文"},EnglishLastName:{2:"请填写姓的拼音或英文"},EnglishName:{2:"请填写姓、名的拼音或英文"},HKMacao:{2:"港澳通行证不能为空",3:"按照证件填写正确的港澳通行证"},TWMacao:{2:"台湾通行证不能为空",3:"按照证件填写正确的台湾通行证"},Hukouben:{2:"户口本不能为空",3:"请填写户口薄上的公民身份证件编号"},Chushengzhengming:{2:"出生证明不能为空",3:"请按照YYYYMMDD格式的出生日期填写"},Huixiangzheng:{2:"回乡证号码不能为空",3:"按照证件填写正确的回乡证号码"},TW:{2:"台胞证不能为空",3:"按照证件填写正确的台胞证"},Passport:{2:"护照不能为空",3:"请按照证件填正确的护照号码"},ID:{2:"身份证号码位数不对!",3:"请填写正确的身份证号码",4:"身份证号码校验错误!",5:"身份证地区非法!",6:"儿童标准"+Backbone.app.get("minChildAge")+"周岁(含)-"+Backbone.app.get("maxChildAge")+"周岁(不含)",7:"取票人需输入证件号码"},Mobile:{2:"至少填写一个手机号",3:"手机号格式不正确",4:"您选择的资源需要您输入手机号码",5:"取票人需输入手机号码",6:"手机号码重复，请确认填写正确",7:"请填写出游人手机号"},Arm:{2:"军官证不能为空",3:"按照证件填写正确的军官证"},Other:{2:"证件号码不能为空",3:"证件号码重复，请正确填写",4:"儿童标准"+Backbone.app.get("minChildAge")+"周岁(含)-"+Backbone.app.get("maxChildAge")+"周岁(不含)"},ValidData:{2:"证件有效期需在出游归来六个月以上",3:"证件有效期需在归来日期之后"},Birthday:{2:"儿童标准"+Backbone.app.get("minChildAge")+"周岁(含)-"+Backbone.app.get("maxChildAge")+"周岁(不含)"},Sign:{2:"证件签发地不能为空"},Height:{1:"身高不能为空"}}},ValidatorErrors=initValidateError();return Backbone.View.extend({initialize:function(){var model=this.model;this.listenTo(this.model,"change",function(){this.render()}),this.listenTo(this.model,"needRender",function(){this.render()}),this.listenTo(this.model,"needLayerShowRepeat",function(){this.renderRepeat()}),this.listenTo(this.model,"needclearVisaError",function(){this.clearAllVisaError()}),this.listenTo(this.model,"changeValidator",function(){ValidatorErrors=initValidateError()}),this.listenTo(model,"destroy",function(){this.$el.remove()}),this.listenTo(model,"needShowErr",function(name,flag){switch(name){case"name":this.clearError(this.$el.find(".J_name")),this.showError(this.$el.find(".J_name"),ValidatorErrors.Name[flag],1);break;case"englishFirstName":this.clearError(this.$el.find(".J-english-name .error_tips")),this.showError(this.$el.find(".J-english-name .error_tips .first_name_tip_wrap"),ValidatorErrors.EnglishFirstName[flag],2);break;case"englishLastName":this.clearError(this.$el.find(".J-english-name .error_tips")),this.showError(this.$el.find(".J-english-name .error_tips .last_name_tip_wrap"),ValidatorErrors.EnglishLastName[flag],2);break;case"Other":this.clearError(this.$el.find(".J_card_no")),this.showError(this.$el.find(".J_card_no"),ValidatorErrors.Other[flag],1);break;case"ID":this.clearError(this.$el.find(".J_card_no")),this.showError(this.$el.find(".J_card_no"),ValidatorErrors.ID[flag],1);break;case"Passport":this.clearError(this.$el.find(".J_card_no")),this.showError(this.$el.find(".J_card_no"),ValidatorErrors.Passport[flag],1);break;case"Arm":this.clearError(this.$el.find(".J_card_no")),this.showError(this.$el.find(".J_card_no"),ValidatorErrors.Arm[flag],1);break;case"HKMacao":this.clearError(this.$el.find(".J_card_no")),this.showError(this.$el.find(".J_card_no"),ValidatorErrors.HKMacao[flag],1);break;case"TWMacao":this.clearError(this.$el.find(".J_card_no")),this.showError(this.$el.find(".J_card_no"),ValidatorErrors.TWMacao[flag],1);break;case"TW":this.clearError(this.$el.find(".J_card_no")),this.showError(this.$el.find(".J_card_no"),ValidatorErrors.TW[flag],1);break;case"Mobile":this.clearError(this.$el.find(".J_mobile_no")),this.showError(this.$el.find(".J_mobile_no"),ValidatorErrors.Mobile[flag],1);break;case"validData":this.clearError(this.$el.find(".J_card_valid_date")),this.showError(this.$el.find(".J_card_valid_date "),ValidatorErrors.ValidData[flag],1);break;case"birthDate":this.clearError(this.$el.find(".J_birth_date")),this.showError(this.$el.find(".J_birth_date"),ValidatorErrors.Birthday[flag],1);break;case"Sign":this.clearError(this.$el.find(".T_sign_addr")),this.showError(this.$el.find(".T_sign_addr"),ValidatorErrors.Sign[flag],1);case"height":this.clearError(this.$el.find(".J_height")),this.showError(this.$el.find(".J_height"),ValidatorErrors.Height[flag],1)}}),this.listenTo(this.model,"enNameRemove",function(){this.$el.find(".J-english-name").removeClass("hide")}),this.listenTo(this.model,"enNameAdd",function(){this.$el.find(".J-english-name").addClass("hide")}),this.bindEvents()},modelEvents:{"change:uiStatus":function(){this.model.trigger("calUiStatus")}},bindEvents:function(){var self=this;this.$el.on("click",".cleat_btn",$.proxy(this.onClear,this)),this.$el.on("click",".delete_btn",$.proxy(this.onDelete,this)),this.$el.on("blur",".J_name .field_input",$.proxy(this.onNameBlur,this)),this.$el.on("blur",".J-english-name .field_input.english-name",$.proxy(this.onEnglishFirstNameBlur,this)),this.$el.on("blur",".J-english-name .field_input.english-surname",$.proxy(this.onEnglishLastNameBlur,this)),this.$el.on("focus",".J-english-name .field_input.english-name ",$.proxy(this.onEnglishFirstNameFocus,this)),this.$el.on("focus",".J-english-name .english-surname",$.proxy(this.onEnglishLastNameFocus,this)),this.$el.on("change",".J-english-name input[name=lastName]",$.proxy(this.onLastNameSelect,this)),this.$el.on("click",".J-english-name .submitFirstname",$.proxy(this.onFirstNameSelect,this)),this.$el.on("click",".J-english-name",function(e){e.stopPropagation()}),this.$el.on("focus",".J-english-name .english-name",function(e){self.$el.find(".lastNameList").hide()}),this.$el.on("focus",".J-english-name .english-surname",function(e){self.$el.find(".firstNameList").hide()}),this.$el.on("click",function(e){self.$el.find(".firstNameList,.lastNameList").hide()}),this.$el.on("change",".J_card_type .field_select",$.proxy(this.cardTypeChange,this)),this.$el.on("blur",".J_card_no .card_no",$.proxy(this.onCardNoBlur,this)),this.$el.on("change",".J_birth_date select",$.proxy(this.onBirthDateChange,this)),this.$el.on("change",".J_card_valid_date select",$.proxy(this.onSelectDateChange,this)),this.$el.on("blur",".J_mobile_no .mobile_box",$.proxy(this.onMobileNoBlur,this)),this.$el.on("click",".J_mobile_no .internation_code_box",$.proxy(this.onInternationCodeBlur,this)),this.$el.on("setInternationCode",".J_mobile_no .internation_code_box",$.proxy(this.onInternationCodeSet,this)),this.$el.on("change",".J_sex select",$.proxy(this.onSexChange,this)),this.$el.on("change",".J_customer_property select",$.proxy(this.onCustomerPropertyChange,this)),this.$el.on("click",".input_checkbox",$.proxy(this.onResourceClick,this)),this.bindWriteTipsHover(),this.$el.on("focus",".J_countryName input",$.proxy(this.onCountryListShow,this)),this.$el.on("input",".J_countryName input",$.proxy(this.onCountryKeyChange,this)),this.$el.on("click",".country_detail",$.proxy(this.onCountrySelect,this)),this.$el.on("mouseover",".country_detail",$.proxy(this.onCountryListMouseOver,this)),this.$el.on("keyup",$.proxy(this.onKeyUp,this)),this.$el.on("click",".tourist-simple .edit_btn",$.proxy(this.onEditing,this)),this.$el.on("click",".collapse_btn",$.proxy(this.onCollapse,this)),1==this.model.get("serial")&&$(document).on("click",function(e){return!$(e.target).parents().is(".country_select")&&(!$(e.target).hasClass("country_index")&&void $(".country_select").hide())}),this.$el.on("change",".T_sign_type .field_select",$.proxy(this.signTypeChange,this)),this.$el.on("mouseenter",".T_sign_box .T_menu a",$.proxy(this.changeSignTypeImg,this)),this.$el.on("blur",".T_sign_addr .field_input",$.proxy(this.signAddrBlur,this)),this.$el.on("click",".T_sign_addr .T_later",$.proxy(this.laterInputSignAddr,this)),this.$el.on("click",".T_sign_addr .T_later_text a",$.proxy(this.nowInputSignAddr,this)),this.$el.on("click",".save-to-common label",$.proxy(this.saveCommon,this)),this.$el.on("click",".show-visa-user label",$.proxy(this.selectVisa,this)),this.$el.on("change",".J_height select",$.proxy(this.changeHeight,this))},onEditing:function(){this.model.set("uiStatus","expanded")},onClear:function(){this.model.clear()},onCollapse:function(){return this.model.isEmpty()?void Layer.msg("请填写出游人信息!"):void this.model.set("uiStatus","collapsed")},onDelete:function(){this.model.deleteItem()},onCountryListShow:function(e){var html=this.makeCountryListHtml(this.model.getCountryList($(e.target).val()));this.$el.find(".country_select").html(html).show()},makeCountryListHtml:function(data){var html="";return html+='<p class="country_title">'+data.msg+"</p>",data.countrylist&&data.countrylist.length&&(html+='<ul class="country_list">',_.each(data.countrylist,function(oneCountry,index){html+='<li class="country_detail"><span class="country_chinese_name" data-countryid="'+oneCountry.countryId+'">'+oneCountry.name+'</span><span class="country_english_name">'+oneCountry.englishName+"</span></li>"}),html+="</ul>"),html},onCountryKeyChange:function(e){var html=this.makeCountryListHtml(this.model.getCountryList($(e.target).val()));this.$el.find(".country_select").html(html).show()},onCountrySelect:function(e){var country_chinese_name="";country_chinese_name=$(e.target).hasClass("country_detail")?$(e.target).find(".country_chinese_name").text():$(e.target).parent().find(".country_chinese_name").text(),country_chinese_name&&(this.$el.find(".J_countryName input").val(country_chinese_name),this.model.set("country",country_chinese_name)),$(".country_select").hide()},onCountryListMouseOver:function(e){$(e.target).parent().find(".country_detail").removeClass("hover"),$(e.target).addClass("hover")},onKeyUp:function(e){if(!$(".country_select").is(":hidden")){var showIndex=$(".country_select:visible .country_detail.hover").index(),maxIndex=$(".country_select:visible .country_detail").length-1;if(40==e.keyCode)var nowIndex=showIndex+1>maxIndex?0:showIndex+1;else if(38==e.keyCode)var nowIndex=showIndex-1>-1?showIndex-1:maxIndex;$(".country_select:visible .country_detail").removeClass("hover"),$(".country_select:visible .country_detail:eq("+nowIndex+")").addClass("hover"),$(".country_select:visible  .country_list").scrollTop(156*parseInt(nowIndex/6))}},onResourceClick:function(e){if($(e.target).hasClass("disable"))return!1;var self=this,resId=$(e.target).parents(".resource_li").data("resid"),allResource=self.model.get("resource"),resourceArr=[];for(var k in allResource)resourceArr.push($.extend({},allResource[k]));for(var k in resourceArr){var cell=resourceArr[k];cell.resId==resId&&(cell.select?(cell.select=0,this.model.finalSet("resource",resourceArr),this.model.trigger("unBindTicket",resId)):(cell.select=1,this.model.trigger("beforeSelectResource",resId,resourceArr,this.model)))}},renderRepeat:function(){Layer.msg("手机号码重复，请确认填写正确")},onNameBlur:function(e){var field=$(e.target).parents(".J_name"),name=$(e.target).val();this.clearError(field);var flag=this.model.checkName(name);1!=flag?(this.showError(field,ValidatorErrors.Name[flag],1),this.model.set({name:name},{silent:!0}),this.model.get("name")!=name):(this.model.set({name:name},{silent:!0}),this.model.getEnglishNameList(name),this.model.setName(name),this.model.get("name")!=name&&this.model.changeStatus("chinesePingyinName",0))},onEnglishFirstNameBlur:function(e){var obj=$(e.target),field=obj.parents(".J-english-name"),name=obj.val();this.clearError(field),this.model.get("englishFirstName")!=name,this.setEnglishNameError()},onEnglishLastNameFocus:function(e){var self=this,lastNameList=this.model.getChineseList(1);if(lastNameList&&lastNameList.length)if(1==lastNameList.length&&1==lastNameList[0].englishName.length)self.model.set("englishLastName",lastNameList[0].englishName[0],{silent:!0}),$(e.currentTarget).val(lastNameList[0].englishName[0]);else{var html="";_.each(lastNameList,function(oneName,index){oneName&&oneName.englishName&&(html+='<p data-index="'+index+'"><span class="english-radio-title">'+oneName.chineseName+"</span>",_.each(oneName.englishName,function(cell,index){html+='<input type="radio" name="lastName" id="lastName" value="'+cell+'" class="englishNameRadio"/><label for="lastName">'+cell+"</label>"}),html+="</p>")}),this.$el.find(".lastNameList").html(html).show()}},onLastNameSelect:function(e){var lastName=this.$el.find("input[name=lastName]:checked").val();this.model.selectLastName(this.$el.find("input[name=lastName]:checked").parent().data("index")),this.model.set("englishLastName",lastName);
},onFirstNameSelect:function(){for(var lastNameLength=this.$el.find(".firstNameList p").length,lastNameArray=[],k=0;k<lastNameLength;k++){var lastNamekey="firstName"+k,lastName=this.$el.find("input[name="+lastNamekey+"]:checked").val();lastNameArray.push(lastName)}this.model.set({englishFirstName:lastNameArray.join(""),lastNameArray:lastNameArray})},onEnglishFirstNameFocus:function(e){var self=this,firstNameList=this.model.getChineseList();if(firstNameList&&firstNameList.length){var duoyinzi=_.find(firstNameList,function(oneName){return 1!=oneName.englishNames.length});if(duoyinzi){var html="";_.each(firstNameList,function(oneName,index){if(oneName&&oneName.englishNames){if(html+='<p data-index="'+index+'"><span class="english-radio-title">'+oneName.chineseName+"</span>",oneName.englishNames&&1==oneName.englishNames.length){var cell=oneName.englishNames[0];html+='<input type="radio" name="firstName'+index+'" id="firstName'+index+'" value="'+cell+'" class="englishNameRadio" checked/><label for="firstName">'+cell+"</label>"}else _.each(oneName.englishNames,function(cell){html+='<input type="radio" name="firstName'+index+'" id="firstName'+index+'" value="'+cell+'" class="englishNameRadio"/><label for="lastName">'+cell+"</label>"});html+="</p>"}}),html+='<span class="submitFirstname">确定</span>',this.$el.find(".firstNameList").html(html).show()}else{var firstName="";_.each(firstNameList,function(oneName){firstName+=oneName.englishNames[0]}),self.model.set("englishFirstName",firstName,{silent:!0}),$(e.currentTarget).val(firstName)}}},onLastNameClick:function(){var lastName=$("input[name=lastName]:checked").val();this.model.set("lastEnglishName",lastName)},onEnglishLastNameBlur:function(e){var obj=$(e.target),field=obj.parents(".J-english-name"),name=obj.val();this.clearError(field),this.model.get("englishLastName")!=name,this.setEnglishNameError()},setEnglishNameError:function(){var field=this.$el.find(".J-english-name"),lastName=field.find(".english-surname").val(),firstName=field.find(".english-name").val(),flag1=this.model.checkEnglishLastName(lastName),flag2=this.model.checkEnglishFirstName(firstName);1!=flag1&&1!=flag2?this.showError(field,ValidatorErrors.EnglishName[2],2):1!=flag1?this.showError(field,ValidatorErrors.EnglishLastName[flag1],2):1!=flag2&&this.showError(field,ValidatorErrors.EnglishFirstName[flag2],2),this.model.set({englishLastName:lastName,englishFirstName:firstName},{silent:!0})},cardTypeChange:function(e){var target=$(e.target),container=$(target).parents(".tourist_info");"child"===container.attr("data-type")||"freeChild"===container.attr("data-type"),$(target).find("option:selected").text();this.model.get("cardType")!=$(target).val(),this.model.set({cardType:$(target).val()}),this.$el.find(".J_card_no .card_no").trigger("blur")},bindWriteTipsHover:function(){this.$el.find(".write_tips_text");var self=this;$(this.el).on("click",".card_name",function(e){self.$el.find(".card_name").removeClass("activity"),$(e.target).addClass("activity"),self.$el.find(".card_img").find("li").hide(),self.$el.find("."+$(e.target).data("cardimg")+"_img").show()})},resetBirthday:function(cardsType){if(!this.model.get("birthDate")&&"1"!=cardsType){var field=this.$el.find(".J_birth_date"),yearField=$(field).find("select[data-year]"),monthField=$(field).find("select[data-month]"),dayField=$(field).find("select[data-day]");this.model.set({birthDate_year:$(yearField).val()},{silent:!0}),this.model.set({birthDate_month:$(monthField).val()},{silent:!0}),this.model.set({birthDate_day:$(dayField).val()},{silent:!0});var birthday=$(yearField).val()+"-"+getTwoBitsString($(monthField).val())+"-"+getTwoBitsString($(dayField).val());this.model.set({birthDate:birthday},{silent:!0})}},onInternationCodeBlur:function(e){icBox.init({dom:$(e.target)}),e.stopPropagation()},onInternationCodeSet:function(e){var telCountryId=$(e.target).data("telCountryId"),intlCode=$(e.target).data("intlCode");this.model.set({intlCode:intlCode,telCountryId:telCountryId},{silent:!0}),this.$el.find(".mobile_box").trigger("blur")},resetValiddate:function(cardsType){if(!this.model.get("cardValidDate")&&"1"!=cardsType&&"7"!=cardsType&&"3"!=cardsType){var field=this.$el.find(".J_card_valid_date"),yearField=$(field).find("select[data-year]"),monthField=$(field).find("select[data-month]"),dayField=$(field).find("select[data-day]");this.model.set({cardValidDate_year:$(yearField).val()},{silent:!0}),this.model.set({cardValidDate_month:$(monthField).val()},{silent:!0}),this.model.set({cardValidDate_day:$(dayField).val()},{silent:!0});var cardValidDate=$(yearField).val()+"-"+getTwoBitsString($(monthField).val())+"-"+getTwoBitsString($(dayField).val());this.model.set({cardValidDate:cardValidDate},{silent:!0})}},onCardNoBlur:function(e){var field=$(e.target).parents(".J_card_no"),value=$(e.target).val();this.clearError(field);var container=$(field).parents(".tourist_info"),cardType=$(container).find(".J_card_type .field_select").val(),flag=1,errorMsg="";switch(cardType){case"1":flag=this.model.checkIdCard(value),errorMsg=ValidatorErrors.ID[flag],this.changeBirthDate(value);break;case"2":flag=this.model.checkPassport(value),errorMsg=ValidatorErrors.Passport[flag];break;case"3":flag=this.model.checkJunguanzheng(value),errorMsg=ValidatorErrors.Arm[flag];break;case"4":flag=this.model.checkHKMacao(value),errorMsg=ValidatorErrors.HKMacao[flag];break;case"7":flag=this.model.checkTW(value),errorMsg=ValidatorErrors.TW[flag];break;case"8":flag=this.model.checkHuixiangzheng(value),errorMsg=ValidatorErrors.Huixiangzheng[flag];break;case"9":flag=this.model.checkHukouben(value),errorMsg=ValidatorErrors.Hukouben[flag];break;case"10":flag=this.model.checkChushengzhengming(value),errorMsg=ValidatorErrors.Chushengzhengming[flag];break;case"11":flag=this.model.checkTWMacao(value),errorMsg=ValidatorErrors.TWMacao[flag]}this.model.get("cardNo")!=value,1!=flag?(this.model.set({cardNo:value},{silent:!0}),this.showError(field,errorMsg,1)):this.model.setCardsNo(value)},changeBirthDate:function(cardNo){var pat,self=this;pat=18==cardNo.length?/\d{6}(\d{4})(\d{2})(\d{2})[\da-zA-Z]{4}/g:/\d{6}(\d{2})(\d{2})(\d{2})[\da-zA-Z]{3}/g;var res=pat.exec(cardNo);if(res){self.model.set({birthDate_year:parseInt(res[1],10)},{silent:!0}),self.model.set({birthDate_month:parseInt(res[2],10)},{silent:!0}),self.model.set({birthDate_day:parseInt(res[3],10)},{silent:!0});var birthday=parseInt(res[1],10)+"-"+("0"+parseInt(res[2],10)).slice(-2)+"-"+("0"+parseInt(res[3],10)).slice(-2);this.model.get("birthDate")!=birthday,self.model.set({birthDate:birthday},{silent:!0})}},onBirthDateChange:function(e){function renderMonth(){$(monthField).empty();for(var options="",i=0;i<12;i++)options+="<option>"+(i+1)+"</option>";$(monthField).html(options)}function renderDay(){var date=new Date(year+"/"+month+"/1");date.setMonth(parseInt(month)),date.setDate(0);for(var days=date.getDate(),options="",i=0;i<days;i++)options+="<option>"+(i+1)+"</option>";$(dayField).html(options)}var field=$(e.target).parents(".field"),yearField=$(field).find("select[data-year]"),monthField=$(field).find("select[data-month]"),dayField=$(field).find("select[data-day]"),year=yearField.val(),month=monthField.val(),self=(dayField.val(),this);if(this.clearError(field),""==$(e.target).attr("data-year")){renderMonth(),renderDay(),self.model.set({birthDate_year:$(yearField).val()},{silent:!0}),self.model.set({birthDate_month:$(monthField).val()},{silent:!0}),self.model.set({birthDate_day:$(dayField).val()},{silent:!0});var birthday=$(yearField).val()+"-"+getTwoBitsString($(monthField).val())+"-"+getTwoBitsString($(dayField).val());this.model.get("birthDate_year")!=$(yearField).val(),this.model.get("birthDate")!=birthday,self.model.set({birthDate:birthday},{silent:!0})}if(""==$(e.target).attr("data-month")){renderDay(),self.model.set({birthDate_month:$(monthField).val()},{silent:!0}),self.model.set({birthDate_day:$(dayField).val()},{silent:!0});var birthday=$(yearField).val()+"-"+getTwoBitsString($(monthField).val())+"-"+getTwoBitsString($(dayField).val());this.model.get("birthDate_month")!=$(monthField).val(),this.model.get("birthDate")!=birthday,self.model.set({birthDate:birthday},{silent:!0})}if(""==$(e.target).attr("data-day")){self.model.set({birthDate_day:$(dayField).val()},{silent:!0});var birthday=$(yearField).val()+"-"+getTwoBitsString($(monthField).val())+"-"+getTwoBitsString($(dayField).val());this.model.get("birthDate_day")!=$(dayField).val(),this.model.get("birthDate")!=birthday,self.model.set({birthDate:birthday},{silent:!0})}var _year=$(yearField).val(),_month=$(monthField).val()-1,_day=$(dayField).val(),_birth=new Date(_year,_month,_day),now=new Date;this.model.checkBirthDay(_birth,now)},onSexChange:function(e){var field=$(e.target).parents(".field"),sexField=$(field).find("select[data-year]"),self=(sexField.val(),this);self.model.set({sex:$(e.target).val()},{silent:!0}),this.model.get("sex")!=$(e.target).val()},onCustomerPropertyChange:function(e){var obj=$(e.currentTarget),val=obj.val(),name=obj.find("option:selected").text();this.model.set({customerPropertyId:val,customerPropertyName:name},{silent:!0})},onSelectDateChange:function(e){function renderMonth(){$(monthField).empty();for(var options="",i=0;i<12;i++)options+="<option>"+(i+1)+"</option>";$(monthField).html(options)}function renderDay(){var date=new Date(year+"/"+month+"/1");date.setMonth(parseInt(month)),date.setDate(0);for(var days=date.getDate(),options="",i=0;i<days;i++)options+="<option>"+(i+1)+"</option>";$(dayField).html(options)}var msg,field=$(e.target).parents(".field"),yearField=$(field).find("select[data-year]"),monthField=$(field).find("select[data-month]"),dayField=$(field).find("select[data-day]"),year=yearField.val(),month=monthField.val(),day=dayField.val(),self=this,date=(new Date,new Date(year+"/"+month+"/"+day)),backDate=new Date(pageDataObj.backDate),cardType=$(e.target).parent().parent().find(".J_card_type").find("option:selected").text();if(this.clearError(field),"护照"===cardType?(msg="证件有效期需在出游归来六个月以上",backDate.setMonth(backDate.getMonth()+6)):msg="证件有效期需在归来日期之后",date<backDate&&this.showError(field,msg,1),""==$(e.target).attr("data-year")){renderMonth(),renderDay(),self.model.set({cardValidDate_year:$(yearField).val()},{silent:!0}),self.model.set({cardValidDate_month:$(monthField).val()},{silent:!0}),self.model.set({cardValidDate_day:$(dayField).val()},{silent:!0});var cardValidDate=$(yearField).val()+"-"+getTwoBitsString($(monthField).val())+"-"+getTwoBitsString($(dayField).val());this.model.get("cardValidDate_year")!=$(yearField).val(),this.model.get("cardValidDate")!=cardValidDate,self.model.set("cardValidDate",cardValidDate,{silent:!0})}if(""==$(e.target).attr("data-month")){renderDay(),self.model.set({cardValidDate_month:$(monthField).val()},{silent:!0}),self.model.set({cardValidDate_day:$(dayField).val()},{silent:!0});var cardValidDate=$(yearField).val()+"-"+getTwoBitsString($(monthField).val())+"-"+getTwoBitsString($(dayField).val());this.model.get("cardValidDate_month")!=$(monthField).val(),this.model.get("cardValidDate")!=cardValidDate,self.model.set({cardValidDate:cardValidDate},{silent:!0})}if(""==$(e.target).attr("data-day")){self.model.set({cardValidDate_day:$(dayField).val()},{silent:!0});var cardValidDate=$(yearField).val()+"-"+getTwoBitsString($(monthField).val())+"-"+getTwoBitsString($(dayField).val());this.model.get("cardValidDate_day")!=$(dayField).val(),this.model.get("cardValidDate")!=cardValidDate,self.model.set({cardValidDate:cardValidDate},{silent:!0})}},onMobileNoBlur:function(e){var field=$(e.target).parents(".J_mobile_no"),value=$(e.target).val(),index=$(e.target).parents(".tourist_info").parent("div").index();if(this.clearError(field),this.model.get("mobileNo")!=value,value){var flag=this.model.checkMobile(value),isRepeatFlag=this.checkIsRepeat(value,index),thisAge=this.model.getAge().deltaAge;1!=flag?this.showError(field,ValidatorErrors.Mobile[flag],1):(1!=Backbone.app.get("isSelectTran")&&21!=Backbone.app.get("resType")&&1!=pageDataObj.singleFlightFlag||thisAge>12&&thisAge<70&&(1==isRepeatFlag?this.showError(field,ValidatorErrors.Mobile[6],6):this.clearError(field)),this.model.set({mobileNo:value,intlTel:this.model.get("intlCode")+value},{silent:!0}))}else this.model.set({mobileNo:value},{silent:!0}),this.model.setMobileNo(value)},getCardTypeList:function(allList,ticketerList){var result=[];return allList&&1==allList.length&&0==allList[0].value&&this.model.get("isTicketer")?result=ticketerList?ticketerList:allList:ticketerList&&ticketerList.length&&this.model.get("isTicketer")?_.each(allList,function(v){_.some(ticketerList,function(i){v.value==i.value&&result.push(v)})}):result=allList,result},checkIsRepeat:function(data,flag){var arr=[],passes=$("#J_Passes").children("div");return _.each(passes,function(item,index){var val=$(item).find(".mobile_box").val();val&&index!=flag&&arr.push(val)}),_.indexOf(arr,data)>-1?1:2},arrRepeat:function(){var nary,flag=0,passes=$("#J_Passes").children("div"),arr=[];_.each(passes,function(item,index){var val=$(item).find(".mobile_box").val();val&&arr.push(val)}),nary=arr.sort();for(var i=0;i<arr.length;i++)nary[i]==nary[i+1]&&(flag=1);return flag},showError:function(field,errorMsg,isErrorFlag){var errorSpan;void 0===isErrorFlag?(errorSpan=$('<span class="error-tips"></span>').append('<span class="icon"></span>').append(errorMsg),$(field).append(errorSpan)):1===isErrorFlag?(errorSpan=$('<span class="error-tips"></span>').append('<span class="icon error-icon"></span>').append(errorMsg),$(field).append(errorSpan).addClass("write-error")):2===isErrorFlag?(errorSpan=$('<span class="error-tips"></span>').append('<span class="icon error-icon"></span>').append(errorMsg),$(field).append(errorSpan).addClass("write-error")):6===isErrorFlag&&(errorSpan=$('<span class="error-tips"></span>').append('<span class="icon notice2-icon"></span>').append(errorMsg),$(field).append(errorSpan))},clearThisError:function(flag){this.$el.find(".show-visa-user").each(function(index,item){var index=$(item).data("index");index==flag&&$(item).removeClass("write-error").find("span.error-tips").remove()})},clearAllVisaError:function(){this.$el.find(".show-visa-user").each(function(index,item){$(item).removeClass("write-error").find("span.error-tips").remove()})},clearError:function(field){$(field).removeClass("write-error").find("span.error-tips").remove()},render:function(){var data=this.model.toJSON(),cardTypeList=this.model.getCardTypeList();data.InfoFlag&&data.cardTypeListModify&&(cardTypeList=data.cardTypeListModify);var ifTempo=_.some(cardTypeList,function(item){return 999==item.value});this.model.setNewCardType(cardTypeList),data.cardTypeList=cardTypeList,data.cardType=this.model.get("cardType"),data.internationalRoute=pageDataObj.internationalRoute,data.customerProperty=pageDataObj.customerProperty,data.showSwitch=this.model.changeShowSwitch(cardTypeList),data.tempoTip=ifTempo&&999!=this.model.get("cardType"),this.$el.html(touristInfoTemplate(data))},renderPage:function(){var data=this.model.toJSON(),cardTypeList=this.model.getCardTypeList(),ifTempo=_.some(cardTypeList,function(item){return 999==item.value});return this.model.setNewCardType(cardTypeList),data.showSwitch=this.model.changeShowSwitch(cardTypeList),data.cardTypeList=cardTypeList,data.cardType=this.model.get("cardType"),data.internationalRoute=pageDataObj.internationalRoute,data.customerProperty=pageDataObj.customerProperty,data.tempoTip=ifTempo&&999!=this.model.get("cardType"),this.$el.html(touristInfoTemplate(data)),this.$el},showEnglishNameNote:function(e){var obj=$(e.target),div=$("<div>");div.addClass("note_tips"),div.text("* 特别提醒：如姓名为张小明，则在“姓（拼音或英文）”栏中输入ZHANG；在“名（拼音或英文）”栏中输入XIAOMING"),obj.parent().children(".note_tips").length||obj.parent().append(div)},signTypeChange:function(e){var target=$(e.target),val=+target.val();this.model.setSignType(val)},changeSignTypeImg:function(e){var target=$(e.target),box=this.$el.find(".T_sign_box"),gWrapper=box.find(".T_picture").eq(0),lWrapper=box.find(".T_picture").eq(1);target.hasClass("T_sign_G")?(gWrapper.removeClass("hide"),lWrapper.addClass("hide")):(gWrapper.addClass("hide"),lWrapper.removeClass("hide")),target.siblings().removeClass("T_active"),target.addClass("T_active")},signAddrBlur:function(e){var target=$(e.target),field=target.parent(),val=target.val();this.clearError(field);var flag=this.model.checkSignAddr(val);1!=flag?this.showError(field,ValidatorErrors.Sign[flag],1):this.model.setSignAddr(val)},laterInputSignAddr:function(){this.model.laterInputSignAddr()},nowInputSignAddr:function(){this.model.nowInputSignAddr()},saveCommon:function(e){this.model.saveCommon()},selectVisa:function(e){var target=$(e.currentTarget),thisIndex=target.parent(".show-visa-user").data("index"),resId=target.data("resid"),isSelect=target.hasClass("enabled");isSelect?this.model.cancelThis(resId):this.model.calculaVisaCount(thisIndex,resId)},changeHeight:function(e){var target=$(e.currentTarget),index=+target.find("option:selected").attr("data-index");"child"==this.model.get("type")&&(3==index?this.model.set("isFreeChild",1,{silent:!0}):1!=index&&2!=index||this.model.set("isFreeChild",0,{silent:!0})),this.model.set("heightIndex",index)}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,cruise=($utils.$helpers,$data.cruise),serial=$data.serial,$escape=$utils.$escape,uiStatus=$data.uiStatus,type=$data.type,isChild=$data.isChild,isFreeChild=$data.isFreeChild,labelText=$data.labelText,name=$data.name,InfoFlag=$data.InfoFlag,showSwitch=$data.showSwitch,englishLastName=$data.englishLastName,englishLastNameModify=$data.englishLastNameModify,englishFirstName=$data.englishFirstName,englishFirstNameModify=$data.englishFirstNameModify,country=$data.country,needCountryModify=$data.needCountryModify,j=$data.j,cardTypeList=$data.cardTypeList,cardType=$data.cardType,cardNo=$data.cardNo,cardNoModify=$data.cardNoModify,tempoTip=$data.tempoTip,_=$data._,visaTypes=$data.visaTypes,signType=($data.item,$data.signType),nowInputSignAddr=$data.nowInputSignAddr,signAddr=$data.signAddr,hkmacIssueOrganModify=$data.hkmacIssueOrganModify,sexModify=$data.sexModify,sex=$data.sex,cardValidDateModify=$data.cardValidDateModify,y=$data.y,cardValidDate_year=$data.cardValidDate_year,m=$data.m,cardValidDate_month=$data.cardValidDate_month,d=$data.d,cardValidDate_day=$data.cardValidDate_day,birthDateModify=$data.birthDateModify,birthDate_year=$data.birthDate_year,birthDate_month=$data.birthDate_month,birthDate_day=$data.birthDate_day,i=$data.i,customerProperty=$data.customerProperty,customerPropertyId=$data.customerPropertyId,telValue=$data.telValue,intlCode=$data.intlCode,telCountryIdModify=$data.telCountryIdModify,mobileNo=$data.mobileNo,mobileNoModify=$data.mobileNoModify,resType=$data.resType,heightOption=$data.heightOption,heightIndex=($data.index,$data.heightIndex),needBindResource=$data.needBindResource,resource=$data.resource,needSaveCommon=$data.needSaveCommon,visaResName=$data.visaResName,backEditing=$data.backEditing,canDelete=$data.canDelete,hasTakeSeat=$data.hasTakeSeat,bookStep=$data.bookStep,cardTypeMap=$data.cardTypeMap,$out="";if(cruise&&($out+='\r\n<div class="T_cruise_info ',1!=serial&&($out+="hide"),$out+='">\r\n    <i class="T_circle"></i>\r\n    <strong class="f-ol" title="',$out+=$escape(cruise.roomTypeName),$out+='">',$out+=$escape(cruise.roomTypeName),$out+="</strong>\r\n    <small>\r\n        ",cruise.minCapacity==cruise.maxCapacity?($out+="\r\n        必须住",$out+=$escape(cruise.minCapacity),$out+="人\r\n        "):($out+="\r\n        可入住",$out+=$escape(cruise.minCapacity),$out+="-",$out+=$escape(cruise.maxCapacity),$out+="人\r\n        "),$out+="\r\n    </small>\r\n    ",0==cruise.cabinIndex&&0==cruise.roomIndex&&($out+='\r\n    <em>\r\n        <i class="icon notice2-icon"></i>\r\n        每间舱房的入住情况由系统自动分配，如果不符合您的入住要求可以在下单后联系客服进行调整\r\n    </em>\r\n    '),$out+="\r\n</div>\r\n"),$out+='\r\n<div class="tourist_info mt20 ',$out+=$escape(uiStatus),$out+='" data-type="',$out+=$escape(type),$out+='">\r\n    <div class="fl-panel">\r\n        <div class="top">\r\n            <input class="field_input touristType" type="hidden">第<span class="num">',$out+=$escape(serial),$out+='</span>位\r\n        </div>\r\n        <div class="bottom ',(isChild||isFreeChild)&&($out+="child"),$out+='">\r\n            ',$out+=$escape(labelText),$out+='\r\n        </div>\r\n    </div>\r\n\r\n    <div class="fr-panel">\r\n        <div class="field J_name">\r\n            <label class="field_label"><em class="stars">* </em>中文姓名：</label>\r\n            <input class="field_input " type="text" value="',$out+=$escape(name),$out+='" placeholder="请与证件保持一致" ',InfoFlag&&name&&($out+=" readonly "),$out+=" >\r\n\r\n            ",showSwitch.showWriteTips&&($out+='\r\n            <div class="instructions write-tips-hover">填写说明\r\n                <div class="write_tips_box">\r\n                    <div class="cardImg">\r\n                        <ul class="change_card_img_tab">\r\n                            <li class="card_name activity" data-cardimg="oldHuzhao">老版护照</li>\r\n                            <li class="card_name" data-cardimg="newHuzhao">新版护照</li>\r\n                            <li class="card_name" data-cardimg="gangao">港澳通行证</li>\r\n                            <li class="card_name" data-cardimg="taiwan">台湾通行证</li>\r\n                        </ul>\r\n                        <ul class="card_img">\r\n                            <li class="oldHuzhao_img">\r\n                                <img src="//ssl3.tuniucdn.com/img/201610271530/bookOnline/card_img_oldhuzhao.png">\r\n                            </li>\r\n                            <li class="newHuzhao_img hide">\r\n                                <img src="//ssl3.tuniucdn.com/img/201610271530/bookOnline/card_img_newhuzhao.png">\r\n                            </li>\r\n                            <li class="gangao_img hide">\r\n                                <img src="//ssl3.tuniucdn.com/img/201610271530/bookOnline/card_img_gangao.png">\r\n                            </li>\r\n                            <li class="taiwan_img hide">\r\n                                <img src="//ssl3.tuniucdn.com/img/201610271530/bookOnline/card_img_taiwan.png">\r\n                            </li>\r\n                        </ul>\r\n\r\n                    </div>\r\n                    <div class="write_note">\r\n                        <p class="rule_tips">*请严格按照所选证件线上的信息填写</p>\r\n                        <p class="notes">填写说明</p>\r\n                        <ul>\r\n                            <li>1.乘客姓名需与所选证件上的名字一致。</li>\r\n                            <li>2.中文姓名:\r\n                                <p>·若持护照登机,必须确认护照上有中文姓名。</p>\r\n                                <p>·生僻字可用拼音代替,例如:"王赟"可输入为"王yun"。</p>\r\n                            </li>\r\n                            <li>3.英文姓名:\r\n                                <p>大陆籍游客,英文名为中文名拼音,若持护照登机,必须按照护照顺序区分姓与名,按照图示填写英文名。</p>\r\n                            </li>\r\n                            <li>4.英文名字的长度不可超过26个字符, 如名字过长请使用缩写,乘客的姓氏不能缩写,名可以缩写。姓氏中如包括空格请在输入时删掉空格。\r\n                            </li>\r\n                        </ul>\r\n                    </div>\r\n                    <span class="q">◆</span>\r\n                    <span class="w">◆</span>\r\n                </div>\r\n            </div>\r\n            '),$out+="\r\n        </div>\r\n\r\n        ",showSwitch.showEnglishName&&($out+='\r\n        <div class="field J-english-name">\r\n            <label class="field_label"><em class="stars">* </em>英文姓名：</label>\r\n            <div class="englishNameBar T_first">\r\n                <input class="field_input english-surname" placeholder="拼音姓" type="text" value="',$out+=$escape(englishLastName),$out+='" ',InfoFlag&&englishLastNameModify&&($out+=' disabled="disabled" '),$out+='>\r\n                <div class="lastNameList hide"></div>\r\n            </div>\r\n            <div class="englishNameBar">\r\n                <input class="field_input english-name" type="text" placeholder="拼音名" value="',$out+=$escape(englishFirstName),$out+='" ',InfoFlag&&englishFirstNameModify&&($out+=' disabled="disabled" '),$out+='>  \r\n                <div class="firstNameList hide"></div>\r\n            </div>\r\n            <div class="name-tips jtxz-detail-hover">\r\n                <i class="icon notice2-icon"></i>\r\n                <div class="jtxz-detail2 T_width2">\r\n                    <p class="YD_mgb">特别提醒：大陆籍游客，英文姓名为中文姓名拼音，如姓名为张小明，则在“姓(拼音或英文)”栏中输入ZHANG; 在“名(拼音或英文)”栏中输入XIAOMING</p>\r\n                    <span class="z">◆</span>\r\n                    <span class="j">◆</span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        '),$out+="\r\n\r\n        ",showSwitch.showPingyin&&($out+='\r\n        <div class="field J-english-name">\r\n            <label class="field_label"><em class="stars">* </em>英文姓名：</label>\r\n            <div class="englishNameBar T_first">\r\n                <input class="field_input english-surname" placeholder="拼音姓" type="text" value="',$out+=$escape(englishLastName),$out+='" ',InfoFlag&&englishLastNameModify&&($out+=" readonly "),$out+='>\r\n                <div class="lastNameList hide"></div>\r\n            </div>\r\n            <div class="englishNameBar">\r\n                <input class="field_input english-name" type="text" placeholder="拼音名" value="',$out+=$escape(englishFirstName),$out+='" ',InfoFlag&&englishFirstNameModify&&($out+=" readonly "),$out+='>\r\n                <div class="firstNameList hide"></div>\r\n            </div>\r\n        </div>\r\n        <div class="tel_tips">\r\n            含生僻字，请填写汉语拼音\r\n        </div>\r\n        '),$out+="\r\n\r\n        ",showSwitch.showCountryList&&($out+='\r\n        <div class="field nationality J_countryName">\r\n            <label class="field_label"><em class="stars">* </em>国籍：</label>\r\n            <input class="field_input country_index" type="text" placeholder="中国大陆" value="',$out+=$escape(country),$out+='" ',InfoFlag&&needCountryModify&&($out+=' disabled="disabled" '),$out+='>\r\n            <div class="country_select hide"></div>\r\n        </div>\r\n        '),$out+="\r\n\r\n        ",showSwitch.showCardType){$out+='\r\n        <div class="field J_card_type J_card_no">\r\n            <label class="field_label"><em class="stars">* </em>证件类型：</label>\r\n            <select class="field_select">\r\n                    ';for(var j=0;j<cardTypeList.length;j++)$out+='\r\n                    <option value="',$out+=$escape(cardTypeList[j].value),$out+='" ',cardTypeList[j].value==cardType&&($out+="selected"),$out+=">",$out+=$escape(cardTypeList[j].name),$out+="</option>\r\n                    ";$out+="\r\n            </select>\r\n            ",showSwitch.showCardNum&&($out+='\r\n            <input class="field_input card_no" type="text" value="',$out+=$escape(cardNo),$out+='" placeholder="证件号码" ',InfoFlag&&cardNoModify&&($out+=" readonly "),$out+=">\r\n            "),$out+="\r\n            ",tempoTip&&($out+='\r\n            <div class="name-tips jtxz-detail-hover">\r\n                <i class="icon notice2-icon"></i>\r\n                <div class="jtxz-detail2 auto-width">\r\n                    <p class="YD_mgb">可选“稍后提供”</p>\r\n                    <span class="z">◆</span>\r\n                    <span class="j">◆</span>\r\n                </div>\r\n            </div>\r\n            '),$out+="\r\n        </div>\r\n        "}if($out+="\r\n\r\n        ",showSwitch.showSignType&&($out+='\r\n        <div class="field T_sign_type">\r\n            <label class="field_label"><em class="stars">* </em>签注类型：</label>\r\n            <select name="" id="" class="field_select">\r\n                ',_.each(visaTypes,function(item){$out+='\r\n                <option value="',$out+=$escape(item.type),$out+='" ',item.type==signType&&($out+="selected"),$out+=">",$out+=$escape(item.visaType),$out+="</option>\r\n                "}),$out+='\r\n            </select>\r\n            <span class="T_operation T_sign_note">\r\n                图示\r\n                <div class="T_sign_container hide">\r\n                    <div class="T_sign_box">\r\n                        <span class="T_sign_triangle_inner"></span>\r\n                        <span class="T_sign_triangle_out"></span>\r\n                        <div class="T_menu">\r\n                            <a href="javascript:;" class="T_sign_G T_active">G签</a>\r\n                            <a href="javascript:;" class="T_sign_L">L签</a>\r\n                        </div>\r\n                        <div class="T_picture">\r\n                            <div class="T_wrapper">\r\n                                <div class="T_title">新版</div>\r\n                                <div class="T_img">\r\n                                    <img src="//ssl2.tuniucdn.com/img/201701201501/bookOnline/G_new.png" alt="G签新版">\r\n                                </div>\r\n                            </div>\r\n                            <div class="T_line"></div>\r\n                            <div class="T_wrapper">\r\n                                <div class="T_title">旧版</div>\r\n                                <div class="T_img">\r\n                                    <img src="//ssl2.tuniucdn.com/img/201701201501/bookOnline/G_old.png" alt="G签旧版">\r\n                                </div>\r\n                            </div>\r\n                            <div class="clear-float"></div>\r\n                        </div>\r\n                        <div class="T_picture hide">\r\n                            <div class="T_wrapper">\r\n                                <div class="T_title">新版</div>\r\n                                <div class="T_img">\r\n                                    <img src="//ssl2.tuniucdn.com/img/201701201501/bookOnline/L_new.png" alt="L签新版">\r\n                                </div>\r\n                            </div>\r\n                            <div class="T_line"></div>\r\n                            <div class="T_wrapper">\r\n                                <div class="T_title">旧版</div>\r\n                                <div class="T_img">\r\n                                    <img src="//ssl2.tuniucdn.com/img/201701201501/bookOnline/L_old.png" alt="L签旧版">\r\n                                </div>\r\n                            </div>\r\n                            <div class="clear-float"></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </span>\r\n        </div>\r\n        '),$out+="\r\n\r\n        ",showSwitch.showSignAddr&&($out+='\r\n        <div class="field T_sign_addr">\r\n            <label class="field_label"><em class="stars">* </em>证件签发地：</label>\r\n            <input class="field_input ',nowInputSignAddr||($out+="hide"),$out+='" type="text" value="',$out+=$escape(signAddr),$out+='" ',InfoFlag&&hkmacIssueOrganModify&&($out+=" readonly "),$out+=' />\r\n            <span class="T_later_text ',nowInputSignAddr&&($out+="hide"),$out+='">L签出境名单表必须签发地信息，您可<a href="javascript:;">现在填写</a>，也可下单后在订单中补充</span>\r\n            <!--<a href="javascript:;" class="T_operation T_later ',nowInputSignAddr||($out+="hide"),$out+='">以后填写</a>-->\r\n        </div>\r\n        '),$out+="\r\n\r\n        ",
showSwitch.showSex&&($out+='\r\n        <div class="field J_sex">\r\n            <label class="field_label"><em class="stars">* </em>性别：</label>\r\n            <select class="field_select sex" ',InfoFlag&&sexModify&&($out+=' disabled="true" '),$out+=' >\r\n                <option value="0" ',0==sex&&($out+='selected="selected"'),$out+='>女</option>\r\n                <option value="1" ',1==sex&&($out+='selected="selected"'),$out+=">男</option>\r\n            </select>\r\n        </div>\r\n        "),$out+="\r\n\r\n        ",showSwitch.showCardValid){$out+='\r\n        <div class="field J_card_valid_date ">\r\n            <label class="field_label"><em class="stars">* </em>证件有效期：</label>\r\n            <select class="field_select_date" data-year ',InfoFlag&&cardValidDateModify&&($out+=' disabled="true" '),$out+=" >\r\n                ";for(var y=2016;y<2030;y++)$out+="\r\n                <option ",y==cardValidDate_year&&($out+='selected="selected"'),$out+=">",$out+=$escape(y),$out+="</option>\r\n                ";$out+='\r\n            </select>\r\n            <select class="field_select_date" data-month ',InfoFlag&&cardValidDateModify&&($out+=' disabled="true" '),$out+=">\r\n                ";for(var m=1;m<13;m++)$out+="\r\n                <option ",m==cardValidDate_month&&($out+='selected="selected"'),$out+=">",$out+=$escape(m),$out+="</option>\r\n                ";$out+='\r\n            </select>\r\n            <select class="field_select_date" data-day ',InfoFlag&&cardValidDateModify&&($out+=' disabled="true" '),$out+=">\r\n                ";for(var d=1;d<32;d++)$out+="\r\n                <option ",d==cardValidDate_day&&($out+='selected="selected"'),$out+=">",$out+=$escape(d),$out+="</option>\r\n                ";$out+="\r\n            </select>\r\n        </div>\r\n        "}if($out+="\r\n\r\n        ",showSwitch.showBirthday){$out+='\r\n        <div class="field J_birth_date">\r\n            <label class="field_label"><em class="stars">* </em>出生日期：</label>\r\n            <select class="field_select_date " data-year="" ',InfoFlag&&birthDateModify&&($out+=' disabled="true" '),$out+=">\r\n                ";for(var y=1920;y<2017;y++)$out+="\r\n                <option ",y==birthDate_year&&($out+='selected="selected"'),$out+=' class="bir">',$out+=$escape(y),$out+="</option>\r\n                ";$out+='\r\n            </select>\r\n            <select class="field_select_date " data-month="" ',InfoFlag&&birthDateModify&&($out+=' disabled="true" '),$out+=">\r\n                ";for(var m=1;m<13;m++)$out+="\r\n                <option ",m==birthDate_month&&($out+='selected="selected"'),$out+=">",$out+=$escape(m),$out+="</option>\r\n                ";$out+='\r\n            </select>\r\n            <select class="field_select_date last" data-day="" ',InfoFlag&&birthDateModify&&($out+=' disabled="true" '),$out+=">\r\n                ";for(var d=1;d<32;d++)$out+="\r\n                <option ",d==birthDate_day&&($out+='selected="selected"'),$out+=">",$out+=$escape(d),$out+="</option>\r\n                ";$out+="\r\n            </select>\r\n        </div>\r\n        "}if($out+="\r\n\r\n        ",showSwitch.showCustomerProperty){$out+='\r\n        <div class="field J_customer_property tourist_info">\r\n            <label class="field_label"><em class="stars">* </em>身份类型：</label>\r\n            <select class="field_select">\r\n                ';for(var i=0;i<customerProperty.length;i++)$out+='\r\n                <option value="',$out+=$escape(customerProperty[i].code),$out+='" ',customerProperty[i].code==customerPropertyId&&($out+='select="selected"'),$out+=">",$out+=$escape(customerProperty[i].name),$out+="</option>\r\n                ";$out+="\r\n            </select>\r\n        </div>\r\n        "}if($out+="\r\n\r\n        ",showSwitch.showMobile){var telValue="0086";InfoFlag&&intlCode&&(telValue=intlCode),$out+='\r\n        <div class="field J_mobile_no">\r\n            <label class="field_label"><em class="stars">* </em>手机号码：</label>\r\n            <input class="field_input internation_code_box" readonly placeholder="国际区号" type="text" value="',$out+=$escape(telValue),$out+='"\r\n                   data-telcountryid="40" ',InfoFlag&&telCountryIdModify&&($out+=' disabled="disabled" '),$out+=' >-\r\n            <input class="field_input mobile_box" type="text" value="',$out+=$escape(mobileNo),$out+='" ',InfoFlag&&mobileNoModify&&($out+=" readonly "),$out+=" >\r\n        </div>\r\n\r\n        ",1==serial&&($out+="\r\n        ",$out+=21==resType?'\r\n        <p class="tel_tips">因机票订票需要，除12岁(不含)以下儿童、70岁(含)以上老人外，所有出游人需填写手机号</p>\r\n        ':'\r\n        <p class="tel_tips">请至少填写一个出游人手机号，以便旅途中联系您</p>\r\n        ',$out+="\r\n        "),$out+="\r\n        "}if($out+="\r\n\r\n        ",showSwitch.showHeight&&($out+='\r\n        <div class="field J_height">\r\n            <label class="field_label"><em class="stars">* </em>身高：</label>\r\n            <select class="field_select">\r\n                    ',_.each(heightOption,function(item,index){$out+="\r\n\r\n                         <option data-index = '",$out+=$escape(index),$out+="' ",index==heightIndex&&($out+=' selected="selected" '),$out+=" >",$out+=$escape(item),$out+="</option>\r\n\r\n                    "}),$out+='\r\n            </select>\r\n            <div class="name-tips jtxz-detail-hover">\r\n                <i class="icon notice2-icon"></i>\r\n                <div class="jtxz-detail2">\r\n                    <p class="YD_mgb">因您购买了火车票资源，火车票是按身高标准区分“成人/儿童/免票儿童”。请您确认一下您的出游人类型，以便我们可以准确的为您购票，给您带来的不便敬请见谅。身高＜1.2米免票，身高1.2米-1.5米 半票，身高＞1.5米全票</p>\r\n                    <span class="z">◆</span>\r\n                    <span class="j">◆</span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        '),$out+="\r\n\r\n        ",needBindResource&&resource&&resource.length){$out+='\r\n        <div class="field ',1!=serial&&($out+="hide"),$out+=' bindResourceTips">\r\n            特殊景点门票需要选择出游人,请选择\r\n        </div>\r\n        <ul>\r\n            ';for(var i in resource)$out+="\r\n            ","1"==resource[i].needBind&&($out+='\r\n            <li class="resource_li" data-resid="',$out+=$escape(resource[i].resId),$out+='">\r\n                <label class="input_checkbox ',resource[i].select&&($out+="enabled"),$out+="  ",resource[i].canNotBind&&($out+="disable"),$out+='">\r\n                    <span class="tn_fontface">&#xe618;</span>',$out+=$escape(resource[i].name),$out+="\r\n                </label>\r\n            </li>\r\n            "),$out+="\r\n            ";$out+="\r\n        </ul>\r\n        "}return $out+="\r\n       \r\n        ",showSwitch.showSaveCommon&&($out+='\r\n        <p class="save-to-common"><label class="input_checkbox ',needSaveCommon&&($out+="enabled"),$out+='"><span\r\n                        class="tn_fontface"></span>保存到常旅</label></p>\r\n        '),$out+="\r\n        \r\n        ",showSwitch.showVisaUser&&($out+="\r\n         ",_.each(visaResName,function(item,index){$out+="\r\n                ",item.show&&($out+='\r\n                  <p class="show-visa-user" data-index = "',$out+=$escape(index),$out+='">\r\n                     <label class="input_checkbox ',item.selected&&($out+="enabled"),$out+='" data-resid="',$out+=$escape(item.resId),$out+='"><span class="tn_fontface"></span><em class="visa-user" title="',$out+=$escape(item.resName),$out+='使用人">',$out+=$escape(item.resName),$out+="使用人</em></label>\r\n                    ",item.error&&($out+='\r\n                       <span class="error-tips"><span class="icon error-icon"></span>',$out+=$escape(item.error),$out+="</span>\r\n                    "),$out+="\r\n                  </p>\r\n                "),$out+="\r\n         "}),$out+=" \r\n        "),$out+='\r\n\r\n        <!--绑定资源-->\r\n    </div>\r\n    <div class="function_box">\r\n        <span class="function_btn cleat_btn">清空</span>\r\n        ',backEditing&&($out+='\r\n        <span class="function_btn collapse_btn">收起</span>\r\n        '),$out+='\r\n    </div>\r\n    <div class="bottom_function_box">\r\n        ',canDelete&&!hasTakeSeat&&($out+='\r\n        <span class="function_btn delete_btn">删除</span>\r\n        '),$out+="\r\n        ",canDelete&&"step2"==bookStep&&($out+='\r\n        <span class="function_btn delete_btn">删除</span>\r\n        '),$out+='\r\n    </div>\r\n    <div class="clear-float">\r\n\r\n    </div>\r\n</div>\r\n',backEditing&&($out+='\r\n<div class="tourist-simple ',$out+=$escape(uiStatus),$out+='">\r\n    <div class="col-1"><span class="col-title">',$out+=$escape(labelText),$out+="</span> : ",$out+=$escape(name),$out+='</div>\r\n    <div class="col-2" style="display: ',$out+=$escape(showSwitch.showCardType?"block":"none"),$out+=';"><span class="col-title">',$out+=$escape(cardTypeMap[cardType].name),$out+="</span> : ",$out+=$escape(cardNo),$out+='</div>\r\n    <div class="col-3" style="display: ',$out+=$escape(showSwitch.showMobile?"block":"none"),$out+=';"><span class="col-title">手机号</span> : ',$out+=$escape(mobileNo),$out+='</div>\r\n    <div class="simple-toolbox">\r\n        ',canDelete&&!hasTakeSeat&&($out+='\r\n        <span class="delete_btn">删除</span>\r\n        '),$out+="\r\n        ",hasTakeSeat||($out+='\r\n        <span class="edit_btn">编辑</span>\r\n        '),$out+="\r\n    </div>\r\n</div>\r\n"),$out+="\r\n\r\n",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,operationFlag=($utils.$helpers,$data.operationFlag),ticketFlag=$data.ticketFlag,hotelFlag=$data.hotelFlag,hideBtn=$data.hideBtn,proMode=$data.proMode,foreignLimit=$data.foreignLimit,maxAgeLimit=$data.maxAgeLimit,showAgeCheckBox=$data.showAgeCheckBox,$escape=$utils.$escape,minAgeLimit=$data.minAgeLimit,$out="";return $out+='<h2>\r\n    <a class="m-more hide" id="J_tourist_detail_switch">展开</a>\r\n    <span class="icon tourist-icon"></span>\r\n    <span class="m-title">出游人信息</span>\r\n    <span class="m-title-desc hide" id="J_no_write_tips">为避免价格变动，请在提交订单后30分钟内前往我的订单添加出游人。</span>\r\n</h2>\r\n<div class="modular-body" id="J_tourist_detail">\r\n    <div class="tourist-tips">\r\n\r\n        ',2==operationFlag?$out+='\r\n            <p class="first-tip">为了保障您的合法权益，请准确、完整的填写游客信息，错误的身份可能造成额外的退、改费用，造成的额外损失、保险拒赔等问题，我司不承担相应责任。</p>\r\n        ':($out+='\r\n            <p class="first-tip">· 请确认所填写信息与所持证件信息一致，因信息不完整，填写不正确造成的额外损失、保险拒赔等问题，我司不承担相应责任，需由客人自行承担。</p>\r\n            <p>· 大于2周岁不满12周岁的儿童不可使用出生证明，请使用身份证、户口簿等，乘机请携带填写的相应证件。</p>\r\n            ',ticketFlag&&($out+='\r\n            <p style="color: black;">· 系统默认第1位出游人为景区取票人信息，请填写正确的成人证件号！</p>\r\n            '),$out+="\r\n            ",hotelFlag&&($out+='\r\n            <p style="color: black;">· 酒店入住时如遇到问题请拨打4007-999-999。</p>\r\n            '),$out+="\r\n        "),$out+='\r\n        <p class="gang-ao-in-side-airplane-tip hide">· 进出香港/澳门请携带有效港澳通行证，乘机请携带填写的相应证件，港澳通行证不作为国内航班有效乘机证件。</p>\r\n    </div>\r\n    <div class="tourist-main hide">\r\n        <span class="tourist-title"><i class="icon common-tourist-icon"></i>常用出游人</span>\r\n        <div class="common-tourist-list">\r\n            <ul class="tourist_list J_tourist_list" id="J_PassFavors">\r\n            </ul>\r\n            <a class="tourist_more">更多常用游客<i class="icon more-tourist-icon"></i></a>\r\n            <div class="clear-float"></div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="J_tourist_info" id="J_Passes"></div>\r\n\r\n    <div class="age-tips">\r\n        <p class="tourist-no-write ',(hideBtn||17==proMode)&&($out+="hide"),$out+='" id="tourist-no-write"><button class="no-write-btn">暂不填写</button></p>\r\n        ',foreignLimit&&($out+='\r\n            <p class="is-has-special-person is-has-foreign" id="isHasForeign">出游人中是否有外籍友人？\r\n                <span class="select-yes-or-no">\r\n                    <span class="yes"><label class="input_checkbox" data-value="1"><span class="tn_fontface"></span>有</label></span>\r\n                    <span class="no"><label class="input_checkbox enabled" data-value="0"><span class="tn_fontface"></span>没有</label></span>\r\n                </span>\r\n            </p>\r\n        '),$out+="\r\n\r\n        ",maxAgeLimit&&showAgeCheckBox&&($out+='\r\n            <p class="is-has-special-person is-has-older" id="isHasOlder">出游人中是否有年龄高于',$out+=$escape(maxAgeLimit),$out+='岁(含)的游客？\r\n                <span class="select-yes-or-no">\r\n                    <span class="yes"><label class="input_checkbox" data-value="1"><span class="tn_fontface"></span>有</label></span>\r\n                    <span class="no"><label class="input_checkbox enabled" data-value="0"><span class="tn_fontface"></span>没有</label></span>\r\n                </span>\r\n            </p>         \r\n        '),$out+="   \r\n        ",minAgeLimit&&showAgeCheckBox&&($out+='\r\n            <p class="is-has-special-person is-has-younger" id="isHasYouner">出游人中是否有年龄低于',$out+=$escape(minAgeLimit),$out+='岁(含)的游客？\r\n                <span class="select-yes-or-no">\r\n                    <span class="yes"><label class="input_checkbox" data-value="1"><span class="tn_fontface"></span>有</label></span>\r\n                    <span class="no"><label class="input_checkbox enabled" data-value="0"><span class="tn_fontface"></span>没有</label></span>\r\n                </span>\r\n            </p>         \r\n        '),$out+='            \r\n        <p class="no-support-info" id="no-support-info"><i class="icon notice2-icon"></i>本产品不支持孕妇出游，18周岁以下的未成年人必须有成年人陪同出游，敬请谅解！</p>\r\n    </div>\r\n</div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(134),__webpack_require__(14),__webpack_require__(6)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backnone,FavorView,$,config){var login=config.isLogin,pageDataObj=config.pageDataObj;return Backnone.View.extend({initialize:function(){var self=this;self.$el=$("#J_PassFavors"),this.listenTo(this.model,"add",function(model){self.addOne(model)}),this.listenTo(this.model,"reset",function(){$("#J_PassFavors").empty(),$(".tourist_more").show(),$("#J_tourist_detail .tourist-main").show(),self.addAll(),pageDataObj.telNum||login.status||($(".tourist_more").hide(),$("#J_tourist_detail .tourist-main").hide()),this.model.length||($(".tourist_more").hide(),$("#J_tourist_detail .tourist-main").hide()),this.model.length<11&&$(".tourist_more").hide()}),$(".tourist_more").on("click",function(){if($(this).hasClass("current")){var html='更多常用游客<i class="icon more-tourist-icon"></i>';$(".tourist_need_show_more").hide(),$(this).removeClass("current"),$(this).html(html)}else{var html='收起常用游客<i class="icon less-tourist-icon"></i>';$(".tourist_need_show_more").show(),$(this).addClass("current"),$(this).html(html)}})},hideFavors:function(){$("#J_tourist_detail .tourist-main").hide(),$(".tourist_more").hide()},showFavors:function(){$("#J_tourist_detail .tourist-main").show(),$(".tourist_more").show()},addOne:function(model){var favorView=new FavorView({model:model});this.$el.append(favorView.render())},addAll:function(){this.$el.hide();var self=this;this.model.length?(this.model.each(function(model){self.addOne(model)}),this.formatPage()):this.$el.hide()},formatPage:function(){$("#J_PassFavors li").length<=8&&$(".tourist_more").hide();$("#J_PassFavors li").each(function(){var _index=$(this).index();_index>7&&($(this).addClass("tourist_need_show_more"),$(this).hide())}),this.$el.show()}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(14),__webpack_require__(6),__webpack_require__(16),__webpack_require__(5)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backnone,$,config,tools,eventBus){var pageDataObj=config.pageDataObj;return Backnone.View.extend({tagName:"a",initialize:function(){var self=this,model=this.model,model_data=this.model.toJSON(),html='<li data-uid="'+model_data.uid+'"><label class="input_checkbox"><span class="tn_fontface">&#xe618;</span>'+model_data.name+"</label></li>";this.$el=$(html),this.$el.find("label").on("click",function(){var flag=!0;if(self.selected)model.beforeUnselect();else if(1==self.model.get("isUserClick")&&2==pageDataObj.operationFlag&&(flag=self.model.getIsLimitTourist()),flag){if(!self.model.getCanSelectFlag()){var line=2,tips="您选择的游客"+model_data.name+"年龄不符合要求，请您更换游客";return pageDataObj.hasAirResource&&(tips="儿童标准2周岁(含)-12周岁(不含)，您选择的游客"+model_data.name+"年龄不符合要求；请您更换游客，如需定婴儿票请联系客服",line=3),tools.layer({msg:tips,line:line}),!1}if(2==pageDataObj.operationFlag)if(0==self.model.get("isUserClick"))self.model.set("isUserClick",1,{silent:!0}),model.beforeSelect(!1);else{eventBus.trigger("checkRepeatFavor",model.toJSON());model.beforeSelect(!0)}else model.beforeSelect()}else tools.layer({msg:"所选游客与预订页不一致，请重选！"})}),this.listenTo(model,"select",function(){self.select()}),this.listenTo(model,"unselect",function(){self.unselect()}),this.listenTo(model,"setDefaultFavors",function(i){self.setDefaultFavors(i)})},render:function(){return this.$el},select:function(){this.selected=!0,this.$el.find(".input_checkbox").addClass("enabled")},unselect:function(){this.selected=!1,this.$el.find(".input_checkbox").removeClass("enabled")},disable:function(){this.$el.addClass("disabled").attr("title",this.model.getLimitMsg())},setDefaultFavors:function(i){this.model.set("isUserClick",0,{silent:!0}),this.$el.find("label").trigger("click")}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(5),__webpack_require__(9),__webpack_require__(14),__webpack_require__(50),__webpack_require__(136),__webpack_require__(124),__webpack_require__(6),__webpack_require__(16)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,EventBus,Backbone,$,Validator,receiptNewTemplate,citys,_config,tools){var pageDataObj=_config.pageDataObj;pageDataObj.invoiceListInfo;return Backbone.View.extend({el:"#m-receipt",events:{"click .field_radio":"needReceipt","blur .J_receipt_title":"onReceiptTitle","blur .receipt_identification_number":"checkIdNumber","blur .receipt_register_address":"checkRaddress","blur .receipt_register_phone":"checkRphone","blur .receipt_register_bank":"checkRbank","blur .receipt_bank_account":"checkBAccount","blur .receipt_contact_phone":"checkContactPhone","blur .receipt_contact_email":"checkContactEmail","mouseenter .delivery-address-item":"showHoverInfo","mouseleave .delivery-address-item":"hideHoverInfo","click .delivery-address-item":"selectDefaultAddress","click #J_resume_address":"resumeAddress","click #J_delete_address":"deleteAddress","click .delivery-address-add":"showAddPanel","click #canShowMore":"reSetMainHeight","blur #J_new_address_name":"valiName","blur #J_new_address_phone":"valiTel","blur #J_new_address_address":"valiAddress","focus #J_new_address_address":"addressFocus","change #J_new_address_province":"renderCity","click .address_add":"valiAll","click .address_cancel":"closeNewAddressPanel","click .no-default":"resetDefaultAddress","change #receipt_selectMethod":"changeReceiptMethod","change #receipt_selectType":"changeReceiptType","change #receipt_selectContent":"changeReceiptContent","click .receipt_entityType":"changeReceiptEntityType","focus .J_receipt_title":"renderRecieiptTitleList","input .J_receipt_title":"renderRecieiptTitleList","click .J_receipt_title_list_li":"onSelectTitle"},initialize:function(){this.listenTo(this.model,"change:isNeedReceipt",this.changeReceiptStatus),this.listenTo(this.model,"needRender",this.renderReceiptNew),this.listenTo(this.model,"validatorAll",this.validatorAll),this.bindEvents()},bindEvents:function(){$(document).on("click",function(e){return!$(e.target).parents().is(".J_receipt_title_list")&&(!$(e.target).hasClass("J_receipt_title")&&void $(".J_receipt_title_list").hide())})},checkContactPhone:function(e){var targetValue=$(e.target).val(),partten=/^1[3,5,7,8]\d{9}$/;return this.hideErr("contactPhone"),this.hideErr("tel"),this.model.set("contactPhone",targetValue),targetValue?!!partten.test(targetValue)||(this.showErr("tel"),!1):(this.showErr("contactPhone"),!1)},onSelectTitle:function(e){var title=$(e.target).attr("data-title");this.model.set("receiptTitle",title),$(".J_receipt_title:visible").val(title),$(".J_receipt_title_list").hide(),title?this.hideErr("receiptTitle"):this.showErr("receiptTitle")},changeReceiptEntityType:function(e){var receiptEntityType;receiptEntityType=$(e.target).hasClass("receipt_entityTypePerson")?1:2,this.model.setReceiptEntityType(receiptEntityType)},checkContactEmail:function(e){var targetValue=$(e.target).val();if(this.hideErr("formatEmail"),this.model.set("contactEmail",targetValue),targetValue){var error=Validator.validateEmail(targetValue);error&&this.showErr("formatEmail")}return!0},renderRecieiptTitleList:function(){var receiptTitle=(this.model.toJSON(),$(".J_receipt_title:visible").val()),receiptTitleList=this.model.getReceiptTitleList(receiptTitle),html="";if(receiptTitleList&&receiptTitleList.length)for(var l=0;l<receiptTitleList.length;l++)html+='<li class="J_receipt_title_list_li" data-title="'+receiptTitleList[l].invoice_title+"-"+receiptTitleList[l].taxpayer+'">'+receiptTitleList[l].invoice_title+"</li>";$(".J_receipt_title:visible").parent().find(".J_receipt_title_list").show().html(html)},onSelectTitle:function(e){var title=$(e.target).attr("data-title").split("-");this.model.set({receiptTitle:title[0],identificationNumber:title[1]}),$(".J_receipt_title:visible").val(title[0]),$(".receipt_identification_number:visible").val(title[1]),$(".J_receipt_title_list").hide(),title?this.hideErr("receiptTitle"):this.showErr("receiptTitle"),$(".receipt_identification_number:visible").trigger("blur")},checkBAccount:function(e){var targetValue=$(e.target).val(),pattern=/^[0-9]+$/;return this.hideErr("bankAccount"),this.hideErr("formatBAccount"),this.model.set("bankAccount",targetValue),targetValue?!!pattern.test(targetValue)||(this.showErr("formatBAccount"),!1):(this.showErr("bankAccount"),!1)},validatorAll:function(e){this.$el.find(".receipt_tourist_list_bar .J_receipt_title").trigger("blur"),2==this.model.get("receiptMethod").paramValue&&this.$el.find(".receipt_tourist_list_bar .receipt_contact_phone").trigger("blur"),1==this.model.get("receiptType").paramValue&&(this.$el.find(".receipt_tourist_list_bar .receipt_identification_number").trigger("blur"),this.$el.find(".receipt_tourist_list_bar .receipt_register_address").trigger("blur"),this.$el.find(".receipt_tourist_list_bar .receipt_register_phone").trigger("blur"),this.$el.find(".receipt_tourist_list_bar .receipt_register_bank").trigger("blur"),this.$el.find(".receipt_tourist_list_bar .receipt_bank_account").trigger("blur"))},checkRbank:function(e){var targetValue=$(e.target).val();return this.model.set("registerBank",targetValue),targetValue?(this.hideErr("registerBank"),!0):(this.showErr("registerBank"),!1)},checkRphone:function(e){var targetValue=$(e.target).val(),pattern=/^[0-9]+$/;return this.model.set("registerPhone",targetValue),this.hideErr("registerPhone"),this.hideErr("formatPhone"),targetValue?!!pattern.test(targetValue)||(this.showErr("formatPhone"),!1):(this.showErr("registerPhone"),!1)},checkRaddress:function(e){var targetValue=$(e.target).val();return this.model.set("receipRAddress",targetValue),targetValue?(this.hideErr("registeraddress"),!0):(this.showErr("registeraddress"),!1)},onReceiptTitle:function(e){var targetValue=$(e.target).val();return this.model.set("receiptTitle",targetValue),targetValue?(this.hideErr("receiptTitle"),!0):(this.showErr("receiptTitle"),!1)},changeReceiptMethod:function(e){var targetValue=$(e.target).val();this.model.setReceiptMethod(targetValue)},changeReceiptContent:function(e){var targetValue=$(e.target).val();this.model.setReceiptContent(targetValue)},changeReceiptType:function(e){var targetValue=$(e.target).val();this.model.setReceiptType(targetValue)},checkIdNumber:function(e){this.hideErr("checkIdFailed"),this.hideErr("emptyCheckId");var targetValue=$(e.target).val(),checkIdentificationId=this.checkIdentificationId(targetValue);return this.model.set("identificationNumber",targetValue),targetValue?!!checkIdentificationId||(this.showErr("checkIdFailed"),!1):(this.showErr("emptyCheckId"),!1)},changeChoose:function(e){var target=$(e.currentTarget),siblings=target.siblings();target.hasClass("choose_active")?target.removeClass("choose_active"):(target.addClass("choose_active"),siblings.removeClass("choose_active"))},checkIdentificationId:function(target){var result=!1;return/^[0-9A-Za-z]{15,20}$/.test(target)&&(result=!0),result},needReceipt:function(e){var target=$(e.currentTarget);target.addClass("yes"),target.siblings().removeClass("yes");var isNeedReceipt=!1;target.hasClass("need")&&(isNeedReceipt=!0),this.model.trigger("needReceipt",isNeedReceipt)},render:function(){var receiptHead=this.$el.find(".J_receipt_head");receiptHead.siblings(".receipt_info_new").show},changeReceiptStatus:function(){var isNeedReceipt=this.model.get("isNeedReceipt"),receiptBody=this.$el.find(".modular-body");isNeedReceipt?(receiptBody.slideDown(),this.$el.children("h2").removeClass("no-border"),tools.scrollTo(this.$el)):(receiptBody.slideUp(),this.$el.children("h2").addClass("no-border"))},renderReceiptNew:function(invoiceListInfo){var html=receiptNewTemplate(this.model.toJSON());this.model.get("canShouMore")?this.$el.find(".delivery-address-list").css("height","auto"):this.$el.find(".delivery-address-list").css("height","155px"),this.$el.html(html).show()},showHoverInfo:function(e){var target=$(e.currentTarget);target.addClass("active")},hideHoverInfo:function(e){var target=$(e.currentTarget);target.removeClass("active")},selectDefaultAddress:function(e){var target=$(e.currentTarget),index=target.data("index");this.$el.find(".delivery-address-item").removeClass("select-active"),target.addClass("select-active"),this.model.resetSelectObj(index)},resetDefaultAddress:function(e){var target=$(e.currentTarget),index=target.data("index");this.$el.find(".is-default").removeClass("is-default").addClass("no-default").text("设为默认地址"),target.removeClass("no-default").addClass("is-default").text("默认地址"),this.model.resetDefaultAddress(index),e.stopPropagation()},deleteAddress:function(e){var target=$(e.currentTarget).parents(".delivery-address-item"),index=target.data("index"),item=this.model.get("list")[index];EventBus.trigger("deleteReceiptAddress",item.address_id,index),e.stopPropagation()},reSetMainHeight:function(e){var target=$(e.currentTarget);"更多地址"==target.text()?(target.find("span").text("收起"),this.model.set("canShouMore",!0),this.$el.find(".delivery-address-list").css("height","auto")):(target.find("span").text("更多地址"),this.model.set("canShouMore",!1),this.$el.find(".delivery-address-list").css("height","170px"))},showAddPanel:function(){_config.isLogin.status?(this.model.set({isShowInput:!0}),this.$el.find(".receipt-new-address-form").show(),this.clearAddressInput()):this.model.needLogin()},valiName:function(e){var text=e?$(e.currentTarget).val().trim():this.$el.find("#J_new_address_name").val().trim();return text?(this.hideErr("name"),!0):(this.showErr("name"),!1)},valiTel:function(e){var tel=e?$(e.currentTarget).val().trim():this.$el.find("#J_new_address_phone").val().trim(),partten=/^1[3,5,7,8]\d{9}$/;return partten.test(tel)?(this.hideErr("tel"),!0):(this.showErr("tel"),!1)},valiAddress:function(e){var address=e?$(e.currentTarget).val().trim():this.$el.find("#J_new_address_address").val().trim();return address&&this.model.get("hasFocus")?(this.hideErr("address"),!0):(this.showErr("address"),!1)},valiProvince:function(){return this.$el.find("#J_new_address_province").val()&&this.$el.find("#J_new_address_city").val()?(this.hideErr("province"),!0):(this.showErr("province"),!1)},valiAll:function(e){var ver1=this.valiName(),ver2=this.valiTel(),ver3=this.valiAddress(),ver4=this.valiProvince(),needSaveOrUpadte=ver1&&ver2&&ver3&&ver4;if(needSaveOrUpadte){var baseObj={receiver_name:this.$el.find("#J_new_address_name").val().trim(),province:this.$el.find("#J_new_address_province option:selected").val().split("_")[1],provinceName:this.$el.find("#J_new_address_province option:selected").text(),city:this.$el.find("#J_new_address_city option:selected").val().split("_")[1],cityName:this.$el.find("#J_new_address_city option:selected").text(),address:this.$el.find("#J_new_address_address").val().trim(),tel_num:this.$el.find("#J_new_address_phone").val().trim()};this.model.get("updaterAddress")?(baseObj.addressId=this.model.get("updaterAddress").address_id,baseObj.isDefault=this.model.get("updaterAddress").isDefault,EventBus.trigger("updateReceiptAddress",baseObj)):EventBus.trigger("saveReceiptAddress",baseObj)}},addressFocus:function(e){var address=$(e.currentTarget).val().trim();this.model.set("hasFocus",!0),address.indexOf("不需要重复填写")!=-1?($(e.currentTarget).val(""),$(e.currentTarget).css("color","#000000")):$(e.currentTarget).css("color","#000000")},renderCity:function(e){var province=$(e.currentTarget).val();this.renderCitys(province)},renderCitys:function(p){var collCityObj=citys[p],html='<option selected="selected" value="">--市--</option>';for(var k in collCityObj)html+='<option value="'+collCityObj[k]+'">'+k+"</option>";this.$el.find("#J_new_address_city").html(html)},showErr:function(key){var err={name:"收件人必填",province:"请选择省市",city:"请选择省市",address:"详细地址必填",postCode:"收件人邮编不能为空",areaCode:"区号不能为空",tel:"请输入正确的手机号码",receiptTitle:"请输入发票抬头",checkIdFailed:"请输入正确的纳税人识别号",emptyCheckId:"请输入纳税人识别号",registeraddress:"请输入注册地址",registerPhone:"请输入注册电话",registerBank:"请输入开户银行",bankAccount:"请输入银行账户",contactPhone:"请输入手机号码",formatEmail:"邮箱格式错误",formatBAccount:"请输入正确的银行账户",formatPhone:"请输入正确的注册电话"};this.$el.find(".err_"+key).html("<img src='http://ssl3.tuniucdn.com/img/201604072050/bookOnline/error.png'>"+err[key])},hideErr:function(key){this.$el.find(".err_"+key).html("")},closeNewAddressPanel:function(){this.$el.find(".receipt-new-address-form").hide(),this.clearAddressInput()},resPosition:function(){var mgTop=($(window).height()-this.$el.height())/2,mgLeft=($(window).width()-this.$el.width())/2;this.$el.css("top",mgTop+"px"),this.$el.css("left",mgLeft+"px")},resumeAddress:function(e){
var i=$(e.currentTarget).data("index"),list=this.model.toJSON().list,updaterAddress=list[i],provinces=this.$el.find("#J_new_address_province option");this.$el.find(".receipt-new-address-form").show(),this.model.set({isShowInput:!1,updaterAddress:updaterAddress}),this.$el.find("#J_new_address_name").val(updaterAddress.user_name),this.$el.find("#J_new_address_phone").val(updaterAddress.tel),this.$el.find("#J_new_address_address").val(updaterAddress.address).css("color","#666666"),this.model.set("hasFocus",!0),_.each(provinces,function(item,index){$(item).text()==updaterAddress.provinceName&&$(item).attr("selected","selected").css("color","#666666")}),this.renderCitys(this.$el.find("#J_new_address_province").val());var renderCity=this.$el.find("#J_new_address_city option");_.each(renderCity,function(item,index){$(item).text()==updaterAddress.cityName&&$(item).attr("selected","selected").css("color","#666666")}),this.resPosition(),e.stopPropagation()},clearAddressInput:function(){this.$el.find(".receipt-new-address-form").find("input").val(""),this.$el.find(".receipt-new-address-form").find("textarea").val("不需要重复填写省市区，不小于5个字符，不超过120个字符。").css("color","#999"),this.$el.find("#J_new_address_province").find("option").eq(0).attr("selected",!0),this.$el.find("#J_new_address_city").find("option").eq(0).attr("selected",!0),this.$el.find(".err_tips").html()},closePanel:function(){$(".receipt-new-address-form").hide()}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,isNeedReceipt=($utils.$helpers,$data.isNeedReceipt),invoiceListInfo=$data.invoiceListInfo,method=$data.method,$escape=$utils.$escape,receiptMethod=$data.receiptMethod,invoiceType=$data.invoiceType,receiptType=$data.receiptType,content=$data.content,receiptContent=$data.receiptContent,isBlackCard=$data.isBlackCard,custLevel=$data.custLevel,isShowSpecialInfo=$data.isShowSpecialInfo,receiptEntityType=$data.receiptEntityType,isShowContactInfo=$data.isShowContactInfo,contactPhone=$data.contactPhone,contactEmail=$data.contactEmail,isShowReceiptAddress=$data.isShowReceiptAddress,_=$data._,list=$data.list,canShouMore=($data.item,$data.index,$data.canShouMore),isShowInput=$data.isShowInput,$out="";if($out+='<h2 class="',isNeedReceipt||($out+="no-border"),$out+='">\r\n    <span class="icon receipt-icon"></span>\r\n    <span class="m-title">发票</span>\r\n    <span class="m-title-desc">\r\n        <span class="field_radio ',isNeedReceipt||($out+="yes"),$out+='">\r\n            <i class="icon or-icon"></i>不需要发票\r\n        </span>\r\n        <span class="field_radio need ',isNeedReceipt&&($out+="yes"),$out+='">\r\n                <i class="icon or-icon"></i>需要发票\r\n        </span>\r\n        <span class="c9">（您可下单后在订单详情页中添加发票）</span>\r\n    </span>\r\n</h2>\r\n<div class="modular-body ',isNeedReceipt||($out+="hide"),$out+='">\r\n    <div class="panel-body-main">\r\n        <div class="panel-tips">     \r\n            <ol class="">\r\n                <li><span class="dot">·</span>您添加的发票将于您出游归来后的<i> 五个工作日 </i>帮您开具；</li>\r\n                <li><span class="dot">·</span>旅游费用和保险费用的发票分开，添加旅游费用发票会自动开具保险发票，优惠金额不开具发票；</li>\r\n                <li><span class="dot">·</span>保险发票由保险公司为您开具，只支持开具电子发票，如您需要保险发票，添加旅游费发票请选择电子发票，每张保单开具一张电子发票，发票抬头与电子保单投保人一致；</li>\r\n                <li><span class="dot">·</span>如需拆分为多张发票开具，您可在完成付款之后在我的订单 > 全部订单 > 订单详情页进行操作添加发票。</li>\r\n            </ol>\r\n        </div>\r\n        <div class="panel-top">\r\n            <div class="panel">\r\n                ',invoiceListInfo&&invoiceListInfo.guest_invoice_type){$out+='\r\n                <span class="title">发票种类：</span>\r\n                <span class="main">\r\n                        <select id="receipt_selectMethod" class="filed-select electronics">\r\n                            ';for(var method=0;method<invoiceListInfo.invoice_method.length;method++)$out+='\r\n                            <option value="',$out+=$escape(invoiceListInfo.invoice_method[method].paramValue),$out+='"',receiptMethod.paramValue==invoiceListInfo.invoice_method[method].paramValue&&($out+=" selected "),$out+=" >",$out+=$escape(invoiceListInfo.invoice_method[method].paramDesc),$out+="</option>\r\n                            ";$out+='\r\n                        </select>\r\n                        <select  id="receipt_selectType" class="filed-select ordinary">\r\n                            ';for(var invoiceType=0;invoiceType<invoiceListInfo.guest_invoice_type.length;invoiceType++)$out+="\r\n                            ",2==receiptMethod.paramValue&&1==invoiceListInfo.guest_invoice_type[invoiceType].paramValue||($out+='\r\n                            <option value="',$out+=$escape(invoiceListInfo.guest_invoice_type[invoiceType].paramValue),$out+='"',receiptType.paramValue==invoiceListInfo.guest_invoice_type[invoiceType].paramValue&&($out+=" selected "),$out+=">",$out+=$escape(invoiceListInfo.guest_invoice_type[invoiceType].paramDesc),$out+="</option>\r\n                            "),$out+="\r\n                            ";$out+="\r\n                        </select>\r\n                    </span>\r\n                "}if($out+='\r\n            </div>\r\n            <div class="panel">\r\n                ',invoiceListInfo.invoice_contents&&invoiceListInfo.invoice_contents.length){$out+='\r\n                <span class="title">发票内容：</span>\r\n                <span class="main">\r\n                        <select class="filed-select select-type" id="receipt_selectContent">\r\n                           ';for(var content=0;content<invoiceListInfo.invoice_contents.length;content++)$out+='\r\n                            <option value="',$out+=$escape(invoiceListInfo.invoice_contents[content].paramValue),$out+='"',receiptContent.paramValue==invoiceListInfo.invoice_contents[content].paramValue&&($out+=" selected "),$out+=" >",$out+=$escape(invoiceListInfo.invoice_contents[content].paramDesc),$out+="</option>\r\n                            ";$out+="\r\n                        </select>\r\n                    </span>\r\n                "}return $out+='\r\n            </div>\r\n            <div class="panel receipt_fee ',receiptMethod&&2==receiptMethod.paramValue&&($out+="hide"),$out+='">\r\n                <span class="title">配送方式：</span>\r\n                <span class="main">\r\n                        ',$out+=isBlackCard?'\r\n                            快递(黑卡会员免<span class="receipt_fee_count">&yen;10</span>邮寄服务费)\r\n                        ':custLevel?'\r\n                            快递(五星会员免<span class="receipt_fee_count">&yen;10</span>邮寄服务费)\r\n                        ':'\r\n                            快递<span class="receipt_fee_count">&yen;10</span>\r\n                        ',$out+='\r\n                    </span>\r\n            </div>\r\n            \r\n            <div class="paper-invoice ',isShowSpecialInfo&&($out+="hide"),$out+='">\r\n                <div class="panel">\r\n                    <span class="title">发票类型：</span>\r\n                    <span class="main">\r\n                        <span class="receipt_entityType receipt_entityTypePerson ',1==receiptEntityType&&($out+="activity"),$out+='">个人</span>\r\n                        <span class="receipt_entityType receipt_entityTypeCompany ',2==receiptEntityType&&($out+="activity"),$out+='">公司</span>\r\n                    </span>\r\n                </div>\r\n                ',2==receiptEntityType&&($out+='\r\n                    <div class="panel">\r\n                        <span class="title">发票抬头：</span>\r\n                        <span class="main">\r\n                            <input type="text" class="field-input receipt-input J_receipt_title" placeholder="请填写公司名称">\r\n                            <span class="err_tips err_receiptTitle"></span>\r\n                            <ul class="J_receipt_title_list">\r\n\r\n                            </ul>\r\n                        </span>\r\n                    </div>\r\n                    <div class="panel">\r\n                        <span class="title">纳税人识别号：</span>\r\n                        <span class="main">\r\n                            <input type="text" class="field-input receipt-input receipt_identification_number" placeholder="请填写纳税人识别号">\r\n                            <span class="err_tips err_checkIdFailed"></span>\r\n                            <span class="err_tips err_emptyCheckId"></span>\r\n                        </span>\r\n                    </div>\r\n                '),$out+='\r\n                                \r\n            </div>\r\n            <div class="paper-invoice ',isShowSpecialInfo||($out+="hide"),$out+='">\r\n                <div class="panel">\r\n                    <span class="title">发票抬头：</span>\r\n                    <span class="main">\r\n                        <input type="text" class="field-input receipt-input J_receipt_title" placeholder="请填写个人姓名或公司名称">\r\n                        <span class="err_tips err_receiptTitle"></span>\r\n                        <ul class="J_receipt_title_list">\r\n\r\n                        </ul>\r\n                    </span>\r\n                </div>\r\n                <div class="panel">\r\n                    <span class="title">纳税人识别号：</span>\r\n                    <span class="main">\r\n                        <input type="text" class="field-input receipt-input receipt_identification_number" placeholder="">\r\n                        <span class="err_tips err_checkIdFailed"></span>\r\n                        <span class="err_tips err_emptyCheckId"></span>\r\n                    </span>\r\n                </div>\r\n                <div class="panel">\r\n                    <span class="title">注册地址：</span>\r\n                    <span class="main">\r\n                        <input type="text" class="field-input receipt-input receipt_register_address" placeholder="">\r\n                        <span class="err_tips err_registeraddress"></span>\r\n                    </span>\r\n                </div>\r\n                <div class="panel">\r\n                    <span class="title">注册电话：</span>\r\n                    <span class="main">\r\n                        <input type="text" class="field-input receipt-input receipt_register_phone" placeholder="">\r\n                        <span class="err_tips err_registerPhone"></span>\r\n                        <span class="err_tips err_formatPhone"></span>\r\n                    </span>\r\n                </div>\r\n                <div class="panel">\r\n                    <span class="title">开户银行：</span>\r\n                    <span class="main">\r\n                        <input type="text" class="field-input receipt-input receipt_register_bank" placeholder="">\r\n                        <span class="err_tips err_registerBank"></span>\r\n                    </span>\r\n                </div>\r\n                <div class="panel">\r\n                    <span class="title">银行账户：</span>\r\n                    <span class="main">\r\n                        <input type="text" class="field-input receipt-input receipt_bank_account" placeholder="">\r\n                        <span class="err_tips err_bankAccount"></span>\r\n                        <span class="err_tips err_formatBAccount"></span>\r\n                    </span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="panel-bottom">\r\n            <div class="fill-in-electronic-invoice ',isShowContactInfo||($out+="hide"),$out+='">\r\n                <div class="panel">\r\n                    <span class="title">手机号码：</span>\r\n                    <span class="main">\r\n                        <input type="text" class="field-input receipt-input receipt_contact_phone" value="',$out+=$escape(contactPhone),$out+='" placeholder="请输入手机号码">\r\n                        <span class="err_tips err_contactPhone"></span>\r\n                        <span class="err_tips err_tel"></span>\r\n                    </span>\r\n                </div>\r\n                <div class="panel">\r\n                    <span class="title">邮箱：</span>\r\n                    <span class="main">\r\n                        <input type="text" class="field-input receipt-input receipt_contact_email" value="',$out+=$escape(contactEmail),$out+='" placeholder="用来接收电子发票邮件，可选填">\r\n                        <span class="err_tips err_formatEmail"></span>\r\n                    </span>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="fill-in-paper-invoice ',isShowReceiptAddress||($out+="hide"),$out+='">\r\n\r\n                <div class="panel-content delivery-address-list">\r\n                    ',_.each(list,function(item,index){$out+='\r\n                    <div class="panel delivery-address-item ',item.selected&&($out+="select-active"),$out+='" data-index="',$out+=$escape(index),$out+='">\r\n                        <div class="panel-body">\r\n                            <p class="panel-title">',$out+=$escape(item.provinceName),$out+=" ",$out+=$escape(item.cityName),$out+="(",$out+=$escape(item.user_name),$out+=' 收)</p>\r\n                            <div class="panel-main">\r\n                                <p>',$out+=$escape(item.tel),$out+='</p>\r\n                                <p class="detail-add f-ol">',$out+=$escape(item.address),$out+='</p>\r\n                            </div>\r\n                            <div class="panel-footer">\r\n                                <div class="footer-left">\r\n                                    <span class="edit" id="J_resume_address" data-index="',$out+=$escape(index),$out+='">修改</span>\r\n                                    <span class="line"></span>\r\n                                    <span id="J_delete_address" class="delete">删除</span>\r\n                                </div>\r\n                                <div class="footer-right">\r\n                                    ',item.isDefault?$out+='\r\n                                    <span class="defaults-address is-default">默认地址</span>\r\n                                    ':($out+='\r\n                                    <span class="defaults-address no-default" data-index="',$out+=$escape(index),$out+='">设为默认地址</span>\r\n                                    '),$out+='\r\n                                </div>\r\n                            </div>\r\n                            <div class="user-selected"><img class="" src="//img3.tuniucdn.com/img/201510131901/bookOnline/user-selected.png" alt=""></div>\r\n                        </div>\r\n                    </div>\r\n                    '}),$out+='\r\n                    <div class="panel delivery-address-add">\r\n                        <div class="panel-main"><img class="add-address" src="http://img3.tuniucdn.com/img/201510131901/bookOnline/add.png" alt=""></div>\r\n                        <div class="add-text">添加配送地址</div>\r\n                    </div>\r\n                    <div class="clear-float"></div>\r\n                </div>\r\n\r\n                ',list&&list.length>=3&&($out+='\r\n                <div class="click-to-more-address">\r\n                    ',$out+=canShouMore?'\r\n                    <span id="canShowMore"><span>收起</span><i class="icon less-tourist-icon"></i></span>\r\n                    ':'\r\n                    <span id="canShowMore"><span>更多地址</span><i class="icon more-tourist-icon"></i></span>\r\n                    ',$out+="\r\n                </div>\r\n                "),$out+='\r\n\r\n                <div class="receipt-new-address-form',isShowInput||($out+=" hide"),$out+='">\r\n\r\n                    <div>\r\n                        <span class="add-consignee-info">添加收货人信息</span>\r\n                    </div>\r\n\r\n                    <table>\r\n                        <tbody>\r\n                        <tr>\r\n                            <td class="receipt_info_title">收件人</td>\r\n                            <td>\r\n                                <input type="text" id="J_new_address_name" class="new_address_input" maxlength="10" placeholder="请输入收件人姓名" onfocus="this.placeholder=\'\'" onblur="this.placeholder=\'请输入收件人姓名\'">\r\n                                <span class="err_tips err_name"></span>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class="receipt_info_title">手机号</td>\r\n                            <td>\r\n                                <input type="text" id="J_new_address_phone" class="new_address_input" placeholder="请输入收件人手机号码" onfocus="this.placeholder=\'\'" onblur="this.placeholder=\'请输入收件人手机号码\'">\r\n                                <span class="err_tips err_tel"></span>\r\n                            </td>\r\n                        </tr>\r\n\r\n                        <tr>\r\n                            <td class="receipt_info_title">所在地区</td>\r\n                            <td>\r\n                                <select name="" id="J_new_address_province">\r\n                                    <option selected="selected" value="">省</option>\r\n                                    <option value="安徽_100">安徽</option>\r\n                                    <option value="北京_200">北京</option>\r\n                                    <option value="重庆_300">重庆</option>\r\n                                    <option value="福建_400">福建</option>\r\n                                    <option value="甘肃_500">甘肃</option>\r\n                                    <option value="广东_600">广东</option>\r\n                                    <option value="广西_700">广西</option>\r\n                                    <option value="贵州_800">贵州</option>\r\n                                    <option value="海南_900">海南</option>\r\n                                    <option value="河北_1000">河北</option>\r\n                                    <option value="黑龙江_1100">黑龙江</option>\r\n                                    <option value="河南_1200">河南</option>\r\n                                    <option value="香港_1300">香港</option>\r\n                                    <option value="湖北_1400">湖北</option>\r\n                                    <option value="湖南_1500">湖南</option>\r\n                                    <option value="江苏_1600">江苏</option>\r\n                                    <option value="江西_1700">江西</option>\r\n                                    <option value="吉林_1800">吉林</option>\r\n                                    <option value="辽宁_1900">辽宁</option>\r\n                                    <option value="澳门_2000">澳门</option>\r\n                                    <option value="内蒙古_2100">内蒙古</option>\r\n                                    <option value="宁夏_2200">宁夏</option>\r\n                                    <option value="青海_2300">青海</option>\r\n                                    <option value="山东_2400">山东</option>\r\n                                    <option value="上海_2500">上海</option>\r\n                                    <option value="山西_2600">山西</option>\r\n                                    <option value="陕西_2700">陕西</option>\r\n                                    <option value="四川_2800">四川</option>\r\n                                    <option value="台湾_2900">台湾</option>\r\n                                    <option value="天津_3000">天津</option>\r\n                                    <option value="新疆_3100">新疆</option>\r\n                                    <option value="西藏_3200">西藏</option>\r\n                                    <option value="云南_3300">云南</option>\r\n                                    <option value="浙江_3400">浙江</option>\r\n                                    <option value="欧洲_3600">欧洲</option>\r\n                                    <option value="北美洲_3700">北美洲</option>\r\n                                    <option value="南美洲_3800">南美洲</option>\r\n                                    <option value="亚洲_3900">亚洲</option>\r\n                                    <option value="非洲_4000">非洲</option>\r\n                                    <option value="大洋洲_4100">大洋洲</option>\r\n                                </select>\r\n                                <select name="" id="J_new_address_city">\r\n                                    <option selected="selected" value="">市</option>\r\n                                </select>\r\n                                <span class="err_tips err_city err_province"></span>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class="receipt_info_title new_detailed_address">详细地址</td>\r\n                            <td>\r\n                                <textarea id="J_new_address_address" class="new_address_input detailed_address">不需要重复填写省市区，不小于5个字符，不超过120个字符</textarea>\r\n                                <span class="err_tips err_address control"></span>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class="new_address_sub_title"></td>\r\n                            <td>\r\n                                <button class="btn address_add">保存</button>\r\n                                <button class="btn address_cancel">取消</button>\r\n                            </td>\r\n                        </tr>\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n            <div class="clear-float"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(138),__webpack_require__(5),__webpack_require__(17),__webpack_require__(139),__webpack_require__(7),__webpack_require__(6),__webpack_require__(140),__webpack_require__(16)],__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,VisaMaterialTemlate,EventBus,layer,store_detail,Template,config,moment,tools){config.pageDataObj;return Backbone.View.extend({el:"#m-visa-material",events:{"click .input_checkbox":"checkCanSubmitVisa","click .top":"showDetail","click .tab a":"changeContent","click .sales-text":"showStoreDetail","click .doc .img":"showImgView"},initialize:function(){this.listenTo(this.model,"needRender",this.render)},render:function(){var self=this,data=self.model.toJSON(),html=VisaMaterialTemlate(data);self.$el.html(html).show(),self.changeSpaceWidth(),self.$el.find(".area").each(function(index,item){var obj=$(item).find(".in-table").eq(0);self.changeHeight(obj),obj.parents(".detail").hide()})},hideVisaM:function(){this.$el.hide()},changeSpaceWidth:function(){this.$el.find(".area").each(function(index,item){var sumWidth=0,obj=$(item).find(".tab .space"),_width=obj.parent().width();obj.siblings("li").each(function(c_index,c_item){sumWidth+=$(c_item).width()}),obj.width(_width-sumWidth)})},changeHeight:function(obj){obj.parent().removeClass("over_scroll");var height=obj.height();height<473?obj.parent().height(height):obj.parent().height(473),obj.parent().addClass("over_scroll")},checkCanSubmitVisa:function(e){var self=this,obj=$(e.currentTarget);obj.hasClass("enabled")?obj.removeClass("enabled"):obj.addClass("enabled"),self.select()},showDetail:function(e){var obj=$(e.currentTarget),showMore=obj.children(".fr").hasClass("more-select-icon");showMore?obj.children(".fr").removeClass("more-select-icon").addClass("less-select-icon"):obj.children(".fr").removeClass("less-select-icon").addClass("more-select-icon"),obj.children(".text").text(showMore?"收起":"展开"),obj.siblings(".detail").toggle()},changeContent:function(e){var obj=$(e.currentTarget);obj.addClass("active"),obj.parent("li").siblings().children("a").removeClass("active");var index=obj.parent("li").index();obj.parents(".detail").find(".in-table").removeClass("active");var nextTable=obj.parents(".detail").find(".in-table").eq(index);nextTable.addClass("active"),this.changeHeight(nextTable)},showStoreDetail:function(){var self=this,val=parseInt(this.$el.find(".sales-address select").val()),modelData=self.model.toJSON(),data=self.findOneAddr(modelData.submitAddr,val),_html=store_detail(data),index=$.layer({type:1,title:["门市详情","font-size: 16px;color: rgb(153, 153, 153)"],area:["601px","auto"],page:{html:_html}}),_height=$("#xubox_layer"+index).height(),windowHeight=$(window).height();layer.area(index,{top:(windowHeight-_height)/2})},findOneAddr:function(arr,val){var result;return _.each(arr,function(ele,index){ele.id==val&&(result=ele)}),result},showImgView:function(e){var _width,_height,loader=layer.msg("加载中...",2,-1),obj=$(e.currentTarget),_src=obj.data("src"),img=$("<img/>");img.load(function(){layer.close(loader);var imgWidth=img[0].width,imgHeight=img[0].height,imgRatio=imgWidth/imgHeight,windowWidth=$(window).width(),windowHeight=$(window).height(),windowRatio=windowWidth/windowHeight;imgRatio<windowRatio?(_height=.6*windowHeight,_width=_height*imgRatio):(_width=.6*windowWidth,_height=_width/imgRatio),img.width(_width);var _html=$("<div></div>").append(img).html();$.layer({type:1,title:!1,closeBtn:[1,!0],area:[_width,_height],page:{html:_html}})}).attr("src",_src)},confirmVisa:function(){var flag=!0,data=this.model.toJSON();if(data.hasBuyVisa&&data.visaData||data.destGroupFlag){var firstCheck=this.$el.find(".input_checkbox").eq(0).hasClass("enabled");if(!firstCheck){this.select();var msg=data.hasBuyVisa&&data.visaData?"请仔细阅读签证材料并打勾":"请确认能自行办理台湾个人旅游签注";this.unselect(msg),tools.scrollTo(this.$el.find(".confirm-visa").eq(0)),flag=!1}}return flag},select:function(){var obj=this.$el.find(".error");obj&&obj.remove()},unselect:function(msg){var html=$('<div class="error" style="margin: 10px 0;"></div>').append('<span class="icon error-icon"></span>'+(msg?msg:"请仔细阅读签证材料并打勾"));this.$el.find(".confirm-visa").filter(":last").after(html)},getData:function(){var data=this.model.toJSON(),result={},companyCode=parseInt(this.$el.find(".sales-address select").val())||0,companyName=this.$el.find(".sales-address select option:selected").text();return result.companyCode=companyCode,result.companyName=companyName,result.hasVisaMaterial=data.hasBuyVisa&&data.visaData,result}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,destGroupFlag=($utils.$helpers,$data.destGroupFlag),hasBuyVisa=$data.hasBuyVisa,_=$data._,visaData=$data.visaData,$escape=($data.ele,$data.index,$utils.$escape),pageType=($data.c_ele,$data.c_index,$data.pageType),$string=($data.c_c_ele,$data.c_c_index,$utils.$string),helperIsImg=($data.c_c_c_ele,$data.c_c_c_index,$data.helperIsImg),endTime=$data.endTime,submitAddr=$data.submitAddr,$out=($data.item,"");return $out+='<h2>\r\n    <span class="icon visa-icon"></span>\r\n    <span class="m-title">签证材料确认</span>\r\n</h2>\r\n<div class="modular-body">\r\n    ',destGroupFlag?$out+='\r\n    <div class="confirm-visa">\r\n        <span class="visa-btn"><label class="input_checkbox" data-index="1"><span class="tn_fontface">&#xe618;</span></label></span>\r\n        <span class="visa-tips">我确定能自行办理台湾个人旅游签证(G签注)，若因签注问题导致无法正常出行，自行承担所有责任</span>\r\n    </div>\r\n    ':($out+="\r\n    ",hasBuyVisa?($out+='\r\n    <div class="confirm-visa">\r\n        <span class="visa-btn"><label class="input_checkbox" data-index="1"><span class="tn_fontface">&#xe618;</span></label></span>\r\n        <span class="visa-tips">我接受以下签证材料的要求作为合同要约的一部分，并已清楚了解我需要提供的签证材料，且确保我可以在截止收取材料前递交所需的签证材料到指定地址。</span>\r\n    </div>\r\n    <div class="panel-main">\r\n        ',_.each(visaData,function(ele,index){$out+='\r\n        <div class="panel">\r\n            <div class="area">\r\n                <a href="javascript:;" class="top">\r\n                    <span class="name"><i class="icon visa-name-icon"></i>',$out+=$escape(ele.name),$out+='</span>\r\n                    <span class="icon more-select-icon fr"></span>\r\n                    <span class="text">展开</span>\r\n                    <div class="clear-float"></div>\r\n                </a>\r\n\r\n                <div class="detail">\r\n                    <div class="content-text">\r\n                        <p>\r\n                            签证类型：<span class="mr">',$out+=$escape(ele.type),$out+='</span>\r\n                            办理时长：<span class="mr">',$out+=$escape(ele.handleTime),$out+='天</span>\r\n                            <!--收取材料截止时间：<span class="c3">',$out+=$escape(ele.submitEndTime),$out+='</span>-->\r\n                        </p>\r\n                        <p class="deal-with">\r\n                            <span class="deal-with-area-title">受理范围：</span>\r\n                            <span class="deal-with-area">',$out+=$escape(ele.range),$out+='</span>\r\n                            <span class="clear-float"></span>\r\n                        </p>\r\n                        <div class="clear-float"></div>\r\n                    </div>\r\n                    <ul class="tab">\r\n                        ',_.each(ele.content,function(c_ele,c_index){$out+="\r\n                        <li>\r\n                            ",$out+=0==c_index?'\r\n                            <a href="javascript:;" class="active">\r\n                                ':'\r\n                                <a href="javascript:;">\r\n                                    ',$out+="\r\n                                    ",$out+=$escape(c_ele.job),$out+="\r\n                                </a>\r\n                        </li>\r\n                        "}),$out+='\r\n                        <li class="space" style="width: 250px;"></li>\r\n                        <div class="clear-float"></div>\r\n                    </ul>\r\n                    <table class="out-table">\r\n                        <thead>\r\n                        <tr class="title">\r\n                            <th class="cl">所需材料</th>\r\n                            <th class="lx">材料类型</th>\r\n                            <th class="ms ',"back2"==pageType&&($out+="msnew"),$out+='">描述</th>\r\n                            <th>模板/样例</th>\r\n                        </tr>\r\n                        </thead>\r\n                        <tfoot></tfoot>\r\n                        <tbody>\r\n                        <tr>\r\n                            <td colspan="4">\r\n                                <div class="box">\r\n                                    ',
_.each(ele.content,function(c_ele,c_index){$out+="\r\n                                    ",$out+=0==c_index?'\r\n                                    <div class="in-table active">\r\n                                        ':'\r\n                                        <div class="in-table">\r\n                                            ',$out+="\r\n                                            ",_.each(c_ele.material,function(c_c_ele,c_c_index){$out+='\r\n                                            <table>\r\n                                                <tr>\r\n                                                    <td class="in-cl">\r\n                                                        <div>\r\n                                                            ',c_c_ele.required&&($out+="\r\n                                                            <em>★</em>\r\n                                                            "),$out+="\r\n                                                            ",$out+=$escape(c_c_ele.materialName),$out+='\r\n                                                        </div>\r\n                                                    </td>\r\n                                                    <td class="in-lx"><div>',$out+=$escape(c_c_ele.typeName),$out+='</div></td>\r\n                                                    <td class="in-ms"><div>',$out+=$string(c_c_ele.materialDesc),$out+='</div></td>\r\n                                                    <td class="in-exam">\r\n                                                        ',c_c_ele.attachments?($out+="\r\n                                                        ",_.each(c_c_ele.attachments,function(c_c_c_ele,c_c_c_index){$out+='\r\n                                                        <div class="doc">\r\n                                                            ',helperIsImg(c_c_c_ele.src)?($out+='\r\n                                                            <a href="javascript:;" class="img"\r\n                                                               data-src="',$out+=$escape(c_c_c_ele.src),$out+='">\r\n                                                                '):($out+='\r\n                                                                <a href="',$out+=$escape(c_c_c_ele.src),$out+='" class="doc">\r\n                                                                    '),$out+='\r\n                                                                    <span class="icon-1"></span>\r\n                                                                    ',$out+=$escape(c_c_c_ele.attachmentName),$out+="\r\n                                                                </a>\r\n                                                        </div>\r\n                                                        "}),$out+="\r\n                                                        "):$out+="\r\n                                                        无\r\n                                                        ",$out+="\r\n                                                    </td>\r\n                                                </tr>\r\n                                            </table>\r\n                                            "}),$out+="\r\n                                        </div>\r\n                                        "}),$out+='\r\n                                    </div>\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n                        </tbody>\r\n                    </table>\r\n                    <div class="content-title">\r\n                        <strong>签证须知：</strong>\r\n                    </div>\r\n                    <div class="content-text">\r\n                        <p>当您在线提交订单成功后，可在会员中心提交材料扫描件。</p>\r\n\r\n                        <p>请确保护照有效期：本次旅游归国至少还有6个月以上有效期，且尚有签证所需空白签证页。</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        '}),$out+='\r\n    </div>\r\n    <div class="panel-footer">\r\n        <div class="sales-detail">\r\n            ',endTime&&"null"!=endTime&&($out+='\r\n            <p class="deadline">',$out+=$escape(endTime),$out+=' 截止收取材料</p>\r\n            <p class="sales-tips">为保证您的正常出游，为审核材料的过程中出现的意外情况预留处理时间，请尽早提交签证材料</p>\r\n            '),$out+='\r\n            <p class="sales-address">\r\n                     <span>\r\n                         <select class="filed-select">\r\n                             ',_.each(submitAddr,function(item,index){$out+='\r\n                             <option value="',$out+=$escape(item.id),$out+='">',$out+=$escape(item.name),$out+="</option>\r\n                             "}),$out+='\r\n                         </select>\r\n                     </span>\r\n                <span class="sales-text"><span><i class="icon sales-icon"></i>门市详情</span></span>\r\n            </p>\r\n        </div>\r\n        <div class="submit-visa-material">\r\n            <p class="title">您可以选择以下两种方式递交签证材料：</p>\r\n            <p>1, 快递至途牛门市</p>\r\n            <p>2, 到途牛门市当面递交签证材料</p>\r\n        </div>\r\n    </div>\r\n    '):($out+='\r\n    <div class="confirm-visa">\r\n        <span class="visa-tips">您未在线路里选择购买签证，请您确保能在出游前自行办理以下签证</span>\r\n    </div>\r\n    <div class="panel-main">\r\n        ',_.each(visaData,function(ele,index){$out+='\r\n        <div class="panel">\r\n            <div class="area">\r\n                <a class="top">\r\n                    <span class="name"><i class="icon visa-name-icon"></i>',$out+=$escape(ele.name),$out+='</span>\r\n\r\n                    <div class="clear-float"></div>\r\n                </a>\r\n            </div>\r\n        </div>\r\n        '}),$out+="\r\n    </div>\r\n    "),$out+="\r\n    "),$out+="\r\n</div>",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,$escape=($utils.$helpers,$utils.$escape),totalAddr=$data.totalAddr,workTime=$data.workTime,tel=$data.tel,bus=$data.bus,metroRoute=$data.metroRoute,$out="";return $out+='<div class="T_company_detail">\r\n    <p>公司地址：',$out+=$escape(totalAddr),$out+="</p>\r\n    <p>营业时间：",$out+=$escape(workTime),$out+="</p>\r\n    <p>电话：",$out+=$escape(tel),$out+="</p>\r\n    <p>公交路线：",$out+=$escape(bus),$out+="</p>\r\n    <p>地铁路线：",$out+=$escape(metroRoute),$out+="</p>\r\n</div>",new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){(function(module){//! moment.js
//! version : 2.10.6
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
!function(a,b){module.exports=b()}(this,function(){"use strict";function a(){return Hc.apply(null,arguments)}function b(a){Hc=a}function c(a){return"[object Array]"===Object.prototype.toString.call(a)}function d(a){return a instanceof Date||"[object Date]"===Object.prototype.toString.call(a)}function e(a,b){var c,d=[];for(c=0;c<a.length;++c)d.push(b(a[c],c));return d}function f(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function g(a,b){for(var c in b)f(b,c)&&(a[c]=b[c]);return f(b,"toString")&&(a.toString=b.toString),f(b,"valueOf")&&(a.valueOf=b.valueOf),a}function h(a,b,c,d){return Ca(a,b,c,d,!0).utc()}function i(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function j(a){return null==a._pf&&(a._pf=i()),a._pf}function k(a){if(null==a._isValid){var b=j(a);a._isValid=!(isNaN(a._d.getTime())||!(b.overflow<0)||b.empty||b.invalidMonth||b.invalidWeekday||b.nullInput||b.invalidFormat||b.userInvalidated),a._strict&&(a._isValid=a._isValid&&0===b.charsLeftOver&&0===b.unusedTokens.length&&void 0===b.bigHour)}return a._isValid}function l(a){var b=h(NaN);return null!=a?g(j(b),a):j(b).userInvalidated=!0,b}function m(a,b){var c,d,e;if("undefined"!=typeof b._isAMomentObject&&(a._isAMomentObject=b._isAMomentObject),"undefined"!=typeof b._i&&(a._i=b._i),"undefined"!=typeof b._f&&(a._f=b._f),"undefined"!=typeof b._l&&(a._l=b._l),"undefined"!=typeof b._strict&&(a._strict=b._strict),"undefined"!=typeof b._tzm&&(a._tzm=b._tzm),"undefined"!=typeof b._isUTC&&(a._isUTC=b._isUTC),"undefined"!=typeof b._offset&&(a._offset=b._offset),"undefined"!=typeof b._pf&&(a._pf=j(b)),"undefined"!=typeof b._locale&&(a._locale=b._locale),Jc.length>0)for(c in Jc)d=Jc[c],e=b[d],"undefined"!=typeof e&&(a[d]=e);return a}function n(b){m(this,b),this._d=new Date(null!=b._d?b._d.getTime():NaN),Kc===!1&&(Kc=!0,a.updateOffset(this),Kc=!1)}function o(a){return a instanceof n||null!=a&&null!=a._isAMomentObject}function p(a){return 0>a?Math.ceil(a):Math.floor(a)}function q(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=p(b)),c}function r(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;e>d;d++)(c&&a[d]!==b[d]||!c&&q(a[d])!==q(b[d]))&&g++;return g+f}function s(){}function t(a){return a?a.toLowerCase().replace("_","-"):a}function u(a){for(var b,c,d,e,f=0;f<a.length;){for(e=t(a[f]).split("-"),b=e.length,c=t(a[f+1]),c=c?c.split("-"):null;b>0;){if(d=v(e.slice(0,b).join("-")))return d;if(c&&c.length>=b&&r(e,c,!0)>=b-1)break;b--}f++}return null}function v(a){var b=null;if(!Lc[a]&&"undefined"!=typeof module&&module&&module.exports)try{b=Ic._abbr,!function(){var e=new Error('Cannot find module "./locale"');throw e.code="MODULE_NOT_FOUND",e}(),w(b)}catch(c){}return Lc[a]}function w(a,b){var c;return a&&(c="undefined"==typeof b?y(a):x(a,b),c&&(Ic=c)),Ic._abbr}function x(a,b){return null!==b?(b.abbr=a,Lc[a]=Lc[a]||new s,Lc[a].set(b),w(a),Lc[a]):(delete Lc[a],null)}function y(a){var b;if(a&&a._locale&&a._locale._abbr&&(a=a._locale._abbr),!a)return Ic;if(!c(a)){if(b=v(a))return b;a=[a]}return u(a)}function z(a,b){var c=a.toLowerCase();Mc[c]=Mc[c+"s"]=Mc[b]=a}function A(a){return"string"==typeof a?Mc[a]||Mc[a.toLowerCase()]:void 0}function B(a){var b,c,d={};for(c in a)f(a,c)&&(b=A(c),b&&(d[b]=a[c]));return d}function C(b,c){return function(d){return null!=d?(E(this,b,d),a.updateOffset(this,c),this):D(this,b)}}function D(a,b){return a._d["get"+(a._isUTC?"UTC":"")+b]()}function E(a,b,c){return a._d["set"+(a._isUTC?"UTC":"")+b](c)}function F(a,b){var c;if("object"==typeof a)for(c in a)this.set(c,a[c]);else if(a=A(a),"function"==typeof this[a])return this[a](b);return this}function G(a,b,c){var d=""+Math.abs(a),e=b-d.length,f=a>=0;return(f?c?"+":"":"-")+Math.pow(10,Math.max(0,e)).toString().substr(1)+d}function H(a,b,c,d){var e=d;"string"==typeof d&&(e=function(){return this[d]()}),a&&(Qc[a]=e),b&&(Qc[b[0]]=function(){return G(e.apply(this,arguments),b[1],b[2])}),c&&(Qc[c]=function(){return this.localeData().ordinal(e.apply(this,arguments),a)})}function I(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function J(a){var b,c,d=a.match(Nc);for(b=0,c=d.length;c>b;b++)Qc[d[b]]?d[b]=Qc[d[b]]:d[b]=I(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function K(a,b){return a.isValid()?(b=L(b,a.localeData()),Pc[b]=Pc[b]||J(b),Pc[b](a)):a.localeData().invalidDate()}function L(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(Oc.lastIndex=0;d>=0&&Oc.test(a);)a=a.replace(Oc,c),Oc.lastIndex=0,d-=1;return a}function M(a){return"function"==typeof a&&"[object Function]"===Object.prototype.toString.call(a)}function N(a,b,c){dd[a]=M(b)?b:function(a){return a&&c?c:b}}function O(a,b){return f(dd,a)?dd[a](b._strict,b._locale):new RegExp(P(a))}function P(a){return a.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e}).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Q(a,b){var c,d=b;for("string"==typeof a&&(a=[a]),"number"==typeof b&&(d=function(a,c){c[b]=q(a)}),c=0;c<a.length;c++)ed[a[c]]=d}function R(a,b){Q(a,function(a,c,d,e){d._w=d._w||{},b(a,d._w,d,e)})}function S(a,b,c){null!=b&&f(ed,a)&&ed[a](b,c._a,c,a)}function T(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function U(a){return this._months[a.month()]}function V(a){return this._monthsShort[a.month()]}function W(a,b,c){var d,e,f;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),d=0;12>d;d++){if(e=h([2e3,d]),c&&!this._longMonthsParse[d]&&(this._longMonthsParse[d]=new RegExp("^"+this.months(e,"").replace(".","")+"$","i"),this._shortMonthsParse[d]=new RegExp("^"+this.monthsShort(e,"").replace(".","")+"$","i")),c||this._monthsParse[d]||(f="^"+this.months(e,"")+"|^"+this.monthsShort(e,""),this._monthsParse[d]=new RegExp(f.replace(".",""),"i")),c&&"MMMM"===b&&this._longMonthsParse[d].test(a))return d;if(c&&"MMM"===b&&this._shortMonthsParse[d].test(a))return d;if(!c&&this._monthsParse[d].test(a))return d}}function X(a,b){var c;return"string"==typeof b&&(b=a.localeData().monthsParse(b),"number"!=typeof b)?a:(c=Math.min(a.date(),T(a.year(),b)),a._d["set"+(a._isUTC?"UTC":"")+"Month"](b,c),a)}function Y(b){return null!=b?(X(this,b),a.updateOffset(this,!0),this):D(this,"Month")}function Z(){return T(this.year(),this.month())}function $(a){var b,c=a._a;return c&&-2===j(a).overflow&&(b=c[gd]<0||c[gd]>11?gd:c[hd]<1||c[hd]>T(c[fd],c[gd])?hd:c[id]<0||c[id]>24||24===c[id]&&(0!==c[jd]||0!==c[kd]||0!==c[ld])?id:c[jd]<0||c[jd]>59?jd:c[kd]<0||c[kd]>59?kd:c[ld]<0||c[ld]>999?ld:-1,j(a)._overflowDayOfYear&&(fd>b||b>hd)&&(b=hd),j(a).overflow=b),a}function _(b){a.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+b)}function aa(a,b){var c=!0;return g(function(){return c&&(_(a+"\n"+(new Error).stack),c=!1),b.apply(this,arguments)},b)}function ba(a,b){od[a]||(_(b),od[a]=!0)}function ca(a){var b,c,d=a._i,e=pd.exec(d);if(e){for(j(a).iso=!0,b=0,c=qd.length;c>b;b++)if(qd[b][1].exec(d)){a._f=qd[b][0];break}for(b=0,c=rd.length;c>b;b++)if(rd[b][1].exec(d)){a._f+=(e[6]||" ")+rd[b][0];break}d.match(ad)&&(a._f+="Z"),va(a)}else a._isValid=!1}function da(b){var c=sd.exec(b._i);return null!==c?void(b._d=new Date(+c[1])):(ca(b),void(b._isValid===!1&&(delete b._isValid,a.createFromInputFallback(b))))}function ea(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return 1970>a&&h.setFullYear(a),h}function fa(a){var b=new Date(Date.UTC.apply(null,arguments));return 1970>a&&b.setUTCFullYear(a),b}function ga(a){return ha(a)?366:365}function ha(a){return a%4===0&&a%100!==0||a%400===0}function ia(){return ha(this.year())}function ja(a,b,c){var d,e=c-b,f=c-a.day();return f>e&&(f-=7),e-7>f&&(f+=7),d=Da(a).add(f,"d"),{week:Math.ceil(d.dayOfYear()/7),year:d.year()}}function ka(a){return ja(a,this._week.dow,this._week.doy).week}function la(){return this._week.dow}function ma(){return this._week.doy}function na(a){var b=this.localeData().week(this);return null==a?b:this.add(7*(a-b),"d")}function oa(a){var b=ja(this,1,4).week;return null==a?b:this.add(7*(a-b),"d")}function pa(a,b,c,d,e){var f,g=6+e-d,h=fa(a,0,1+g),i=h.getUTCDay();return e>i&&(i+=7),c=null!=c?1*c:e,f=1+g+7*(b-1)-i+c,{year:f>0?a:a-1,dayOfYear:f>0?f:ga(a-1)+f}}function qa(a){var b=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==a?b:this.add(a-b,"d")}function ra(a,b,c){return null!=a?a:null!=b?b:c}function sa(a){var b=new Date;return a._useUTC?[b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]:[b.getFullYear(),b.getMonth(),b.getDate()]}function ta(a){var b,c,d,e,f=[];if(!a._d){for(d=sa(a),a._w&&null==a._a[hd]&&null==a._a[gd]&&ua(a),a._dayOfYear&&(e=ra(a._a[fd],d[fd]),a._dayOfYear>ga(e)&&(j(a)._overflowDayOfYear=!0),c=fa(e,0,a._dayOfYear),a._a[gd]=c.getUTCMonth(),a._a[hd]=c.getUTCDate()),b=0;3>b&&null==a._a[b];++b)a._a[b]=f[b]=d[b];for(;7>b;b++)a._a[b]=f[b]=null==a._a[b]?2===b?1:0:a._a[b];24===a._a[id]&&0===a._a[jd]&&0===a._a[kd]&&0===a._a[ld]&&(a._nextDay=!0,a._a[id]=0),a._d=(a._useUTC?fa:ea).apply(null,f),null!=a._tzm&&a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),a._nextDay&&(a._a[id]=24)}}function ua(a){var b,c,d,e,f,g,h;b=a._w,null!=b.GG||null!=b.W||null!=b.E?(f=1,g=4,c=ra(b.GG,a._a[fd],ja(Da(),1,4).year),d=ra(b.W,1),e=ra(b.E,1)):(f=a._locale._week.dow,g=a._locale._week.doy,c=ra(b.gg,a._a[fd],ja(Da(),f,g).year),d=ra(b.w,1),null!=b.d?(e=b.d,f>e&&++d):e=null!=b.e?b.e+f:f),h=pa(c,d,e,g,f),a._a[fd]=h.year,a._dayOfYear=h.dayOfYear}function va(b){if(b._f===a.ISO_8601)return void ca(b);b._a=[],j(b).empty=!0;var c,d,e,f,g,h=""+b._i,i=h.length,k=0;for(e=L(b._f,b._locale).match(Nc)||[],c=0;c<e.length;c++)f=e[c],d=(h.match(O(f,b))||[])[0],d&&(g=h.substr(0,h.indexOf(d)),g.length>0&&j(b).unusedInput.push(g),h=h.slice(h.indexOf(d)+d.length),k+=d.length),Qc[f]?(d?j(b).empty=!1:j(b).unusedTokens.push(f),S(f,d,b)):b._strict&&!d&&j(b).unusedTokens.push(f);j(b).charsLeftOver=i-k,h.length>0&&j(b).unusedInput.push(h),j(b).bigHour===!0&&b._a[id]<=12&&b._a[id]>0&&(j(b).bigHour=void 0),b._a[id]=wa(b._locale,b._a[id],b._meridiem),ta(b),$(b)}function wa(a,b,c){var d;return null==c?b:null!=a.meridiemHour?a.meridiemHour(b,c):null!=a.isPM?(d=a.isPM(c),d&&12>b&&(b+=12),d||12!==b||(b=0),b):b}function xa(a){var b,c,d,e,f;if(0===a._f.length)return j(a).invalidFormat=!0,void(a._d=new Date(NaN));for(e=0;e<a._f.length;e++)f=0,b=m({},a),null!=a._useUTC&&(b._useUTC=a._useUTC),b._f=a._f[e],va(b),k(b)&&(f+=j(b).charsLeftOver,f+=10*j(b).unusedTokens.length,j(b).score=f,(null==d||d>f)&&(d=f,c=b));g(a,c||b)}function ya(a){if(!a._d){var b=B(a._i);a._a=[b.year,b.month,b.day||b.date,b.hour,b.minute,b.second,b.millisecond],ta(a)}}function za(a){var b=new n($(Aa(a)));return b._nextDay&&(b.add(1,"d"),b._nextDay=void 0),b}function Aa(a){var b=a._i,e=a._f;return a._locale=a._locale||y(a._l),null===b||void 0===e&&""===b?l({nullInput:!0}):("string"==typeof b&&(a._i=b=a._locale.preparse(b)),o(b)?new n($(b)):(c(e)?xa(a):e?va(a):d(b)?a._d=b:Ba(a),a))}function Ba(b){var f=b._i;void 0===f?b._d=new Date:d(f)?b._d=new Date(+f):"string"==typeof f?da(b):c(f)?(b._a=e(f.slice(0),function(a){return parseInt(a,10)}),ta(b)):"object"==typeof f?ya(b):"number"==typeof f?b._d=new Date(f):a.createFromInputFallback(b)}function Ca(a,b,c,d,e){var f={};return"boolean"==typeof c&&(d=c,c=void 0),f._isAMomentObject=!0,f._useUTC=f._isUTC=e,f._l=c,f._i=a,f._f=b,f._strict=d,za(f)}function Da(a,b,c,d){return Ca(a,b,c,d,!1)}function Ea(a,b){var d,e;if(1===b.length&&c(b[0])&&(b=b[0]),!b.length)return Da();for(d=b[0],e=1;e<b.length;++e)(!b[e].isValid()||b[e][a](d))&&(d=b[e]);return d}function Fa(){var a=[].slice.call(arguments,0);return Ea("isBefore",a)}function Ga(){var a=[].slice.call(arguments,0);return Ea("isAfter",a)}function Ha(a){var b=B(a),c=b.year||0,d=b.quarter||0,e=b.month||0,f=b.week||0,g=b.day||0,h=b.hour||0,i=b.minute||0,j=b.second||0,k=b.millisecond||0;this._milliseconds=+k+1e3*j+6e4*i+36e5*h,this._days=+g+7*f,this._months=+e+3*d+12*c,this._data={},this._locale=y(),this._bubble()}function Ia(a){return a instanceof Ha}function Ja(a,b){H(a,0,0,function(){var a=this.utcOffset(),c="+";return 0>a&&(a=-a,c="-"),c+G(~~(a/60),2)+b+G(~~a%60,2)})}function Ka(a){var b=(a||"").match(ad)||[],c=b[b.length-1]||[],d=(c+"").match(xd)||["-",0,0],e=+(60*d[1])+q(d[2]);return"+"===d[0]?e:-e}function La(b,c){var e,f;return c._isUTC?(e=c.clone(),f=(o(b)||d(b)?+b:+Da(b))-+e,e._d.setTime(+e._d+f),a.updateOffset(e,!1),e):Da(b).local()}function Ma(a){return 15*-Math.round(a._d.getTimezoneOffset()/15)}function Na(b,c){var d,e=this._offset||0;return null!=b?("string"==typeof b&&(b=Ka(b)),Math.abs(b)<16&&(b*=60),!this._isUTC&&c&&(d=Ma(this)),this._offset=b,this._isUTC=!0,null!=d&&this.add(d,"m"),e!==b&&(!c||this._changeInProgress?bb(this,Ya(b-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,a.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?e:Ma(this)}function Oa(a,b){return null!=a?("string"!=typeof a&&(a=-a),this.utcOffset(a,b),this):-this.utcOffset()}function Pa(a){return this.utcOffset(0,a)}function Qa(a){return this._isUTC&&(this.utcOffset(0,a),this._isUTC=!1,a&&this.subtract(Ma(this),"m")),this}function Ra(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(Ka(this._i)),this}function Sa(a){return a=a?Da(a).utcOffset():0,(this.utcOffset()-a)%60===0}function Ta(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Ua(){if("undefined"!=typeof this._isDSTShifted)return this._isDSTShifted;var a={};if(m(a,this),a=Aa(a),a._a){var b=a._isUTC?h(a._a):Da(a._a);this._isDSTShifted=this.isValid()&&r(a._a,b.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}function Va(){return!this._isUTC}function Wa(){return this._isUTC}function Xa(){return this._isUTC&&0===this._offset}function Ya(a,b){var c,d,e,g=a,h=null;return Ia(a)?g={ms:a._milliseconds,d:a._days,M:a._months}:"number"==typeof a?(g={},b?g[b]=a:g.milliseconds=a):(h=yd.exec(a))?(c="-"===h[1]?-1:1,g={y:0,d:q(h[hd])*c,h:q(h[id])*c,m:q(h[jd])*c,s:q(h[kd])*c,ms:q(h[ld])*c}):(h=zd.exec(a))?(c="-"===h[1]?-1:1,g={y:Za(h[2],c),M:Za(h[3],c),d:Za(h[4],c),h:Za(h[5],c),m:Za(h[6],c),s:Za(h[7],c),w:Za(h[8],c)}):null==g?g={}:"object"==typeof g&&("from"in g||"to"in g)&&(e=_a(Da(g.from),Da(g.to)),g={},g.ms=e.milliseconds,g.M=e.months),d=new Ha(g),Ia(a)&&f(a,"_locale")&&(d._locale=a._locale),d}function Za(a,b){var c=a&&parseFloat(a.replace(",","."));return(isNaN(c)?0:c)*b}function $a(a,b){var c={milliseconds:0,months:0};return c.months=b.month()-a.month()+12*(b.year()-a.year()),a.clone().add(c.months,"M").isAfter(b)&&--c.months,c.milliseconds=+b-+a.clone().add(c.months,"M"),c}function _a(a,b){var c;return b=La(b,a),a.isBefore(b)?c=$a(a,b):(c=$a(b,a),c.milliseconds=-c.milliseconds,c.months=-c.months),c}function ab(a,b){return function(c,d){var e,f;return null===d||isNaN(+d)||(ba(b,"moment()."+b+"(period, number) is deprecated. Please use moment()."+b+"(number, period)."),f=c,c=d,d=f),c="string"==typeof c?+c:c,e=Ya(c,d),bb(this,e,a),this}}function bb(b,c,d,e){var f=c._milliseconds,g=c._days,h=c._months;e=null==e||e,f&&b._d.setTime(+b._d+f*d),g&&E(b,"Date",D(b,"Date")+g*d),h&&X(b,D(b,"Month")+h*d),e&&a.updateOffset(b,g||h)}function cb(a,b){var c=a||Da(),d=La(c,this).startOf("day"),e=this.diff(d,"days",!0),f=-6>e?"sameElse":-1>e?"lastWeek":0>e?"lastDay":1>e?"sameDay":2>e?"nextDay":7>e?"nextWeek":"sameElse";return this.format(b&&b[f]||this.localeData().calendar(f,this,Da(c)))}function db(){return new n(this)}function eb(a,b){var c;return b=A("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=o(a)?a:Da(a),+this>+a):(c=o(a)?+a:+Da(a),c<+this.clone().startOf(b))}function fb(a,b){var c;return b=A("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=o(a)?a:Da(a),+a>+this):(c=o(a)?+a:+Da(a),+this.clone().endOf(b)<c)}function gb(a,b,c){return this.isAfter(a,c)&&this.isBefore(b,c)}function hb(a,b){var c;return b=A(b||"millisecond"),"millisecond"===b?(a=o(a)?a:Da(a),+this===+a):(c=+Da(a),+this.clone().startOf(b)<=c&&c<=+this.clone().endOf(b))}function ib(a,b,c){var d,e,f=La(a,this),g=6e4*(f.utcOffset()-this.utcOffset());return b=A(b),"year"===b||"month"===b||"quarter"===b?(e=jb(this,f),"quarter"===b?e/=3:"year"===b&&(e/=12)):(d=this-f,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?(d-g)/864e5:"week"===b?(d-g)/6048e5:d),c?e:p(e)}function jb(a,b){var c,d,e=12*(b.year()-a.year())+(b.month()-a.month()),f=a.clone().add(e,"months");return 0>b-f?(c=a.clone().add(e-1,"months"),d=(b-f)/(f-c)):(c=a.clone().add(e+1,"months"),d=(b-f)/(c-f)),-(e+d)}function kb(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function lb(){var a=this.clone().utc();return 0<a.year()&&a.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():K(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):K(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function mb(b){var c=K(this,b||a.defaultFormat);return this.localeData().postformat(c)}function nb(a,b){return this.isValid()?Ya({to:this,from:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function ob(a){return this.from(Da(),a)}function pb(a,b){return this.isValid()?Ya({from:this,to:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function qb(a){return this.to(Da(),a)}function rb(a){var b;return void 0===a?this._locale._abbr:(b=y(a),null!=b&&(this._locale=b),this)}function sb(){return this._locale}function tb(a){switch(a=A(a)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a&&this.weekday(0),"isoWeek"===a&&this.isoWeekday(1),"quarter"===a&&this.month(3*Math.floor(this.month()/3)),this}function ub(a){return a=A(a),void 0===a||"millisecond"===a?this:this.startOf(a).add(1,"isoWeek"===a?"week":a).subtract(1,"ms")}function vb(){return+this._d-6e4*(this._offset||0)}function wb(){return Math.floor(+this/1e3)}function xb(){return this._offset?new Date(+this):this._d}function yb(){var a=this;return[a.year(),a.month(),a.date(),a.hour(),a.minute(),a.second(),a.millisecond()]}function zb(){var a=this;return{years:a.year(),months:a.month(),date:a.date(),hours:a.hours(),minutes:a.minutes(),seconds:a.seconds(),milliseconds:a.milliseconds()}}function Ab(){return k(this)}function Bb(){return g({},j(this))}function Cb(){return j(this).overflow}function Db(a,b){H(0,[a,a.length],0,b)}function Eb(a,b,c){return ja(Da([a,11,31+b-c]),b,c).week}function Fb(a){var b=ja(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==a?b:this.add(a-b,"y")}function Gb(a){var b=ja(this,1,4).year;return null==a?b:this.add(a-b,"y")}function Hb(){return Eb(this.year(),1,4)}function Ib(){var a=this.localeData()._week;return Eb(this.year(),a.dow,a.doy)}function Jb(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*(a-1)+this.month()%3)}function Kb(a,b){return"string"!=typeof a?a:isNaN(a)?(a=b.weekdaysParse(a),"number"==typeof a?a:null):parseInt(a,10)}function Lb(a){return this._weekdays[a.day()]}function Mb(a){return this._weekdaysShort[a.day()]}function Nb(a){return this._weekdaysMin[a.day()]}function Ob(a){var b,c,d;for(this._weekdaysParse=this._weekdaysParse||[],b=0;7>b;b++)if(this._weekdaysParse[b]||(c=Da([2e3,1]).day(b),d="^"+this.weekdays(c,"")+"|^"+this.weekdaysShort(c,"")+"|^"+this.weekdaysMin(c,""),this._weekdaysParse[b]=new RegExp(d.replace(".",""),"i")),this._weekdaysParse[b].test(a))return b}function Pb(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=Kb(a,this.localeData()),this.add(a-b,"d")):b}function Qb(a){var b=(this.day()+7-this.localeData()._week.dow)%7;return null==a?b:this.add(a-b,"d")}function Rb(a){return null==a?this.day()||7:this.day(this.day()%7?a:a-7)}function Sb(a,b){H(a,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),b)})}function Tb(a,b){return b._meridiemParse}function Ub(a){return"p"===(a+"").toLowerCase().charAt(0)}function Vb(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"}function Wb(a,b){b[ld]=q(1e3*("0."+a))}function Xb(){return this._isUTC?"UTC":""}function Yb(){return this._isUTC?"Coordinated Universal Time":""}function Zb(a){return Da(1e3*a)}function $b(){return Da.apply(null,arguments).parseZone()}function _b(a,b,c){var d=this._calendar[a];return"function"==typeof d?d.call(b,c):d}function ac(a){var b=this._longDateFormat[a],c=this._longDateFormat[a.toUpperCase()];return b||!c?b:(this._longDateFormat[a]=c.replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a])}function bc(){return this._invalidDate}function cc(a){return this._ordinal.replace("%d",a)}function dc(a){return a}function ec(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)}function fc(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)}function gc(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function hc(a,b,c,d){var e=y(),f=h().set(d,b);return e[c](f,a)}function ic(a,b,c,d,e){if("number"==typeof a&&(b=a,a=void 0),a=a||"",null!=b)return hc(a,b,c,e);var f,g=[];for(f=0;d>f;f++)g[f]=hc(a,f,c,e);return g}function jc(a,b){return ic(a,b,"months",12,"month")}function kc(a,b){return ic(a,b,"monthsShort",12,"month")}function lc(a,b){return ic(a,b,"weekdays",7,"day")}function mc(a,b){return ic(a,b,"weekdaysShort",7,"day")}function nc(a,b){return ic(a,b,"weekdaysMin",7,"day")}function oc(){var a=this._data;return this._milliseconds=Wd(this._milliseconds),this._days=Wd(this._days),this._months=Wd(this._months),a.milliseconds=Wd(a.milliseconds),a.seconds=Wd(a.seconds),a.minutes=Wd(a.minutes),a.hours=Wd(a.hours),a.months=Wd(a.months),a.years=Wd(a.years),this}function pc(a,b,c,d){var e=Ya(b,c);return a._milliseconds+=d*e._milliseconds,a._days+=d*e._days,a._months+=d*e._months,a._bubble()}function qc(a,b){return pc(this,a,b,1)}function rc(a,b){return pc(this,a,b,-1)}function sc(a){return 0>a?Math.floor(a):Math.ceil(a)}function tc(){var a,b,c,d,e,f=this._milliseconds,g=this._days,h=this._months,i=this._data;return f>=0&&g>=0&&h>=0||0>=f&&0>=g&&0>=h||(f+=864e5*sc(vc(h)+g),g=0,h=0),i.milliseconds=f%1e3,a=p(f/1e3),i.seconds=a%60,b=p(a/60),i.minutes=b%60,c=p(b/60),i.hours=c%24,g+=p(c/24),e=p(uc(g)),h+=e,g-=sc(vc(e)),d=p(h/12),h%=12,i.days=g,i.months=h,i.years=d,this}function uc(a){return 4800*a/146097}function vc(a){return 146097*a/4800}function wc(a){var b,c,d=this._milliseconds;if(a=A(a),"month"===a||"year"===a)return b=this._days+d/864e5,c=this._months+uc(b),"month"===a?c:c/12;switch(b=this._days+Math.round(vc(this._months)),a){case"week":return b/7+d/6048e5;case"day":return b+d/864e5;case"hour":return 24*b+d/36e5;case"minute":return 1440*b+d/6e4;case"second":return 86400*b+d/1e3;case"millisecond":return Math.floor(864e5*b)+d;default:throw new Error("Unknown unit "+a)}}function xc(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*q(this._months/12)}function yc(a){return function(){return this.as(a)}}function zc(a){return a=A(a),this[a+"s"]()}function Ac(a){return function(){return this._data[a]}}function Bc(){return p(this.days()/7)}function Cc(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function Dc(a,b,c){var d=Ya(a).abs(),e=ke(d.as("s")),f=ke(d.as("m")),g=ke(d.as("h")),h=ke(d.as("d")),i=ke(d.as("M")),j=ke(d.as("y")),k=e<le.s&&["s",e]||1===f&&["m"]||f<le.m&&["mm",f]||1===g&&["h"]||g<le.h&&["hh",g]||1===h&&["d"]||h<le.d&&["dd",h]||1===i&&["M"]||i<le.M&&["MM",i]||1===j&&["y"]||["yy",j];return k[2]=b,k[3]=+a>0,k[4]=c,Cc.apply(null,k)}function Ec(a,b){return void 0!==le[a]&&(void 0===b?le[a]:(le[a]=b,!0))}function Fc(a){var b=this.localeData(),c=Dc(this,!a,b);return a&&(c=b.pastFuture(+this,c)),b.postformat(c)}function Gc(){var a,b,c,d=me(this._milliseconds)/1e3,e=me(this._days),f=me(this._months);a=p(d/60),b=p(a/60),d%=60,a%=60,c=p(f/12),f%=12;var g=c,h=f,i=e,j=b,k=a,l=d,m=this.asSeconds();return m?(0>m?"-":"")+"P"+(g?g+"Y":"")+(h?h+"M":"")+(i?i+"D":"")+(j||k||l?"T":"")+(j?j+"H":"")+(k?k+"M":"")+(l?l+"S":""):"P0D"}var Hc,Ic,Jc=a.momentProperties=[],Kc=!1,Lc={},Mc={},Nc=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Oc=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Pc={},Qc={},Rc=/\d/,Sc=/\d\d/,Tc=/\d{3}/,Uc=/\d{4}/,Vc=/[+-]?\d{6}/,Wc=/\d\d?/,Xc=/\d{1,3}/,Yc=/\d{1,4}/,Zc=/[+-]?\d{1,6}/,$c=/\d+/,_c=/[+-]?\d+/,ad=/Z|[+-]\d\d:?\d\d/gi,bd=/[+-]?\d+(\.\d{1,3})?/,cd=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,dd={},ed={},fd=0,gd=1,hd=2,id=3,jd=4,kd=5,ld=6;H("M",["MM",2],"Mo",function(){return this.month()+1}),H("MMM",0,0,function(a){return this.localeData().monthsShort(this,a)}),H("MMMM",0,0,function(a){return this.localeData().months(this,a)}),z("month","M"),N("M",Wc),N("MM",Wc,Sc),N("MMM",cd),N("MMMM",cd),Q(["M","MM"],function(a,b){b[gd]=q(a)-1}),Q(["MMM","MMMM"],function(a,b,c,d){var e=c._locale.monthsParse(a,d,c._strict);null!=e?b[gd]=e:j(c).invalidMonth=a});var md="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),nd="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),od={};a.suppressDeprecationWarnings=!1;var pd=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,qd=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],rd=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],sd=/^\/?Date\((\-?\d+)/i;a.createFromInputFallback=aa("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))}),H(0,["YY",2],0,function(){return this.year()%100}),H(0,["YYYY",4],0,"year"),H(0,["YYYYY",5],0,"year"),H(0,["YYYYYY",6,!0],0,"year"),z("year","y"),N("Y",_c),N("YY",Wc,Sc),N("YYYY",Yc,Uc),N("YYYYY",Zc,Vc),N("YYYYYY",Zc,Vc),Q(["YYYYY","YYYYYY"],fd),Q("YYYY",function(b,c){c[fd]=2===b.length?a.parseTwoDigitYear(b):q(b)}),Q("YY",function(b,c){c[fd]=a.parseTwoDigitYear(b)}),a.parseTwoDigitYear=function(a){return q(a)+(q(a)>68?1900:2e3)};var td=C("FullYear",!1);H("w",["ww",2],"wo","week"),H("W",["WW",2],"Wo","isoWeek"),z("week","w"),z("isoWeek","W"),N("w",Wc),N("ww",Wc,Sc),N("W",Wc),N("WW",Wc,Sc),R(["w","ww","W","WW"],function(a,b,c,d){b[d.substr(0,1)]=q(a)});var ud={dow:0,doy:6};H("DDD",["DDDD",3],"DDDo","dayOfYear"),z("dayOfYear","DDD"),N("DDD",Xc),N("DDDD",Tc),Q(["DDD","DDDD"],function(a,b,c){c._dayOfYear=q(a)}),a.ISO_8601=function(){};var vd=aa("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var a=Da.apply(null,arguments);return this>a?this:a}),wd=aa("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var a=Da.apply(null,arguments);return a>this?this:a});Ja("Z",":"),Ja("ZZ",""),N("Z",ad),N("ZZ",ad),Q(["Z","ZZ"],function(a,b,c){c._useUTC=!0,c._tzm=Ka(a)});var xd=/([\+\-]|\d\d)/gi;a.updateOffset=function(){};var yd=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,zd=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;Ya.fn=Ha.prototype;var Ad=ab(1,"add"),Bd=ab(-1,"subtract");a.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";var Cd=aa("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(a){return void 0===a?this.localeData():this.locale(a)});H(0,["gg",2],0,function(){return this.weekYear()%100}),H(0,["GG",2],0,function(){return this.isoWeekYear()%100}),Db("gggg","weekYear"),Db("ggggg","weekYear"),Db("GGGG","isoWeekYear"),Db("GGGGG","isoWeekYear"),z("weekYear","gg"),z("isoWeekYear","GG"),N("G",_c),N("g",_c),N("GG",Wc,Sc),N("gg",Wc,Sc),N("GGGG",Yc,Uc),N("gggg",Yc,Uc),N("GGGGG",Zc,Vc),N("ggggg",Zc,Vc),R(["gggg","ggggg","GGGG","GGGGG"],function(a,b,c,d){b[d.substr(0,2)]=q(a)}),R(["gg","GG"],function(b,c,d,e){c[e]=a.parseTwoDigitYear(b)}),H("Q",0,0,"quarter"),z("quarter","Q"),N("Q",Rc),Q("Q",function(a,b){b[gd]=3*(q(a)-1)}),H("D",["DD",2],"Do","date"),z("date","D"),N("D",Wc),N("DD",Wc,Sc),N("Do",function(a,b){return a?b._ordinalParse:b._ordinalParseLenient}),Q(["D","DD"],hd),Q("Do",function(a,b){b[hd]=q(a.match(Wc)[0],10)});var Dd=C("Date",!0);H("d",0,"do","day"),H("dd",0,0,function(a){return this.localeData().weekdaysMin(this,a)}),H("ddd",0,0,function(a){return this.localeData().weekdaysShort(this,a)}),H("dddd",0,0,function(a){return this.localeData().weekdays(this,a)}),H("e",0,0,"weekday"),H("E",0,0,"isoWeekday"),z("day","d"),z("weekday","e"),z("isoWeekday","E"),N("d",Wc),N("e",Wc),N("E",Wc),N("dd",cd),N("ddd",cd),N("dddd",cd),R(["dd","ddd","dddd"],function(a,b,c){var d=c._locale.weekdaysParse(a);null!=d?b.d=d:j(c).invalidWeekday=a}),R(["d","e","E"],function(a,b,c,d){b[d]=q(a)});var Ed="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Fd="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Gd="Su_Mo_Tu_We_Th_Fr_Sa".split("_");H("H",["HH",2],0,"hour"),H("h",["hh",2],0,function(){return this.hours()%12||12}),Sb("a",!0),Sb("A",!1),z("hour","h"),N("a",Tb),N("A",Tb),N("H",Wc),N("h",Wc),N("HH",Wc,Sc),N("hh",Wc,Sc),Q(["H","HH"],id),Q(["a","A"],function(a,b,c){c._isPm=c._locale.isPM(a),c._meridiem=a}),Q(["h","hh"],function(a,b,c){b[id]=q(a),j(c).bigHour=!0});var Hd=/[ap]\.?m?\.?/i,Id=C("Hours",!0);H("m",["mm",2],0,"minute"),z("minute","m"),N("m",Wc),N("mm",Wc,Sc),Q(["m","mm"],jd);var Jd=C("Minutes",!1);H("s",["ss",2],0,"second"),z("second","s"),N("s",Wc),N("ss",Wc,Sc),Q(["s","ss"],kd);var Kd=C("Seconds",!1);H("S",0,0,function(){return~~(this.millisecond()/100)}),H(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),H(0,["SSS",3],0,"millisecond"),H(0,["SSSS",4],0,function(){return 10*this.millisecond()}),H(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),H(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),H(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),H(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),H(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),z("millisecond","ms"),N("S",Xc,Rc),N("SS",Xc,Sc),N("SSS",Xc,Tc);var Ld;for(Ld="SSSS";Ld.length<=9;Ld+="S")N(Ld,$c);for(Ld="S";Ld.length<=9;Ld+="S")Q(Ld,Wb);var Md=C("Milliseconds",!1);H("z",0,0,"zoneAbbr"),H("zz",0,0,"zoneName");var Nd=n.prototype;Nd.add=Ad,Nd.calendar=cb,Nd.clone=db,Nd.diff=ib,Nd.endOf=ub,Nd.format=mb,Nd.from=nb,Nd.fromNow=ob,Nd.to=pb,Nd.toNow=qb,Nd.get=F,Nd.invalidAt=Cb,Nd.isAfter=eb,Nd.isBefore=fb,Nd.isBetween=gb,Nd.isSame=hb,Nd.isValid=Ab,Nd.lang=Cd,Nd.locale=rb,Nd.localeData=sb,Nd.max=wd,Nd.min=vd,Nd.parsingFlags=Bb,Nd.set=F,Nd.startOf=tb,Nd.subtract=Bd,Nd.toArray=yb,Nd.toObject=zb,Nd.toDate=xb,Nd.toISOString=lb,Nd.toJSON=lb,Nd.toString=kb,Nd.unix=wb,Nd.valueOf=vb,Nd.year=td,Nd.isLeapYear=ia,Nd.weekYear=Fb,Nd.isoWeekYear=Gb,Nd.quarter=Nd.quarters=Jb,Nd.month=Y,Nd.daysInMonth=Z,Nd.week=Nd.weeks=na,Nd.isoWeek=Nd.isoWeeks=oa,Nd.weeksInYear=Ib,Nd.isoWeeksInYear=Hb,Nd.date=Dd,Nd.day=Nd.days=Pb,Nd.weekday=Qb,Nd.isoWeekday=Rb,Nd.dayOfYear=qa,Nd.hour=Nd.hours=Id,Nd.minute=Nd.minutes=Jd,Nd.second=Nd.seconds=Kd,Nd.millisecond=Nd.milliseconds=Md,
Nd.utcOffset=Na,Nd.utc=Pa,Nd.local=Qa,Nd.parseZone=Ra,Nd.hasAlignedHourOffset=Sa,Nd.isDST=Ta,Nd.isDSTShifted=Ua,Nd.isLocal=Va,Nd.isUtcOffset=Wa,Nd.isUtc=Xa,Nd.isUTC=Xa,Nd.zoneAbbr=Xb,Nd.zoneName=Yb,Nd.dates=aa("dates accessor is deprecated. Use date instead.",Dd),Nd.months=aa("months accessor is deprecated. Use month instead",Y),Nd.years=aa("years accessor is deprecated. Use year instead",td),Nd.zone=aa("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",Oa);var Od=Nd,Pd={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},Qd={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},Rd="Invalid date",Sd="%d",Td=/\d{1,2}/,Ud={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},Vd=s.prototype;Vd._calendar=Pd,Vd.calendar=_b,Vd._longDateFormat=Qd,Vd.longDateFormat=ac,Vd._invalidDate=Rd,Vd.invalidDate=bc,Vd._ordinal=Sd,Vd.ordinal=cc,Vd._ordinalParse=Td,Vd.preparse=dc,Vd.postformat=dc,Vd._relativeTime=Ud,Vd.relativeTime=ec,Vd.pastFuture=fc,Vd.set=gc,Vd.months=U,Vd._months=md,Vd.monthsShort=V,Vd._monthsShort=nd,Vd.monthsParse=W,Vd.week=ka,Vd._week=ud,Vd.firstDayOfYear=ma,Vd.firstDayOfWeek=la,Vd.weekdays=Lb,Vd._weekdays=Ed,Vd.weekdaysMin=Nb,Vd._weekdaysMin=Gd,Vd.weekdaysShort=Mb,Vd._weekdaysShort=Fd,Vd.weekdaysParse=Ob,Vd.isPM=Ub,Vd._meridiemParse=Hd,Vd.meridiem=Vb,w("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var b=a%10,c=1===q(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),a.lang=aa("moment.lang is deprecated. Use moment.locale instead.",w),a.langData=aa("moment.langData is deprecated. Use moment.localeData instead.",y);var Wd=Math.abs,Xd=yc("ms"),Yd=yc("s"),Zd=yc("m"),$d=yc("h"),_d=yc("d"),ae=yc("w"),be=yc("M"),ce=yc("y"),de=Ac("milliseconds"),ee=Ac("seconds"),fe=Ac("minutes"),ge=Ac("hours"),he=Ac("days"),ie=Ac("months"),je=Ac("years"),ke=Math.round,le={s:45,m:45,h:22,d:26,M:11},me=Math.abs,ne=Ha.prototype;ne.abs=oc,ne.add=qc,ne.subtract=rc,ne.as=wc,ne.asMilliseconds=Xd,ne.asSeconds=Yd,ne.asMinutes=Zd,ne.asHours=$d,ne.asDays=_d,ne.asWeeks=ae,ne.asMonths=be,ne.asYears=ce,ne.valueOf=xc,ne._bubble=tc,ne.get=zc,ne.milliseconds=de,ne.seconds=ee,ne.minutes=fe,ne.hours=ge,ne.days=he,ne.weeks=Bc,ne.months=ie,ne.years=je,ne.humanize=Fc,ne.toISOString=Gc,ne.toString=Gc,ne.toJSON=Gc,ne.locale=rb,ne.localeData=sb,ne.toIsoString=aa("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Gc),ne.lang=Cd,H("X",0,0,"unix"),H("x",0,0,"valueOf"),N("x",_c),N("X",bd),Q("X",function(a,b,c){c._d=new Date(1e3*parseFloat(a,10))}),Q("x",function(a,b,c){c._d=new Date(q(a))}),a.version="2.10.6",b(Da),a.fn=Od,a.min=Fa,a.max=Ga,a.utc=h,a.unix=Zb,a.months=jc,a.isDate=d,a.locale=w,a.invalid=l,a.duration=Ya,a.isMoment=o,a.weekdays=lc,a.parseZone=$b,a.localeData=y,a.isDuration=Ia,a.monthsShort=kc,a.weekdaysMin=nc,a.defineLocale=x,a.weekdaysShort=mc,a.normalizeUnits=A,a.relativeTimeThreshold=Ec;var oe=a;return oe})}).call(exports,__webpack_require__(141)(module))},function(module,exports){module.exports=function(module){return module.webpackPolyfill||(module.deprecate=function(){},module.paths=[],module.children=[],module.webpackPolyfill=1),module}},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),tpl=(__webpack_require__(5),__webpack_require__(143)),config=__webpack_require__(6);config.pageDataObj;module.exports=backbone.View.extend({el:"#m-remark",events:{"blur textarea":"changeInfo"},initialize:function(){this.model.get("show")&&this.render()},render:function(){var data=this.model.toJSON(),html=tpl(data);this.$el.html(html).show()},changeInfo:function(e){var obj=$(e.currentTarget),val=obj.val();this.model.changeInfo(val)}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,$out=($utils.$helpers,"");return $out+='<h2>\r\n    <span class="icon remark-icon"></span>\r\n    <span class="m-title">备注信息</span>\r\n</h2>\r\n<div class="modular-body">\r\n    <textarea name="" id="" placeholder="添加备注信息之后，会生成网络订单，如无特殊情况，请勿填写"></textarea>\r\n</div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),eventBus=__webpack_require__(5),tpl=__webpack_require__(145);module.exports=backbone.View.extend({el:"#m-footer",events:{"click .input_checkbox":"agree","click .contract-name":"toContract","click .next button":"confirm"},initialize:function(){this.render(),this.listenTo(this.model,"render",this.render)},render:function(){var data=this.model.toJSON(),html=tpl(data);this.$el.html(html).show()},agree:function(){this.model.agree()},toContract:function(e){eventBus.trigger("toContract"),e.stopPropagation()},confirm:function(){eventBus.trigger("saveOrder")}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,isTeamTour=($utils.$helpers,$data.isTeamTour),isFastOrder=$data.isFastOrder,agree=$data.agree,$escape=$utils.$escape,contractName=$data.contractName,btnDisabled=$data.btnDisabled,operationFlag=$data.operationFlag,bookStep=$data.bookStep,pageType=$data.pageType,buttonText=$data.buttonText,$out="";return $out+='<div class="footer-main">\r\n    ',isTeamTour||isFastOrder||($out+='\r\n    <div class="click-to-agree">\r\n        <label class="input_checkbox ',agree&&($out+="enabled"),$out+='">\r\n            <span class="tn_fontface"></span>我已阅读并同意 <em class="contract-name">',$out+=$escape(contractName),$out+="</em>\r\n        </label>\r\n    </div>\r\n    "),$out+='\r\n    <div class="next">\r\n        <button ',btnDisabled&&($out+="disabled\r\n                "),$out+="\r\n                ","2"==operationFlag&&($out+='\r\n                m="点击_底部按钮____提交"\r\n                '),$out+='\r\n                href="javascript:;">\r\n            ',"step1"==bookStep?($out+="\r\n            ","cruise2"==pageType?$out+="\r\n            下一步\r\n            ":($out+="\r\n                ",$out+=$escape(buttonText),$out+="\r\n            "),$out+="\r\n            "):"step2"==bookStep?$out+="\r\n            提交\r\n            ":"step3"==bookStep&&($out+="\r\n            确认\r\n            "),$out+='\r\n        </button>\r\n    </div>\r\n    <div class="clear-float"></div>\r\n</div>',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),layer2=__webpack_require__(18),tpl=__webpack_require__(147),tools=__webpack_require__(16),constant=__webpack_require__(11);module.exports=backbone.View.extend({el:"#m-agreement",events:{"click .left-panel p":"changeContent","click .book-close":"close"},initialize:function(){this.listenTo(this.model,"render",this.render)},changeContent:function(e){var obj=$(e.currentTarget),index=+obj.data("index");this.model.changeContent(index)},show:function(){this.open(),this.render()},open:function(){this.height=tools.responsive(this.$el,constant.MAX_FLOAT_PANEL_HEIGHT).height,this.layerIndex=layer2.open({type:1,title:!1,content:this.$el,closeBtn:0,area:["1165px",this.height]})},render:function(){var data=this.model.toJSON(),html=tpl(data);this.$el.html(html).show(),this.$el.find(".right-panel").height(this.height-120)},close:function(){layer2.close(this.layerIndex)}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(fn){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7)],__WEBPACK_AMD_DEFINE_FACTORY__=fn,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(function(template){function anonymous($data,$filename){"use strict";var $utils=this,_=($utils.$helpers,$data._),bookNote=$data.bookNote,index=$data.index,addition=$data.addition,orderNotice=$data.orderNotice,$escape=($data.item,$utils.$escape),isGuide=($data.item2,$data.index2,$data.isGuide),destClassId=$data.destClassId,proMode=$data.proMode,contractCode=$data.contractCode,productId=$data.productId,safeNoticeUrl=$data.safeNoticeUrl,civilizedLedge=$data.civilizedLedge,riskContents=$data.riskContents,$string=$utils.$string,$out="";return $out+='<header class="float-header">\r\n    <h2 class="active">途牛订单协议</h2>\r\n    <span><i class="icon book-close"></i></span>\r\n</header>\r\n<div class="order-main">\r\n    <p class="order-main-title">请仔细阅读合同范本，具体出游信息以您填写的订单为准，付款完成后您可在“会员中心-我的订单”中下载包含完整订单信息的旅游合同。</p>\r\n\r\n    <div class="order-panel">\r\n        <div class="left-panel">\r\n\r\n            ',_.isEmpty(bookNote)||($out+='\r\n            <p data-index="0" class="',0==index&&($out+="active"),$out+='"><i class="icon agreement-icon"></i>预订须知</p>\r\n            '),$out+='\r\n            <p data-index="1" class="',1==index&&($out+="active"),$out+='"><i class="icon agreement-icon"></i>旅游合同</p>\r\n            ',_.isEmpty(addition)||($out+='\r\n            <p data-index="2" class="',2==index&&($out+="active"),$out+='"><i class="icon agreement-icon"></i>保险条款</p>\r\n            '),$out+="\r\n            ",_.isEmpty(addition)||($out+='\r\n            <p data-index="3" class="',3==index&&($out+="active"),$out+='"><i class="icon agreement-icon"></i>保险经纪委托合同及客户告知书</p>\r\n            '),$out+="\r\n            ",_.isEmpty(orderNotice)||($out+='\r\n            <p data-index="4" class="',4==index&&($out+="active"),$out+='"><i class="icon agreement-icon"></i>特别预订提示</p>\r\n            '),$out+='\r\n            <p data-index="5" class="',5==index&&($out+="active"),$out+='"><i class="icon agreement-icon"></i>安全提示</p>\r\n\r\n        </div>\r\n        <div class="right-panel">\r\n\r\n            ',_.isEmpty(bookNote)||0!=index||($out+='\r\n            <div class="right-wrapper">\r\n                <dl>\r\n                    ',_.each(bookNote,function(item){$out+="\r\n                    ",_.isEmpty(item.content)||($out+="\r\n                    <dt>",$out+=$escape(item.title),$out+="</dt>\r\n                    ",_.each(item.content,function(item2,index2){$out+="\r\n                    <dd>",$out+=$escape(index2+1),$out+="、",$out+=$escape(item2),$out+="</dd>\r\n                    "}),$out+="\r\n                    "),$out+="\r\n                    "}),$out+="\r\n                </dl>\r\n            </div>\r\n            "),$out+="\r\n\r\n            ",1==index&&($out+='\r\n            <div class="right-wrapper wrapper-iframe">\r\n                ',1!=isGuide||8!=destClassId&&9!=destClassId||7!=proMode?($out+='\r\n                <iframe frameborder="0" class="contract-iframe"\r\n                        src="//www.tuniu.com/yii.php?r=order/tourV3Order/GetContractTemplate&contractCode=',$out+=$escape(contractCode),$out+="&productId=",$out+=$escape(productId),$out+='"></iframe>\r\n                '):($out+='\r\n                <iframe frameborder="0" class="contract-iframe"\r\n                        src="//www.tuniu.com/yii.php?r=order/tourV3Order/GetContractTemplate&contractCode=',$out+=$escape(contractCode),$out+="&productId=",$out+=$escape(productId),$out+='"></iframe>\r\n                <iframe frameborder="0" class="contract-iframe"\r\n                        src="//www.tuniu.com/yii.php?r=order/tourV3Order/GetContractTemplate&contractCode=316&productId=',$out+=$escape(productId),$out+='"></iframe>\r\n                '),$out+="\r\n            </div>\r\n            "),$out+="\r\n\r\n            ",_.isEmpty(addition)||2!=index||($out+='\r\n            <div class="right-wrapper">\r\n                <dl>\r\n                    ',_.each(addition,function(item){$out+="\r\n                    <dt>",$out+=$escape(item.title),$out+="</dt>\r\n                    ",_.each(item.content,function(item2,index2){$out+="\r\n                    <dd>",$out+=$escape(index2+1),$out+="、",$out+=$escape(item2),$out+="</dd>\r\n                    "}),$out+="\r\n                    "}),$out+="\r\n                </dl>\r\n            </div>\r\n            "),$out+="\r\n\r\n            ",_.isEmpty(addition)||3!=index||($out+='\r\n            <div class="right-wrapper wrapper-iframe">\r\n                <iframe frameborder="0" class="contract-iframe"\r\n                        src="/tn?r=order/tourV3Order/GetContractTemplate&contractCode=335&productId=',$out+=$escape(productId),$out+='"></iframe>\r\n            </div>\r\n            '),$out+="\r\n\r\n            ",_.isEmpty(orderNotice)||4!=index||($out+='\r\n            <div class="right-wrapper">\r\n                <dl>\r\n                    ',_.each(orderNotice,function(item2,index2){$out+="\r\n                    <dd>",$out+=$escape(index2+1),$out+="、",$out+=$escape(item2),$out+="</dd>\r\n                    "}),$out+="\r\n                </dl>\r\n            </div>\r\n            "),$out+="\r\n\r\n            ",5==index&&($out+='\r\n            <div class="right-wrapper">\r\n                <div class="para">1、为普及旅游安全知识及旅游文明公约，使您的旅程顺利圆满完成、特拟定安全须知和文明公约：</div>\r\n                <div class="para">\r\n                    <a name="safe" class="safe" href="',$out+=$escape(safeNoticeUrl),$out+='">《安全须知》</a>、<a name="safe" class="safe" href="',$out+=$escape(civilizedLedge),$out+='">《文明条约》</a>\r\n                </div>\r\n                <div class="para">2、高危项目活动安全须知提示：</div>\r\n                <div class="para">\r\n                    <dl>\r\n                        ',_.each(riskContents,function(item){$out+="\r\n                        <dt>",$out+=$escape(item.riskTitle),$out+="</dt>\r\n                        ",_.each(item.riskDetails,function(item2,index2){$out+="\r\n                        <dd>（",$out+=$escape(index2+1),$out+="）",$out+=$string(item2),$out+="</dd>\r\n                        "}),$out+="\r\n                        "}),$out+="\r\n                    </dl>\r\n                </div>\r\n            </div>\r\n            "),$out+='\r\n\r\n        </div>\r\n        <div class="clear-float"></div>\r\n    </div>\r\n</div>\r\n',new String($out)}return function(){var obj={};arguments[0]=arguments[0]||{};for(var key2 in arguments[0])obj[key2]=arguments[0][key2];for(var key in template.helpers)obj[key]=template.helpers[key];return window.pageDataObj&&(obj.bookStep=window.pageDataObj.bookStep,obj.pageType=window.pageDataObj.pageType,obj.proType=window.pageDataObj.proType,obj.proLine=window.pageDataObj.proLine,obj.proMode=window.pageDataObj.proMode),anonymous.call(template.utils,obj).toString()}})},function(module,exports,__webpack_require__){var backbone=__webpack_require__(9),layer=__webpack_require__(17),config=__webpack_require__(6),pageDataObj=config.pageDataObj,tools=__webpack_require__(16),eventBus=__webpack_require__(5);module.exports=backbone.View.extend({showLoading:function(){eventBus.trigger("changeBtnDisabled",!0),layer.closeAll(),layer.load("请稍后...")},hideLoading:function(){eventBus.trigger("changeBtnDisabled",!1),layer.closeAll()},saveOrderSuccess:function(data){3!=data.source?data.salerId&&data.telNum?tools.layer({icon:2,msg:"订单号"+data.orderId+"已经生成，订单状态：网络单!"}):this.goNetOrder(data):data.hasPassengers?this.checkCanPay(data):data.salerId&&data.telNum?tools.layer({icon:0,msg:"提交成功，已生成订单号："+data.orderId+"，请提醒客人前往订单详情页填写出游人信息!"}):window.location.href="https://i.tuniu.com/list/?fromorder="+data.orderId},saveOrderSuccess2:function(data){data&&data.next?window.location.href=data.next:2==data.source?window.location.href="/tours/"+pageDataObj.productId+"/book/transform/"+data.orderId:tools.layer({msg:data.msg||"很抱歉，系统出现异常，您可以再次尝试！"})},saveOrderFail:function(data){if(data)if(data.data.blackCard&&!data.data.blackCard.success)eventBus.trigger("hasNoRightBlackCard",data.data.blackCard);else switch(data.filterType){case 1:this.showTeenageErr(),eventBus.trigger("resetHasCheck");break;case 2:this.showBeyondAgeLimitErr(),eventBus.trigger("resetHasCheck");break;case 3:window.location.href=data.orderUrl;break;default:var index=tools.layer({msg:data.msg||"很抱歉，系统出现异常，您可以再次尝试！",yes:function(){layer.close(index),pageDataObj.hasCheckTourist=0}});eventBus.trigger("resetHasCheck")}else tools.layer({msg:"下单超时"}),eventBus.trigger("resetHasCheck")},saveOrderFail2:function(){tools.layer({msg:"下单超时"})},checkCanPay:function(data){var self=this;layer.closeAll(),layer.load('订单已经生成，正在占位中...<br/><span class="loading_time">我们会在<span class="tip-waiting-remaining">'+(pageDataObj.occupyTimeout||30)+"</span>秒内反馈结果</span>");var timeCount=pageDataObj.occupyTimeout||30,times=1,data={orderId:data.orderId,times:times,telNum:pageDataObj.telNum};this.model.checkPaySwitch(data),$(".tip-waiting-remaining").text(timeCount),window.checkCanPayTimer=setInterval(function(){timeCount--,$(".tip-waiting-remaining").text(timeCount),timeCount%2==0&&(times++,data.times=times,self.model.checkPaySwitch(data)),0==timeCount&&(window.clearInterval(window.checkCanPayTimer),self.goNetOrder(data))},1e3)},goSige:function(data){layer.closeAll(),window.clearInterval(window.checkCanPayTimer),data.salerId&&data.telNum?tools.layer({icon:0,msg:"提交成功，已生成订单号："+data.orderId+"，请提醒客人登录会员中心签约付款。"}):(layer.load("正在签约，请稍候..."),this.model.saveSign(data),this.model.set("hasSign",1))},goNetOrder:function(data){window.location.href="//www.tuniu.com/tours/"+pageDataObj.productId+"/book/transform/"+data.orderId},showTeenageErr:function(){tools.layer({msg:"未成年人需要大人陪同出游"})},showBeyondAgeLimitErr:function(){tools.layer({msg:"因服务能力有限，不接受"+pageDataObj.maxAgeLimit+"周岁以上的旅游者出游报名，敬请谅解"})}})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(14),__webpack_require__(6)],__WEBPACK_AMD_DEFINE_RESULT__=function($,config){var pageDataObj=config.pageDataObj,tksHost=config.tksHost,webDetailHost="/web-detail",ajaxUrlConfig={getDefaultTrain:"/tn?r=order/tourV3Order/GetTourDefaultTrain",getDefaultBus:"/tn?r=order/tourV3Order/GetDefaultBus",getDefaultHotel:"/tn?r=order/tourV3Order/getDefaultHotelRoom",getQueryTrain:"/tn?r=order/TourV3Order/QueryAllTranInfo",getQueryBus:"/tn?r=order/tourV3Order/ChangeBus",getNewQueryBus:tksHost+"/book/getChangeBusRes",getQueryHotel:"/tn?r=order/tourV3Order/GetJourneyAllHotel",getFavourableInfo:"/tn?r=order/TourV3Order/ChangePromotionInfo",sendSaveOrder:"/tn?r=order/TourV3Order/SaveOrder","sendSaveOrder:cruise2":tksHost+"/cruiseShip/SaveOrder",getCommonReceipt:"/tn?r=order/TourV3Order/GetCustAddressInfo",getRoomAddBudget:"/tn?r=order/TourV3Order/ChangeRoomAddBudget",queryReOrder:"/tn?r=order/Comm/ReOrder",addTravelPromotion:"/tn?r=order/Comm/TravelCouponCharge",addPromotionCod:"/tn?r=order/DiyTourOrder/CheckCouponCode",refreshInsurance:"/tn?r=order/TourV3Order/RefreshInsurance",getBindsCardsData:"/tn?r=order/TourV3Order/Membershipsellist",postBindsCardsData:"/tn?r=order/TourV3Order/BindMembcard",getTouristInfo:"/tn?r=order/TourV3Order/GetTourer",checkPaySwitch:"/tn?r=order/TourV3Order/PaySwitch",getCompanyPrivilege:"/tn?r=order/tourV3Order/GetCompanyPrivilege",checkRegisted:"/tn?r=order/Comm/isTuniuUserByTel",getJudgeCrm:"/tn?r=order/TourV3Order/JudgeCrm",getUserInfo:"/tn?r=order/Comm/GetContactsInfo",defaultAirplane:"/tn?r=order/TourV3Order/GetDefaultFlight",checkAirplane:"/tn?r=order/TourV3Order/CheckInternalCabinAndPrice",checkAirplaneInternational:"/tn?r=order/TourV3Order/CheckFlightCabinAndPrice",airplaneListPackage:"/tn?r=order/TourV3Order/PkgFlightRes",airplaneListRecommend:"/tn?r=order/TourV3Order/GroupRes",airplaneListFree:"/tn?r=order/TourV3Order/IndividualFlightRes",sendSaveTourist:"/tn?r=order/TourV3Order/AddTourerPost",getDriveContractUrl:"/tn?r=order/TourV3Order/sign",getAllAddService:"/tn?r=order/TourV3Order/getNormalAddItemResource",getResPrice:"/tn?r=order/TourV3DriveOrder/GetRetailHotelResIdNDetail",boss3NormalDriverSaveSign:"/tn?r=order/TourV3Order/SaveSign",getTransPort:"/tn?r=order/TourV3Order/RefreshTransport",checkName:"/tn?r=order/TourV3Order/CheckName",getMultiTransport:"/tn?r=order/TourV3Order/GetCombinedTransportationsInfo",getEnglishName:"/tn?r=order/TourV3Order/getEnglishName",getAddition:"/tn?r=order/TourV3Order/GetTourV3AdditionalItemResources","getAddition:cruise2":"/tn?r=order/CruiseV3Order/queryAdditionalItemRes",getDefaultTransport:"/tn?r=order/TourV3Order/GetDefaultTransportationsInfo",getAirportTransfer:tksHost+"/book/GetAirportTransfer",placeSearch:tksHost+"/book/PlaceSearch",airportlist:tksHost+"/book/Airportlist",refreshRatePlan:"/tn?r=order/TourV3DriveOrder/GetRetailHotelResIdNDetail",getHotelResId:"/tn?r=order/TourV3DriveOrder/GetRetailHotelResIdNDetail",getFinancePlans:"/tn?r=order/TourV3Order/GetFinancePlans",checkBusLeftNumber:tksHost+"/book/busTicketCheck",getDeliveryAddress:"/tn?r=order/TourV3Order/getDeliveryAddress",saveNewAddress:"/tn?r=order/Comm/SaveUserAddress",setDefaultAddress:"/tn?r=order/Comm/setDefaultAddress",deleteAddress:"/tn?r=order/Comm/deleteUserAddress",updateUserAddress:"/tn?r=order/Comm/updateUserAddress",getCruise:"/tn?r=order/CruiseV3Order/queryCabinTypeRes",checkCruise:"/tn?r=order/CruiseV3Order/checkCabin",defaultAirplaneV2:webDetailHost+"/api/tour/getDefaultFlight",getCruiseVendor:"/tn?r=order/CruiseV3Order/queryVendorPrices",checkCabinAndPrice:webDetailHost+"/api/tour/checkCabinAndPrice"},prevXHR={refreshRatePlan:null,refreshInsurance:null,getFavourableInfo:null};return{request:{},refreshInsurance:function(data){return prevXHR.refreshInsurance&&prevXHR.refreshInsurance.abort(),prevXHR.refreshInsurance=$.ajax({url:ajaxUrlConfig.refreshInsurance,data:data,type:"POST",dataType:"json",timeout:3e5}),prevXHR.refreshInsurance},getDefaultTrain:function(data){return $.ajax({url:ajaxUrlConfig.getDefaultTrain,data:data,type:"POST",dataType:"json",timeout:3e5})},getDefaultBus:function(data){return $.ajax({url:ajaxUrlConfig.getDefaultBus,data:{postData:data},type:"POST",dataType:"json",timeout:3e5})},getDefaultHotel:function(data){return $.ajax({url:ajaxUrlConfig.getDefaultHotel,data:{postData:data},type:"POST",dataType:"json",timeout:3e5})},getQueryTrain:function(data){return $.ajax({url:ajaxUrlConfig.getQueryTrain,data:data,type:"POST",dataType:"json",timeout:3e5})},getQueryBus:function(data){return $.ajax({url:ajaxUrlConfig.getQueryBus,data:data,type:"GET",dataType:"json",timeout:3e5})},getNewQueryBus:function(data){return $.ajax({url:ajaxUrlConfig.getNewQueryBus,data:{postData:data},type:"GET",dataType:"json",timeout:3e5})},checkBusLeftNumber:function(data){return $.ajax({url:ajaxUrlConfig.checkBusLeftNumber,data:{postData:data},type:"POST",dataType:"json",timeout:3e5})},getQueryDisplayTrain:function(data){var self=this,request=this.request.queryDisplayTrain;return self.trigger("loadQueryDisplayTrain:before"),request&&request.abort(),this.request.queryDisplayTrain=$.ajax({url:ajaxUrlConfig.getQueryTrain,data:data,type:"POST",dataType:"json",timeout:3e5,success:function(data){self.request.queryDisplayTrain=null,!_.isNull(data)&&data.success?self.trigger("loadQueryDisplayTrain:success",data.data):self.trigger("loadQueryDisplayTrain:error",data)},error:function(){self.request.queryDisplayTrain=null,self.trigger("loadQueryDisplayTrain:timeout")}}),this},getQueryHotel:function(data,extraRespondData){return $.ajax({url:ajaxUrlConfig.getQueryHotel,data:data,type:"POST",dataType:"json",timeout:3e5})},getFavourableInfo:function(data){return prevXHR.getFavourableInfo&&prevXHR.getFavourableInfo.abort(),prevXHR.getFavourableInfo=$.ajax({url:ajaxUrlConfig.getFavourableInfo,data:data,type:"POST",dataType:"json",timeout:3e5}),prevXHR.getFavourableInfo},sendSaveOrder:function(data){return $.ajax({url:ajaxUrlConfig.sendSaveOrder,data:data,type:"POST",dataType:"json",timeout:3e5,xhrFields:{withCredentials:!0}})},sendSaveOrder2:function(data){return $.ajax({url:ajaxUrlConfig["sendSaveOrder:cruise2"],data:data,type:"POST",dataType:"json",timeout:3e5,xhrFields:{withCredentials:!0}})},sendSaveTourist:function(data){var self=this;self.trigger("beforeSaveTourist"),$.ajax({url:ajaxUrlConfig.sendSaveTourist,data:data,type:"POST",dataType:"json",timeout:3e5,success:function(res){res&&res.success?self.trigger("saveTouristSuccess",res):self.trigger("saveTouristError",res)},error:function(){self.trigger("saveTouristTimeOut")}})},getCommonReceiptInfo:function(){return $.ajax({url:ajaxUrlConfig.getCommonReceipt,data:{},type:"POST",dataType:"json",timeout:3e5})},checkRegisted:function(data){return data.uid=Math.random(),$.ajax({url:ajaxUrlConfig.checkRegisted,type:"post",data:data,dataType:"text"})},getJudgeCrm:function(data){return data.uid=Math.random(),$.ajax({url:ajaxUrlConfig.getJudgeCrm,type:"get",data:data,dataType:"json"})},login:function(username,password,validCode,callback){var url="/main.php?do=order_login_ajax&flag=login&t="+Math.random(),param={username:username,password:password,identify:validCode,needReturn:1};$.ajax({url:url,data:param,type:"post",dataType:"json",success:function(data){callback(data)},error:function(){callback()}})},getUserInfo:function(){return $.get(ajaxUrlConfig.getUserInfo,function(data){},"json")},checkTravleCoupon:function(param){return $.ajax({url:"/tn?r=order/Comm/CheckCoupon",data:param,type:"post",dataType:"json"})},getRoomAddBudget:function(requestData){return $.ajax({url:ajaxUrlConfig.getRoomAddBudget,data:requestData,type:"POST",dataType:"json",timeout:3e5})},queryReOrder:function(requestData){return $.ajax({url:ajaxUrlConfig.queryReOrder,data:requestData,type:"POST",dataType:"json",timeout:3e4})},addTravelPromotion:function(id,pwd){return $.ajax({url:ajaxUrlConfig.addTravelPromotion,type:"post",dataType:"json",data:{postData:{couponId:id,couponPwd:pwd}}})},addPromotionCodeService:function(code){return $.ajax({url:ajaxUrlConfig.addPromotionCod,type:"post",dataType:"json",data:{couponCodeId:code}})},getBindsCardsData:function(){return $.ajax({url:ajaxUrlConfig.getBindsCardsData,type:"post",dataType:"json"})},postBindsCardsData:function(data){return $.ajax({url:ajaxUrlConfig.postBindsCardsData,type:"post",dataType:"json",data:data})},getTouristInfo:function(data){return $.ajax({url:ajaxUrlConfig.getTouristInfo,type:"get",dataType:"json",data:data})},checkPaySwitch:function(data){return $.ajax({url:ajaxUrlConfig.checkPaySwitch,type:"get",dataType:"json",data:data})},getAddService:function(data){var self=this;$.ajax({url:ajaxUrlConfig.getAllAddService,type:"get",dataType:"json",data:{postData:data},success:function(res){res&&res.success?self.trigger("getAddServiceSuccess",res.data):self.trigger("getAddServiceError")},error:function(){self.trigger("getAddServiceError")}})},getDriveContract:function(data){return $.ajax({url:ajaxUrlConfig.getDriveContractUrl,type:"post",dataType:"json",data:data,xhrFields:{withCredentials:!0}})},saveSign:function(data){return $.ajax({url:ajaxUrlConfig.boss3NormalDriverSaveSign,type:"post",dataType:"json",data:data})},fetchHotelDetailById:function(data,index){var self=this;$.ajax({url:ajaxUrlConfig.getResPrice,type:"get",dataType:"json",data:data,success:function(res){res&&res.success?(res.data.hotelIndex=index,res.data.resId=data.resId,self.trigger("fetchHotelDetailSuccess",res.data)):self.trigger("fetchHotelDetailError",res.msg)},error:function(){self.trigger("fetchHotelDetailError")}})},getTransPort:function(data){return $.ajax({url:ajaxUrlConfig.getTransPort,type:"get",dataType:"json",data:data})},checkAjaxName:function(nameData){return $.ajax({url:ajaxUrlConfig.checkName,type:"POST",dataType:"json",data:{nameData:nameData},async:!1})},getCompanyPrivilege:function(data){return $.ajax({url:ajaxUrlConfig.getCompanyPrivilege,type:"POST",dataType:"json",data:data})},defaultAirplane:function(data,options){var tempData=$.extend(!0,{},data),isRefresh=options.isRefresh,promise=null;if(isRefresh&&(tempData.refreshFileCache=1),options.isV2){var requestData={productId:data.productId,adultNum:data.adultNum,childNum:data.childNum,freeChildNum:data.freeChildNum,departDate:data.departDate,bookCityCode:data.bookCityFromDetail,departCityCode:data.departCityCode,backCityCode:data.backCity,configWindowNum:0};promise=$.ajax({url:ajaxUrlConfig.defaultAirplaneV2,data:tempData,type:"GET",dataType:"json",data:requestData})}else promise=$.ajax({url:ajaxUrlConfig.defaultAirplane,data:tempData,type:"POST",dataType:"json",timeout:6e4,crossDomain:!0});return promise},checkAirplane:function(data,options){var url="";if(options.isV2)return prevXHR.checkCabinAndPrice&&prevXHR.checkCabinAndPrice.abort(),delete data.journeyId,prevXHR.checkCabinAndPrice=$.ajax({url:ajaxUrlConfig.checkCabinAndPrice,data:data,type:"GET",dataType:"json",timeout:4e4}),prevXHR.checkCabinAndPrice;url=options.isInternationalFlag?ajaxUrlConfig.checkAirplaneInternational:ajaxUrlConfig.checkAirplane;var promise=$.ajax({url:url,type:"post",dataType:"json",data:{postData:data}});return promise},airplaneListPackage:function(data){var promise=$.ajax({url:ajaxUrlConfig.airplaneListPackage,type:"POST",dataType:"json",data:data});return promise},airplaneListRecommend:function(data){var promise=$.ajax({url:ajaxUrlConfig.airplaneListRecommend,type:"POST",dataType:"json",data:data});return promise},airplaneListFree:function(data){var promise=$.ajax({url:ajaxUrlConfig.airplaneListFree,type:"POST",dataType:"json",data:data});return promise},getMultiTransport:function(data){var promise=$.ajax({url:ajaxUrlConfig.getMultiTransport,type:"POST",dataType:"json",data:{postData:data}});return promise},getAddition:function(data){if("cruise2"==pageDataObj.pageType)var requestData={productId:data.productId,cruiseVendorId:data.cruiseVendorId,departDate:data.departDate,departCityCode:data.departCityCode||data.departCity},promise=$.ajax({url:ajaxUrlConfig["getAddition:cruise2"],type:"GET",dataType:"json",data:requestData});else var promise=$.ajax({url:ajaxUrlConfig.getAddition,type:"POST",dataType:"json",data:{postData:data}});return promise},getEnglishName:function(nameData){return $.ajax({
url:ajaxUrlConfig.getEnglishName,type:"POST",dataType:"json",data:nameData})},getDefaultTransport:function(data){var promise=$.ajax({url:ajaxUrlConfig.getDefaultTransport,type:"POST",dataType:"json",data:{postData:data}});return promise},getAirportTransfer:function(data){var promise=$.ajax({url:ajaxUrlConfig.getAirportTransfer,type:"POST",dataType:"json",data:{postData:data}});return promise},placeSearch:function(data){var promise=$.ajax({url:ajaxUrlConfig.placeSearch,type:"POST",dataType:"json",data:{postData:data}});return promise},getAirportlist:function(data){var promise=$.ajax({url:ajaxUrlConfig.airportlist,type:"POST",dataType:"json",data:{postData:data}});return promise},refreshRatePlan:function(data){return prevXHR.refreshRatePlan&&prevXHR.refreshRatePlan.abort(),prevXHR.refreshRatePlan=$.ajax({type:"GET",url:ajaxUrlConfig.refreshRatePlan,data:data,dataType:"json"})},getHotelResId:function(data){return $.ajax({type:"GET",url:ajaxUrlConfig.refreshRatePlan,data:data,dataType:"json"})},getFinancePlans:function(data){return $.ajax({type:"GET",url:ajaxUrlConfig.getFinancePlans,data:data,dataType:"json"})},getDeliveryAddress:function(){return $.ajax({type:"GET",url:ajaxUrlConfig.getDeliveryAddress,data:{},dataType:"json"})},saveNewAddress:function(data){return $.ajax({type:"GET",url:ajaxUrlConfig.saveNewAddress,data:data,dataType:"json"})},setDefaultAddress:function(data){return $.ajax({type:"GET",url:ajaxUrlConfig.setDefaultAddress,data:data,dataType:"json"})},deleteAddress:function(data){return $.ajax({type:"GET",url:ajaxUrlConfig.deleteAddress,data:data,dataType:"json"})},updateUserAddress:function(data){return $.ajax({type:"GET",url:ajaxUrlConfig.updateUserAddress,data:data,dataType:"json"})},checkJiBaoPrice:function(data){return $.ajax({url:ajaxUrlConfig.getResPrice,type:"get",dataType:"json",data:data})},getCruiseVendor:function(data){prevXHR.getCruiseVendor&&prevXHR.getCruiseVendor.abort();var requestData={productId:data.productId,departDate:data.departDate,departCityCode:data.departCityCode||data.departCity};return prevXHR.getCruiseVendor=$.ajax({url:ajaxUrlConfig.getCruiseVendor,data:requestData,type:"GET",dataType:"json",timeout:3e5,xhrFields:{withCredentials:!0}}),prevXHR.getCruiseVendor},getCruise:function(data){var requestData={productId:data.productId,cruiseVendorId:data.cruiseVendorId,departDate:data.departDate,departCityCode:data.departCityCode||data.departCity};return $.ajax({url:ajaxUrlConfig.getCruise,data:requestData,type:"GET",dataType:"json",timeout:6e5,xhrFields:{withCredentials:!0}})},checkCruise:function(data){return $.ajax({url:ajaxUrlConfig.checkCruise,data:data,type:"POST",dataType:"json",timeout:3e5,xhrFields:{withCredentials:!0}})}}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(8),__webpack_require__(9),__webpack_require__(14),__webpack_require__(17),__webpack_require__(6),__webpack_require__(16)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,Backbone,$,Layer,config,tools){var pageDataObj=config.pageDataObj;return Backbone.View.extend({checkOrderData:function(orderData){return!(!orderData.departCityName||!orderData.departDate||null==orderData.departCity||parseInt(orderData.adultNum)<1&&11!=pageDataObj.tagType||parseInt(orderData.childNum)<0)||(this.showError(orderData),!1)},showError:function(orderData){var url="/tours/"+orderData.productId;orderData.fromUrl&&(url=orderData.fromUrl),tools.layer({msg:"出发城市（或出发日期等）出错，请返回产品页重新选择！",yes:function(){window.location.href=url},close:function(){window.location.href=url}})}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(14),__webpack_require__(9),__webpack_require__(6),__webpack_require__(16)],__WEBPACK_AMD_DEFINE_RESULT__=function($,Backbone,config,tools){var pageDataObj=config.pageDataObj;return Backbone.Model.extend({showAnimateTime:200,initialize:function(){this.render(),this.bindEvents()},bindEvents:function(){var self=this;$(document).on("mouseenter","#channelPageSuspended li",function(e){self.mouseEnterHandler($(e.currentTarget))}),$(document).on("mouseleave","#channelPageSuspended li",function(e){self.mouseLeaveHandler($(e.currentTarget))}),$(document).on("click","#channelPageSuspended li",function(e){self.clickHandler($(e.currentTarget))})},render:function(){var windowWidth=$(window).width(),rightOffset=(windowWidth>1280?30:0)+"px",bottomOffset="160px",suspendedHtml='<div id="channelPageSuspended" style="z-index:9999;cursor: pointer;position:fixed;bottom:'+bottomOffset+";right: "+rightOffset+';width:40px;text-align: center;line-height: 40px;font-size: 14px;color: #f80;font-family: \'Microsoft YaHei\'"><ul><li style="height:40px;display:block;-moz-box-shadow:0px 0px 2px #CCCCCC;-webkit-box-shadow:0px 0px 2px #CCCCCC;box-shadow:0px 0px 2px #CCCCCC;background: url(\'http://img3.tuniucdn.com/site/images/kefu/icon-headset.png\') 0 0 no-repeat;"><p style="height: 40px;width: 76px;border-left: 4px solid #f80;position:absolute;left:-40px;background-color: #fff;display: none;">在线客服</p></li><li style="display:none;height:40px;-moz-box-shadow:0px 0px 2px #CCCCCC;-webkit-box-shadow:0px 0px 2px #CCCCCC;box-shadow:0px 0px 2px #CCCCCC;background: url(\'http://img3.tuniucdn.com/site/images/kefu/icon-barcode.png\') 0 0 no-repeat;"><div style="display:none;background:url(\'http://img3.tuniucdn.com/site/images/kefu/barcode.png\') 0 0 no-repeat;position: absolute;width: 150px;height: 150px;left: -160px;"><div style="position:absolute;top:15px;right:-5px;width:0;height:0;border-top:5px solid transparent;border-bottom:5px solid transparent;border-left:5px solid white; "></div></div></li><li style="height:40px;display:block;-moz-box-shadow:0px 0px 2px #CCCCCC;-webkit-box-shadow:0px 0px 2px #CCCCCC;box-shadow:0px 0px 2px #CCCCCC;background: url(\'http://img3.tuniucdn.com/site/images/kefu/icon-goup.png\') 0 0 no-repeat;"><p style="height: 40px;width: 76px;border-left: 4px solid #f80;position:absolute;left:-40px;background-color: #fff;display:none;">返回顶部</p></li><ul></div>';$("body").append(suspendedHtml)},clickHandler:function($target){var index=$target.index();if(0===index){"undefined"!=typeof window._gaq&&window._gaq.push(["_trackEvent","在线客服按钮_1","",""]);var supportProductType=[1,2,3,8];if(supportProductType.indexOf(pageDataObj.productType)==-1&&(pageDataObj.productType=1),window.TNCHAT_isShowChatEntry){var postData;"order_detail"==pageDataObj.pageType?(postData={entryTemplateId:7,orderId:pageDataObj.baseInfo.orderId},tools.safeEventTrack("点击_在线客服____在线客服")):postData={entryTemplateId:22,productId:pageDataObj.productId,productType:pageDataObj.productType||1},window.TNCHAT_isShowChatEntry(postData,function(data){data.status&&window.open(decodeURIComponent(data.url),"在线客服","width=640, height=515, top=100, left=500, toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")})}else{var entranceUrl=location.pathname,livechatUrl=encodeURI("http://dynamic.m.tuniu.com/livechat?entranceUrl="+entranceUrl);window.open(livechatUrl,"在线客服","width=640, height=515, top=100, left=500, toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")}}else 2===index&&$("body,html").animate({scrollTop:"0px"},this.showAnimateTime)},mouseEnterHandler:function($target){var handlers=[function(target){target.css({background:"url('http://img3.tuniucdn.com/site/images/kefu/icon-headset-on.png') 0 0 no-repeat"}),target.find("p").stop().animate({left:-80,opacity:"show"},200)},function(target){target.css({background:"url('http://img3.tuniucdn.com/site/images/kefu/icon-barcode-on.png') 0 0 no-repeat"}),target.find("div").stop().show(this.showAnimateTime)},function(target){target.css({background:"url('http://img3.tuniucdn.com/site/images/kefu/icon-goup-on.png') 0 0 no-repeat"}),target.find("p").stop().animate({left:-80,opacity:"show"},this.showAnimateTime)}];handlers[$target.index()]($target)},mouseLeaveHandler:function($target){var handlers=[function(target){target.css({background:"url('http://img3.tuniucdn.com/site/images/kefu/icon-headset.png') 0 0 no-repeat"}),target.find("p").stop().animate({left:-40,opacity:"hide"},100)},function(target){target.css({background:"url('http://img3.tuniucdn.com/site/images/kefu/icon-barcode.png') 0 0 no-repeat"}),target.find("div").stop().hide(100)},function(target){target.css({background:"url('http://img3.tuniucdn.com/site/images/kefu/icon-goup.png') 0 0 no-repeat"}),target.find("p").stop().animate({left:-40,opacity:"hide"},100)}];handlers[$target.index()]($target)}})}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(module,exports,__webpack_require__){var $=__webpack_require__(14),dataObj=(__webpack_require__(8),{}),init=!0,idIndex=1;module.exports={supportAnimation:function(){var div=document.createElement("div");return void 0!==div.style.animationName||void 0!==div.style.webkitAnimationName},watchScroll:function(options){function compare(el){var $el=$(el);if(supportAnimation){var id=$el.data("moduleSlideId");id||(id="T_slide_"+idIndex,idIndex++,$el.data("moduleSlideId",id));var ofObj=el.getBoundingClientRect(),prevTop=dataObj[id]&&dataObj[id].top,prevBottom=dataObj[id]&&dataObj[id].bottom;prevTop||prevBottom||(prevTop=wH,prevBottom=wH);var top=ofObj.top,bottom=ofObj.bottom;top||bottom||(top=wH,bottom=wH),dataObj[id]={top:top,bottom:bottom};var slideInDown=prevTop>=wH&&top<wH,inSight=bottom>0&&top<wH,inSightTop=bottom<=0,inSightBottom=top>=wH;slideInDown&&($el.addClass("slide-in-down"),$el.one("animationend webkitAnimationEnd",function(){$el.css("opacity",1).removeClass("slide-in-down")})),inSight?init&&($el.addClass("slide-in-down"),$el.one("animationend webkitAnimationEnd",function(){$el.css("opacity",1).removeClass("slide-in-down")})):inSightTop?$el.css("opacity",1):inSightBottom&&$el.css("opacity",0)}else $el.css("opacity",1)}var self=this,moduleClass=options.moduleClass||"container",supportAnimation=this.supportAnimation(),$win=$(window),wH=$win.height(),$obj=$("."+moduleClass);$obj.each(function(index,item){compare(item)}),init=null,setTimeout(function(){self.watchScroll(options)},200)},watchFooter:function(){setInterval(function(e){var $body=$("body"),body=$body[0],bodyH=body.offsetHeight,windowH=$(window).height(),scrollH=$(document).height(),scrollT=$(window).scrollTop(),$footer=$(".footer"),footerHeight=$footer.innerHeight(),margin=parseInt($footer.css("marginBottom")),delta=footerHeight+margin,isFixed="fixed"==$footer.css("position");bodyH+(isFixed?delta:0)<=windowH?$body.removeClass("footer-fixed").addClass("footer-static"):($body.removeClass("footer-static"),windowH+scrollT>=scrollH?$body.hasClass("footer-fixed")||($body.addClass("footer-fixed"),scrollH=body.scrollHeight,body.scrollTop=scrollH-windowH,$footer.addClass("slide-in-down-no-opacity"),$footer.one("animationend webkitAnimationEnd",function(){$footer.removeClass("slide-in-down-no-opacity")})):$body.removeClass("footer-fixed"))},200)}}},function(module,exports,__webpack_require__){__webpack_require__(24);module.exports={init:function(){this.bindEvents()},bindEvents:function(){$(document).on("click",".detail-wrapper",function(e){var id=(new Date).getTime(),el=$(this).find(".resources-detail");el.data("showMoreId",id),$(".resources-detail").each(function(index,item){$(item).data("showMoreId")!=id&&$(item).hide()}),el.is(":hidden")&&el.find(".resources").tScroll({delta:15,fixedScrollObjHeight:!1}),el.toggle(),e.stopPropagation()}),$(document).on("click",".resources-detail .close-icon",function(e){$(this).parents(".resources-detail").hide()}),$(document).on("click",".resources-detail",function(e){e.stopPropagation()}),$(document).on("click",function(e){$(".resources-detail").hide()})}}},function(module,exports,__webpack_require__){var config=__webpack_require__(6),pageDataObj=config.pageDataObj,constant=__webpack_require__(11),compositionEventName=constant.COMPOSITION_EVENT_NAME,compositionEvent={init:function(){pageDataObj[compositionEventName]=!0,this.bindEvents()},bindEvents:function(){$(document).on("compositionstart",function(){pageDataObj[compositionEventName]=!1}),$(document).on("compositionend",function(){pageDataObj[compositionEventName]=!0})}};compositionEvent.init(),module.exports=compositionEvent},function(module,exports,__webpack_require__){function prepare(data,callback){cacheData=data,window[config.getterName]=function(){return cacheData},window[config.okCallbackName]=function(data){data=JSON.parse(JSON.stringify(data)),callback(data),close()},window[config.cancelCallbackName]=function(){close()}}function destroy(){cacheData=null,["getterName","okCallbackName","cancelCallbackName"].forEach(function(key){window[config[key]]=null;try{delete window[config[key]]}catch(e){}})}function getWidth(){var winWidth=$(window).width();return.8*winWidth<1e3?"80%":"1000px"}function open(options){dialogId=layer.open({type:2,title:[options.title,"font-weight:bold;font-size:16px;"],shadeClose:!0,shade:.8,move:!1,area:options.area||[getWidth(),"95%"],content:[options.url],end:destroy})}function close(){layer.close(dialogId),dialogId=null}var layer=__webpack_require__(18),config=__webpack_require__(156),cacheData=null,dialogId=null,dialog={open:function(options){options&&(prepare(options.data,options.callback),open({title:options.title,url:options.url,area:options.area}))},close:function(){close()}};module.exports=dialog},function(module,exports){var config={dataKey:"",getterName:"__getDialogData__",okCallbackName:"__dialogOkCallback__",cancelCallbackName:"__dialogCancelCallback__"};module.exports=config},function(module,exports){module.exports=function(config){return function(){var newEvent;newEvent=this.event+":"+config.pageDataObj.pageType,"function"==typeof this.allEvents[newEvent]&&(this.event=newEvent),this.next()}}}]);
//# sourceMappingURL=entry_bundle.js.map?v=2637dd246e063da4f4ba