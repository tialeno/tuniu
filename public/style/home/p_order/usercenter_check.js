var usercenter_check={check_email:function(){var email=$("#email").val();email=email.replace(/(^\s*)|(\s*$)/g,'');if(email==''){$('#email-tip').removeClass('ok');$('#email-tip').addClass('err');$('#email-tip .input-tip-inner').html('<span>您的邮箱为空</span>');$('#email-tip .input-tip-inner').show();$('#sub_email').attr('value',0);return false;}
if(new RegExp("^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$").test(email)==false||''==email){$('#email-tip').removeClass('ok');$('#email-tip').addClass('err');$('#email-tip .input-tip-inner').html('<span>您输入的邮箱格式不对，格式如：XXXX@XXXX.com</span>');$('#email-tip .input-tip-inner').show();$('#sub_email').attr('value',0);return false;}
var url="/u/register/checkEmail";$.ajax({url:url,data:{email:email},type:'post',success:function(data){if(data=='2'){$('#email-tip').removeClass('ok');$('#email-tip').addClass('err');$('#email-tip .input-tip-inner').html('<span>该邮箱已注册</span>');$('#email-tip .input-tip-inner').show();document.getElementById('sub_email').value=0;return false;}else{$('#email-tip').removeClass('err');$('#email-tip').addClass('ok');$('#email-tip .input-tip-inner').html('<span></span>');$('#sub_email').attr('value',1);return true;}}});},check_email2:function(){var email=$("#email").val();email=email.replace(/(^\s*)|(\s*$)/g,'');if(email!=''){if(new RegExp("^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$").test(email)==false||''==email){$('#email-tip2').removeClass('ok');$('#email-tip2').addClass('err');$('#email-tip2 .input-tip-inner').html('<span>您输入的邮箱格式不对，格式如：XXXX@XXXX.com</span>');$('#email-tip2 .input-tip-inner').show();$('#sub_email').attr('value',0);return false;}
var url="/u/register/checkEmail";$.ajax({url:url,data:{email:email},type:'post',success:function(data){if(data=='2'){$('#email-tip2').removeClass('ok');$('#email-tip2').addClass('err');$('#email-tip2 .input-tip-inner').html('<span>该邮箱已注册</span>');$('#email-tip2 .input-tip-inner').show();document.getElementById('sub_email').value=0;return false;}else{$('#email-tip2').removeClass('err');$('#email-tip2').addClass('ok');$('#email-tip2 .input-tip-inner').html('<span></span>');document.getElementById('sub_email').value=1;return true;}}});}},hide_note:function(data){if(data=='tel-tip'){$('#tel-tip').removeClass('ok');$('#tel-tip').removeClass('err');$('#tel-tip .input-tip-inner span').addClass('reg_mes mes_phone');$('#tel-tip .input-tip-inner span').html('');$('#tel-tip .input-tip-inner').show();}else if(data=='user-tip'){$('#user-tip').removeClass('ok');$('#user-tip').removeClass('err');$('#user-tip .input-tip-inner').html('<span>5-20个英文字母、数字或下划线,必须为英文字母开头</span>');$('#user-tip .input-tip-inner').show();}else if(data=='nick-tip'){$('#nick-tip').removeClass('ok');$('#nick-tip').removeClass('err');$('#nick-tip .input-tip-inner').html('<span>必须为中文或英文，4位以上字符</span>');$('#nick-tip .input-tip-inner').show();}else if(data=='identify-tip'){$('#identify-tip').removeClass('ok');$('#identify-tip').removeClass('err');$('#identify-tip .input-tip-inner').html('<span>请输入验证码</span>');$('#identify-tip .input-tip-inner').show();}else if(data=='email-tip'){$('#email-tip').removeClass('ok');$('#email-tip').removeClass('err');$('#email-tip .input-tip-inner span').addClass('reg_mes mes_email');$('#email-tip .input-tip-inner span').html('');$('#email-tip .input-tip-inner').show();}else if(data=='password-tip'){$('#password-tip').removeClass('ok');$('#password-tip').removeClass('err');$('#password-tip .input-tip-inner span').addClass('reg_mes mes_pass');$('#password-tip .input-tip-inner span').html('');$('#password-tip .input-tip-inner').show();}else if(data=='email-tip2'){$('#email-tip2').removeClass('ok');$('#email-tip2').removeClass('err');$('#email-tip2 .input-tip-inner').html('<span>可选，输入您常用的邮箱，方便登录和找回密码</span>');$('#email-tip2 .input-tip-inner').show();}else if(data=='email-tel-tip'){$('#email-tel-tip').removeClass('ok');$('#email-tel-tip').removeClass('err');$('#email-tel-tip .input-tip-inner span').addClass('reg_mes mes_success_email');$('#email-tel-tip .input-tip-inner span').html('');$('#email-tel-tip .input-tip-inner').show();}},check_passwordagain:function(){var password=$("#password").val();password=password.replace(/(^\s*)|(\s*$)/g,'');var passwordagain=$("#passwordagain").val();passwordagain=passwordagain.replace(/(^\s*)/g,"");if(passwordagain==''){$('#passwordagain-tip').removeClass('ok');$('#passwordagain-tip').addClass('err');$('#passwordagain-tip .input-tip-inner').html('<span>确认密码不能为空</span>');$('#passwordagain-tip .input-tip-inner').show();if(password==''){$('#password-tip').removeClass('ok');$('#password-tip').addClass('err');$('#password-tip .input-tip-inner').html('<span>请输入密码</span>');$('#password-tip .input-tip-inner').show();}
return false;}
if(password!=''){if(passwordagain!=password){$('#passwordagain-tip').removeClass('ok');$('#passwordagain-tip').addClass('err');$('#passwordagain-tip .input-tip-inner').html('<span>两次密码输入不一致，请重新输入</span>');$('#passwordagain-tip .input-tip-inner').show();return false;}}
$('#passwordagain-tip').addClass('ok');$('#passwordagain-tip').removeClass('err');$('#passwordagain-tip .input-tip-inner').html('<span></span>');return true;},change_indenty_img:function(){var rd=Math.random();$('#identify_img').attr('src','/u/register/authCode?cache='+rd);},indentify_img_onload:function(){$('#img_loading').hide();$('#identify_img').show();$('#identify_code').val('');},check_icode:function(){var identify=$("#identify_code").val();identify=identify.replace(/(^\s*)|(\s*$)/g,'');if(identify==""){$('#identify-tip').removeClass('ok');$('#identify-tip').addClass('err');$('#identify-tip .input-tip-inner').html('<span>请输入验证码</span>');$('#identify-tip .input-tip-inner').show();document.getElementById('sub_identify').value=0;return false;}
var url='/u/register/checkAuthCode';$.ajax({type:"POST",url:url,data:{'num':101,'identify_code':identify},success:function(data){if(data=='验证码错误'){usercenter_check.change_indenty_img();$('#identify-tip').removeClass('ok');$('#identify-tip').addClass('err');$('#identify-tip .input-tip-inner').html('<span>验证码错误</span>');$('#identify-tip .input-tip-inner').show();document.getElementById('sub_identify').value=0;return false;}else if(data.indexOf('发送失败')!=-1){$('#identify-tip').removeClass('ok');$('#identify-tip').addClass('err');$('#identify-tip .input-tip-inner').html('<span>发送失败</span>');$('#identify-tip .input-tip-inner').show();document.getElementById('sub_identify').value=0;return false;}else{$('#identify-tip').removeClass('err');$('#identify-tip').addClass('ok');$('#identify-tip .input-tip-inner').html('<span></span>');document.getElementById('sub_identify').value=1;return true;}}});},onload_change_indenty_img:function(){rd=Math.random();$('#identify_img').hide();$('#identify_img').attr('src','/u/register/authCode?cache='+rd);},focus_passwordagain:function(){$('#passwordagain-tip').removeClass('err');$('#passwordagain-tip').removeClass('ok');$("#passwordagain-tip .input-tip-inner span").html("请再次输入密码");},check_tel:function(){var tel=$("#tel").val();tel=tel.replace(/(^\s*)|(\s*$)/g,'');if(tel==''){$('#tel-tip').removeClass('ok');$('#tel-tip').addClass('err');$('#tel-tip .input-tip-inner').html('<span>请输入手机号</span>');$('#tel-tip .input-tip-inner').show();document.getElementById('sub_tel').value=0;return false;}
if(new RegExp("^((13[0-9])|(15[0-35-9])|(18[0-9])|147)[0-9]{8,8}$").test(tel)==false){$('#tel-tip').removeClass('ok');$('#tel-tip').addClass('err');$('#tel-tip .input-tip-inner').html('<span>请输入正确的手机号</span>');$('#tel-tip .input-tip-inner').show();document.getElementById('sub_tel').value=0;return false;}
var url="/u/register/checkUserTel";$.ajax({url:url,data:{tel:tel},type:'post',success:function(result){result=result.replace(/^\s+|\s+$/g,"");if(result=='2'){$("#tel-tip .input-tip-inner").html('<span>您输入的手机已存在，请<a style="color:#f90;" href="http://www.tuniu.com/u/login" target="_blank">直接登录</a>或输入新的手机注册。<br><a class="cgreen vlink" style="margin-left:0px" href="javascript:void(0);" onclick="usercenter_check.phone_back_form();">您没有使用此手机注册过？</a></span>');$('#tel-tip').addClass('err');$('#tel-tip .input-tip-inner').show();document.getElementById('sub_tel').value=0;return false;}else{$('#tel-tip').addClass('ok');$('#tel-tip').removeClass('err');$('#tel-tip .input-tip-inner').html('<span></span>');document.getElementById('sub_tel').value=1;return true;}}});},check_tel2:function(){var tel=$("#tel").val();tel=tel.replace(/(^\s*)|(\s*$)/g,'');if(tel!=''){if(new RegExp("^((13[0-9])|(15[0-35-9])|(18[0-9])|147)[0-9]{8,8}$").test(tel)==false){$('#email-tel-tip').removeClass('ok');$('#email-tel-tip').addClass('err');$('#email-tel-tip .input-tip-inner').html('<span>请输入正确的手机号</span>');$('#email-tel-tip .input-tip-inner').show();document.getElementById('sub_tel').value=0;return false;}
var url="/u/register/checkUserTel";$.ajax({url:url,data:{tel:tel},type:'post',success:function(result){result=result.replace(/^\s+|\s+$/g,"");if(result=='2'){$("#email-tel-tip .input-tip-inner").html('<span>您输入的手机已存在</span>');$('#email-tel-tip').addClass('err');$('#email-tel-tip .input-tip-inner').show();document.getElementById('sub_tel').value=0;return false;}else{$('#email-tel-tip').addClass('ok');$('#email-tel-tip').removeClass('err');$('#email-tel-tip .input-tip-inner').html('<span></span>');document.getElementById('sub_tel').value=1;return true;}}});}},goto_phoneback:function(){$("#registerFrm").submit();},check_code:function(){type=$("#type").val();$("#codeTip").html('');inputCode=$("#code").val();var tel=$(".num").html();var type=$("#type").val();var url="/u/register/checkTelAuthCode";inputCode=inputCode.replace(/(^\s*)|(\s*$)/g,'');if(inputCode==""){$("#codeTip").html('请填写验证码');return;}
var inputData={"tel":tel,"type":type,"inputCode":inputCode};$("#codeTip").html('信息正在提交中...');$.post(url,inputData,function(data){$("#input_do_check_code").attr("disabled",true);$("#codeTip").html(data);if(data=="1"){$("#codeTip").html("验证码输入正确");if(type=="register"){$("#registerFrm").attr("action","/u/register/phoneStepThree");$("#registerFrm").submit();}else{$("#registerFrm").submit();}}});},check_username:function(){var username=$("#username").val();username=username.replace(/(^\s*)|(\s*$)/g,'');if(username==''){$('#user-tip').removeClass('ok');$('#user-tip').addClass('err');$('#user-tip .input-tip-inner').html('<span>请输入昵称</span>');$('#user-tip .input-tip-inner').show();document.getElementById('sub_username').value=0;return false;}
if(username.length>20||username.length<5){$('#user-tip').removeClass('ok');$('#user-tip').addClass('err');$('#user-tip .input-tip-inner').html('<span>请输入5-20位字符</span>');$('#user-tip .input-tip-inner').show();document.getElementById('sub_username').value=0;return false;}
if(new RegExp("^[a-zA-Z]{1}[a-zA-Z0-9_]{4,19}$").test(username)==false){$('#user-tip').removeClass('ok');$('#user-tip').addClass('err');$('#user-tip .input-tip-inner').html('<span>昵称格式错误</span>');$('#user-tip .input-tip-inner').show();document.getElementById('sub_username').value=0;return false;}
var url="/u/register/checkNickName";$.ajax({url:url,type:'post',data:{'nickname':username},async:false,success:function(result){result=result.replace(/^\s+|\s+$/g,"");if(result=='2'){$('#user-tip').removeClass('ok');$('#user-tip').addClass('err');$('#user-tip .input-tip-inner').html('<span>该昵称已经存在</span>');$('#user-tip .input-tip-inner').show();document.getElementById('sub_username').value=0;return false;}else{$('#user-tip').removeClass('err');$('#user-tip').addClass('ok');$('#user-tip .input-tip-inner').html('<span></span>');document.getElementById('sub_username').value=1;return true;}}});},phone_info_submit:function(){var pwda_flag=usercenter_check.check_passwordagain();usercenter_check.check_tel();usercenter_check.check_icode();var tel_flag=$("#sub_tel").val();if(tel_flag==0){tel_flag=false;}else{tel_flag=true;}
var icode_flag=$("#sub_identify").val();if(icode_flag==0){icode_flag=false;}else{icode_flag=true;}
if($("#agreement").attr("checked")==true){$("#agree-tip .input-tip-inner").html("");var agree_flag=true;}else{$("#agree-tip .input-tip-inner").html("请阅读途牛会员协议");var agree_flag=false;}
if(pwda_flag&&tel_flag&&icode_flag&&agree_flag){$("#hid_tel").attr("value",$("#tel").val());$("#hid_pwd").attr("value",$("#password").val());if(agree_flag){$("#hid_agree").val('1');}else{$("#hid_agree").val('0');}
if($("#travel-info").attr("checked")==false){$("#hid_info").val('0');}else{$("#hid_info").val('1');}
$('#registerFrm').submit();$('#info_submit').attr("disabled",true);}},email_info_submit:function(){var pwda_flag=usercenter_check.check_passwordagain();usercenter_check.check_email();usercenter_check.check_icode();var email_flag=$("#sub_email").val();if(email_flag==0){email_flag=false;}else{email_flag=true;}
var icode_flag=$("#sub_identify").val();if(icode_flag==0){icode_flag=false;}else{icode_flag=true;}
if($("#agreement").attr("checked")==true){$("#agree-tip .input-tip-inner").html("");var agree_flag=true;}else{$("#agree-tip .input-tip-inner").html("请阅读途牛会员协议");var agree_flag=false;}
if(pwda_flag&&email_flag&&icode_flag&&agree_flag){$("#hid_email").attr("value",$("#email").val());$("#hid_pwd").attr("value",$("#password").val());if(agree_flag){$("#hid_agree").val('1');}else{$("#hid_agree").val('0');}
if($("#travel-info").attr("checked")==false){$("#hid_info").val('0');}else{$("#hid_info").val('1');}
$('#registerFrm').submit();$('#info_submit').attr("disabled",true);}},check_phone_three_info:function(){$("#nick_name_tip").hide();password=$("#hid_pwd").val();custId=$("#cust_id").val();var username=$("#username").val();username=username.replace(/^\s+|\s+$/g,"");var email=$("#email").val();email=email.replace(/^\s+|\s+$/g,"");if((username==null&&email==null)||(username.length<1&&email.length<1)){$("#user-tip").removeClass("err");$("#user-tip .input-tip-inner").html('<span>5-20个英文字母、数字或下划线,必须为英文字母开头</span>');return;}
usercenter_check.check_username();nameFlag=$("#sub_username").val();if(email!=''){usercenter_check.check_email2();}
emailFlag=$("#sub_email").val();if(nameFlag==1){nameFlag=true;checkFlag=true;}else{nameFlag=false;checkFlag=false;}
if(email!=''){if(emailFlag==1){checkFlag=true;}else{checkFlag=false;}}
if(checkFlag==true){url="/u/register/addUserInfo";var inputData={"username":username,"email":email,"custId":custId,"password":password};$.post(url,inputData,function(data){response=eval("("+data+")");if(response.success){$("#nick_name_tip").css("display","inline");$(".user_name a").html(response.nickname);if(response.email==''){$(".check_email_web").hide();}else{$(".check_email_web").show();$("#email_info").html("一封确认邮件已经发送您的邮箱"+response.email+"<br/>"+"点击确认链接即可登录，快去查收吧！");$(".tac").html("<a href="+response.emailLink+" target='_blank'>查看邮件</a>");}}else{$("#nick_name_tip").html('昵称修改失败');$("#nick_name_tip").css("display","inline");}});}},check_email_three_info:function(){custId=$("#cust_id").val();username=$("#username").val();tel=$("#tel").val();password=$("#userPassword").val();username=username.replace(/^\s+|\s+$/g,"");tel=tel.replace(/^\s+|\s+$/g,"");if((username==null&&tel==null)||(username.length<1&&tel.length<1)){$("#user-tip").removeClass("err");$("#user-tip .input-tip-inner").html('<span>5-20个英文字母、数字或下划线,必须为英文字母开头</span>');return;}
usercenter_check.check_username();if(tel!=''){usercenter_check.check_tel2();telFlag=$("#sub_tel").val();if(telFlag==1){telFlag=true;}else{telFlag=false;}}
nameFlag=$("#sub_username").val();if(nameFlag==1){nameFlag=true;checkFlag=true;}else{nameFlag=false;checkFlag=false;}
if(tel!=''){if(telFlag){checkFlag=true;}else{checkFlag=false;}}
if(checkFlag){url="/u/register/addEmailUserInfo";if(tel!=''){var inputData={"username":username,"tel":tel,"custId":custId,"password":password}}else{var inputData={"username":username,"custId":custId,"password":password}}
$.post(url,inputData,function(data){response=eval("("+data+")");if(response.success){if(response.tel==null){$("#email_submit_info").html('昵称修改成功');$("#email_submit_info").css("display","inline");}else{$(".num").html(tel);$(".check_email_web").show();}}else{$("#email_submit_info").html('昵称修改失败');$("#email_submit_info").css("display","inline");}});}},phone_back_form:function(){tel=$("#tel").val();hid_pwd=$("#passowrd").val();hid_tel=$("#tel").val();hid_info=$("#travel-info").val();$("#hid_tel").attr("value",hid_tel);$("#hid_pwd").attr("value",hid_pwd);$("#hid_info").attr("value",hid_info);$("#type").attr("value","back");$("#registerFrm").attr("action","/u/register/phoneBackForm");$("#registerFrm").submit();},go_back:function(){$("#registerFrm").submit();},send_email_again:function(){url="/u/register/sendSystemAuthEmail";email=$("#email").val();var inputData={"email":email};$.post(url,inputData,function(data){response=eval("("+data+")");if(response.success){if(response.email==''){window.location="/";}else{$(".check_email_web").show();$("#email_info").html("一封确认邮件已经发送您的邮箱"+response.email+"<br/>"+"点击确认链接即可登录，快去查收吧！");$("#emailSendAgain").html("已发送成功");$("#emailSendAgain").unbind("click");$(".tac").html("<a href="+response.emailLink+" target='_blank'>查看邮件</a>");}}else{$("#emailSendAgain").html("发送失败，请重新验证");$("#emailSendAgain").bind("click",usercenter_check.send_email_again);alert("系统异常，请稍等5秒再试");}});},goto_register:function(){$("#registerFrm").attr("action","/u/register/phoneStepOne");$("#registerFrm").submit();},email_go_back:function(){$("#registerFrm").attr("action","/u/register/emailStepOne");$("#registerFrm").submit();},goto_activate_email:function(){emailLink=$("#emailLink").val();$("#activate_email_link").attr("target","_blank");window.location=emailLink;}};jQuery.fn.passwordStrength=function(options){document.getElementById("password").maxLength=16;var element=this;$(this).live('keyup',function(){var pass=$.trim($(this).val());var level_score=0;var rating=0;var numericTest=/[0-9]/;var lowerCaseAlphaTest=/[a-z]/;var upperCaseAlphaTest=/[A-Z]/;var symbolsTest=/[\\.,!@#$%^&*()}{:<>|]/;if(numericTest.test(pass)){level_score++;}
if(lowerCaseAlphaTest.test(pass)||upperCaseAlphaTest.test(pass)){level_score++;}
if(symbolsTest.test(pass)){level_score++;}
if(pass.length>0&&pass.length<6){rating=1;}
else if(level_score<3&&pass.length>6){rating=2;}else if(level_score=3&&pass.length>6){rating=3;}
if(rating==1){document.getElementById('pwd_s').value=1;$('#password-tip .input-tip-inner span').attr('class','');$('#password-tip .input-tip-inner span').addClass('reg_mes mes_pass_weak');}else if(rating==2){$('#password-tip .input-tip-inner span').attr('class','');$('#password-tip .input-tip-inner span').addClass('reg_mes mes_pass_in');document.getElementById('pwd_s').value=2;}else if(rating==3){$('#password-tip .input-tip-inner span').attr('class','');$('#password-tip .input-tip-inner span').addClass('reg_mes mes_pass_strong');document.getElementById('pwd_s').value=3;}});$(this).live('blur',function(){var psw=$("#password").val();psw=psw.replace(/(^\s*)/g,"");if(psw===''){$('#password-tip').removeClass('ok');$('#password-tip').addClass('err');$('#password-tip .input-tip-inner').html('<span>请输入密码</span>');;$('#password-tip .input-tip-inner').show();$('#password-strength').hide();$('#rating-msg').empty();return false;}else if(psw.length<6){$('#password-tip').removeClass('ok');$('#password-tip').addClass('err');$('#password-tip .input-tip-inner').html('<span>请输入6位以上的密码</span>');;$('#password-tip .input-tip-inner').show();$('#password-strength').hide();$('#rating-msg').empty();return false;}else if(psw.length>16){$('#password-tip').removeClass('ok');$('#password-tip').addClass('err');$('#password-tip .input-tip-inner').html('<span>请输入16位以下的密码</span>');;$('#password-tip .input-tip-inner').show();$('#password-strength').hide();$('#rating-msg').empty();return false;}
$("#passwordagain").bind("blur",usercenter_check.check_passwordagain);$("#passwordagain").bind("focus",usercenter_check.focus_passwordagain);});$(this).live('focus',function(){});return this;}