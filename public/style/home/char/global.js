var PROTOCOL=window.location.protocol=="http:"?"http:":"https:";if((window.location.protocol=="http:"||window.location.protocol=="https:")&&!window.FTA)document.write("<scri"+'pt type="text/javascript" src="'+PROTOCOL+'//img4.tuniucdn.com/w/j/20170328/common/tac.js,common/ga.js"></scri'+"pt>");if(/MicroMessenger/i.test(navigator.userAgent)){document.write("<scri"+'pt type="text/javascript" src="'+PROTOCOL+'//img2.tuniucdn.com/site/wap/js/new/weixin/wx-share.js"></scri'+"pt>")}if(/qq/i.test(navigator.userAgent)&&/android/i.test(navigator.userAgent)){document.write("<scr"+'ipt src="'+PROTOCOL+'//jsapi.qq.com/get?api=app.getGeoLocation"><'+"/script>")}!function(e,t){var i={isWeApp:false,weApp:{id:"",name:""},hideBothPConfig:["27187","34912","35925"],hideDownloadPConfig:["32890","33083"],noHeader:function(){return this.isApp||this.isWeApp||false},init:function(){this._initConstant();this._initEvironment();this._initAppCookie();this._hideAppHeader();this._initRetina();this._initAutoGPS();this._initUserGPS();this._initAppLinks();this._initTelAndP()},_initConstant:function(){this.USER_GPS="userGPS";this.AUTO_GPS="autoGPS";this.DEFAULT_CITY_INFO={name:"上海",code:2500,letter:"sh",isDefault:true};this.LT="lastAlertTime";this.AI=108e5},_initAppCookie:function(){var t=decodeURIComponent(e.location.hash.slice(1));var i=t.match(/deviceType=\d+/);if(i&&i[0]){document.cookie=i[0]+";path=/;domain=tuniu.com"}this.isApp=document.cookie.indexOf("deviceType")!=-1||!!localStorage.getItem("zipLocation");this.isFinanceApp=function(){var e=document.cookie.match(new RegExp("(^| )clientType=([^;]*)(;|$)"));if(e&&e[2]){if(",50001,50004,".indexOf(","+e[2]+",")!=-1){return true}}return false}();this.isHybrid=e.location.protocol.indexOf("http")==-1;if(this.isApp&&document.documentElement){document.documentElement.classList.add("app")}if(localStorage.getItem("appVersion")){this.AppVersion=localStorage.getItem("appVersion")}else{var a=document.cookie.match(/appVersion=([\.|\d]+)/);if(a&&a[1]){this.AppVersion=a[1]}else{this.AppVersion=null}}},_getWeAppNameById:function(e){switch(e){case"wx340329c7ee375a33":return"tuniu";break;default:return"";break}},_initWeAppInfo:function(){var e="";if(sessionStorage.M_GLOBAL_WEAPP_ID){e=sessionStorage.M_GLOBAL_WEAPP_ID}else{e=this._getParamsFromURL("appid")||"";if(e){sessionStorage.M_GLOBAL_WEAPP_ID=e}}this.weApp.id=e;this.weApp.name=this._getWeAppNameById(e)},_initWeAppCookie:function(){var t=this;var i="miniprogram";this._initWeAppInfo();if(this.weApp.id!=""){this.isWeApp=true;this._setEvironment(i)}else{function a(a){if(e.__wxjs_environment&&e.__wxjs_environment==="miniprogram"){t.isWeApp=true;t._setEvironment(i);a||t._hideAppHeader()}else{t.isWeApp=false;t._setEvironment("weixin")}}if(!e.WeixinJSBridge||!WeixinJSBridge.invoke){document.addEventListener("WeixinJSBridgeReady",a,false)}else{a(true)}}},isEvironment:function(e){return document.cookie.indexOf("tuniu_webview_env="+e)>-1},_setEvironment:function(e,t){if(!t){var i=new Date;if(e===null){i.setDate(i.getDate()-1)}else{i.setDate(i.getDate()+15)}document.cookie="tuniu_webview_env="+e+";path=/;domain=tuniu.com;expires="+i.toUTCString()}},_initEvironment:function(){this._initAppCookie();this._initWeAppCookie()},_hideAppHeader:function(){if(i.noHeader()){var e=document.getElementsByTagName("header")[0];if(e){e.style.display="none"}var t=document.getElementById("J_appDownloadRenderBox");if(t){t.style.display="none"}var a=document.getElementById("index");if(a){a.style.paddingTop="0px"}var n=document.getElementById("content");if(n){n.style.paddingTop="0px"}var o=document.querySelector(".wrapper");if(o){o.style.marginTop="0px";o.style.paddingTop="0px"}var r=document.querySelector(".main_count");if(r){r.style.paddingTop=0}var s=document.querySelector(".app-header");if(s){s.style.display="none"}}else{var c=this.getPFromURL()||this.getPFromCookie()||200;if(this.hideBothPConfig.indexOf(c)>-1||this.hideDownloadPConfig.indexOf(c)>-1){var e=document.getElementById("J_header");var d=document.getElementById("J_appDownloadRenderBox");if(e){this.hideBothPConfig.indexOf(c)>-1?e.style.display="none":"";d.style.display="none"}}}},_initRetina:function(){if(e.devicePixelRatio&&e.devicePixelRatio>=2){var t=document.createElement("div");t.style.border=".5px solid transparent";document.body.appendChild(t);if(t.offsetHeight==1){document.querySelector("html").classList.add("hairlines")}document.body.removeChild(t)}},_initUserGPS:function(){var e=document.getElementById(this.USER_GPS);var t=function(e){return typeof e=="string"&&e.indexOf("code")>-1&&e.indexOf("name")>-1&&e.indexOf("letter")>-1};if(e&&e.value&&t(e.value)){var i=JSON.parse(e.value);var a=location.hash.indexOf("autoJump")==-1;this.setUserGps(i,a)}else{var n=localStorage.getItem(this.USER_GPS);t(n)?this.userGPS=n==null?n:JSON.parse(n):localStorage.removeItem(this.USER_GPS)}},_initAutoGPS:function(){var e=localStorage.getItem(this.AUTO_GPS);this.location=e==null?e:JSON.parse(e)},_initAppLinks:function(){var t=this;document.body.addEventListener("click",function(i){var a=i.target;var n=[];while(a&&a.nodeName!="BODY"){if(a.nodeName=="A"){n.push(a)}a=a.parentNode}for(var o=0;o<n.length;o++){var r=n[o].getAttribute("data-appurl")||"";var s=n[o].getAttribute("data-pst")||"";var c=n[o].getAttribute("href");var d;r=r.trim();if(r.indexOf("tuniuapp://")==0&&t.isApp&&!t.isFinanceApp){e.location.href=r;i.preventDefault();break}if(s){var u=c.split("#");if(u[0].indexOf("?")==-1){d=u[0]+"?"+s+"#"+u.slice(1).join("#")}else{d=u[0]+"&"+s+"#"+u.slice(1).join("#")}e.location.href=d;i.preventDefault();break}}},false)},_getParamsFromURL:function(t){var i=e.location.hash.slice(1).split("&").concat(e.location.search.slice(1).split("&"));var a={};for(var n=0;n<i.length;n++){var o=i[n].split("=");a[o[0]]=o[1]}if(t){return a[t]}else{return a}},getPFromURL:function(){return this._getParamsFromURL("p")},getPFromCookie:function(){var e=0;var t=document.cookie.match(/(^| )tuniu_partner=([^;]+)/);if(t&&t[2]){e=atob(decodeURIComponent(t[2])).replace(/^([^,]+),.+$/,"$1")}return e},getHost:function(){var t=e.location.host;var i=e.location.protocol;return i+"//"+t.replace(/^dynamic\./,"")},replaceProtocol:function(e){return e?e.replace(/^http:|^https:/g,PROTOCOL):""},convertProtocol:function(e){var t=e,i=JSON.stringify(e),a;if(location.protocol=="https:"){a=i.replace(/http:/g,"https:");t=JSON.parse(a)}return t},_initTelAndP:function(){var e=this;var i=e.getHost();function a(e){return document.getElementById(e)}e.p=e.getPFromURL();var n={partner:{p:e.getPFromURL()||"",referer:encodeURIComponent(document.referrer)}};if(t&&t.phone){n.phone=""}var o=new XMLHttpRequest;o.open("GET",i+"/m2015/global/index?data="+encodeURIComponent(JSON.stringify(n)));o.onreadystatechange=function(){if(o.readyState==4&&o.status==200){var t=JSON.parse(o.responseText);if(t.success){e.gaStatus.p=true;e.tryTa();t=t.data;var i=t.phone;if(i){localStorage.setItem("400phone",i);var n=new Date;n.setDate(n.getDate()+15);document.cookie="400phone="+i+";path=/;domain=tuniu.com;expires="+n.toUTCString();e.phone=i;for(var r=0;r<e.phoneListeners.length;r++){e.phoneListeners[r](e.phone)}}if(i&&a("telConsult")){a("telConsult").href="tel:"+i}}}};o.withCredentials=true;o.send(null)},_startTa:function(){if(typeof _tat=="undefined"){return}var e=_tat.getTracker();e.setPageName(this.gaStatus.taPageName);e.addOrganic("www.so.com","u");e.addOrganic("www.so.com","q");e.addOrganic("so.360.cn","u");e.addOrganic("so.360.cn","q");e.addOrganic("baidu.com","w");e.addOrganic("baidu.com","q1");e.addOrganic("baidu.com","q2");e.addOrganic("baidu.com","q3");e.addOrganic("baidu.com","q4");e.addOrganic("baidu.com","q5");e.addOrganic("baidu.com","q6");e.addOrganic("m.so.com","q");e.addOrganic("m.sogou.com","keyword");e.addOrganic("wap.sogou.com","keyword");e.addOrganic("wap.soso.com","key");e.addOrganic("m.yisou.com","q");e.addOrganic("m.sm.cn","q");e.addOrganic("sm.cn","q");e.trackPageView();e.enableLinkTracking()},tryTa:function(){var e=this;if(e.gaStatus.p&&e.gaStatus.taPageName){e._startTa()}},_startGa:function(){if(typeof _gaq=="undefined"){return}_gaq=_gaq||[];var e=e||{isWebview:(document.cookie.indexOf("deviceType")>-1)+""};var t=this.gaStatus.gaPageName;_gaq.push(["_setAllowHash",false]);_gaq.push(["_setAllowAnchor",true]);_gaq.push(["_addOrganic","baidu","wd"]);_gaq.push(["_addOrganic","baidu","word"]);_gaq.push(["_addOrganic","google","q"]);_gaq.push(["_addOrganic","118114","kw"]);_gaq.push(["_addOrganic","bing","q"]);_gaq.push(["_addOrganic","soso","w"]);_gaq.push(["_addOrganic","youdao","q"]);_gaq.push(["_addOrganic","sogou","query"]);_gaq.push(["_addOrganic","360","q"]);_gaq.push(["_addOrganic","baidu","w"]);_gaq.push(["_addOrganic","baidu","q1"]);_gaq.push(["_addOrganic","baidu","q2"]);_gaq.push(["_addOrganic","baidu","q3"]);_gaq.push(["_addOrganic","baidu","q4"]);_gaq.push(["_addOrganic","baidu","q5"]);_gaq.push(["_addOrganic","baidu","q6"]);_gaq.push(["_addOrganic","baidu","q6"]);_gaq.push(["_addOrganic","m.so.com","q"]);_gaq.push(["_addOrganic","m.sogou.com","keyword"]);_gaq.push(["_addOrganic","wap.sogou.com","keyword"]);_gaq.push(["_addOrganic","wap.soso.com","key"]);_gaq.push(["_addOrganic","m.yisou.com","q"]);_gaq.push(["_addOrganic","m.sm.cn","q"]);_gaq.push(["_addOrganic","sm.cn","q"]);_gaq.push(["_setDomainName","tuniu.com"]);_gaq.push(["_setCustomVar",5,"UIWebview",e.isWebview,3]);_gaq.push(["_setAccount","UA-4782081-5"]);_gaq.push(["_trackPageview",t])},tryGa:function(){var e=this;if(e.gaStatus.loaded&&e.gaStatus.gaPageName){e._startGa()}},versionCmp:function(e,t){if(!e||!t){return-1}if(e==t)return 0;var i=e.split("."),a=t.split(".");return i[0]==a[0]?this.versionCmp(i.slice(1).join("."),a.slice(1).join(".")):+i[0]>+a[0]?1:-1},emptyAutoGps:function(){return!localStorage.getItem(this.AUTO_GPS)},setAutoGps:function(e){this.autoGPS=e;localStorage.setItem(this.AUTO_GPS,JSON.stringify(e));if(i.autoGPSListeners){for(var t=0;t<i.autoGPSListeners.length;t++){i.autoGPSListeners[t](e)}}},addAutoGPSListener:function(e){this.autoGPSListeners.push(e);if(this.autoGPS){e(this.autoGPS)}},setUserGps:function(t,i){var a=typeof t==="string"?JSON.parse(t):t;if(i){this.userGPS=a;localStorage.setItem(this.USER_GPS,JSON.stringify(a));var n=new Date;n.setDate(n.getDate()+14);document.cookie="tuniuuser_citycode="+e.btoa(a.code)+";path=/;domain=tuniu.com;expires="+n.toUTCString()}else{var o=localStorage.getItem(this.USER_GPS);this.userGPS=o==null?o:JSON.parse(o)}for(var r=0;r<this.userGPSListeners.length;r++){this.userGPSListeners[r](a)}},_setLastAlertTime:function(){localStorage.setItem(this.LT,(new Date).getTime())},afterGetPosition:function(e,i){if(!e){return}e.lat=i.lat||"";e.lng=i.lng||"";this.lastLocation=this.location;var a=this.location=e,n=!a.code?null:{name:a.name,code:a.code,letter:a.letter},o=!a.belongCityCode?null:{name:a.belongCityName,code:a.belongCityCode,letter:a.belongCityLetter},r=o||n;if(r==null){if(this.emptyAutoGps()){this.setAutoGps(this.DEFAULT_CITY_INFO);return this.DEFAULT_CITY_INFO}else{return}}r.lat=i.lat||"";r.lng=i.lng||"";this.setAutoGps(r);this.storedMc=o;this.storedPc=n;if(t.jumpWhenLocationOver){this.showHitByPosition(this._reloadCity)}else{this.checkCityChanged()}return r},checkCityChanged:function(e){var i=this.cityChangedListens;e&&i.push(e);if(t.hasJumpCallback&&i.length>0){this.showHitByPosition(function(e){for(var t=0;t<i.length;t++){i[t](e)}})}},showHitByPosition:function(e,i){i=i||function(){};var a=this.storedMc;var n=this.storedPc;var o=this;if(null==n||this.hasPosition){return}this.hasPosition=true;var r=function(){var e=localStorage.getItem(o.LT);return e&&new Date-new Date(+e)<o.AI};if(r()&&this.userGPS!=null){return}var s=this.userGPS||this.lastLocation;var c=a||n;if(null==s){if(c.name!="上海"){e(c,t.jumpWhenLocationOver?"#autoJump":0)}return}var d=function(e,t){return null!=e&&null!=t&&e.name===t.name&&e.code===t.code&&e.letter==t.letter};if(d(c,s)){return}var u=function(e){o.setUserGps(e,true);o._setLastAlertTime()};if(d(c,n)){var l="检测到您所在的城市发生了变化，当前城市为"+c.name+"，是否切换到当前城市？"}else{l="根据您当前的位置"+n.name+"，我们向您推荐较近的可预订城市"+c.name+"，是否切换？"}o._showDialog(l,function(){u(c);e.call(o,c)},function(){u(s);i.call(o,s)})},_reloadCity:function(e,i){if(!e||!e.letter){return}var a=t.jumpWhenLocationOver;a=a.replace(/\{cityLetter\}/g,e.letter).replace(/\{cityCode\}/g,e.code).replace(/\{cityName\}/g,e.name)+(i||"");history.replaceState(null,null,a);location.reload()},_showDialog:function(e,t,i){var a="切换城市提示";function n(e){var t=document.createElement("div");t.style.cssText=e;document.body.appendChild(t);return t}var o=n("position:fixed;top:0;width: 100%;height: 100%;background-color:rgba(0,0,0,0.56);z-index: 999;");var r=n("border-radius:8px;position: fixed;left: 13%;top:30%;width: 74%;z-index: 999;background-color:rgba(256,256,256,1);text-align:center;");r.innerHTML='<div style="color:#333;padding-top:7.4%;font-weight:bold;font-size: 1.8rem;text-align: center;">'+a+'</div>                            <div style="padding:7.4% 5.5%;font-size:1.5rem;color:#666;">                                <span>'+e+'</span>                            </div>                            <div style="border-top: 1px solid rgb(212,212,212);font-size:1.8rem;color:#037AFF;line-height: 2.222;">                                <div class="J-ok" style="width: 50%;float: left;">切换</div>                                <div class="J-cancel" style="width: 49%;border-left: 1px solid rgb(212,212,212);float: right;">取消</div>                            </div>';r.addEventListener("click",function(e){var a=e.target.className;var n=["J-ok","J-cancel"].indexOf(a);if(n==-1){return}r.style.display=o.style.display="none";n?i():t()})},initWebviewBridge:function(){if(this.webviewBridgeInited){return}WebViewJavascriptBridge.init(function(e,t){});this.webviewBridgeInited=true},webviewBridgeReady:function(t){var i=this;if(e.WebViewJavascriptBridge){i.initWebviewBridge();t(WebViewJavascriptBridge)}else{document.addEventListener("WebViewJavascriptBridgeReady",function(){i.initWebviewBridge();t(WebViewJavascriptBridge)},false)}},getAppStatusBarHeight:function(){if(i.isApp){var e=document.cookie.match(/full_screen_top_height=([\d]+)/);if(e&&e[1]){var t=parseInt(e[1]);if(t==64){return 20}if(t==88){return 44}return t||0}else{if(/iphone|ipad/i.test(navigator.userAgent)){return 20}}}return 0},gaStatus:{p:"",taPageName:"",gaPageName:"",loaded:false},phoneListeners:[],userGPSListeners:[],autoGPSListeners:[],cityChangedListens:[]};i.init();function a(a,n,o,r){var s;function c(e){if(!a.trim()){i.gaStatus.taPageName=n;i.tryTa()}else{if(e){i.gaStatus.taPageName=a.replace("{city}",e);i.tryTa()}}if(!o.trim()){i.gaStatus.gaPageName=r;i.tryGa()}else{if(e){i.gaStatus.gaPageName=r.replace("{city}",e);i.tryGa()}}}e.addEventListener("load",function(){i.gaStatus.loaded=true;i.tryGa();if(e.criteo_q){u()}},false);if(i.versionCmp(i.AppVersion,"7.1.1")>=0){i.webviewBridgeReady(function(e){e.callHandler("getGPS",{},function(e){s=e.orderCityName||e.name;c(s)})});return}var d=localStorage.getItem(i.USER_GPS)||localStorage.getItem(i.AUTO_GPS)||localStorage.getItem("zipLocation");if(d){s=JSON.parse(d).name||JSON.parse(d).cityName||"上海";c(s)}function u(){var e=document.createElement("script");e.type="text/javascript";e.src="//static.criteo.net/js/ld/ld.js";document.querySelector("head").appendChild(e)}function l(e){e=e||"";var t=new XMLHttpRequest;t.open("GET","/m2015/global/index?data="+encodeURIComponent(JSON.stringify({location:e||""})));t.onreadystatechange=function(){if(t.readyState==4&&t.status==200){var a=JSON.parse(t.responseText);if(a.success){a=a.data;var n=i.afterGetPosition(a.location,e);if(!s&&n&&n.name){try{c(n.name)}catch(e){console.debug(e)}}}}};t.withCredentials=true;t.send(null)}if(t&&t.location){var p=localStorage.getItem("zipLocation");if((t.justLocationIP||/19007/.test(document.cookie))&&e.G&&e.G.isApp){l();return}if(i.isApp&&p&&e.G&&e.G.isHybrid){p=JSON.parse(p);if(p.lat&&p.lng){l({lat:p.lat,lng:p.lng});return}}var g=setTimeout(function(){l();g=null},5e3);var h=function(e){if(g){clearTimeout(g);l(e)}};if(e.browser&&/qq/i.test(navigator.userAgent)&&/android/i.test(navigator.userAgent)){browser.app.getGeoLocation(function(e){h({lat:e.latitude,lng:e.longitude})},function(){h()})}else{navigator.geolocation.getCurrentPosition(function(e){h({lat:e.coords.latitude,lng:e.coords.longitude})},function(e){h()})}}else{l();return}}e.COLLECT=a;e.G=i}(window,window.globalAjaxControl);window.app_url=function(e){if(/^api\/self/.test(e)){return"https://m.tuniu.com/"+e.replace(/^api\/self/,"mapi/package")}else{return"https://m.tuniu.com/h5/"+e}};